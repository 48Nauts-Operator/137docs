
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>autodoc src backend tests conftest py 2025 06 01T06 30 52 - 137docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pytest-configuration-and-fixtures-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="137docs" class="md-header__button md-logo" aria-label="137docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            137docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              autodoc src backend tests conftest py 2025 06 01T06 30 52
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../placeholder/" class="md-tabs__link">
          
  
  
  AI Docs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="137docs" class="md-nav__button md-logo" aria-label="137docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    137docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AI Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            AI Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../placeholder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Placeholder
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-database" class="md-nav__link">
    <span class="md-ellipsis">
      Test Database
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      Fixtures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fixtures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-management" class="md-nav__link">
    <span class="md-ellipsis">
      Session Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event_loop" class="md-nav__link">
    <span class="md-ellipsis">
      event_loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_engine" class="md-nav__link">
    <span class="md-ellipsis">
      test_engine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_session" class="md-nav__link">
    <span class="md-ellipsis">
      test_session
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-client" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Client
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test_client" class="md-nav__link">
    <span class="md-ellipsis">
      test_client
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mock-data-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Mock Data and Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Mock Data and Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mock_llm_config" class="md-nav__link">
    <span class="md-ellipsis">
      mock_llm_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample_document_text" class="md-nav__link">
    <span class="md-ellipsis">
      sample_document_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#temp_file" class="md-nav__link">
    <span class="md-ellipsis">
      temp_file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Dependencies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Required Packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Patterns
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<!--
This documentation was auto-generated by Claude on 2025-06-01T06-30-52.
Source file: ./src/backend/tests/conftest.py
-->

<h1 id="pytest-configuration-and-fixtures-documentation">Pytest Configuration and Fixtures Documentation<a class="headerlink" href="#pytest-configuration-and-fixtures-documentation" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>This module provides comprehensive pytest configuration and fixtures for testing the 137Docs backend application. It sets up test database connections, HTTP clients, and mock data to support isolated and reliable testing.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<h3 id="test-database">Test Database<a class="headerlink" href="#test-database" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Database URL</strong>: <code>sqlite+aiosqlite:///:memory:</code></li>
<li><strong>Type</strong>: In-memory SQLite database for fast, isolated tests</li>
<li><strong>Engine</strong>: Async SQLAlchemy engine with echo disabled</li>
</ul>
<h2 id="fixtures">Fixtures<a class="headerlink" href="#fixtures" title="Permanent link">&para;</a></h2>
<h3 id="session-management">Session Management<a class="headerlink" href="#session-management" title="Permanent link">&para;</a></h3>
<h4 id="event_loop"><code>event_loop</code><a class="headerlink" href="#event_loop" title="Permanent link">&para;</a></h4>
<p><strong>Scope</strong>: <code>session</code></p>
<p>Creates and manages the default event loop for the entire test session.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">event_loop</span><span class="p">():</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns</strong>: <code>asyncio.AbstractEventLoop</code></p>
<p><strong>Lifecycle</strong>:
- Creates new event loop at session start
- Yields loop for test execution
- Closes loop after session completion</p>
<hr />
<h4 id="test_engine"><code>test_engine</code><a class="headerlink" href="#test_engine" title="Permanent link">&para;</a></h4>
<p><strong>Scope</strong>: <code>session</code></p>
<p>Provides an async SQLAlchemy engine configured for testing.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_engine</span><span class="p">():</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns</strong>: <code>sqlalchemy.ext.asyncio.AsyncEngine</code></p>
<p><strong>Features</strong>:
- Uses in-memory SQLite for speed and isolation
- Automatically creates all database tables
- Properly disposes of engine after tests</p>
<p><strong>Configuration</strong>:
- <code>echo=False</code>: Disables SQL query logging
- <code>future=True</code>: Enables SQLAlchemy 2.0 style</p>
<hr />
<h4 id="test_session"><code>test_session</code><a class="headerlink" href="#test_session" title="Permanent link">&para;</a></h4>
<p><strong>Scope</strong>: <code>function</code></p>
<p>Creates a fresh database session for each test function.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_session</span><span class="p">(</span><span class="n">test_engine</span><span class="p">):</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns</strong>: <code>sqlalchemy.ext.asyncio.AsyncSession</code></p>
<p><strong>Dependencies</strong>: <code>test_engine</code></p>
<p><strong>Isolation Strategy</strong>:
- Creates new session per test
- Rolls back all changes after test completion
- Ensures test isolation and clean state</p>
<hr />
<h3 id="http-client">HTTP Client<a class="headerlink" href="#http-client" title="Permanent link">&para;</a></h3>
<h4 id="test_client"><code>test_client</code><a class="headerlink" href="#test_client" title="Permanent link">&para;</a></h4>
<p><strong>Scope</strong>: <code>function</code></p>
<p>Provides an HTTP client for testing API endpoints with database dependency injection.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_client</span><span class="p">(</span><span class="n">test_session</span><span class="p">):</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns</strong>: <code>httpx.AsyncClient</code></p>
<p><strong>Dependencies</strong>: <code>test_session</code></p>
<p><strong>Features</strong>:
- Overrides application database dependency
- Base URL: <code>http://test</code>
- Automatic cleanup of dependency overrides
- Uses test database session for all requests</p>
<p><strong>Usage Example</strong>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_api_endpoint</span><span class="p">(</span><span class="n">test_client</span><span class="p">):</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">test_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/api/documents&quot;</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</code></pre></div></td></tr></table></div></p>
<hr />
<h3 id="mock-data-and-configuration">Mock Data and Configuration<a class="headerlink" href="#mock-data-and-configuration" title="Permanent link">&para;</a></h3>
<h4 id="mock_llm_config"><code>mock_llm_config</code><a class="headerlink" href="#mock_llm_config" title="Permanent link">&para;</a></h4>
<p><strong>Scope</strong>: <code>function</code></p>
<p>Provides mock LLM (Large Language Model) configuration for testing AI features.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">mock_llm_config</span><span class="p">():</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns</strong>: <code>dict</code></p>
<p><strong>Configuration Fields</strong>:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>provider</code></td>
<td><code>'local'</code></td>
<td>LLM provider type</td>
</tr>
<tr>
<td><code>api_url</code></td>
<td><code>'http://localhost:11434'</code></td>
<td>Local API endpoint</td>
</tr>
<tr>
<td><code>api_key</code></td>
<td><code>''</code></td>
<td>Empty for local provider</td>
</tr>
<tr>
<td><code>model_tagger</code></td>
<td><code>'phi3'</code></td>
<td>Model for document tagging</td>
</tr>
<tr>
<td><code>model_enricher</code></td>
<td><code>'llama3'</code></td>
<td>Model for content enrichment</td>
</tr>
<tr>
<td><code>model_analytics</code></td>
<td><code>'llama3'</code></td>
<td>Model for analytics</td>
</tr>
<tr>
<td><code>model_responder</code></td>
<td><code>'gpt-4'</code></td>
<td>Model for responses</td>
</tr>
<tr>
<td><code>enabled</code></td>
<td><code>True</code></td>
<td>LLM features enabled</td>
</tr>
<tr>
<td><code>auto_tagging</code></td>
<td><code>True</code></td>
<td>Automatic tagging enabled</td>
</tr>
<tr>
<td><code>auto_enrichment</code></td>
<td><code>True</code></td>
<td>Automatic enrichment enabled</td>
</tr>
<tr>
<td><code>external_enrichment</code></td>
<td><code>False</code></td>
<td>External enrichment disabled</td>
</tr>
<tr>
<td><code>max_retries</code></td>
<td><code>3</code></td>
<td>Maximum retry attempts</td>
</tr>
<tr>
<td><code>retry_delay</code></td>
<td><code>300</code></td>
<td>Delay between retries (seconds)</td>
</tr>
<tr>
<td><code>batch_size</code></td>
<td><code>5</code></td>
<td>Processing batch size</td>
</tr>
<tr>
<td><code>concurrent_tasks</code></td>
<td><code>2</code></td>
<td>Maximum concurrent tasks</td>
</tr>
<tr>
<td><code>cache_responses</code></td>
<td><code>True</code></td>
<td>Response caching enabled</td>
</tr>
<tr>
<td><code>min_confidence_tagging</code></td>
<td><code>0.7</code></td>
<td>Minimum confidence for tagging</td>
</tr>
<tr>
<td><code>min_confidence_entity</code></td>
<td><code>0.8</code></td>
<td>Minimum confidence for entities</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="sample_document_text"><code>sample_document_text</code><a class="headerlink" href="#sample_document_text" title="Permanent link">&para;</a></h4>
<p><strong>Scope</strong>: <code>function</code></p>
<p>Provides realistic sample document text for testing document processing features.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">sample_document_text</span><span class="p">():</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns</strong>: <code>str</code></p>
<p><strong>Content</strong>: Sample invoice document containing:
- Invoice header and number
- Sender and recipient addresses
- Dates and payment terms
- Line items with pricing
- Tax calculations</p>
<p><strong>Usage Example</strong>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_document_parsing</span><span class="p">(</span><span class="n">sample_document_text</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">parse_document</span><span class="p">(</span><span class="n">sample_document_text</span><span class="p">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="k">assert</span> <span class="s2">&quot;INV-2024-001&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">invoice_number</span>
</code></pre></div></td></tr></table></div></p>
<hr />
<h4 id="temp_file"><code>temp_file</code><a class="headerlink" href="#temp_file" title="Permanent link">&para;</a></h4>
<p><strong>Scope</strong>: <code>function</code></p>
<p>Creates a temporary file for testing file operations.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">temp_file</span><span class="p">():</span>
</code></pre></div></td></tr></table></div>
<p><strong>Returns</strong>: <code>str</code> (file path)</p>
<p><strong>Features</strong>:
- Creates temporary file with <code>.txt</code> extension
- Pre-populated with test content: <code>"Test document content"</code>
- Automatic cleanup after test completion
- Safe deletion with existence check</p>
<p><strong>Usage Example</strong>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_file_upload</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="n">test_client</span><span class="p">):</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">test_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/upload&quot;</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">})</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="dependencies">Dependencies<a class="headerlink" href="#dependencies" title="Permanent link">&para;</a></h2>
<h3 id="required-packages">Required Packages<a class="headerlink" href="#required-packages" title="Permanent link">&para;</a></h3>
<ul>
<li><code>pytest</code>: Testing framework</li>
<li><code>pytest-asyncio</code>: Async testing support</li>
<li><code>sqlalchemy</code>: Database ORM</li>
<li><code>httpx</code>: HTTP client for API testing</li>
<li><code>aiosqlite</code>: Async SQLite driver</li>
</ul>
<h3 id="internal-dependencies">Internal Dependencies<a class="headerlink" href="#internal-dependencies" title="Permanent link">&para;</a></h3>
<ul>
<li><code>app.main.app</code>: FastAPI application instance</li>
<li><code>app.database.get_db</code>: Database dependency</li>
<li><code>tests.test_models.Base</code>: Test database models</li>
</ul>
<h2 id="usage-patterns">Usage Patterns<a class="headerlink" href="#usage-patterns" title="Permanent link">&para;</a></h2>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.top", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>