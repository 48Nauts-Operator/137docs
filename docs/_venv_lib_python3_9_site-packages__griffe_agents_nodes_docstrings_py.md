<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Docstring Extraction Utilities

## Overview

This module provides utilities for extracting docstrings from Abstract Syntax Tree (AST) nodes in Python code. It's designed to parse Python source code and retrieve documentation strings along with their location information.

## Purpose

The primary purpose of this module is to:
- Extract docstrings from various types of AST nodes
- Provide line number information for extracted docstrings
- Support both strict and flexible docstring extraction modes

## Functions

### `get_docstring()`

```python
def get_docstring(
    node: ast.AST,
    *,
    strict: bool = False,
) -> tuple[str | None, int | None, int | None]:
```

Extracts a docstring from an AST node and returns its content along with location information.

#### Parameters

- **`node`** (`ast.AST`): The AST node to extract the docstring from
- **`strict`** (`bool`, optional): Whether to use strict extraction mode
  - `False` (default): Searches the body of nodes like functions, classes, and modules
  - `True`: Only extracts from direct expression nodes

#### Returns

A tuple containing three elements:
- **`str | None`**: The docstring content, or `None` if no docstring found
- **`int | None`**: Starting line number of the docstring, or `None` if not found
- **`int | None`**: Ending line number of the docstring, or `None` if not found

#### Behavior

The function handles two main scenarios:

1. **Direct Expression Nodes** (`ast.Expr`):
   - Extracts docstrings from expression nodes directly

2. **Container Nodes** (when `strict=False`):
   - Searches the first statement in the node's body
   - Applies to functions, classes, modules, etc.

#### Example Usage

```python
import ast

# Parse some Python code
code = '''
def example_function():
    """This is a docstring."""
    pass
'''

tree = ast.parse(code)
function_node = tree.body[0]

# Extract docstring
docstring, start_line, end_line = get_docstring(function_node)
print(f"Docstring: {docstring}")
print(f"Lines: {start_line}-{end_line}")
```

## Implementation Notes

### Technical Details

- Uses Python's `ast` module for AST manipulation
- Validates that extracted content is actually a string constant
- Handles both single-line and multi-line docstrings
- Returns line number information for precise source location

### Type Safety

- Uses type annotations for better IDE support and documentation
- Includes proper type checking for AST node types
- Uses `# type: ignore` comments where necessary for dynamic attribute access

## Suggestions and Improvements

### Current Limitations

- **TODO Comment**: The code mentions a possible optimization using a type map, which could improve performance for large codebases

### Potential Enhancements

1. **Performance Optimization**: Implement the suggested type map for faster node type checking
2. **Error Handling**: Consider adding more robust error handling for malformed AST nodes
3. **Documentation**: Could be extended to handle other forms of documentation (e.g., type annotations)
4. **Validation**: Add validation for edge cases with nested expressions

### Usage Recommendations

- Use `strict=True` when you only want docstrings from direct expression nodes
- Use `strict=False` (default) for general docstring extraction from functions, classes, and modules
- Always check for `None` return values before using the extracted docstring
- Consider the line number information for source code analysis tools

## Dependencies

- **Python 3.7+**: Uses `from __future__ import annotations` for forward references
- **Standard Library**: Only uses Python's built-in `ast` module