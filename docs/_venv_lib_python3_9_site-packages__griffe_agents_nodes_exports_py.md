<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Export Utilities Module

This module provides utilities for extracting and parsing `__all__` assignments from Python AST (Abstract Syntax Tree) nodes. It's part of the Griffe library and is used to determine which names are publicly exported from Python modules.

## Purpose

The module analyzes Python code's `__all__` declarations to extract the list of publicly exported names. It handles various forms of `__all__` assignments, including:
- Simple lists: `__all__ = ["foo", "bar"]`
- Concatenated lists: `__all__ = ["foo"] + ["bar"]`
- Complex expressions with names and attributes

## Key Components

### Classes

#### `ExportedName` (Deprecated)

```python
@dataclass
class ExportedName:
    name: str        # The exported name
    parent: Module   # The parent module
```

**⚠️ Deprecation Notice**: This class is deprecated and will be removed. Use `ExprName` instances instead.

### Main Functions

#### `get__all__(node, parent)`

```python
def get__all__(node: ast.Assign | ast.AnnAssign | ast.AugAssign, parent: Module) -> list[str | ExprName]:
```

Extracts values declared in `__all__` assignments.

- **Parameters:**
  - `node`: The AST assignment node containing the `__all__` declaration
  - `parent`: The parent module for context
- **Returns:** List of exported names (strings or `ExprName` objects)

#### `safe_get__all__(node, parent, log_level)`

```python
def safe_get__all__(
    node: ast.Assign | ast.AnnAssign | ast.AugAssign,
    parent: Module,
    log_level: LogLevel = LogLevel.debug
) -> list[str | ExprName]:
```

Safe wrapper around `get__all__()` that handles exceptions gracefully.

- **Parameters:**
  - `node`: The `__all__` assignment node
  - `parent`: The parent module for name resolution
  - `log_level`: Logging level for error messages (default: debug)
- **Returns:** List of exported names, or empty list if extraction fails

## Internal Implementation

### Node Extraction Functions

The module includes specialized extraction functions for different AST node types:

- `_extract_attribute()`: Handles attribute access (e.g., `module.name`)
- `_extract_binop()`: Handles binary operations (e.g., list concatenation)
- `_extract_constant()`: Handles constant values (strings, numbers)
- `_extract_name()`: Handles simple names/identifiers
- `_extract_sequence()`: Handles lists, sets, and tuples
- `_extract_starred()`: Handles starred expressions (unpacking)

### Node Mapping

```python
_node_map: dict[type, Callable[[Any, Module], list[str | ExprName]]] = {
    ast.Attribute: _extract_attribute,
    ast.BinOp: _extract_binop,
    ast.Constant: _extract_constant,
    # ... additional mappings
}
```

## Usage Examples

```python
# Example __all__ declarations this module can handle:

# Simple list
__all__ = ["function1", "Class1"]

# Concatenated lists
__all__ = ["base"] + ["extended"]

# With variables
EXPORTS = ["item1", "item2"]
__all__ = EXPORTS + ["item3"]
```

## Notes and Suggestions

### Error Handling
- The `safe_get__all__()` function provides robust error handling with detailed logging
- Unsupported AST node types are logged with appropriate error messages
- File location information is included in error messages when available

### Best Practices
- Use `safe_get__all__()` for production code to avoid crashes on malformed `__all__` declarations
- The module handles complex expressions, but simple list declarations are most reliable
- Consider the deprecation of `ExportedName` when upgrading code

### Limitations
- Some complex dynamic `__all__` constructions may not be supported
- Runtime-computed `__all__` values cannot be statically analyzed

## Dependencies

- `ast`: Python's Abstract Syntax Tree module
- `_griffe.expressions.ExprName`: For representing resolvable names
- `_griffe.logger`: For logging extraction errors
- `_griffe.agents.nodes.values.get_value`: For extracting node values