<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# `__all__` Export Extraction Module

This module provides utilities for extracting and parsing `__all__` assignments in Python modules. It analyzes AST (Abstract Syntax Tree) nodes to identify exported names and handle various assignment patterns.

## Purpose

The module is designed to:
- Extract exported names from `__all__` variable assignments
- Handle complex assignment patterns (binary operations, sequences, attributes, etc.)
- Provide safe extraction with error handling and logging
- Support the Griffe documentation generation system

## Classes

### `ExportedName` (Deprecated)

```python
@dataclass
class ExportedName:
    name: str
    parent: Module
```

**⚠️ Deprecation Notice**: This class is deprecated and will be removed in a future version. Use `ExprName` instead.

- **Purpose**: Intermediate storage for exported names
- **Fields**:
  - `name`: The exported name as a string
  - `parent`: The parent module containing the export

## Main Functions

### `get__all__(node, parent)`

```python
def get__all__(node: ast.Assign | ast.AnnAssign | ast.AugAssign, parent: Module) -> list[str | ExprName]
```

Extracts values declared in `__all__` assignments.

- **Parameters**:
  - `node`: The AST assignment node to analyze
  - `parent`: The parent module for context
- **Returns**: List of exported names (strings or `ExprName` objects)
- **Note**: May raise exceptions for unsupported node types

### `safe_get__all__(node, parent, log_level)`

```python
def safe_get__all__(
    node: ast.Assign | ast.AnnAssign | ast.AugAssign,
    parent: Module,
    log_level: LogLevel = LogLevel.debug
) -> list[str | ExprName]
```

Safe wrapper around `get__all__()` with exception handling.

- **Parameters**:
  - `node`: The `__all__` assignment node
  - `parent`: The parent module for name resolution
  - `log_level`: Logging level for error messages (default: debug)
- **Returns**: List of extracted names, or empty list on failure
- **Features**:
  - Never raises exceptions
  - Logs detailed error messages with file location when possible
  - Handles both `KeyError` (unsupported nodes) and general exceptions

## Internal Implementation

### Supported AST Node Types

The module handles the following assignment patterns:

| Node Type | Handler Function | Purpose |
|-----------|------------------|---------|
| `ast.Attribute` | `_extract_attribute()` | Handle `module.name` patterns |
| `ast.BinOp` | `_extract_binop()` | Handle binary operations (e.g., list concatenation) |
| `ast.Constant` | `_extract_constant()` | Handle literal values |
| `ast.List/Set/Tuple` | `_extract_sequence()` | Handle sequence literals |
| `ast.Name` | `_extract_name()` | Handle simple variable names |
| `ast.Starred` | `_extract_starred()` | Handle unpacking operations |

### Core Extraction Logic

```python
def _extract(node: ast.AST, parent: Module) -> list[str | ExprName]:
    return _node_map[type(node)](node, parent)
```

The extraction uses a dispatch pattern with `_node_map` to route different AST node types to their appropriate handlers.

## Usage Examples

```python
# Simple list assignment
__all__ = ["function1", "Class1", "CONSTANT"]

# Binary operation (concatenation)
__all__ = BASE_EXPORTS + ["additional_export"]

# Tuple assignment
__all__ = ("export1", "export2")

# Complex nested structure
__all__ = [
    *base_exports,
    module.exported_name,
    "literal_export"
]
```

## Notes and Recommendations

- **Error Handling**: Use `safe_get__all__()` in production code to avoid crashes
- **Logging**: Consider setting `log_level` to `LogLevel.error` for production environments
- **Future Changes**: The TODO comment suggests the default log level may change to error
- **Node Support**: The module may not support all possible AST node types; unsupported nodes will trigger `KeyError`
- **Migration**: Replace usage of deprecated `ExportedName` class with `ExprName`

## Dependencies

- `ast`: Python's Abstract Syntax Tree module
- `_griffe.agents.nodes.values`: For value extraction utilities
- `_griffe.expressions.ExprName`: Modern replacement for `ExportedName`
- `_griffe.logger`: Logging infrastructure
- `_griffe.models.Module`: Module representation