<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Docstring Parser Module

This module provides a unified interface for parsing docstrings in different formats (Google, NumPy, Sphinx) and automatically detecting docstring styles. It serves as the main entry point for docstring parsing functionality in the Griffe library.

## Purpose

The module's primary purposes are:
- **Unified Parsing Interface**: Provides a single `parse()` function that can handle multiple docstring formats
- **Automatic Style Detection**: Automatically infers the docstring format when style is unknown
- **Parser Registry**: Maintains a mapping of available parsers for different docstring styles

## Type Definitions

### DocstringStyle
```python
DocstringStyle = Literal["google", "numpy", "sphinx", "auto"]
```
Supported docstring styles as literal string values.

### DocstringDetectionMethod
```python
DocstringDetectionMethod = Literal["heuristics", "max_sections"]
```
Available methods for automatically detecting docstring styles:
- **`heuristics`**: Uses regular expressions to detect style patterns
- **`max_sections`**: Tries all parsers and selects the one that parses the most sections

## Key Functions

### `parse(docstring, parser, **options)`

The main parsing function that processes docstrings based on the specified parser.

**Parameters:**
- `docstring`: The docstring object to parse
- `parser`: The parser type to use (`DocstringStyle`, `Parser`, or `None`)
- `**options`: Additional parsing options passed to the specific parser

**Returns:** List of `DocstringSection` objects

**Behavior:**
- If `parser` is `None`, returns a single text section with the raw docstring
- Converts string parser names to `Parser` enum values
- Delegates to the appropriate parser function

### `parse_auto(docstring, *, method, style_order, default, **options)`

Automatically detects and parses docstrings without requiring explicit style specification.

**Key Features:**
- **üîí Sponsors Only Feature** (Insiders 1.3.0+)
- Uses `infer_docstring_style()` to detect the appropriate parser
- Falls back to manual parsing if style detection returns sections directly

### `infer_docstring_style(docstring, *, method, style_order, default, **options)`

Determines the most appropriate parser for a given docstring.

**Parameters:**
- `method`: Detection method (`"heuristics"` or `"max_sections"`)
- `style_order`: Preferred order of styles to try
- `default`: Fallback parser if detection fails

**Returns:** Tuple of `(Parser | None, list[DocstringSection] | None)`

## Parser Registry

```python
parsers: dict[Parser, Callable[[Docstring], list[DocstringSection]]] = {
    Parser.auto: parse_auto,
    Parser.google: parse_google,
    Parser.sphinx: parse_sphinx,
    Parser.numpy: parse_numpy,
}
```

Maps parser types to their corresponding parsing functions.

## Configuration

### Default Style Order
```python
_default_style_order = [Parser.sphinx, Parser.google, Parser.numpy]
```

**‚ö†Ô∏è Important Note:** This order prioritizes detection accuracy over preference:
- **Sphinx first**: Most specific syntax, least likely to cause false positives
- **Google second**: Medium specificity
- **NumPy last**: Uses regular rST markup that might appear in plain docstrings

## Usage Examples

### Basic Parsing
```python
# Parse with specific style
sections = parse(docstring, "google")

# Parse with auto-detection (Insiders only)
sections = parse(docstring, "auto")

# Parse as plain text
sections = parse(docstring, None)
```

### Auto-Detection with Custom Settings
```python
sections = parse_auto(
    docstring,
    method="max_sections",
    style_order=["google", "numpy", "sphinx"],
    default="google"
)
```

## Notes and Recommendations

### For Non-Insiders Users
- Auto-detection features are limited in the open-source version
- The function will fall back to `default` or first item in `style_order`
- Consider upgrading to Insiders for full auto-detection capabilities

### Best Practices
- Use explicit parser specification when the docstring style is known
- The default style order is optimized for accuracy, not speed
- Consider the trade-offs between automatic detection and explicit specification

### Dependencies
The module relies on specific parser implementations:
- `_griffe.docstrings.google.parse_google`
- `_griffe.docstrings.numpy.parse_numpy` 
- `_griffe.docstrings.sphinx.parse_sphinx`