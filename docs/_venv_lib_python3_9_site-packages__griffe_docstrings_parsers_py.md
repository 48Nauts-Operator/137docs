<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Docstring Parser Module

This module provides a unified interface for parsing docstrings in different formats (Google, NumPy, Sphinx) and includes functionality to automatically detect the docstring style.

## Purpose

The module serves as the main entry point for docstring parsing in the Griffe library. It:

- Aggregates all available docstring parsers (Google, NumPy, Sphinx)
- Provides automatic style detection functionality
- Offers a generic parsing interface that works with any supported style
- Handles fallback scenarios when parsing fails

## Type Definitions

### `DocstringStyle`
```python
DocstringStyle = Literal["google", "numpy", "sphinx", "auto"]
```
Defines the supported docstring styles as literal string values.

### `DocstringDetectionMethod`
```python
DocstringDetectionMethod = Literal["heuristics", "max_sections"]
```
Defines the methods available for automatically detecting docstring styles:
- `"heuristics"`: Uses regular expressions for detection
- `"max_sections"`: Tries all parsers and selects the one that parses the most sections

## Key Functions

### `infer_docstring_style()`

```python
def infer_docstring_style(
    docstring: Docstring,
    *,
    method: DocstringDetectionMethod = "heuristics",
    style_order: list[Parser] | list[DocstringStyle] | None = None,
    default: Parser | DocstringStyle | None = None,
    **options: Any,
) -> tuple[Parser | None, list[DocstringSection] | None]
```

**Purpose**: Automatically determines which parser should be used for a given docstring.

**Parameters**:
- `docstring`: The docstring to analyze
- `method`: Detection method ("heuristics" or "max_sections")
- `style_order`: Priority order for trying different parsers
- `default`: Fallback parser if detection fails
- `**options`: Additional parsing options

**Returns**: A tuple containing the inferred parser and optionally parsed sections.

> **Note**: This is a **Sponsors-only feature** (Insiders 1.3.0+). For non-Insiders versions, it returns the default or first parser in style_order.

### `parse_auto()`

```python
def parse_auto(
    docstring: Docstring,
    *,
    method: DocstringDetectionMethod = "heuristics",
    style_order: list[Parser] | list[DocstringStyle] | None = None,
    default: Parser | DocstringStyle | None = None,
    **options: Any,
) -> list[DocstringSection]
```

**Purpose**: Parses a docstring by automatically detecting its style first.

**Parameters**: Same as `infer_docstring_style()`

**Returns**: A list of parsed docstring sections.

> **Note**: Also a **Sponsors-only feature** (Insiders 1.3.0+).

### `parse()`

```python
def parse(
    docstring: Docstring,
    parser: DocstringStyle | Parser | None,
    **options: Any,
) -> list[DocstringSection]
```

**Purpose**: Main parsing function that handles docstring parsing with a specified parser.

**Parameters**:
- `docstring`: The docstring to parse
- `parser`: The specific parser to use (or None for plain text)
- `**options`: Parser-specific options

**Returns**: A list of docstring sections.

**Behavior**:
- If `parser` is `None`, returns a single text section
- Converts string parser names to `Parser` enum values
- Delegates to the appropriate specialized parser

## Parser Registry

```python
parsers: dict[Parser, Callable[[Docstring], list[DocstringSection]]] = {
    Parser.auto: parse_auto,
    Parser.google: parse_google,
    Parser.sphinx: parse_sphinx,
    Parser.numpy: parse_numpy,
}
```

Maps parser types to their corresponding parsing functions.

## Default Style Order

```python
_default_style_order = [Parser.sphinx, Parser.google, Parser.numpy]
```

The default order for trying parsers during automatic detection. This order is chosen for safety:
- **Sphinx first**: Most specific syntax
- **Google second**: Less likely to cause false positives than NumPy
- **NumPy last**: Uses regular rST markup that might appear in plain docstrings

## Usage Examples

### Basic Parsing
```python
# Parse with a specific style
sections = parse(docstring, "google")

# Parse with automatic detection (Insiders only)
sections = parse(docstring, "auto")

# Parse as plain text
sections = parse(docstring, None)
```

### Automatic Style Detection (Insiders)
```python
# Infer style with custom order
parser, sections = infer_docstring_style(
    docstring,
    style_order=["numpy", "google", "sphinx"],
    default="google"
)

# Parse with automatic detection
sections = parse_auto(
    docstring,
    method="max_sections",
    default="google"
)
```

## Notes and Considerations

- **Feature Availability**: Automatic detection features require Griffe Insiders (paid version)
- **Safety First**: The default parser order prioritizes avoiding false positives
- **Fallback Handling**: Always provides graceful fallback to plain text parsing
- **Extensibility**: Easy to add new parsers by updating the `parsers` dictionary
- **Type Safety**: Uses proper type hints and literal types for better IDE support