<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Sphinx Docstring Parser Documentation

## Overview

This module provides functionality to parse Sphinx-style docstrings into structured data. It converts docstring text with Sphinx field directives (like `:param:`, `:type:`, `:returns:`, etc.) into organized sections that can be used for documentation generation.

## Credits

Originally contributed by Patrick Lannigan ([@plannigan](https://github.com/plannigan)) to the [pytkdocs project](https://github.com/mkdocstrings/pytkdocs). See the [original pull request](https://github.com/mkdocstrings/pytkdocs/pull/71).

## Main Functions

### `parse_sphinx()`

The primary entry point for parsing Sphinx-style docstrings.

```python
def parse_sphinx(
    docstring: Docstring,
    *,
    warn_unknown_params: bool = True,
    warnings: bool = True,
    **options: Any,
) -> list[DocstringSection]:
```

**Parameters:**
- `docstring`: The docstring object to parse
- `warn_unknown_params`: Whether to warn about documented parameters not in the function signature
- `warnings`: Whether to log warnings at all
- `**options`: Additional parsing options

**Returns:** A list of `DocstringSection` objects representing the parsed content.

## Core Data Classes

### `_FieldType`

Maps directive names to their corresponding parser functions.

```python
@dataclass(frozen=True)
class _FieldType:
    names: frozenset[str]
    reader: Callable[[Docstring, int, _ParsedValues], int]
```

### `_ParsedDirective`

Contains information about a parsed directive from the docstring.

```python
@dataclass
class _ParsedDirective:
    line: str
    next_index: int
    directive_parts: list[str]
    value: str
    invalid: bool = False
```

### `_ParsedValues`

Accumulates parsed values during docstring processing.

```python
@dataclass
class _ParsedValues:
    description: list[str]
    parameters: dict[str, DocstringParameter]
    param_types: dict[str, str]
    attributes: dict[str, DocstringAttribute]
    attribute_types: dict[str, str]
    exceptions: list[DocstringRaise]
    return_value: DocstringReturn | None
    return_type: str | None
```

## Supported Sphinx Directives

The parser recognizes the following Sphinx field directive types:

- **Parameters**: `:param:`, `:parameter:`, `:arg:`, `:argument:`, `:key:`, `:keyword:`
- **Parameter Types**: `:type:`
- **Attributes**: `:var:`, `:ivar:`, `:cvar:`
- **Attribute Types**: `:vartype:`
- **Returns**: `:returns:`, `:return:`
- **Return Types**: `:rtype:`
- **Exceptions**: `:raises:`, `:raise:`, `:except:`, `:exception:`

## Key Parser Functions

### Parameter Processing

- `_read_parameter()`: Parses parameter directives
- `_read_parameter_type()`: Parses parameter type directives
- `_determine_param_annotation()`: Resolves parameter type annotations with precedence rules
- `_determine_param_default()`: Extracts default values from function signatures

### Attribute Processing

- `_read_attribute()`: Parses attribute directives
- `_read_attribute_type()`: Parses attribute type directives

### Return Value Processing

- `_read_return()`: Parses return value directives
- `_read_return_type()`: Parses return type directives

### Exception Processing

- `_read_exception()`: Parses exception/raise directives

## Utility Functions

### `_consolidate_continuation_lines()`

Handles multi-line directive values by consolidating continuation lines.

### `_consolidate_descriptive_type()`

Converts descriptive type syntax (e.g., "str or int" becomes "str | int").

### `_strip_blank_lines()`

Removes leading and trailing blank lines from content blocks.

## Type Annotation Precedence

The parser follows specific precedence rules when determining type annotations:

### Parameters
1. Inline directive type (`:param type name:`)
2. Separate `:type:` directive
3. Function signature annotation
4. None

### Attributes
1. `:vartype:` directive
2. Parent object annotation
3. None

### Returns
1. `:rtype:` directive
2. Function signature annotation
3. None

## Error Handling and Warnings

The parser includes comprehensive warning systems for:

- Unknown parameters not in function signatures
- Duplicate parameter/attribute entries
- Malformed directives
- Missing type information
- Invalid directive syntax

Warnings can be controlled via the `warnings` parameter and use the `docstring_warning()` utility function.

## Usage Example

```python
from _griffe.models import Docstring

# Assuming you have a docstring object
docstring = Docstring("Some docstring content...")
sections = parse_sphinx(docstring, warn_unknown_params=True, warnings=True)

# Process the resulting sections
for section in sections:
    if isinstance(section, DocstringSectionParameters):
        for param in section.value:
            print(f"Parameter: {param.name}, Type: {param.annotation}")
```

## Notes and Limitations

- **Examples section**: Currently not implemented due to lack of standard format in Sphinx documentation
- **Multi-line handling**: The parser properly handles continuation lines for directive values
- **Validation**: Includes extensive validation against function signatures when available
- **Type conversion**: Automatically converts old-style union syntax to modern Python union syntax

## Dependencies

This module relies on several internal Griffe modules:
- `_griffe.docstrings.models` for docstring section data structures
- `_griffe.docstrings.utils` for warning utilities
- `_griffe.expressions` and `_griffe.models` for type definitions