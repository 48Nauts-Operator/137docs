<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Docstring Parser Utilities Module

This module provides utility functions for parsing and handling docstrings in the Griffe documentation framework. It contains helper functions for logging warnings during docstring parsing and converting string annotations into parseable expressions.

## Purpose

The module serves as a support layer for docstring parsers by providing:
- Standardized warning/error logging with proper file location context
- Safe parsing of type annotations found within docstrings
- Error handling and fallback mechanisms for robust docstring processing

## Functions

### `docstring_warning()`

```python
def docstring_warning(
    docstring: Docstring,
    offset: int,
    message: str,
    log_level: LogLevel = LogLevel.warning,
) -> None
```

Logs warning messages during docstring parsing with contextual information.

**Parameters:**
- `docstring`: The docstring object being processed
- `offset`: Line offset within the docstring where the issue occurs
- `message`: The warning message to log
- `log_level`: Severity level for logging (defaults to `LogLevel.warning`)

**Features:**
- Automatically determines the source file path for context
- Handles various edge cases (missing attributes, built-in modules, etc.)
- Calculates accurate line numbers by combining docstring line number with offset
- Uses appropriate logging level based on the `log_level` parameter

**Example output format:**
```
<filepath>:<line_number>: <message>
```

### `parse_docstring_annotation()`

```python
def parse_docstring_annotation(
    annotation: str,
    docstring: Docstring,
    log_level: LogLevel = LogLevel.error,
) -> str | Expr
```

Safely parses string type annotations found in docstrings into executable expressions.

**Parameters:**
- `annotation`: The annotation string to parse (e.g., `"List[str]"`, `"Optional[int]"`)
- `docstring`: The containing docstring object (used for context and name resolution)
- `log_level`: Logging level for any parsing errors

**Returns:**
- `Expr`: A parsed expression object if parsing succeeds
- `str`: The original annotation string if parsing fails

**Features:**
- Uses Python's AST compilation with `PyCF_ONLY_AST` flag for safe parsing
- Handles syntax errors gracefully by falling back to the original string
- Integrates with the parent object's name resolution system
- Optimized compilation settings (`optimize=2`)

## Error Handling

Both functions implement robust error handling:

- **`docstring_warning()`**: Catches `AttributeError`, `ValueError`, and `BuiltinModuleError` when determining file paths
- **`parse_docstring_annotation()`**: Uses `suppress()` context manager to handle `AttributeError` and `SyntaxError` gracefully

## Dependencies

The module relies on several internal Griffe components:
- `_griffe.enumerations.LogLevel`: For log level management
- `_griffe.exceptions.BuiltinModuleError`: For handling built-in module edge cases
- `_griffe.expressions.safe_get_annotation`: For safe AST-to-expression conversion
- `_griffe.logger.logger`: For centralized logging

## Usage Notes

### Best Practices
- Always provide meaningful context in warning messages
- Use appropriate log levels based on severity
- The annotation parser should be your first choice for parsing type hints in docstrings

### Limitations
- Annotation parsing may fail silently and return the original string
- File path resolution depends on the docstring having a proper parent relationship
- Built-in modules receive special handling but may have limited context information

## Type Hints

The module uses conditional imports (`TYPE_CHECKING`) to avoid circular dependencies while maintaining proper type annotations for development tools.