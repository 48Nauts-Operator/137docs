<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Docstring Parser Utilities

This module provides utility functions for parsing and processing docstrings in the Griffe library. It contains helper functions for logging warnings during docstring parsing and converting string annotations into structured expressions.

## Purpose

The module serves as a support layer for docstring parsers by providing:
- Standardized warning/error logging with file location context
- Conversion of string-based type annotations into structured expressions that can be resolved later

## Functions

### `docstring_warning()`

```python
def docstring_warning(
    docstring: Docstring,
    offset: int,
    message: str,
    log_level: LogLevel = LogLevel.warning,
) -> None
```

Logs warnings or errors that occur during docstring parsing with contextual information.

**Parameters:**
- `docstring`: The docstring object being parsed
- `offset`: Line offset within the docstring where the issue occurred
- `message`: The warning/error message to log
- `log_level`: Severity level (defaults to `LogLevel.warning`)

**Features:**
- Automatically determines the source file path from the docstring's parent
- Handles various edge cases:
  - Missing file paths (falls back to `<module>`)
  - Built-in modules (shows `<module: name>`)
  - Missing line numbers (defaults to 0)
- Formats output as: `filepath:line_number: message`

### `parse_docstring_annotation()`

```python
def parse_docstring_annotation(
    annotation: str,
    docstring: Docstring,
    log_level: LogLevel = LogLevel.error,
) -> str | Expr
```

Converts string-based type annotations found in docstrings into structured expression objects.

**Parameters:**
- `annotation`: The annotation string to parse
- `docstring`: The docstring context (used for name resolution)
- `log_level`: Log level for any parsing errors

**Returns:**
- `Expr`: A structured expression object if parsing succeeds
- `str`: The original string if parsing fails

**Process:**
1. Compiles the annotation string into an AST using `eval` mode
2. Converts the AST into a safe annotation expression
3. Binds the expression to the docstring's parent for later name resolution
4. Falls back to returning the original string if any step fails

## Error Handling

Both functions use robust error handling:

- **`docstring_warning()`**: Gracefully handles missing attributes and built-in module errors
- **`parse_docstring_annotation()`**: Uses `contextlib.suppress()` to handle:
  - `AttributeError`: When docstring has no resolvable parent
  - `SyntaxError`: When annotation contains invalid Python syntax

## Dependencies

- `ast`: For compiling annotation strings to AST
- `_griffe.enumerations.LogLevel`: For log level constants
- `_griffe.expressions.safe_get_annotation()`: For safe AST-to-expression conversion
- `_griffe.logger`: For the logging infrastructure

## Usage Notes

- These are utility functions typically called by higher-level docstring parsers
- The annotation parsing helps convert docstring type hints into the same format as source code annotations
- Error handling is designed to be non-blocking - parsing continues even when individual annotations fail