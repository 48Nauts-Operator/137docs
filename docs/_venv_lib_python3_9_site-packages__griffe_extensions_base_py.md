<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Griffe Extensions Module

This module provides the base infrastructure for Griffe extensions and utilities to load them. It contains the base `Extension` class that all extensions inherit from, along with functions to dynamically load extensions from various sources.

## Purpose

The module enables extensibility in the Griffe Python code analysis tool by:
- Providing a base class for creating custom extensions
- Offering hooks for different stages of code analysis (AST visiting, object inspection, etc.)
- Supporting dynamic loading of extensions from files, modules, or built-in sources
- Managing collections of extensions and their execution

## Key Classes

### `Extension`

The base class that all Griffe extensions must inherit from. It provides hook methods that are called at different stages of the code analysis process.

#### Key Methods

**AST Visiting Methods:**
- `visit(node)` - Visit an AST node, automatically dispatching to specific visit methods
- `generic_visit(node)` - Visit all children of an AST node

**Object Inspection Methods:**
- `inspect(node)` - Inspect a runtime object node
- `generic_inspect(node)` - Inspect all children of an object node

**Event Hook Methods:**
The extension provides numerous event hooks for different analysis stages:

```python
# General hooks
def on_node(self, *, node, agent, **kwargs):
    """Called when visiting any new node"""

def on_instance(self, *, node, obj, agent, **kwargs):
    """Called when any Object has been created"""

# Specific object type hooks
def on_module_instance(self, *, node, mod, agent, **kwargs):
    """Called when a Module has been created"""

def on_class_instance(self, *, node, cls, agent, **kwargs):
    """Called when a Class has been created"""

def on_function_instance(self, *, node, func, agent, **kwargs):
    """Called when a Function has been created"""

def on_attribute_instance(self, *, node, attr, agent, **kwargs):
    """Called when an Attribute has been created"""

# Loading hooks
def on_package_loaded(self, *, pkg, loader, **kwargs):
    """Called when a package has been completely loaded"""
```

### `Extensions`

A container class that manages multiple extension instances and provides a unified interface for calling their hooks.

#### Methods

```python
def __init__(self, *extensions):
    """Initialize with extension instances"""

def add(self, *extensions):
    """Add more extensions to the container"""

def call(self, event, **kwargs):
    """Call a specific event hook on all extensions"""
```

## Key Functions

### `load_extensions(*exts)`

The main function for loading and configuring extensions from various sources.

**Parameters:**
- `*exts`: Variable number of extension specifications

**Supported Extension Types:**
- **Extension instances**: Already instantiated extension objects
- **Extension classes**: Classes that inherit from `Extension`
- **String paths**: Import paths or file paths to extension modules
- **Dictionaries**: Configuration with import path as key and options as value

**Examples:**
```python
# Load from string path
extensions = load_extensions("mypackage.MyExtension")

# Load with configuration
extensions = load_extensions({
    "mypackage.MyExtension": {"option1": "value1"}
})

# Load built-in extension
extensions = load_extensions("dataclasses")

# Load from file
extensions = load_extensions("/path/to/extension.py")
```

### `_load_extension(extension)`

Internal function that handles the actual loading logic for a single extension specification.

**Loading Process:**
1. Check if already an extension instance
2. Check if it's an extension class
3. Parse configuration dictionaries
4. Handle built-in extensions
5. Load from file paths
6. Import from Python module paths
7. Instantiate with provided options

## Built-in Extensions

The module includes built-in extensions accessible by name:

```python
builtin_extensions = {
    "dataclasses",
}
```

Built-in extensions are automatically prefixed with `_griffe.extensions.` when loaded.

## Type Definitions

```python
LoadableExtensionType = Union[str, dict[str, Any], Extension, type[Extension]]
```

This type alias defines all the acceptable formats for specifying extensions to load.

## Usage Example

```python
from _griffe.extensions import Extension, load_extensions

class MyExtension(Extension):
    def on_class_instance(self, *, node, cls, agent, **kwargs):
        # Custom logic when a class is processed
        print(f"Processing class: {cls.name}")

# Load extensions
extensions = load_extensions(
    MyExtension(),  # Instance
    "mypackage.AnotherExtension",  # Import path
    {"path.to.Extension": {"debug": True}},  # With config
)

# Use in analysis
extensions.call("on_class_instance", node=node, cls=cls, agent=agent)
```

## Notes and Considerations

- **Forward Compatibility**: All hook methods use `**kwargs` to support future parameter additions
- **Error Handling**: The module raises `ExtensionNotLoadedError` for loading failures while preserving `ImportError` tracebacks
- **Built-in Integration**: The dataclasses extension is automatically loaded unless already present
- **File Loading**: Supports loading extensions from filesystem paths with proper module isolation
- **Multiple Extensions**: Single modules can export multiple extension classes, all of which will be loaded

## Dependencies

The module relies on several Griffe internal components:
- AST utilities from `_griffe.agents.nodes.ast`
- Exception classes from `_griffe.exceptions`
- Dynamic import functionality from `_griffe.importer`
- Type definitions for various analysis agents and object models