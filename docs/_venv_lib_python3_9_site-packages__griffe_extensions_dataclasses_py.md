<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Dataclasses Extension Documentation

## Overview

This module is a built-in extension for the Griffe static analysis tool that adds support for Python dataclasses. The extension automatically reconstructs `__init__` methods of dataclasses during static analysis, making it possible to properly analyze and document dataclass constructors without executing the code.

## Purpose

Python dataclasses use the `@dataclass` decorator to automatically generate `__init__` methods at runtime. However, during static analysis, these generated methods are not visible in the source code. This extension solves that problem by:

- Detecting classes decorated with `@dataclass`
- Analyzing class attributes and field configurations
- Reconstructing the `__init__` method signature with proper parameters
- Handling inheritance from parent dataclasses
- Managing special dataclass features like `InitVar` and field options

## Main Components

### Core Class

#### `DataclassesExtension`

```python
class DataclassesExtension(Extension):
    """Built-in extension adding support for dataclasses."""
```

The main extension class that integrates with the Griffe analysis pipeline.

**Key Method:**
- `on_package_loaded()`: Hook that processes loaded packages to reconstruct dataclass `__init__` methods

### Key Functions

#### Decorator Detection

- **`_dataclass_decorator(decorators)`**: Identifies if a class has the `@dataclass` decorator
- **`_dataclass_arguments(decorators)`**: Extracts arguments passed to the `@dataclass` decorator

#### Parameter Analysis

- **`_dataclass_parameters(class_)`**: 
  - Analyzes class attributes to determine `__init__` parameters
  - Handles dataclass-specific features like `kw_only`, field configurations
  - Returns list of `Parameter` objects for the constructor

#### Method Reconstruction

- **`_set_dataclass_init(class_)`**:
  - Main function that reconstructs the `__init__` method
  - Handles inheritance by analyzing Method Resolution Order (MRO)
  - Creates properly ordered parameter list
  - Adds the generated `__init__` method to the class

#### Utility Functions

- **`_reorder_parameters(parameters)`**: Ensures proper parameter ordering (positional-only, positional-or-keyword, keyword-only)
- **`_field_arguments(attribute)`**: Extracts configuration from `dataclasses.field()` calls
- **`_del_members_annotated_as_initvar(class_)`**: Removes `InitVar` attributes from class members
- **`_apply_recursively(mod_cls, processed)`**: Recursively processes modules and classes

## Features Supported

### Dataclass Decorator Options

- **`init`**: Controls whether to generate `__init__` method
- **`kw_only`**: Makes all parameters keyword-only

### Field Configuration

The extension handles `dataclasses.field()` configurations:

- **`init`**: Whether field appears in `__init__`
- **`default`**: Default value for the parameter
- **`default_factory`**: Factory function for default values
- **`kw_only`**: Makes specific field keyword-only

### Special Annotations

- **`dataclasses.KW_ONLY`**: Marker for starting keyword-only parameters
- **`dataclasses.InitVar`**: Variables that appear in `__init__` but aren't stored as attributes
- **`ClassVar`**: Class variables excluded from `__init__`

### Inheritance Support

- Properly handles dataclass inheritance through MRO analysis
- Merges parameters from parent dataclasses
- Maintains correct parameter ordering

## Usage Notes

### Automatic Processing

The extension automatically processes all loaded packages without requiring explicit configuration.

### Limitations

- Only processes classes that don't already have an `__init__` method defined
- Requires proper type annotations on dataclass fields
- Depends on static analysis of decorator arguments

### Error Handling

- Uses `suppress(Exception)` context manager for graceful error handling
- Provides debug logging for processed dataclasses
- Handles MRO resolution failures gracefully

## Example

```python
@dataclass
class Person:
    name: str
    age: int = 0
    active: bool = field(default=True, kw_only=True)
```

The extension would reconstruct:
```python
def __init__(self, name: str, age: int = 0, *, active: bool = True) -> None:
    ...
```

## Integration

This extension integrates with the Griffe static analysis framework and is automatically loaded as a built-in extension. It operates during the package loading phase to ensure all dataclasses are properly processed before documentation generation or other analysis tasks.