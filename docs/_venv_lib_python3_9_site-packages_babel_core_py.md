<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# babel.core Documentation

## Overview

The `babel.core` module provides core locale representation and locale data access functionality for the Babel internationalization library. It contains the primary `Locale` class and various utility functions for parsing, negotiating, and working with locale identifiers.

## Purpose

This module serves as the foundation for Babel's internationalization features by:

- Representing specific locales and their associated data
- Parsing and formatting locale identifiers
- Negotiating the best available locale from user preferences
- Providing access to locale-specific formatting patterns, names, and cultural data

## Key Classes

### `Locale`

The main class representing a specific locale with all its cultural and formatting data.

```python
# Create a locale directly
locale = Locale('en', 'US')

# Parse from string
locale = Locale.parse('en-US', sep='-')

# Get system default
locale = Locale.default()
```

**Key attributes:**
- `language`: Language code (e.g., 'en')
- `territory`: Territory/country code (e.g., 'US') 
- `script`: Script code (e.g., 'Latn')
- `variant`: Variant code (e.g., 'POSIX')
- `modifier`: Modifier (e.g., 'euro')

**Important properties:**
- `display_name`: Localized display name
- `currencies`: Currency names and symbols
- `date_formats`/`time_formats`: Date/time formatting patterns
- `number_symbols`: Number formatting symbols
- `plural_form`: Plural rules for the locale

### `UnknownLocaleError`

Exception raised when requesting data for a locale that doesn't exist.

```python
try:
    locale = Locale.parse('xx_XX')
except UnknownLocaleError as e:
    print(f"Locale not found: {e.identifier}")
```

## Key Functions

### `parse_locale(identifier, sep='_')`

Parses a locale identifier into its components.

```python
# Returns: ('en', 'US', None, None)
parse_locale('en_US')

# Returns: ('zh', 'CN', 'Hans', None) 
parse_locale('zh_Hans_CN')

# With modifier: ('de', 'DE', None, None, 'euro')
parse_locale('de_DE@euro')
```

### `get_locale_identifier(tup, sep='_')`

Creates a locale identifier from a tuple of components.

```python
# Returns: 'de_DE_1999@custom'
get_locale_identifier(('de', 'DE', None, '1999', 'custom'))
```

### `negotiate_locale(preferred, available, sep='_', aliases=LOCALE_ALIASES)`

Finds the best match between preferred and available locales.

```python
# Returns: 'de_DE'
negotiate_locale(['de_DE', 'en_US'], ['de_DE', 'de_AT'])

# Returns: 'de' (fallback to language only)
negotiate_locale(['de_DE', 'en_US'], ['en', 'de'])
```

### `default_locale(category=None, aliases=LOCALE_ALIASES)`

Gets the system default locale from environment variables.

```python
# Check LC_MESSAGES, then fallback variables
default_locale('LC_MESSAGES')
```

### `get_global(key)`

Accesses global locale data (currency info, territory mappings, etc.).

```python
# Get timezone aliases
get_global('zone_aliases')['UTC']  # Returns: 'Etc/UTC'

# Get territory for timezone  
get_global('zone_territories')['Europe/Berlin']  # Returns: 'DE'
```

## Usage Examples

### Basic Locale Creation and Usage

```python
from babel.core import Locale

# Create locale
locale = Locale('de', 'DE')

# Display information
print(locale.display_name)  # "Deutsch (Deutschland)"
print(locale.english_name)  # "German (Germany)"

# Access formatting data
print(locale.currencies['USD'])  # "US-Dollar"
print(locale.number_symbols['latn']['decimal'])  # ","
```

### Locale Negotiation

```python
from babel.core import negotiate_locale

user_locales = ['fr_CA', 'en_US', 'en']
available_locales = ['en_US', 'en_GB', 'es_ES']

best_match = negotiate_locale(user_locales, available_locales)
# Returns: 'en_US'
```

### Parsing Complex Locales

```python
from babel.core import parse_locale

# Parse with script
components = parse_locale('zh_Hans_CN')
# Returns: ('zh', 'CN', 'Hans', None)

# Parse with modifier
components = parse_locale('ca_ES_valencia@euro')  
# Returns: ('ca', 'ES', None, 'VALENCIA', 'euro')
```

## Important Notes

### Data Files Requirement

- Babel requires compiled locale data files to function
- If you see "babel data files are not available" errors, run `python setup.py import_cldr` before installation
- Data is stored in `babel/global.dat` and individual locale files

### Locale Aliases

- The module includes `LOCALE_ALIASES` mapping for common locale variations
- Maps language-only codes to full locales (e.g., 'en' → 'en_US')
- Handles browser compatibility issues and legacy codes

### Likely Subtag Resolution

- `Locale.parse()` can automatically resolve incomplete locale identifiers
- Uses CLDR likely subtags data to expand locales (e.g., 'zh_TW' → 'zh_Hant_TW')
- Can be disabled with `resolve_likely_subtags=False`

### Performance Considerations

- Locale data is lazy-loaded when first accessed
- Global data is cached after first load
- Consider caching `Locale` instances for frequently used locales

### Version Compatibility

- Internal data structure formats may change between Babel versions
- Always use the public API rather than accessing internal data structures directly
- The `get_global()` function provides stable access to global locale data