<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# babel.localtime._fallback

## Overview

This module provides a fallback implementation for local timezone handling when other timezone detection mechanisms fail. It's part of the Babel internationalization library and serves as a last resort for determining local timezone information using Python's built-in `time` module.

## Purpose

The `_fallback` module creates an emulated local timezone class that can:
- Determine UTC offsets for standard and daylight saving time
- Calculate daylight saving time adjustments
- Provide timezone names
- Detect whether a given datetime falls within daylight saving time

This fallback is used when more sophisticated timezone libraries or system timezone data are unavailable.

## Constants

### Timezone Offsets
```python
STDOFFSET = datetime.timedelta(seconds=-time.timezone)
DSTOFFSET = datetime.timedelta(seconds=-time.altzone) if time.daylight else STDOFFSET
```

- **`STDOFFSET`**: Standard time offset from UTC
- **`DSTOFFSET`**: Daylight saving time offset from UTC (falls back to standard offset if DST is not supported)

### Helper Constants
```python
DSTDIFF = DSTOFFSET - STDOFFSET
ZERO = datetime.timedelta(0)
```

- **`DSTDIFF`**: The difference between DST and standard time offsets
- **`ZERO`**: A zero timedelta for convenience

## Classes

### `_FallbackLocalTimezone`

A `datetime.tzinfo` subclass that implements local timezone behavior using system time functions.

#### Methods

##### `utcoffset(dt: datetime.datetime) -> datetime.timedelta`
Returns the UTC offset for the given datetime.

- **Parameters**: `dt` - A datetime object
- **Returns**: `DSTOFFSET` if the datetime is in DST, otherwise `STDOFFSET`

##### `dst(dt: datetime.datetime) -> datetime.timedelta`
Returns the daylight saving time offset for the given datetime.

- **Parameters**: `dt` - A datetime object  
- **Returns**: `DSTDIFF` if the datetime is in DST, otherwise `ZERO`

##### `tzname(dt: datetime.datetime) -> str`
Returns the timezone name for the given datetime.

- **Parameters**: `dt` - A datetime object
- **Returns**: The appropriate timezone name from `time.tzname`

##### `_isdst(dt: datetime.datetime) -> bool` *(Private)*
Determines whether the given datetime falls within daylight saving time.

- **Parameters**: `dt` - A datetime object
- **Returns**: `True` if the datetime is in DST, `False` otherwise
- **Implementation**: Converts the datetime to a time tuple, uses `time.mktime()` and `time.localtime()` to let the system determine DST status

## Usage Notes

⚠️ **Important Considerations:**

- This is a **fallback implementation** - prefer using proper timezone libraries like `pytz` or `zoneinfo` when available
- The DST detection relies on the system's time functions, which may not be accurate for historical dates or dates far in the future
- The implementation assumes the local system's timezone settings are correct
- Performance may be slower than dedicated timezone libraries due to the time conversion operations in `_isdst()`

## Example Usage

```python
from babel.localtime._fallback import _FallbackLocalTimezone
import datetime

# Create timezone instance
tz = _FallbackLocalTimezone()

# Use with datetime
dt = datetime.datetime(2023, 7, 15, 12, 0, 0)
print(f"UTC Offset: {tz.utcoffset(dt)}")
print(f"DST Offset: {tz.dst(dt)}")
print(f"Timezone Name: {tz.tzname(dt)}")
```

## Dependencies

- `datetime` - Python standard library for date/time handling
- `time` - Python standard library for time-related functions