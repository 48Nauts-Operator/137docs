<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Timezone Utilities Module

## Overview

This module provides utility functions for working with timezone information in Python. It serves as a compatibility layer between two popular timezone libraries: `pytz` and `zoneinfo` (Python 3.9+). The module gracefully handles cases where either library might not be available and provides consistent timezone lookup functionality.

## Purpose

- **Cross-library compatibility**: Works with both `pytz` and `zoneinfo` libraries
- **Graceful fallback**: Automatically uses available timezone library
- **Consistent API**: Provides unified functions regardless of underlying library
- **Error handling**: Properly handles timezone lookup failures and file operations

## Dependencies

The module attempts to import two timezone libraries with fallback handling:

```python
try:
    import pytz
except ModuleNotFoundError:
    pytz = None

try:
    import zoneinfo
except ModuleNotFoundError:
    zoneinfo = None
```

- **`pytz`**: Third-party timezone library (legacy but widely used)
- **`zoneinfo`**: Built-in timezone library (Python 3.9+)

## Functions

### `_get_tzinfo(tzenv: str)`

Retrieves timezone information from available timezone libraries.

**Parameters:**
- `tzenv` (str): Timezone identifier in the format "Continent/City" (e.g., "America/New_York")

**Returns:**
- `tzinfo` object if timezone is found
- `None` if timezone is not found or invalid

**Behavior:**
- Prioritizes `pytz` if available
- Falls back to `zoneinfo` if `pytz` is not available
- Handles library-specific exceptions gracefully

**Example usage:**
```python
tz = _get_tzinfo("Europe/London")
if tz:
    print(f"Timezone found: {tz}")
else:
    print("Timezone not found")
```

### `_get_tzinfo_or_raise(tzenv: str)`

Similar to `_get_tzinfo()` but raises an exception if the timezone is not found.

**Parameters:**
- `tzenv` (str): Timezone identifier in the format "Continent/City"

**Returns:**
- `tzinfo` object

**Raises:**
- `LookupError`: If the timezone cannot be found

**Example usage:**
```python
try:
    tz = _get_tzinfo_or_raise("Invalid/Timezone")
except LookupError as e:
    print(f"Error: {e}")
```

### `_get_tzinfo_from_file(tzfilename: str)`

Loads timezone information from a timezone file.

**Parameters:**
- `tzfilename` (str): Path to timezone file

**Returns:**
- `tzinfo` object created from the file

**Behavior:**
- Uses `pytz.tzfile.build_tzinfo()` if `pytz` is available
- Uses `zoneinfo.ZoneInfo.from_file()` if `zoneinfo` is available

**Example usage:**
```python
tz = _get_tzinfo_from_file("/usr/share/zoneinfo/UTC")
```

## Error Handling

The module includes specific error handling for different scenarios:

- **Unknown timezone errors**: Caught and handled gracefully
- **File-related errors**: Managed through library-specific exception handling
- **Library availability**: Graceful fallback when libraries are not installed

## Important Notes

### Library Priority
- The module prioritizes `pytz` over `zoneinfo` when both are available
- This ensures backward compatibility with existing code

### Error Message Parsing
- Contains a workaround for `zoneinfo` error handling (see line comments about issue #1092)
- Parses error messages to determine if a timezone lookup failed

### Function Naming
- All functions are prefixed with underscore (`_`) indicating they are internal/private functions
- These are likely utility functions used by a larger timezone handling system

## Suggestions for Usage

1. **Error Handling**: Always wrap timezone lookups in try-catch blocks when using `_get_tzinfo_or_raise()`

2. **Validation**: Consider validating timezone format before passing to these functions

3. **Caching**: For performance-critical applications, consider caching timezone objects

4. **Testing**: Test with both libraries available and unavailable to ensure proper fallback behavior

## Dependencies Installation

```bash
# For pytz support
pip install pytz

# zoneinfo is built-in for Python 3.9+
# For older Python versions, use backport:
pip install backports.zoneinfo
```