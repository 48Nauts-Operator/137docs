<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# babel.messages.catalog

## Overview

This module provides core data structures for working with message catalogs in internationalization (i18n) applications. It contains classes for representing individual messages and complete message catalogs, supporting features like pluralization, message validation, fuzzy matching, and various translation formats.

## Main Classes

### Message

Represents a single translatable message in a catalog.

```python
class Message:
    def __init__(
        self,
        id: _MessageID,
        string: _MessageID | None = '',
        locations: Iterable[tuple[str, int]] = (),
        flags: Iterable[str] = (),
        auto_comments: Iterable[str] = (),
        user_comments: Iterable[str] = (),
        previous_id: _MessageID = (),
        lineno: int | None = None,
        context: str | None = None,
    ) -> None:
```

#### Key Properties

- **`id`**: The message identifier (string or tuple for plurals)
- **`string`**: The translated text (string or tuple for plurals)
- **`locations`**: List of (filename, line_number) tuples where message appears
- **`flags`**: Set of flags (e.g., 'fuzzy', 'python-format')
- **`context`**: Message context for disambiguation
- **`pluralizable`**: Boolean indicating if message supports plural forms
- **`fuzzy`**: Boolean indicating if translation needs review
- **`python_format`**: Boolean indicating Python-style formatting (e.g., `%(name)s`)
- **`python_brace_format`**: Boolean indicating Python brace formatting (e.g., `{name}`)

#### Important Methods

- **`check(catalog=None)`**: Validates the message and returns list of errors
- **`clone()`**: Creates a deep copy of the message
- **`is_identical(other)`**: Compares all message properties for equality

### Catalog

Represents a complete message catalog containing multiple messages and metadata.

```python
class Catalog:
    def __init__(
        self,
        locale: Locale | str | None = None,
        domain: str | None = None,
        header_comment: str | None = DEFAULT_HEADER,
        project: str | None = None,
        version: str | None = None,
        copyright_holder: str | None = None,
        msgid_bugs_address: str | None = None,
        creation_date: datetime.datetime | str | None = None,
        revision_date: datetime.datetime | datetime.time | float | str | None = None,
        last_translator: str | None = None,
        language_team: str | None = None,
        charset: str | None = None,
        fuzzy: bool = True,
    ) -> None:
```

#### Key Properties

- **`locale`**: Target locale for translations
- **`domain`**: Message domain (namespace)
- **`project`**: Project name
- **`version`**: Project version
- **`mime_headers`**: MIME headers for PO file format
- **`num_plurals`**: Number of plural forms for the locale
- **`plural_expr`**: Plural expression formula
- **`obsolete`**: Dictionary of obsolete messages

#### Important Methods

- **`add(id, string=None, ...)`**: Adds or updates a message
- **`get(id, context=None)`**: Retrieves a message by ID and context
- **`delete(id, context=None)`**: Removes a message
- **`update(template, ...)`**: Updates catalog based on template with fuzzy matching
- **`check()`**: Validates all messages in the catalog
- **`is_identical(other)`**: Compares catalogs for complete equality

## Utility Functions

### get_close_matches(word, possibilities, n=3, cutoff=0.6)

Modified version of `difflib.get_close_matches` that provides fuzzy matching for message IDs during catalog updates.

### Format Detection Functions

- **`_has_python_brace_format(string)`**: Detects Python brace-style format strings
- **`PYTHON_FORMAT`**: Regex pattern for Python %-style format strings

## Usage Examples

### Creating Messages

```python
# Simple message
msg = Message('Hello, world!')

# Pluralizable message
msg = Message(('One item', '{count} items'), 
              ('Un élément', '{count} éléments'))

# Message with metadata
msg = Message('Save file', 'Enregistrer le fichier',
              locations=[('main.py', 42)],
              flags=['python-format'],
              user_comments=['Button label'])
```

### Working with Catalogs

```python
# Create catalog
catalog = Catalog(locale='fr_FR', project='MyApp', version='1.0')

# Add messages
catalog.add('Hello', 'Bonjour')
catalog.add(('One file', '{count} files'), 
            ('Un fichier', '{count} fichiers'))

# Access messages
msg = catalog['Hello']
print(f"Translation: {msg.string}")

# Update from template
template = Catalog()  # Load from POT file
catalog.update(template, no_fuzzy_matching=False)
```

## Important Notes

### Pluralization Support

- Messages can be pluralizable by using tuples for `id` and `string`
- Plural forms are automatically determined by locale
- The catalog handles plural expressions and counts per locale

### Fuzzy Matching

- When updating catalogs, fuzzy matching helps preserve translations for slightly modified messages
- Fuzzy matches are marked with the 'fuzzy' flag for manual review
- Can be disabled with `no_fuzzy_matching=True`

### Format String Detection

- Automatically detects Python % and brace formatting in messages
- Sets appropriate flags (`python-format`, `python-brace-format`)
- Used by validation checkers to ensure format consistency

### Message Validation

- Built-in validation system checks for common translation errors
- Extensible through the checker system
- Validates format string consistency, placeholder matching, etc.

## Error Handling

### TranslationError

Exception raised by validation checkers when encountering invalid translations:

```python
try:
    errors = message.check(catalog)
    if errors:
        for