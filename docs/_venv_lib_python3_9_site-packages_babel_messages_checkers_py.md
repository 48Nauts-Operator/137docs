<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Babel Message Checkers

## Overview

The `babel.messages.checkers` module provides validation routines for translation messages. It ensures that translated strings maintain proper formatting and structure compared to their original source strings. This module is essential for maintaining translation quality and preventing runtime errors caused by malformed format strings.

## Purpose

- **Translation Validation**: Verify that translations maintain proper format string compatibility
- **Plural Form Checking**: Ensure correct number of plural forms based on locale requirements
- **Format String Validation**: Check Python format string placeholders for consistency between source and translated text
- **Error Prevention**: Catch translation errors before they cause runtime issues

## Key Components

### Global Variables

#### `_string_format_compatibilities`
```python
_string_format_compatibilities = [
    {'i', 'd', 'u'},
    {'x', 'X'},
    {'f', 'F', 'g', 'G'},
]
```
- Defines groups of Python format characters that are compatible with each other
- Used to determine if different format specifiers can be safely substituted

#### `checkers`
- List of all available checker functions loaded from entry points or default checkers
- Automatically populated when the module is imported

### Core Checker Functions

#### `num_plurals(catalog, message)`

Validates the number of plural forms in translated messages.

**Parameters:**
- `catalog`: Babel Catalog object containing locale information
- `message`: Message object to validate

**Functionality:**
- Skips validation for non-pluralizable messages
- Compares the number of plural forms in translation against catalog requirements
- Raises `TranslationError` if counts don't match

**Usage Example:**
```python
from babel.messages.catalog import Catalog, Message
from babel.messages.checkers import num_plurals

# This will validate plural form count
num_plurals(catalog, message)
```

#### `python_format(catalog, message)`

Validates Python format string placeholders between source and translated text.

**Parameters:**
- `catalog`: Babel Catalog object (can be None)
- `message`: Message object with 'python-format' flag

**Functionality:**
- Only processes messages flagged with 'python-format'
- Compares format placeholders between original and translated strings
- Handles both single strings and plural forms

### Internal Validation Functions

#### `_validate_format(format, alternative)`

Core validation logic for format string compatibility.

**Parameters:**
- `format`: Original format string (msgid)
- `alternative`: Translated format string (msgstr)

**Key Features:**
- **Placeholder Parsing**: Extracts format specifiers using regex
- **Compatibility Checking**: Verifies format characters are compatible
- **Positional vs Named**: Ensures consistency in placeholder style
- **Error Reporting**: Provides detailed error messages for various mismatch types

**Validation Rules:**
- Format strings must use consistent placeholder styles (positional or named)
- Positional placeholders must match in count and order
- Named placeholders in translation must exist in original
- Format characters must be compatible (e.g., `%d` and `%i` are compatible)

**Example Validations:**
```python
# ✅ Compatible formats
_validate_format('Hello %s!', 'Hallo %s!')
_validate_format('Hello %i!', 'Hallo %d!')  # Compatible numeric formats

# ❌ Incompatible formats
_validate_format('Hello %(name)s!', 'Hallo %s!')  # Mixed placeholder styles
```

### Checker Discovery

#### `_find_checkers()`

Dynamically loads checker functions from entry points.

**Functionality:**
- Searches for checkers via `babel.checkers` entry points
- Falls back to built-in checkers if entry points unavailable
- Returns list of callable checker functions

## Error Handling

The module raises `TranslationError` exceptions for various validation failures:

- **Plural Form Errors**: Wrong number of plural forms
- **Format Mismatch**: Incompatible format specifiers
- **Placeholder Style**: Mixed positional and named placeholders
- **Missing Placeholders**: Named placeholders not found in original

## Usage Notes

### Best Practices

- **Always validate translations** before deploying to production
- **Use consistent format styles** within each message (don't mix `%s` and `%(name)s`)
- **Test with actual data** to ensure format compatibility works in practice

### Integration

```python
from babel.messages.checkers import checkers
from babel.messages.catalog import Catalog, Message

# Run all available checkers on a message
for checker in checkers:
    try:
        checker(catalog, message)
    except TranslationError as e:
        print(f"Validation error: {e}")
```

### Extensibility

- Custom checkers can be added via entry points under `babel.checkers`
- Checker functions should follow the signature: `(Catalog | None, Message) -> None`
- Raise `TranslationError` for validation failures

## Dependencies

- `babel.messages.catalog`: Core catalog and message classes
- `babel.messages._compat`: Entry point discovery utilities
- Standard library: `collections.abc`, `__future__`

This module is essential for maintaining high-quality translations and preventing format-related runtime errors in internationalized applications.