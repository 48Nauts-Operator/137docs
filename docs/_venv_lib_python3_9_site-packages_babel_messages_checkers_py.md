<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# babel.messages.checkers

This module provides validation routines for translation messages in Babel, helping ensure the quality and correctness of translations by checking various aspects like plural forms and format string compatibility.

## Purpose

The module validates translations to catch common translation errors such as:
- Incorrect number of plural forms
- Incompatible format string placeholders between original and translated messages
- Mixed positional and named placeholders in format strings

## Key Components

### Global Variables

#### `_string_format_compatibilities`
```python
_string_format_compatibilities = [
    {'i', 'd', 'u'},
    {'x', 'X'},
    {'f', 'F', 'g', 'G'},
]
```
- Defines groups of Python format characters that are compatible with each other
- Used for validating format string translations where different but compatible format types are acceptable

#### `checkers`
- List of available checker functions loaded dynamically via entry points
- Falls back to built-in checkers (`num_plurals`, `python_format`) if no entry points are found

### Main Checker Functions

#### `num_plurals(catalog, message)`
Validates that translated messages have the correct number of plural forms.

**Parameters:**
- `catalog`: Catalog object containing locale-specific plural rules
- `message`: Message object to validate

**Behavior:**
- Skips validation for non-pluralizable messages
- Raises `TranslationError` if plural forms are found for non-pluralizable messages
- Checks that the number of translated plural forms matches the catalog's expected count

#### `python_format(catalog, message)`
Validates Python format string placeholders in translations.

**Parameters:**
- `catalog`: Catalog object (may be None)
- `message`: Message object with 'python-format' flag

**Behavior:**
- Only processes messages flagged with 'python-format'
- Validates each msgid/msgstr pair for format string compatibility
- Delegates actual validation to `_validate_format()`

### Helper Functions

#### `_validate_format(format, alternative)`
Core validation logic for comparing format strings.

**Features:**
- Parses Python format strings to extract placeholders
- Ensures consistent use of either positional or named placeholders
- Validates placeholder compatibility using `_string_format_compatibilities`
- Provides detailed error messages for different types of format mismatches

**Example Usage:**
```python
# Compatible formats
_validate_format('Hello %s!', 'Hallo %s!')  # OK
_validate_format('Hello %i!', 'Hallo %d!')  # OK (compatible types)

# Incompatible formats
_validate_format('Hello %(name)s!', 'Hallo %s!')  # Raises TranslationError
```

#### `_find_checkers()`
Dynamically discovers and loads checker functions.

**Behavior:**
- Attempts to load checkers from 'babel.checkers' entry points
- Falls back to built-in checkers if entry points are unavailable
- Returns list of callable checker functions

## Usage Notes

### For Translators
- Ensure translated messages maintain the same format placeholders as the original
- Use compatible format types when exact matches aren't possible (e.g., `%d` and `%i`)
- Don't mix positional (`%s`) and named (`%(name)s`) placeholders in the same string

### For Developers
- The module automatically validates translations during catalog processing
- Custom checkers can be added via the 'babel.checkers' entry point
- All checker functions should follow the signature: `(Catalog | None, Message) -> None`

### Error Handling
All validation errors raise `TranslationError` with descriptive messages:
- "Wrong number of plural forms"
- "Format strings are of different kinds"  
- "Incompatible format for placeholder"
- "Unknown named placeholder"

## Dependencies

- `babel.messages.catalog`: For `Catalog`, `Message`, `TranslationError`, and `PYTHON_FORMAT`
- `babel.messages._compat`: For entry point discovery
- `collections.abc`: For type hints

## Version History
- **Since:** Babel version 0.9
- **Copyright:** 2013-2025 Babel Team
- **License:** BSD