<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Babel Messages Extract Module

This module provides an extensible system for extracting localizable message strings from various source files. It's part of the Babel internationalization library and serves as the foundation for collecting translatable strings from Python, JavaScript, and other file types.

## Purpose

The primary purpose of this module is to:
- Extract translatable strings from source code files
- Support multiple programming languages through an extensible plugin system
- Provide customizable extraction rules and options
- Generate structured output for use in internationalization workflows

## Main Entry Points

### `extract_from_dir()`
Extracts messages from all source files in a directory tree.

```python
def extract_from_dir(
    dirname=None,
    method_map=DEFAULT_MAPPING,
    options_map=None,
    keywords=DEFAULT_KEYWORDS,
    comment_tags=(),
    callback=None,
    strip_comment_tags=False,
    directory_filter=None,
) -> Generator[tuple[str, int, str|tuple[str, ...], list[str], str|None], None, None]
```

**Parameters:**
- `dirname`: Directory path to scan (defaults to current directory)
- `method_map`: List of `(pattern, method)` tuples mapping file patterns to extraction methods
- `options_map`: Dictionary of additional options mapped by file patterns
- `keywords`: Dictionary mapping function names to argument specifications
- `comment_tags`: List of translator comment tags to include
- `callback`: Function called before extracting from each file
- `strip_comment_tags`: Whether to remove comment tags from output
- `directory_filter`: Function to filter which directories to process

**Returns:** Generator yielding 5-tuples of `(filename, lineno, message, comments, context)`

### `extract_from_file()`
Extracts messages from a single file.

```python
def extract_from_file(
    method,
    filename,
    keywords=DEFAULT_KEYWORDS,
    comment_tags=(),
    options=None,
    strip_comment_tags=False,
) -> list[tuple[int, str|tuple[str, ...], list[str], str|None]]
```

**Returns:** List of 4-tuples `(lineno, message, comments, context)`

### `extract()`
Core extraction function that dispatches to appropriate extractors.

```python
def extract(
    method,
    fileobj,
    keywords=DEFAULT_KEYWORDS,
    comment_tags=(),
    options=None,
    strip_comment_tags=False,
) -> Generator[tuple[int, str|tuple[str, ...], list[str], str|None], None, None]
```

## Built-in Extractors

### Python Extractor (`extract_python`)
- Extracts strings from Python source code
- Handles regular strings, f-strings (Python 3.12+), and multiline strings
- Supports translator comments
- Respects encoding declarations and future imports

### JavaScript Extractor (`extract_javascript`)
- Extracts strings from JavaScript/JSX source code
- Supports template strings and JSX syntax
- Handles nested function calls and string concatenation
- Can parse template string contents recursively

### Null Extractor (`extract_nothing`)
- Pseudo-extractor that returns empty results
- Useful for ignoring certain file types

## Configuration

### Default Keywords
```python
DEFAULT_KEYWORDS = {
    '_': None,
    'gettext': None,
    'ngettext': (1, 2),
    'ugettext': None,
    'ungettext': (1, 2),
    'dgettext': (2,),
    'dngettext': (2, 3),
    'N_': None,
    'pgettext': ((1, 'c'), 2),
    'npgettext': ((1, 'c'), 2, 3),
}
```

### Default File Mapping
```python
DEFAULT_MAPPING = [('**.py', 'python')]
```

## Usage Examples

### Basic Directory Extraction
```python
from babel.messages.extract import extract_from_dir

# Extract from all Python files in current directory
for filename, lineno, message, comments, context in extract_from_dir():
    print(f"{filename}:{lineno}: {message}")
```

### Custom Method Mapping
```python
method_map = [
    ('**/templates/**.*', 'genshi'),
    ('**.py', 'python'),
    ('**.js', 'javascript'),
]

options_map = {
    '**.js': {'jsx': True, 'template_string': True}
}

for result in extract_from_dir(method_map=method_map, options_map=options_map):
    # Process results
    pass
```

### Single File Extraction
```python
from babel.messages.extract import extract_from_file

results = extract_from_file('python', 'mymodule.py')
for lineno, message, comments, context in results:
    print(f"Line {lineno}: {message}")
```

## Important Notes

- **Keyword Specifications**: Tuples specify which function arguments contain translatable strings (1-based indexing)
- **Context Support**: Functions like `pgettext` support context strings using `((1, 'c'), 2)` syntax
- **Comment Tags**: Translator comments must immediately precede the translatable string
- **Encoding**: Python files are parsed using their declared encoding or UTF-8 as fallback
- **Extensibility**: New extractors can be added via entry points in the `babel.extractors` group

## Suggestions

1. **Performance**: For large codebases, consider using `directory_filter` to skip unnecessary directories
2. **Custom Extractors**: Implement custom extractors for domain-specific languages or frameworks
3. **Comment Tags**: Use consistent comment tags like `# TRANSLATORS:` for translator notes
4. **Validation**: The module warns about empty msgids which are invalid in gettext
5. **File Patterns**: Use specific patterns in `method_map` to avoid processing unnecessary files