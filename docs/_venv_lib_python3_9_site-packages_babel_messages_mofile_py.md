<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# babel.messages.mofile

## Overview

This module provides functionality for reading and writing GNU gettext MO (Machine Object) files, which are binary files containing compiled translation data. MO files are the compiled version of PO (Portable Object) files used by the gettext internationalization system.

## Purpose

- **Reading**: Parse binary MO files and convert them into Babel `Catalog` objects
- **Writing**: Serialize Babel `Catalog` objects into binary MO format
- **Compatibility**: Maintain compatibility with GNU gettext MO file format specifications

## Constants

```python
LE_MAGIC: int = 0x950412de  # Little-endian magic number
BE_MAGIC: int = 0xde120495  # Big-endian magic number
```

These magic numbers are used to identify valid MO files and determine their byte order.

## Functions

### `read_mo(fileobj: SupportsRead[bytes]) -> Catalog`

Reads a binary MO file and returns a corresponding `Catalog` object.

**Parameters:**
- `fileobj`: A file-like object containing MO file data

**Returns:**
- `Catalog`: A Babel catalog object containing the parsed messages

**Features:**
- Handles both little-endian and big-endian MO files
- Parses message contexts (using `\x04` separator)
- Supports plural forms (using `\x00` separator)
- Extracts catalog metadata from headers
- Validates file integrity

**Error Handling:**
- Raises `OSError` for invalid magic numbers or corrupt files

### `write_mo(fileobj: SupportsWrite[bytes], catalog: Catalog, use_fuzzy: bool = False) -> None`

Writes a `Catalog` object to a file-like object in GNU MO format.

**Parameters:**
- `fileobj`: File-like object to write the MO data to
- `catalog`: The Babel catalog to serialize
- `use_fuzzy`: Whether to include fuzzy translations (default: `False`)

**Features:**
- Filters out empty translations and fuzzy messages (unless `use_fuzzy=True`)
- Handles plural forms correctly
- Supports message contexts
- Sorts messages for consistent output
- Uses little-endian format for output

## Implementation Details

### File Structure

The MO file format consists of:

1. **Header** (28 bytes):
   - Magic number (4 bytes)
   - Version (4 bytes) 
   - Message count (4 bytes)
   - Original strings index offset (4 bytes)
   - Translated strings index offset (4 bytes)
   - Hash table size and offset (8 bytes)

2. **Index Tables**:
   - Original strings index
   - Translated strings index

3. **String Data**:
   - Original strings
   - Translated strings

### Special Encodings

- **Context separation**: Uses `\x04` to separate context from message ID
- **Plural forms**: Uses `\x00` to separate different plural forms
- **Metadata**: Empty message ID contains catalog headers

## Usage Examples

### Reading a MO file

```python
from babel.messages.mofile import read_mo

with open('messages.mo', 'rb') as f:
    catalog = read_mo(f)
    
print(f"Locale: {catalog.locale}")
for message in catalog:
    print(f"{message.id} -> {message.string}")
```

### Writing a MO file

```python
from babel.messages import Catalog
from babel.messages.mofile import write_mo
from io import BytesIO

catalog = Catalog(locale='en_US')
catalog.add('Hello', 'Hola')
catalog.add('Goodbye', 'Adi√≥s')

with open('output.mo', 'wb') as f:
    write_mo(f, catalog)
```

## Notes and Considerations

- **Performance**: The implementation is based on the standard library's `gettext` module for compatibility
- **Encoding**: Respects the catalog's charset setting for proper string encoding/decoding
- **Fuzzy translations**: By default, fuzzy translations are excluded from MO output
- **Error handling**: Provides meaningful error messages for corrupt or invalid files
- **Memory efficiency**: Processes the entire file in memory, so may not be suitable for extremely large MO files

## Dependencies

- `array`: For efficient binary data handling
- `struct`: For binary format parsing and generation
- `babel.messages.catalog`: For `Catalog` and `Message` classes