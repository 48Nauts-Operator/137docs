<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# babel.messages.plurals

## Overview

This module provides plural form definitions for internationalization in the Babel library. It contains a comprehensive mapping of language codes to their corresponding plural rules, which are essential for proper localization of messages that need to change form based on quantity (e.g., "1 item" vs "2 items").

**Purpose:**
- Define plural rules for different languages and locales
- Provide utilities to retrieve plural information for localization
- Support gettext-style pluralization in internationalized applications

> **Note:** The module contains a comment indicating it may be deprecated (`# XXX: remove this file, duplication with babel.plural`), suggesting there might be duplication with another module.

## Key Components

### Constants

#### `LC_CTYPE`
```python
LC_CTYPE: str | None = default_locale('LC_CTYPE')
```
- Stores the default system character type locale
- Used as fallback when no locale is explicitly provided

#### `PLURALS`
```python
PLURALS: dict[str, tuple[int, str]]
```
- Main dictionary mapping language/locale codes to plural rules
- Each entry contains a tuple with:
  - Number of plural forms (int)
  - Plural expression as a string
- Covers 50+ languages including complex cases like Arabic (6 forms) and Breton (6 forms)

**Examples:**
- `'en': (2, '(n != 1)')` - English: 2 forms, singular for 1, plural for others
- `'ar': (6, '(n==0 ? 0 : n==1 ? 1 : n==2 ? 2 : n%100>=3 && n%100<=10 ? 3 : n%100>=0 && n%100<=2 ? 4 : 5)')` - Arabic: 6 complex forms
- `'ja': (1, '0')` - Japanese: 1 form (no pluralization)

#### `DEFAULT_PLURAL`
```python
DEFAULT_PLURAL: tuple[int, str] = (2, '(n != 1)')
```
- Fallback plural rule when language is not found
- Uses English-style pluralization (singular/plural)

### Classes

#### `_PluralTuple`

A specialized tuple class that extends the standard tuple with convenient properties for accessing plural information.

**Properties:**
- `num_plurals: int` - Number of plural forms
- `plural_expr: str` - The plural expression
- `plural_forms: str` - Formatted string for gettext catalogs
- `__str__()` - Returns formatted plural forms string

```python
>>> tup = _PluralTuple((2, '(n != 1)'))
>>> tup.num_plurals
2
>>> tup.plural_expr
'(n != 1)'
>>> tup.plural_forms
'nplurals=2; plural=(n != 1);'
>>> str(tup)
'nplurals=2; plural=(n != 1);'
```

### Functions

#### `get_plural(locale=None)`

Main function to retrieve plural information for a given locale.

**Parameters:**
- `locale` (Locale | str | None): Locale object or identifier. Defaults to system locale.

**Returns:**
- `_PluralTuple`: Tuple containing plural count and expression

**Logic:**
1. Parses the provided locale or uses system default
2. Attempts exact locale match (e.g., 'pt_BR')
3. Falls back to language code (e.g., 'pt')
4. Uses default plural rule if no match found

**Examples:**
```python
>>> get_plural('en')
(2, '(n != 1)')

>>> get_plural('ja')
(1, '0')

>>> get_plural('ar')
(6, '(n==0 ? 0 : n==1 ? 1 : n==2 ? 2 : n%100>=3 && n%100<=10 ? 3 : n%100>=0 && n%100<=2 ? 4 : 5)')
```

## Usage Examples

### Basic Usage
```python
from babel.messages.plurals import get_plural

# Get plural info for English
en_plural = get_plural('en')
print(f"English has {en_plural.num_plurals} plural forms")
print(f"Expression: {en_plural.plural_expr}")

# Use in gettext catalog
print(str(en_plural))  # Output: nplurals=2; plural=(n != 1);
```

### Working with Complex Languages
```python
# Arabic has 6 plural forms
ar_plural = get_plural('ar')
print(f"Arabic has {ar_plural.num_plurals} plural forms")

# Languages with no pluralization
ja_plural = get_plural('ja')
print(f"Japanese has {ja_plural.num_plurals} plural form(s)")
```

## Important Notes

- **Deprecation Warning**: The module header suggests this file may be removed due to duplication
- **Fallback Strategy**: Uses a three-tier fallback (exact locale → language → default)
- **Gettext Compatibility**: The `_PluralTuple` class formats output for gettext catalogs
- **Coverage**: Supports 50+ languages with varying complexity levels
- **Expression Format**: Plural expressions use C-style ternary operators

## Suggestions for Improvement

1. **Consider consolidation** with `babel.plural` to eliminate duplication
2. **Add validation** for plural expressions to catch syntax errors
3. **Include more locales** - many languages are commented out as placeholders
4. **Add documentation** for plural expression syntax
5. **Consider caching** parsed locales for performance
6. **Add type hints** for better IDE support (partially implemented)