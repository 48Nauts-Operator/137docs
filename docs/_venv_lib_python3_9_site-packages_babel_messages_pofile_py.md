<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Babel PO File Module Documentation

## Overview

The `babel.messages.pofile` module provides functionality for reading and writing files in the **gettext** PO (Portable Object) format. This module is part of the Babel internationalization library and handles the parsing and generation of translation files used by the GNU gettext system.

## Purpose

This module enables:
- **Reading PO files** into Babel `Catalog` objects
- **Writing Catalog objects** back to PO file format
- **Parsing and formatting** PO file syntax with proper escaping/unescaping
- **Handling obsolete messages** and comments
- **Supporting Unicode directional isolates** for filenames with spaces

## Key Functions

### String Processing Functions

#### `unescape(string: str) -> str`
Reverses escape sequences in PO file strings.

```python
>>> print(unescape('"Say:\\n  \\"hello, world!\\"\\n"'))
Say:
  "hello, world!"
```

#### `escape(string: str) -> str`  
Escapes strings for inclusion in PO files.

```python
>>> escape('Say:\n  "hello, world!"\n')
'"Say:\\n  \\"hello, world!\\"\\n"'
```

#### `normalize(string: str, prefix: str = '', width: int = 76) -> str`
Formats strings appropriately for PO files with line wrapping.

```python
>>> print(normalize('Say:\n  "hello, world!"\n', width=None))
""
"Say:\n"
"  \"hello, world!\"\n"
```

#### `denormalize(string: str) -> str`
Reverses normalization to get the original string content.

### File I/O Functions

#### `read_po(fileobj, locale=None, domain=None, ignore_obsolete=False, charset=None, abort_invalid=False) -> Catalog`
**Primary function for reading PO files.**

```python
from babel.messages.pofile import read_po
from io import StringIO

po_content = '''
#: main.py:1
#, fuzzy, python-format
msgid "Hello %(name)s"
msgstr "Hola %(name)s"
'''

catalog = read_po(StringIO(po_content))
```

**Parameters:**
- `fileobj`: File-like object or iterable of lines
- `locale`: Locale identifier or Locale object
- `domain`: Message domain
- `ignore_obsolete`: Skip obsolete messages
- `charset`: Character encoding
- `abort_invalid`: Raise exception on invalid PO syntax

#### `write_po(fileobj, catalog, width=76, no_location=False, omit_header=False, sort_output=False, sort_by_file=False, ignore_obsolete=False, include_previous=False, include_lineno=True)`
**Primary function for writing PO files.**

```python
from babel.messages.pofile import write_po
from babel.messages.catalog import Catalog
from io import BytesIO

catalog = Catalog()
catalog.add('Hello', 'Hola', locations=[('main.py', 1)])

buf = BytesIO()
write_po(buf, catalog)
```

**Parameters:**
- `fileobj`: File-like object to write to
- `catalog`: Catalog instance to write
- `width`: Maximum line width (0 or negative disables wrapping)
- `no_location`: Omit location comments
- `omit_header`: Skip the header message
- `sort_output`: Sort messages by msgid
- `sort_by_file`: Sort messages by location
- `ignore_obsolete`: Skip obsolete messages
- `include_previous`: Include previous msgid in comments
- `include_lineno`: Include line numbers in location comments

#### `generate_po(catalog, **kwargs) -> Iterable[str]`
Generator version of `write_po()` that yields strings instead of writing to a file.

## Key Classes

### `PoFileParser`
**Low-level parser class for PO files.**

```python
parser = PoFileParser(catalog, ignore_obsolete=False, abort_invalid=False)
parser.parse(fileobj)
```

**Key Methods:**
- `parse(fileobj)`: Parse PO file content
- `_process_message_line()`: Handle message lines
- `_process_comment()`: Handle comment lines
- `_add_message()`: Add parsed message to catalog

### `PoFileError`
**Exception class for PO file parsing errors.**

```python
class PoFileError(Exception):
    def __init__(self, message: str, catalog: Catalog, line: str, lineno: int):
        # Contains error context including line number and content
```

### `_NormalizedString` (Internal)
Helper class for handling multi-line strings in PO format.

## Usage Examples

### Reading a PO File

```python
from babel.messages.pofile import read_po

# From file
with open('messages.po', 'r', encoding='utf-8') as f:
    catalog = read_po(f, locale='es')

# From string
from io import StringIO
po_text = '''
msgid "Hello"
msgstr "Hola"
'''
catalog = read_po(StringIO(po_text))
```

### Writing a PO File

```python
from babel.messages.catalog import Catalog
from babel.messages.pofile import write_po

catalog = Catalog(locale='es')
catalog.add('Hello', 'Hola')
catalog.add('Goodbye', 'Adi√≥s')

with open('output.po', 'wb') as f:
    write_po(f, catalog, width=80, sort_output=True)
```

## Important Notes

### Character Encoding
- **Default encoding**: UTF-8
- **Specify charset** parameter when reading files with different encodings
- **Output encoding**: Uses catalog's charset property

### Unicode Support
- Handles **Unicode directional isolates** (U+2068, U+2069) for filenames with spaces
- Properly escapes Unicode characters in strings

### Error Handling
- **Graceful degradation**: By default, prints warnings for invalid syntax
- **Strict mode**: Set `abort_invalid=True` to