<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# babel.messages.pofile

This module provides functionality for reading and writing gettext PO (Portable Object) files, which are used for internationalization and localization of software applications.

## Purpose

The module handles the parsing and generation of PO files, which contain translatable message strings and their translations. It provides tools to:

- Parse PO files into `Catalog` objects
- Write `Catalog` objects back to PO file format
- Handle string escaping/unescaping and normalization
- Support various PO file features like plural forms, contexts, comments, and obsolete messages

## Key Functions

### String Processing Functions

#### `unescape(string: str) -> str`
Reverses escape sequences in PO file strings.

```python
# Example: converts escaped newlines back to actual newlines
print(unescape('"Say:\\n  \\"hello, world!\\"\\n"'))
# Output:
# Say:
#   "hello, world!"
```

#### `escape(string: str) -> str`
Escapes strings for inclusion in PO files by adding quotes and escaping special characters.

```python
result = escape('Say:\n  "hello, world!"\n')
# Returns: '"Say:\\n  \\"hello, world!\\"\\n"'
```

#### `normalize(string: str, prefix: str = '', width: int = 76) -> str`
Formats strings appropriately for PO files, handling line wrapping and multi-line strings.

#### `denormalize(string: str) -> str`
Reverses the normalization process to reconstruct original strings.

### File I/O Functions

#### `read_po(fileobj, locale=None, domain=None, ignore_obsolete=False, charset=None, abort_invalid=False) -> Catalog`
Main function to read PO files and create `Catalog` objects.

**Parameters:**
- `fileobj`: File-like object or iterable of lines containing PO data
- `locale`: Target locale for the catalog
- `domain`: Message domain
- `ignore_obsolete`: Whether to skip obsolete messages
- `charset`: Character encoding of the catalog
- `abort_invalid`: Whether to raise exceptions on invalid PO syntax

**Example:**
```python
from io import StringIO
po_content = '''
#: main.py:1
#, fuzzy, python-format
msgid "foo %(name)s"
msgstr "queux %(name)s"
'''
catalog = read_po(StringIO(po_content))
```

#### `write_po(fileobj, catalog, width=76, no_location=False, omit_header=False, sort_output=False, sort_by_file=False, ignore_obsolete=False, include_previous=False, include_lineno=True)`
Writes a `Catalog` object to a PO file.

**Key Parameters:**
- `width`: Maximum line width (0 or None disables wrapping)
- `no_location`: Omit location comments
- `sort_output`: Sort messages by msgid
- `sort_by_file`: Sort messages by file location
- `include_previous`: Include previous msgid when updating

#### `generate_po(catalog, *, ignore_obsolete=False, include_lineno=True, ...) -> Iterable[str]`
Generator version of `write_po` that yields strings instead of writing to a file.

## Key Classes

### `PoFileParser`
Low-level parser class for processing PO files line by line.

**Key Methods:**
- `parse(fileobj)`: Parse a file object and populate the catalog
- `_process_message_line()`: Handle message definition lines
- `_process_comment()`: Handle comment lines

**Usage:**
```python
catalog = Catalog()
parser = PoFileParser(catalog, ignore_obsolete=True)
parser.parse(file_object)
```

### `PoFileError`
Exception class for PO file parsing errors.

**Attributes:**
- `catalog`: The catalog being parsed
- `line`: The problematic line
- `lineno`: Line number where error occurred

### `_NormalizedString` 
Internal class for handling multi-line strings in PO files with proper normalization.

## Utility Functions

### `_extract_locations(line: str) -> list[str]`
Extracts file locations from location comments, properly handling Unicode directional isolate characters for filenames with spaces.

### `_enclose_filename_if_necessary(filename: str) -> str`
Adds Unicode directional isolate characters around filenames containing whitespace, following gettext conventions.

## Notes and Suggestions

### Performance Considerations
- For large PO files, consider using `ignore_obsolete=True` if obsolete messages aren't needed
- The `abort_invalid=False` default allows parsing of imperfect PO files with warnings

### Error Handling
- Set `abort_invalid=True` for strict parsing that raises `PoFileError` on invalid syntax
- The parser attempts to continue processing even with some syntax errors

### Unicode Support
- The module properly handles Unicode directional isolate characters in filenames
- Charset detection and conversion is handled automatically

### Best Practices
```python
# Reading PO files
try:
    catalog = read_po(file_obj, abort_invalid=True)
except PoFileError as e:
    print(f"Parse error at line {e.lineno}: {e}")

# Writing PO files with good formatting
write_po(output_file, catalog, 
         width=78,           # Reasonable line width
         sort_output=True,   # Consistent ordering
         include_lineno=True # Helpful for developers
)
```

### Compatibility
- Follows gettext PO file format specifications
- Handles both simple and complex PO file features (plurals, contexts, flags)
- Compatible with standard gettext tools