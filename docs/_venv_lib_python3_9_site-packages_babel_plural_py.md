<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# babel.numbers - CLDR Plural Support Documentation

## Overview

This module implements CLDR (Common Locale Data Repository) plural rule support according to UTS #35 (Unicode Technical Standard). It provides functionality to parse, compile, and evaluate plural rules for internationalization purposes, supporting multiple output formats including Python functions, JavaScript, and gettext expressions.

## Key Features

- Parse and evaluate CLDR plural rules
- Convert between different rule formats (Python, JavaScript, gettext)
- Extract numeric operands according to CLDR specifications
- Support for all CLDR plural categories: zero, one, two, few, many, other

## Important Functions

### `extract_operands(source)`

Extracts operands from a number according to CLDR rules, returning an 8-tuple of values used in plural rule evaluation.

```python
def extract_operands(source: float | decimal.Decimal) -> tuple[...]:
    """Extract operands from a decimal, a float or an int, according to CLDR rules.
    
    Returns: (n, i, v, w, f, t, c, e) where:
    - n: absolute value of the source number
    - i: integer digits of n
    - v: number of visible fraction digits (with trailing zeros)
    - w: number of visible fraction digits (without trailing zeros)
    - f: visible fractional digits (with trailing zeros)
    - t: visible fractional digits (without trailing zeros)
    - c: compact decimal exponent (currently 0)
    - e: synonym for c (currently 0)
    """
```

### `to_python(rule)`

Converts plural rules into a Python function for efficient evaluation.

```python
func = to_python({'one': 'n is 1', 'few': 'n in 2..4'})
print(func(1))  # 'one'
print(func(3))  # 'few'
```

### `to_javascript(rule)`

Converts plural rules into a JavaScript function string.

```python
js_func = to_javascript({'one': 'n is 1'})
# Returns: "(function(n) { return (n == 1) ? 'one' : 'other'; })"
```

### `to_gettext(rule)`

Converts plural rules into gettext-compatible expressions.

```python
gettext_expr = to_gettext({'one': 'n is 1', 'two': 'n is 2'})
# Returns: "nplurals=3; plural=((n == 1) ? 0 : (n == 2) ? 1 : 2);"
```

## Main Classes

### `PluralRule`

The core class for representing and evaluating plural rules.

```python
class PluralRule:
    """Represents a set of language pluralization rules."""
    
    def __init__(self, rules: Mapping[str, str] | Iterable[tuple[str, str]]):
        """Initialize with rules as dict or list of (tag, expression) tuples."""
    
    def __call__(self, n: float | decimal.Decimal) -> str:
        """Evaluate the rule for number n, returning the appropriate tag."""
    
    @property
    def rules(self) -> Mapping[str, str]:
        """Return rules as a dictionary."""
    
    @property
    def tags(self) -> frozenset[str]:
        """Return set of explicitly defined tags."""
```

#### Usage Example

```python
rule = PluralRule({'one': 'n is 1', 'few': 'n in 2..4'})
print(rule(1))    # 'one'
print(rule(3))    # 'few'
print(rule(5))    # 'other'
```

## Utility Functions

### Range Testing Functions

- **`in_range_list(num, range_list)`**: Tests if an integer is within specified ranges
- **`within_range_list(num, range_list)`**: Tests if a number (including decimals) is within ranges
- **`cldr_modulo(a, b)`**: Java-style modulo operation (result has sign of dividend)

## Internal Components

### Parser Classes

- **`_Parser`**: Parses CLDR rule expressions into abstract syntax trees
- **`_Compiler`**: Base class for compiling expressions to different formats
- **`_PythonCompiler`**: Compiles to Python code
- **`_JavaScriptCompiler`**: Compiles to JavaScript code  
- **`_GettextCompiler`**: Compiles to gettext format
- **`_UnicodeCompiler`**: Compiles back to Unicode CLDR format

### Grammar Support

The parser implements a complete grammar for CLDR plural rules including:
- Logical operators: `and`, `or`, `not`
- Comparison operators: `is`, `in`, `within`
- Mathematical operators: `mod`, `%`
- Range expressions: `1..5`, `1,3,5..10`
- Variable references: `n`, `i`, `v`, `w`, `f`, `t`, `c`, `e`

## Error Handling

### `RuleError`

Custom exception raised when plural rule expressions are malformed.

```python
class RuleError(Exception):
    """Raised if a rule is malformed."""
```

## Usage Notes

- **Performance**: The `to_python()` function creates optimized Python functions for best performance
- **Compatibility**: JavaScript output is self-contained and requires no external libraries
- **Gettext Integration**: The `to_gettext()` function provides seamless integration with GNU gettext
- **CLDR Compliance**: Full support for CLDR plural rule specifications

## Example Usage

```python
# Define rules for a language
rules = {
    'one': 'n is 1',
    'few': 'n in 2..4', 
    'many': 'n mod 10 in 5..9'
}

# Create and use a PluralRule
rule = PluralRule(rules)
print(rule(1))  # 'one'
print(rule(3))  # 'few' 
print(rule(7))  # 'many'
print(rule(10)) # 'other'

# Convert to different formats
python_