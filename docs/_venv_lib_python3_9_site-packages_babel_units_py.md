<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Unit Formatting Module Documentation

## Overview

This Python module provides internationalized unit formatting capabilities using the Babel library. It enables formatting of measurement units, compound units (like "kilometers per hour"), and unit display names according to locale-specific rules and pluralization patterns.

The module relies on the Unicode CLDR (Common Locale Data Repository) for unit definitions and formatting patterns.

## Classes

### `UnknownUnitError`

A custom exception raised when an unknown or unsupported measurement unit is encountered.

```python
class UnknownUnitError(ValueError):
    def __init__(self, unit: str, locale: Locale) -> None:
        ValueError.__init__(self, f"{unit} is not a known unit in {locale}")
```

**Parameters:**
- `unit`: The unknown unit identifier
- `locale`: The locale where the unit was not found

## Public Functions

### `get_unit_name(measurement_unit, length='long', locale=None)`

Retrieves the localized display name for a measurement unit.

**Parameters:**
- `measurement_unit` (str): Unit code (e.g., "radian", "meter")
- `length` (Literal['short', 'long', 'narrow']): Display format length
- `locale` (Locale | str | None): Target locale

**Returns:** `str | None` - The localized unit name

**Example:**
```python
get_unit_name("radian", locale="en")  # Returns: 'radians'
```

**Raises:** `UnknownUnitError` for invalid units

### `format_unit(value, measurement_unit, length='long', format=None, locale=None, *, numbering_system="latn")`

Formats a numeric value with its measurement unit according to locale conventions.

**Parameters:**
- `value` (str | float | decimal.Decimal): The value to format
- `measurement_unit` (str): Unit identifier
- `length` (Literal['short', 'long', 'narrow']): Display format
- `format` (str | None): Optional number format pattern
- `locale` (Locale | str | None): Target locale
- `numbering_system` (str): Number system for formatting (default: "latn")

**Returns:** `str` - Formatted unit string

**Examples:**
```python
format_unit(12, 'length-meter', locale='ro_RO')     # '12 metri'
format_unit(15.5, 'length-mile', locale='fi_FI')    # '15,5 mailia'
format_unit(1, 'length-meter', locale='ro_RO')      # '1 metru' (singular)
```

**Features:**
- Respects locale pluralization rules
- Supports various numbering systems
- Handles preformatted string values

### `format_compound_unit(numerator_value, numerator_unit=None, denominator_value=1, denominator_unit=None, length="long", format=None, locale=None, *, numbering_system="latn")`

Formats compound units like ratios or rates (e.g., "kilometers per hour").

**Parameters:**
- `numerator_value` (str | float | decimal.Decimal): Numerator value
- `numerator_unit` (str | None): Numerator unit
- `denominator_value` (str | float | decimal.Decimal): Denominator value (default: 1)
- `denominator_unit` (str | None): Denominator unit
- `length`, `format`, `locale`, `numbering_system`: Same as `format_unit`

**Returns:** `str | None` - Formatted compound unit string

**Examples:**
```python
format_compound_unit(150, "kilometer", denominator_unit="hour", locale="sv")
# Returns: '150 kilometer per timme'

format_compound_unit(7, denominator_value=11, length="short", locale="pt")
# Returns: '7/11'
```

**Features:**
- Attempts to use predefined compound units when available
- Falls back to generic "per" patterns
- Supports preformatted values
- Handles unitless numerators/denominators

## Internal Helper Functions

### `_find_unit_pattern(unit_id, locale=None)`

Expands partial unit identifiers into fully qualified forms.

**Example:**
```python
_find_unit_pattern("radian", locale="en")  # Returns: 'angle-radian'
```

### `_find_compound_unit(numerator_unit, denominator_unit, locale=None)`

Searches for predefined compound unit patterns in CLDR data.

**Example:**
```python
_find_compound_unit("kilometer", "hour", locale="en")  # Returns: 'speed-kilometer-per-hour'
```

## Key Features

- **Locale-aware formatting**: Respects cultural conventions for number and unit display
- **Pluralization support**: Automatically handles singular/plural forms
- **Flexible input**: Accepts strings, floats, and Decimal values
- **Comprehensive unit support**: Based on Unicode CLDR unit definitions
- **Compound units**: Special handling for rates and ratios
- **Multiple display lengths**: Short, long, and narrow formats
- **Custom numbering systems**: Support for non-Latin numerals

## Unit Reference

Valid measurement units can be found in the [CLDR Unit Validity XML file](https://unicode.org/repos/cldr/tags/latest/common/validity/unit.xml).

## Notes and Suggestions

1. **Error Handling**: Always handle `UnknownUnitError` when working with dynamic unit inputs
2. **Performance**: Consider caching locale objects for repeated formatting operations
3. **Unit Validation**: Validate unit identifiers against CLDR data before formatting
4. **Fallback Strategy**: The module provides graceful fallbacks when specific compound units aren't available
5. **Version Requirements**: The `format_unit` function was added in version 2.2.0

## Dependencies

- `babel.core.Locale`: Locale handling
- `babel.numbers`: Number formatting utilities
- `decimal`: Decimal number support
- `typing`: Type hints