<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# babel.util

This module provides various utility classes and functions for the Babel internationalization library. It contains helper functions for working with iterables, file parsing, pattern matching, text wrapping, and timezone handling.

## Purpose

The `babel.util` module serves as a collection of general-purpose utilities that support Babel's core functionality. These utilities are used throughout the Babel library for tasks such as:

- Processing Python source files to extract encoding and future imports
- Pattern matching for file paths
- Text wrapping with internationalization considerations
- Timezone handling
- General data processing utilities

## Key Functions and Classes

### Data Processing Utilities

#### `distinct(iterable)`

Yields unique items from an iterable while preserving order.

```python
from babel.util import distinct

# Remove duplicates while preserving order
result = list(distinct([1, 2, 1, 3, 4, 4]))
# Output: [1, 2, 3, 4]
```

**Parameters:**
- `iterable`: The iterable collection to process

**Returns:** Generator yielding distinct items in original order

### File Parsing Utilities

#### `parse_encoding(fp)`

Extracts encoding information from Python source files by reading magic comments.

```python
with open('source.py', 'rb') as f:
    encoding = parse_encoding(f)
```

**Parameters:**
- `fp`: Seekable file object opened in binary mode

**Returns:** Encoding string or `None` if no encoding specified

**Features:**
- Follows Python interpreter's encoding detection rules
- Handles BOM (Byte Order Mark) detection
- Checks first two lines for encoding declarations
- Validates syntax to avoid false positives

#### `parse_future_flags(fp, encoding='latin-1')`

Parses `__future__` import statements to determine compiler flags.

```python
with open('source.py', 'rb') as f:
    flags = parse_future_flags(f)
```

**Parameters:**
- `fp`: File object opened in binary mode
- `encoding`: Text encoding to use (default: 'latin-1')

**Returns:** Integer representing combined compiler flags

### Pattern Matching

#### `pathmatch(pattern, filename)`

Extended pathname pattern matching with support for recursive wildcards.

```python
from babel.util import pathmatch

# Match any Python file
pathmatch('**.py', 'src/module.py')  # True

# Match files in specific directory structure
pathmatch('**/templates/*.html', 'app/templates/index.html')  # True
```

**Supported Patterns:**
- `?`: Single character (except path separator)
- `*`: Multiple characters (except path separator)
- `**`: Recursive directory matching
- `^pattern`: Match from beginning of path
- `./pattern`: Match relative paths

### Text Processing

#### `TextWrapper` Class

Enhanced text wrapper that handles special cases for internationalization.

```python
from babel.util import TextWrapper

wrapper = TextWrapper(width=70, break_long_words=False)
wrapped_lines = wrapper.wrap(text)
```

**Features:**
- Doesn't break on em-dashes
- Preserves enclosed filenames with Unicode characters
- Extends `textwrap.TextWrapper` from standard library

#### `wraptext()` Function

**⚠️ Deprecated:** This function is deprecated and will be removed in a future version.

```python
# Use TextWrapper class instead
wrapper = TextWrapper(width=width, initial_indent=initial_indent)
lines = wrapper.wrap(text)
```

### Timezone Utilities

#### `FixedOffsetTimezone` Class

Simple timezone implementation for fixed UTC offsets.

```python
from babel.util import FixedOffsetTimezone

# Create timezone with +5:30 offset
tz = FixedOffsetTimezone(330, 'IST')  # 330 minutes = 5.5 hours
```

**Parameters:**
- `offset`: Offset in minutes from UTC
- `name`: Optional timezone name

## Constants and Re-exports

The module also provides several constants and re-exports for backward compatibility:

- `missing`: Sentinel object for missing values
- `UTC`, `LOCALTZ`: Timezone objects
- `ZERO`, `STDOFFSET`, `DSTOFFSET`: Time delta constants
- `get_localzone()`: Function to get local timezone

## Notes and Suggestions

### Best Practices

1. **Use `distinct()` instead of `set()`** when order preservation is important
2. **Handle encoding detection carefully** - always check return value of `parse_encoding()`
3. **Use `TextWrapper` class directly** instead of deprecated `wraptext()` function
4. **Test pattern matching thoroughly** - the `**` wildcard behavior may be unintuitive

### Migration Notes

- The `wraptext()` function is deprecated - migrate to `TextWrapper` class
- The `odict` export (formerly OrderedDict) now points to regular `dict` (Python 3.7+ behavior)

### Common Use Cases

```python
# Extract unique items preserving order
unique_items = list(distinct(source_list))

# Check if file matches pattern
if pathmatch('**/*.py', filepath):
    process_python_file(filepath)

# Parse Python file encoding
with open(filename, 'rb') as f:
    encoding = parse_encoding(f) or 'utf-8'

# Wrap text with custom behavior
wrapper = TextWrapper(width=80, break_long_words=False)
lines = wrapper.wrap(long_text)
```

This module is essential for Babel's file processing and text handling capabilities, providing robust utilities that handle edge cases common in internationalization scenarios.