<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Backrefs RE Module Documentation

## Overview

The `backrefs` module extends Python's built-in `re` module with additional regex functionality, providing enhanced backref support for both search patterns and replacement templates. It adds support for Unicode properties, POSIX character classes, advanced case conversion, and other useful regex features not available in the standard library.

## Purpose

This module serves as a drop-in replacement for Python's `re` module while adding:

- Extended character classes (`\l`, `\c`, `\L`, `\C`)
- Unicode property support (`\pL`, `\p{Lu}`, etc.)
- POSIX-style character classes (`[:ascii:]`)
- Advanced replacement features with case conversion
- Generic line break matching (`\R`)
- Word boundary extensions (`\m`, `\M`)
- Grapheme cluster support (`\X`)

## Key Classes

### `Bre` Class

The main compiled pattern class that wraps compiled regex patterns with enhanced functionality.

```python
class Bre(Generic[AnyStr]):
    """Enhanced compiled regex pattern with backref support."""
    
    def __init__(self, pattern: Pattern[AnyStr], auto_compile: bool = True) -> None:
        """Initialize with a compiled pattern and auto-compile setting."""
```

#### Key Properties:
- `pattern`: Returns the original pattern string
- `flags`: Returns the regex flags used
- `groupindex`: Returns the group index mapping
- `groups`: Returns the groups tuple
- `auto_compile`: Controls automatic compilation of replacement templates

#### Key Methods:
- `search()`, `match()`, `fullmatch()`: Standard regex search methods
- `split()`, `findall()`, `finditer()`: Standard regex utility methods
- `sub()`, `subn()`: Standard substitution with enhanced backref support
- `subf()`, `subfn()`: Format-style substitution methods
- `compile()`: Compile replacement templates

### `ReplaceTemplate` Class

Imported from `_bre_parse`, this class represents compiled replacement templates with enhanced backref support.

## Important Functions

### Compilation Functions

```python
def compile(pattern, flags=0, auto_compile=None) -> Bre[AnyStr]:
    """Compile pattern into enhanced Bre object."""

def compile_search(pattern, flags=0) -> Pattern[AnyStr]:
    """Compile search pattern with backref support."""

def compile_replace(pattern, repl, flags=0) -> Callable:
    """Compile replacement template with backref support."""
```

### Core Regex Functions

All standard `re` module functions are available with enhanced backref support:

```python
def search(pattern, string, flags=0, *args, **kwargs) -> Match | None:
    """Enhanced search with backref support."""

def sub(pattern, repl, string, count=0, flags=0, **kwargs) -> AnyStr:
    """Enhanced substitution with backref support."""

def subf(pattern, repl, string, count=0, flags=0, **kwargs) -> AnyStr:
    """Format-style substitution with backref support."""
```

### Expansion Functions

```python
def expand(m, repl) -> AnyStr:
    """Expand match using replacement template."""

def expandf(m, repl) -> AnyStr:
    """Expand match using format-style replacement template."""
```

### Utility Functions

```python
def purge() -> None:
    """Clear internal caches."""
```

## Enhanced Backref Features

### Search Pattern Extensions

- **Case Classes**: `\l` (lowercase), `\c` (uppercase), `\L` (not lowercase), `\C` (not uppercase)
- **Quote/Escape**: `\Q...\E` for literal text matching
- **POSIX Classes**: `[:ascii:]`, `[:^ascii:]` for POSIX-style character classes
- **Unicode Properties**: `\pL`, `\p{Lu}`, `\p{Letter}` for Unicode character properties
- **Word Boundaries**: `\m` (start), `\M` (end) for enhanced word boundary matching
- **Line Breaks**: `\R` for generic line break matching
- **Grapheme Clusters**: `\X` for simplified grapheme cluster matching

### Replacement Extensions

- **Case Conversion**: `\l`, `\L...\E` (lowercase), `\c`, `\C...\E` (uppercase)
- **Unicode Characters**: `\u0000`, `\U00000000` for Unicode character insertion
- **Named Characters**: `\N{Black Club Suit}` for Unicode characters by name

## Usage Examples

### Basic Usage

```python
import backrefs as bre

# Compile a pattern with Unicode property support
pattern = bre.compile(r'\p{Lu}+')  # Match uppercase letters
result = pattern.search("Hello WORLD")

# Use enhanced replacement features
text = bre.sub(r'(\w+)', r'\c\1', "hello world")  # Capitalize words
```

### Format-Style Replacements

```python
# Using format-style replacements
pattern = bre.compile(r'(\w+)\s+(\w+)')
result = pattern.subf(r'\c\1 \c\2', "john doe")  # "John Doe"
```

## Constants and Flags

The module exports all standard `re` module flags:

- `DEBUG`, `I`/`IGNORECASE`, `L`/`LOCALE`, `M`/`MULTILINE`
- `S`/`DOTALL`, `U`/`UNICODE`, `X`/`VERBOSE`, `A`/`ASCII`
- `FORMAT`: Special flag for format-style replacements

## Performance Notes

- The module uses LRU caching with a maximum cache size of 500 entries
- Compiled patterns and replacement templates are cached for performance
- Use `purge()` to clear caches if memory usage becomes a concern

## Suggestions and Best Practices

1. **Use compiled patterns** for repeated operations to maximize cache benefits
2. **Enable auto_compile** (default) for automatic replacement template compilation
3. **Use format-style functions** (`subf`, `subfn`, `expandf`) for advanced formatting needs
4. **Test Unicode patterns** thoroughly as behavior may vary across platforms
5. **Cache management**: Call `purge()`