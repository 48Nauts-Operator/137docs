<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Backrefs RE Module Documentation

## Overview

The `backrefs` module extends Python's built-in `re` module with additional backref functionality for both search patterns and replacement strings. It provides enhanced regex capabilities including Unicode properties, POSIX character classes, case conversion, and more sophisticated pattern matching features.

## Purpose

This module adds support for extended regex features that are not available in Python's standard `re` module:

### Search Features
- **Case classes**: `\l` (lowercase), `\c` (uppercase), `\L` (not lowercase), `\C` (not uppercase)
- **Quoting**: `\Q...\E` for literal text escaping
- **POSIX classes**: `[:ascii:]`, `[:^ascii:]` etc.
- **Unicode properties**: `\pL`, `\p{Lu}`, `\p{Letter}`, etc.
- **Word boundaries**: `\m` (start), `\M` (end)
- **Line breaks**: `\R` (generic line breaks)
- **Grapheme clusters**: `\X` (simplified grapheme clusters)

### Replacement Features
- **Case conversion**: `\l`, `\L...\E` (lowercase), `\c`, `\C...\E` (uppercase)
- **Unicode characters**: `\u0000`, `\U00000000`, `\N{name}`
- **Format-style replacements**: Enhanced replacement templates

## Key Classes

### `Bre` Class

A compiled regex object that wraps Python's `Pattern` with extended functionality.

```python
class Bre:
    def __init__(self, pattern: Pattern[AnyStr], auto_compile: bool = True)
```

**Key Features:**
- **Auto-compilation**: Automatically compiles replacement templates when `auto_compile=True`
- **All standard regex methods**: `search()`, `match()`, `split()`, `findall()`, etc.
- **Enhanced substitution**: `sub()`, `subn()`, `subf()`, `subfn()` with backref support
- **Immutable**: Thread-safe compiled pattern object

**Properties:**
- `pattern`: Original pattern string
- `flags`: Regex flags used
- `groupindex`: Named group mappings
- `groups`: Captured groups

### `ReplaceTemplate` Class

A compiled replacement template (imported from `_bre_parse`).

```python
# Used for pre-compiled replacement patterns
template = compile_replace(pattern, r'\c\1\l\2')  # Returns ReplaceTemplate
```

## Important Functions

### Compilation Functions

#### `compile(pattern, flags=0, auto_compile=None)`
```python
# Compile pattern with extended features
regex = compile(r'\pL+')  # Unicode letters
compiled = compile(r'hello', auto_compile=True)
```

#### `compile_search(pattern, flags=0)`
```python
# Compile search pattern only
pattern = compile_search(r'\Q...\E')  # Literal matching
```

#### `compile_replace(pattern, repl, flags=0)`
```python
# Compile replacement template
pattern = compile_search(r'(\w+)')
repl_func = compile_replace(pattern, r'\c\1')  # Uppercase first group
```

### Search Functions

All standard `re` functions with extended backref support:

```python
# Standard usage with extended features
match = search(r'\pL+', 'Hello')  # Unicode letters
results = findall(r'\m\w+\M', text)  # Word boundaries
parts = split(r'\R', multiline_text)  # Generic line breaks
```

### Substitution Functions

#### `sub()` and `subn()`
```python
# Basic substitution with backrefs
result = sub(r'(\w+)', r'\c\1', 'hello world')  # 'Hello World'
result, count = subn(r'(\w+)', r'\l\1', 'HELLO WORLD')  # ('hello world', 2)
```

#### `subf()` and `subfn()`
Format-style replacements with enhanced features:

```python
# Format-style replacement
result = subf(r'(?P<word>\w+)', r'\c{word}', 'hello')  # 'Hello'
```

### Expansion Functions

#### `expand(match, repl)`
```python
match = search(r'(\w+)', 'hello')
result = expand(match, r'\c\1')  # 'Hello'
```

#### `expandf(match, repl)`
```python
match = search(r'(?P<word>\w+)', 'hello')
result = expandf(match, r'\c{word}')  # 'Hello' - format style
```

## Constants and Flags

The module re-exports all standard `re` flags:

```python
# Standard re flags
DEBUG, I, IGNORECASE, L, LOCALE, M, MULTILINE
S, DOTALL, U, UNICODE, X, VERBOSE, A, ASCII

# Additional flags
FORMAT = 1  # For format-style replacements
```

## Usage Examples

### Basic Pattern Matching
```python
import backrefs

# Unicode property matching
pattern = backrefs.compile(r'\p{Letter}+')
match = pattern.search('Hello世界')

# POSIX character classes
emails = backrefs.findall(r'[\w.]+@[:alnum:]+\.[:alpha:]+', text)
```

### Case Conversion
```python
# Convert to title case
title = backrefs.sub(r'\b(\w)(\w*)', r'\c\1\l\2', 'hello world')
# Result: 'Hello World'

# Using format style
title = backrefs.subf(r'\b(?P<first>\w)(?P<rest>\w*)', 
                      r'\c{first}\l{rest}', 'hello world')
```

### Compiled Objects
```python
# Pre-compile for better performance
regex = backrefs.compile(r'\p{Letter}+', auto_compile=True)
result = regex.sub(r'\c\g<0>', text)  # Uppercase all matches

# Manual replacement compilation
replace_func = regex.compile(r'\