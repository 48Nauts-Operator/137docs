<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Backrefs for the 'regex' Module Documentation

## Overview

This module extends the Python `regex` module with additional backref (backreference) functionality. It provides enhanced pattern matching and replacement capabilities beyond what's available in the standard `re` module.

## Purpose

The module adds support for the following backrefs:

- `\Q` and `\Q...\E` - Escape/quote characters (search)
- `\c` and `\C...\E` - Uppercase character or characters (replace)
- `\l` and `\L...\E` - Lowercase character or characters (replace)
- `\N{Black Club Suit}` - Unicode character by name (replace)
- `\u0000` and `\U00000000` - Unicode characters (replace)
- `\R` - Generic line breaks (search)

## Key Classes

### `Bregex`

A wrapper class around compiled regex patterns that provides enhanced functionality.

```python
class Bregex(Generic[AnyStr]):
    def __init__(self, pattern: Pattern[AnyStr], auto_compile: bool = True) -> None
```

**Key Features:**
- Auto-compilation of replacement templates
- All standard regex methods (`search`, `match`, `fullmatch`, etc.)
- Enhanced `sub`, `subf`, `subn`, `subfn` methods with backref support
- Immutable object with proper hashing and equality

**Important Properties:**
- `pattern` - Returns the original pattern string
- `flags` - Returns the compilation flags
- `groupindex` - Returns group index mapping
- `auto_compile` - Controls automatic compilation of replacement templates

### `ReplaceTemplate`

Imported from `_bregex_parse`, this class represents compiled replacement patterns with backref support.

## Important Functions

### Compilation Functions

#### `compile(pattern, flags=0, auto_compile=None, **kwargs)`
Compiles a pattern into a `Bregex` object with enhanced backref support.

```python
compiled_pattern = compile(r'\Q...\E', flags=IGNORECASE)
```

#### `compile_search(pattern, flags=0, **kwargs)`
Compiles only the search pattern with backref processing.

#### `compile_replace(pattern, repl, flags=0)`
Compiles a replacement template for use with substitution functions.

### Pattern Matching Functions

All standard regex functions are available with backref support:

- `match()` - Match at beginning of string
- `search()` - Search anywhere in string  
- `fullmatch()` - Match entire string
- `findall()` - Find all matches
- `finditer()` - Iterator over matches

### Substitution Functions

#### `sub(pattern, repl, string, count=0, flags=0)`
Standard substitution with backref support.

#### `subf(pattern, repl, string, count=0, flags=0)`
Format-style substitution with enhanced backrefs.

#### `subn()` and `subfn()`
Similar to `sub()` and `subf()` but return tuple of (result, count).

### Utility Functions

#### `expand(match, repl)`
Expands a replacement template against a match object.

#### `expandf(match, repl)`
Format-style expansion of replacement template.

#### `purge()`
Clears internal caches.

## Constants and Flags

The module exposes all `regex` module flags:

```python
# Common flags
IGNORECASE, I
MULTILINE, M  
DOTALL, S
VERBOSE, X
UNICODE, U
ASCII, A
LOCALE, L
DEBUG, D

# Extended flags specific to regex module
BESTMATCH, B
ENHANCEMATCH, E
FULLCASE, F
REVERSE, R
WORD, W
POSIX, P
VERSION0, V0
VERSION1, V1

# Replace-specific flag
FORMAT = 1  # For format-style replacements
```

## Usage Examples

### Basic Pattern Compilation
```python
import bregex

# Compile with auto-compilation enabled
pattern = bregex.compile(r'\Q[special]\E', auto_compile=True)
result = pattern.search('[special] text')
```

### Enhanced Replacements
```python
# Using format-style replacements
text = "Hello World"
result = bregex.subf(r'(\w+)', r'\L\1\E', text)  # Lowercase matches
```

### Caching
The module uses LRU caching with a maximum size of 500 for both search and replace pattern compilation to improve performance.

## Notes and Suggestions

### Performance Considerations
- The module caches compiled patterns automatically
- Use `purge()` to clear caches if memory usage becomes a concern
- Auto-compilation provides convenience but may have slight overhead

### Error Handling
- Proper type checking for pattern and replacement arguments
- Clear error messages for invalid flag combinations
- Validation of compiled vs. non-compiled pattern usage

### Best Practices
- Use `Bregex` objects for patterns that will be reused multiple times
- Enable auto-compilation for convenience, disable for fine-grained control
- Use format-style functions (`subf`, `subfn`, `expandf`) for enhanced replacement features

### Compatibility
- Fully compatible with the `regex` module
- Provides enhanced functionality over standard `re` module
- Maintains similar API patterns for easy migration