<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Utilities Module Documentation

## Overview

This module provides utilities and compatibility abstractions for string processing and regex operations. It includes helper classes for string iteration, formatting, immutable objects, and compatibility checks across different Python versions.

**License:** MIT  
**Copyright:** (c) 2015 - 2020 Isaac Muse

## Python Version Compatibility

The module defines version compatibility flags:

```python
PY311 = (3, 11) <= sys.version_info
PY312 = (3, 12) <= sys.version_info
```

- `PY311`: Boolean flag indicating Python 3.11 or higher
- `PY312`: Boolean flag indicating Python 3.12 or higher

## Constants

Format field type constants used for string formatting operations:

```python
FMT_FIELD = 0   # Field formatting
FMT_INDEX = 1   # Index access
FMT_ATTR = 2    # Attribute access
FMT_CONV = 3    # Conversion operations
FMT_SPEC = 4    # Format specification
```

## Classes

### StringIter

A string iterator class that provides character-by-character iteration with additional control features.

**Features:**
- Sequential character iteration
- Index tracking and rewinding capability
- Python 3 iterator protocol compliance

**Methods:**

- `__init__(text: str)`: Initialize with a string
- `__iter__()`: Return iterator object
- `__next__()`: Get next character (Python 3 compatible)
- `index` (property): Get current index position
- `rewind(count: int)`: Move index backwards by specified count
- `iternext()`: Core iteration method

**Example Usage:**
```python
iterator = StringIter("hello")
for char in iterator:
    print(char)  # Prints: h, e, l, l, o

# Rewind functionality
iterator.rewind(2)
```

### Immutable

A base class for creating immutable objects using `__slots__` for memory efficiency.

**Features:**
- Prevents attribute modification after initialization
- Memory efficient through `__slots__`
- Initialize attributes via keyword arguments

**Methods:**

- `__init__(**kwargs)`: Initialize with keyword arguments
- `__setattr__(name, value)`: Raises `AttributeError` to prevent mutation

**Example Usage:**
```python
class Config(Immutable):
    __slots__ = ('name', 'value')

config = Config(name="test", value=42)
# config.name = "new"  # This would raise AttributeError
```

## Functions

### String Conversion Functions

#### `_to_bstr(obj: Any) -> bytes`
Converts any object to a byte string using ASCII encoding with backslash replacement for non-ASCII characters.

#### `_to_str(obj: Any) -> str`
Converts any object to a string representation.

### `format_captures()`

```python
format_captures(
    captures: list[AnyStr],
    formatting: tuple[tuple[int, Any]],
    converter: Callable[[Any], AnyStr],
    default: AnyStr
) -> AnyStr
```

Performs complex string formatting operations on captured text, supporting:

- **Attribute access** (`FMT_ATTR`): Access object attributes
- **Index access** (`FMT_INDEX`): Array/string indexing
- **Conversions** (`FMT_CONV`): ASCII (`a`), repr (`r`), string (`s`)
- **Format specifications** (`FMT_SPEC`): Alignment and padding

**Parameters:**
- `captures`: List of captured strings/objects
- `formatting`: Tuple of format operations
- `converter`: Function to convert final result
- `default`: Default value for empty captures

### `warn_deprecated()`

```python
warn_deprecated(message: str, stacklevel: int = 2) -> None
```

Issues deprecation warnings with proper stack level for debugging.

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

1. **Private Functions**: `_to_bstr()` and `_to_str()` are internal utilities - avoid using directly in external code

2. **Error Handling**: The `format_captures()` function includes type checking for format specifications and will raise `ValueError` for invalid format codes

3. **Memory Efficiency**: Use the `Immutable` class for configuration objects that shouldn't change after creation

4. **Compatibility**: The version flags (`PY311`, `PY312`) should be used for conditional feature implementation

### üí° Best Practices

- Use `StringIter` when you need fine-grained control over string parsing
- Leverage `Immutable` for data classes that represent configuration or constant values
- The `format_captures()` function is likely part of a larger regex replacement system

### üîß Usage Examples

```python
# String iteration with rewind
text = "example"
iterator = StringIter(text)
char1 = next(iterator)  # 'e'
char2 = next(iterator)  # 'x'
iterator.rewind(1)
char3 = next(iterator)  # 'x' again

# Immutable configuration
class Settings(Immutable):
    __slots__ = ('debug', 'timeout')

config = Settings(debug=True, timeout=30)
```

This module appears to be part of a larger text processing or regex library, providing low-level utilities for string manipulation and formatting operations.