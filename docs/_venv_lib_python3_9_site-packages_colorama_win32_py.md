<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Windows Console API Wrapper

This Python module provides a wrapper around Windows Console API functions using the `ctypes` library. It enables direct interaction with the Windows console for terminal manipulation, including cursor positioning, text attributes, and screen buffer operations.

## Purpose

The module serves as a bridge between Python and Windows console functions, allowing applications to:
- Control console text colors and attributes
- Manipulate cursor position
- Clear screen areas
- Get console information
- Set console modes and titles

This is commonly used in terminal-based applications that need cross-platform console control, particularly for colorized output on Windows systems.

## Constants

```python
STDOUT = -11                              # Standard output handle
STDERR = -12                              # Standard error handle  
ENABLE_VIRTUAL_TERMINAL_PROCESSING = 0x0004  # Console mode flag
```

## Important Classes

### CONSOLE_SCREEN_BUFFER_INFO

A structure that mirrors the Windows `CONSOLE_SCREEN_BUFFER_INFO` struct:

```python
class CONSOLE_SCREEN_BUFFER_INFO(Structure):
    _fields_ = [
        ("dwSize", COORD),                # Console screen buffer size
        ("dwCursorPosition", COORD),      # Current cursor position
        ("wAttributes", wintypes.WORD),   # Text attributes
        ("srWindow", wintypes.SMALL_RECT), # Console window boundaries
        ("dwMaximumWindowSize", COORD),   # Maximum window size
    ]
```

**Features:**
- Provides a readable string representation via `__str__()` method
- Contains all essential console buffer information

## Key Functions

### Console Information Functions

#### `winapi_test()`
Tests if Windows API console functions are available and working.

```python
def winapi_test():
    return any(_winapi_test(h) for h in 
               (_GetStdHandle(STDOUT), _GetStdHandle(STDERR)))
```

#### `GetConsoleScreenBufferInfo(stream_id=STDOUT)`
Retrieves current console screen buffer information.

**Parameters:**
- `stream_id`: Console handle (STDOUT or STDERR)

**Returns:** `CONSOLE_SCREEN_BUFFER_INFO` object

### Text Manipulation Functions

#### `SetConsoleTextAttribute(stream_id, attrs)`
Sets text color and attribute for console output.

**Parameters:**
- `stream_id`: Console handle
- `attrs`: Text attribute flags

#### `SetConsoleTitle(title)`
Sets the console window title.

**Parameters:**
- `title`: New window title string

### Cursor and Screen Functions

#### `SetConsoleCursorPosition(stream_id, position, adjust=True)`
Moves the console cursor to specified position.

**Parameters:**
- `stream_id`: Console handle  
- `position`: Tuple of (Y, X) coordinates
- `adjust`: Whether to adjust for viewport scroll position

**Notes:**
- Handles coordinate system conversion between ANSI (1-based) and Windows (0-based)
- Swaps X,Y coordinate order to match Windows API expectations

#### `FillConsoleOutputCharacter(stream_id, char, length, start)`
Fills console area with specified character.

**Parameters:**
- `stream_id`: Console handle
- `char`: Character to fill with
- `length`: Number of characters to write
- `start`: Starting position (COORD)

**Returns:** Number of characters actually written

#### `FillConsoleOutputAttribute(stream_id, attr, length, start)`
Fills console area with specified text attributes.

**Parameters:**
- `stream_id`: Console handle
- `attr`: Attribute value to apply
- `length`: Number of positions to fill
- `start`: Starting position (COORD)

### Console Mode Functions

#### `GetConsoleMode(handle)`
Gets current console mode flags.

**Parameters:**
- `handle`: Console handle

**Returns:** Console mode value
**Raises:** `ctypes.WinError` on failure

#### `SetConsoleMode(handle, mode)`
Sets console mode flags.

**Parameters:**
- `handle`: Console handle
- `mode`: Mode flags to set

**Raises:** `ctypes.WinError` on failure

## Error Handling

The module includes graceful fallback handling:

```python
try:
    import ctypes
    # ... Windows API setup
except (AttributeError, ImportError):
    windll = None
    SetConsoleTextAttribute = lambda *_: None
    winapi_test = lambda *_: None
```

If `ctypes` or Windows APIs are unavailable, functions become no-ops rather than raising exceptions.

## Usage Notes

- **Windows-specific**: This module only functions on Windows systems
- **ANSI vs Wide characters**: Functions are hard-coded for ANSI character encoding
- **Coordinate systems**: Handles conversion between ANSI (1-based, Y,X) and Windows (0-based, X,Y) coordinate systems
- **Viewport awareness**: Cursor positioning can adjust for console viewport scrolling

## Dependencies

- `ctypes` library (Python standard library)
- Windows operating system
- Access to `kernel32.dll` functions

## License

Copyright Jonathan Hartley 2013. BSD 3-Clause license.