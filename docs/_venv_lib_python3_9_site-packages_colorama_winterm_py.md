<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Windows Terminal Support Module

This module provides Windows-specific terminal functionality for handling console colors, styles, cursor positioning, and screen manipulation. It's part of a cross-platform terminal library that enables ANSI-like functionality on Windows systems.

## Purpose

The module serves as a Windows compatibility layer for terminal operations, providing:
- Color and style management for Windows console
- Cursor positioning and movement
- Screen and line clearing operations
- Virtual Terminal (VT) processing support for modern Windows versions

## Classes

### WinColor

Defines standard console color constants based on Windows console color values.

```python
class WinColor(object):
    BLACK   = 0
    BLUE    = 1
    GREEN   = 2
    CYAN    = 3
    RED     = 4
    MAGENTA = 5
    YELLOW  = 6
    GREY    = 7
```

### WinStyle

Defines console text style constants for brightness and background intensity.

```python
class WinStyle(object):
    NORMAL              = 0x00  # dim text, dim background
    BRIGHT              = 0x08  # bright text, dim background
    BRIGHT_BACKGROUND   = 0x80  # dim text, bright background
```

### WinTerm

Main class that handles Windows console operations and terminal state management.

#### Key Methods

##### `__init__(self)`
- Initializes the terminal with default console attributes
- Stores default foreground, background, and style settings
- Sets up light color tracking for LIGHT_EX emulation

##### Color and Style Management

- **`fore(fore=None, light=False, on_stderr=False)`**: Sets foreground color
- **`back(back=None, light=False, on_stderr=False)`**: Sets background color  
- **`style(style=None, on_stderr=False)`**: Sets text style
- **`reset_all(on_stderr=None)`**: Resets all attributes to defaults

##### Cursor Operations

- **`get_position(handle)`**: Gets current cursor position
- **`set_cursor_position(position=None, on_stderr=False)`**: Sets cursor to specific position
- **`cursor_adjust(x, y, on_stderr=False)`**: Moves cursor relative to current position

##### Screen Manipulation

- **`erase_screen(mode=0, on_stderr=False)`**: Clears screen content
  - `mode=0`: Clear from cursor to end of screen
  - `mode=1`: Clear from cursor to beginning of screen  
  - `mode=2`: Clear entire screen and move cursor to (1,1)

- **`erase_line(mode=0, on_stderr=False)`**: Clears line content
  - `mode=0`: Clear from cursor to end of line
  - `mode=1`: Clear from cursor to beginning of line
  - `mode=2`: Clear entire line

##### Utility Methods

- **`set_title(title)`**: Sets console window title
- **`get_attrs()`**: Returns current console attributes as integer
- **`set_attrs(value)`**: Sets console attributes from integer value

## Functions

### `enable_vt_processing(fd)`

Enables Virtual Terminal processing on modern Windows systems to support ANSI escape sequences.

```python
def enable_vt_processing(fd):
    # Attempts to enable VT processing for the given file descriptor
    # Returns True if successful, False otherwise
```

**Parameters:**
- `fd`: File descriptor for the console handle

**Returns:** 
- `True` if VT processing was successfully enabled
- `False` if operation failed or is not supported

## Important Notes

### Platform Compatibility
- This module is Windows-specific and imports `msvcrt.get_osfhandle`
- On non-Windows systems, `get_osfhandle` raises an `OSError`

### Light Color Emulation
The module implements a clever workaround for LIGHT_EX colors:
- Uses `BRIGHT` and `BRIGHT_BACKGROUND` styles to emulate light colors
- Tracks light colors separately from regular styles to prevent conflicts
- Light colors are overwritten by Fore/Back codes, while BRIGHT is overwritten by Style codes

### Coordinate System
- Windows console uses 0-based coordinates internally
- The module adjusts coordinates to 1-based for external API consistency

### Error Handling
- Gracefully handles missing Windows APIs
- Returns `False` from `enable_vt_processing()` when operations fail
- Protects against `TypeError` in test environments with mocked file descriptors

## Dependencies

- **win32 module**: Provides low-level Windows console API access
- **msvcrt**: Standard library module for Microsoft Visual C Runtime functions

## Usage Example

```python
# Initialize Windows terminal
term = WinTerm()

# Set red foreground color
term.fore(WinColor.RED)

# Set bright style
term.style(WinStyle.BRIGHT)

# Clear entire screen
term.erase_screen(mode=2)

# Reset to defaults
term.reset_all()
```