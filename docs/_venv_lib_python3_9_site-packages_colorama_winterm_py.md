<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Windows Terminal Control Module

## Overview

This module provides Windows-specific terminal control functionality, enabling colored text output, cursor manipulation, and screen clearing operations on Windows console applications. It serves as a Windows implementation layer for terminal control operations, utilizing the Windows Console API through win32 calls.

## Purpose

- **Platform-specific implementation**: Provides Windows console control capabilities
- **Color and styling**: Manages foreground/background colors and text styling (bright, normal)
- **Cursor control**: Handles cursor positioning and movement
- **Screen manipulation**: Supports clearing screen and line operations
- **VT processing**: Enables Virtual Terminal processing for modern Windows terminals

## Classes

### `WinColor`

Defines standard Windows console color constants based on `wincon.h`.

```python
class WinColor(object):
    BLACK   = 0
    BLUE    = 1
    GREEN   = 2
    CYAN    = 3
    RED     = 4
    MAGENTA = 5
    YELLOW  = 6
    GREY    = 7
```

### `WinStyle`

Defines text styling options for Windows console output.

```python
class WinStyle(object):
    NORMAL              = 0x00  # dim text, dim background
    BRIGHT              = 0x08  # bright text, dim background
    BRIGHT_BACKGROUND   = 0x80  # dim text, bright background
```

### `WinTerm`

The main class that handles all Windows terminal operations.

#### Key Methods

##### `__init__(self)`
- Initializes the terminal with default console attributes
- Stores default foreground, background, and style settings
- Sets up light color emulation tracking

##### Color Management
- **`fore(fore=None, light=False, on_stderr=False)`**: Sets foreground color
- **`back(back=None, light=False, on_stderr=False)`**: Sets background color  
- **`style(style=None, on_stderr=False)`**: Sets text styling

##### Cursor Operations
- **`get_position(handle)`**: Retrieves current cursor position
- **`set_cursor_position(position=None, on_stderr=False)`**: Sets cursor to specific position
- **`cursor_adjust(x, y, on_stderr=False)`**: Moves cursor relative to current position

##### Screen Clearing
- **`erase_screen(mode=0, on_stderr=False)`**: Clears screen content
  - `mode=0`: Clear from cursor to end of screen
  - `mode=1`: Clear from cursor to beginning of screen  
  - `mode=2`: Clear entire screen and move cursor to (1,1)

- **`erase_line(mode=0, on_stderr=False)`**: Clears line content
  - `mode=0`: Clear from cursor to end of line
  - `mode=1`: Clear from cursor to beginning of line
  - `mode=2`: Clear entire line

##### Utility Methods
- **`reset_all(on_stderr=None)`**: Resets all attributes to defaults
- **`set_title(title)`**: Sets console window title
- **`get_attrs()`**: Returns current attribute combination
- **`set_attrs(value)`**: Sets attributes from combined value

## Functions

### `enable_vt_processing(fd)`

Enables Virtual Terminal processing for modern Windows terminals that support ANSI escape sequences.

- **Parameters**: `fd` - file descriptor for the console
- **Returns**: `True` if VT processing was successfully enabled, `False` otherwise
- **Purpose**: Allows use of ANSI escape sequences on Windows 10+ terminals

## Implementation Notes

### Light Color Emulation
The module uses a clever approach to emulate light colors:
- Tracks light colors separately from regular brightness styling
- Prevents conflicts between `LIGHT_EX` colors and `BRIGHT` style
- Uses bitwise operations to manage style combinations

### Coordinate System
- Windows uses 0-based coordinates internally
- The module adjusts coordinates to 1-based for `SetConsoleCursorPosition`
- Position calculations account for this difference

### Error Handling
- Gracefully handles non-Windows platforms with fallback functions
- Manages cases where win32 API calls might fail
- Includes type checking for test environments

## Dependencies

- **`msvcrt`**: For `get_osfhandle()` function (Windows-specific)
- **`win32`**: Local module providing Windows API wrappers

## Usage Notes

‚ö†Ô∏è **Platform Compatibility**: This module is designed specifically for Windows. The `get_osfhandle` import will fail on non-Windows platforms, which is handled gracefully.

üí° **Modern Windows Support**: The `enable_vt_processing` function enables ANSI escape sequence support on Windows 10 version 1511 and later, providing better terminal compatibility.

üîß **Integration**: This module is typically used as part of a larger cross-platform terminal library, providing the Windows-specific implementation layer.