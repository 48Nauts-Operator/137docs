<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# dateutil tzinfo utilities

This file provides compatibility utilities and base classes for timezone handling in Python's `dateutil` library. It primarily addresses differences between Python 2/3 and implements support for PEP 495's "fold" attribute for handling ambiguous datetime instances during DST transitions.

## Purpose

The module serves two main purposes:

1. **Python 2/3 Compatibility**: Handles encoding differences in timezone name strings between Python versions
2. **DST Ambiguity Handling**: Provides unified support for the "fold" attribute (PEP 495) across Python versions to disambiguate times that occur twice during DST transitions

## Key Components

### Decorators and Utility Functions

#### `tzname_in_python2(namefunc)`

A decorator that ensures timezone name compatibility between Python 2 and 3.

- **Purpose**: Converts unicode timezone names to byte strings in Python 2
- **Usage**: Applied to `tzname()` methods in timezone classes
- **Behavior**: 
  - Python 2: Encodes unicode strings to bytes
  - Python 3: Returns the function unchanged

```python
@tzname_in_python2
def tzname(self, dt):
    return "UTC"  # Will be encoded in Python 2
```

#### `enfold(dt, fold=1)`

Provides a unified interface for setting the `fold` attribute on datetime objects.

- **Parameters**:
  - `dt`: The datetime object to modify
  - `fold`: The fold value (0 or 1, default: 1)
- **Returns**: A datetime object with the specified fold value
- **Compatibility**: Works on both pre-3.6 and post-3.6 Python versions

```python
# Create a datetime in a DST fold
folded_dt = enfold(datetime(2021, 11, 7, 1, 30), fold=1)
```

### Classes

#### `_DatetimeWithFold(datetime)`

A custom datetime subclass for Python versions prior to 3.6 that lack native `fold` support.

**Features**:
- Fixed `fold` attribute set to `1`
- Custom `replace()` method that preserves the fold behavior
- Only used when `fold=1` is needed on pre-3.6 Python

#### `_tzinfo(tzinfo)`

Base class for all dateutil timezone objects, extending Python's built-in `tzinfo`.

**Key Methods**:

- `is_ambiguous(dt)`: Determines if a datetime is ambiguous (occurs twice during DST transition)
- `_fold_status(dt_utc, dt_wall)`: Calculates fold status based on UTC and wall time representations
- `fromutc(dt)`: Converts UTC datetime to local timezone with proper fold handling

#### `tzrangebase(_tzinfo)`

Abstract base class for timezone implementations that have annual DST transitions.

**Required Implementations**:
- `__init__(self, *args, **kwargs)`
- `transitions(self, year)`: Returns tuple of DST on/off transition datetimes

**Required Attributes**:
- `hasdst`: Boolean indicating DST usage
- `_dst_offset`/`_std_offset`: UTC offset timedeltas
- `_dst_abbr`/`_std_abbr`: Timezone abbreviation strings

**Provided Methods**:
- `utcoffset(dt)`: Returns appropriate UTC offset
- `dst(dt)`: Returns DST offset or zero
- `tzname(dt)`: Returns timezone abbreviation
- `fromutc(dt)`: Converts from UTC with DST handling
- `is_ambiguous(dt)`: Checks for ambiguous times

## Usage Notes

### Important Considerations

- **Fold Attribute**: The `fold` attribute disambiguates times that occur twice during "fall back" DST transitions
  - `fold=0`: First occurrence of the time
  - `fold=1`: Second occurrence of the time

- **Ambiguous Times**: Times are ambiguous when clocks "fall back" during DST transitions. For example, 1:30 AM occurs twice when DST ends.

- **Python Version Compatibility**: The module automatically handles differences between Python versions, particularly around the `fold` attribute introduction in Python 3.6.

### Example Implementation

```python
class MyTimezone(tzrangebase):
    def __init__(self):
        self.hasdst = True
        self._std_offset = timedelta(hours=-5)  # EST
        self._dst_offset = timedelta(hours=-4)  # EDT
        self._std_abbr = "EST"
        self._dst_abbr = "EDT"
    
    def transitions(self, year):
        # Return DST start and end dates for the year
        dst_start = datetime(year, 3, 8, 2, 0)  # Second Sunday in March
        dst_end = datetime(year, 11, 1, 2, 0)   # First Sunday in November
        return (dst_start, dst_end)
```

### Best Practices

- Always use `enfold()` when you need to specify fold behavior
- Check `is_ambiguous()` before assuming datetime uniqueness during DST transitions
- Use the provided base classes rather than implementing timezone logic from scratch
- The `@tzname_in_python2` decorator should be applied to all `tzname()` method implementations

## Dependencies

- `six`: For Python 2/3 compatibility detection
- `functools`: For the `@wraps` decorator
- `datetime`: Core datetime functionality