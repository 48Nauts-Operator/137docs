<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# tzwin Module Documentation

## Overview

The `tzwin` module provides an interface to native Windows time zone data, including `datetime.tzinfo` implementations. This module enables Python applications running on Windows to access and utilize the system's built-in time zone information stored in the Windows registry.

> **⚠️ Important Note**: This module can only be imported on Windows platforms. Attempting to import it on non-Windows systems will raise an `ImportError`.

## Purpose

- Access Windows registry time zone data
- Provide `datetime.tzinfo` compatible time zone objects
- Handle both named time zones and local system time zone
- Parse time zone resources from Windows DLLs

## Main Classes

### `tzres`

Class for accessing `tzres.dll`, which contains timezone name related resources.

```python
tzr = tzres()
timezone_name = tzr.load_name(112)  # Returns 'Eastern Standard Time'
```

**Key Methods:**
- `load_name(offset)`: Load a timezone name from a DLL offset
- `name_from_string(tzname_str)`: Parse registry strings into timezone names

### `tzwinbase`

Abstract base class for Windows timezone implementations.

**Key Features:**
- Implements comparison operations between timezone objects
- Provides `list()` static method to enumerate all system timezones
- Handles DST transition calculations
- Displays timezone information

**Important Methods:**
- `list()`: Returns all available system timezones
- `display()`: Returns the display name of the timezone
- `transitions(year)`: Gets DST on/off transition times for a given year

### `tzwin`

Main timezone class created from Windows registry zone information.

```python
# Create timezone object for Eastern Time
est = tzwin("Eastern Standard Time")
print(est.display())  # Shows full timezone name
```

**Constructor Parameters:**
- `name`: Windows timezone key name (e.g., "Eastern Standard Time")

**Features:**
- Handles standard and daylight saving time offsets
- Parses registry TZI (Time Zone Information) binary data
- Supports timezone transitions and DST rules

### `tzwinlocal`

Represents the local system timezone from Windows registry.

```python
local_tz = tzwinlocal()
print(str(local_tz))  # Shows local timezone info
```

**Key Advantages:**
- Reads registry directly (not affected by process start time)
- Updates reflect current system settings
- More reliable than `time` module calls on Windows

## Utility Functions

### `picknthweekday(year, month, dayofweek, hour, minute, whichweek)`

Calculates specific weekday occurrences for DST transitions.

**Parameters:**
- `year`, `month`: Target date
- `dayofweek`: Day of week (0=Sunday)
- `hour`, `minute`: Time of day
- `whichweek`: Which occurrence (5=last)

### `valuestodict(key)`

Converts Windows registry key values to a Python dictionary.

**Features:**
- Handles different registry data types (DWORD, REG_SZ)
- Processes timezone resource references
- Manages signed/unsigned integer conversion

## Registry Constants

```python
TZKEYNAMENT = r"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Time Zones"
TZKEYNAME9X = r"SOFTWARE\Microsoft\Windows\CurrentVersion\Time Zones"
TZLOCALKEYNAME = r"SYSTEM\CurrentControlSet\Control\TimeZoneInformation"
```

## Usage Examples

### Basic Timezone Creation

```python
from dateutil.tzwin import tzwin, tzwinlocal

# Create specific timezone
eastern = tzwin("Eastern Standard Time")
pacific = tzwin("Pacific Standard Time")

# Get local timezone
local = tzwinlocal()

# List all available timezones
all_zones = tzwin.list()
```

### Working with DateTime Objects

```python
import datetime
from dateutil.tzwin import tzwin

est = tzwin("Eastern Standard Time")
dt = datetime.datetime(2023, 7, 15, 12, 0, 0, tzinfo=est)
print(dt)  # 2023-07-15 12:00:00-04:00
```

## Technical Notes

### Registry Data Structure

The module parses Windows TZI (Time Zone Information) binary structure:
- **Bias**: Minutes offset from UTC
- **StandardBias**: Additional standard time offset
- **DaylightBias**: Additional daylight time offset
- **SystemTime structures**: Define DST transition rules

### DST Handling

- Transitions calculated using Windows SYSTEMTIME format
- Supports complex rules (nth weekday of month)
- Handles ambiguous times by defaulting to standard time

### Performance Considerations

- Registry access occurs during object initialization
- Consider caching timezone objects for repeated use
- `tzres.dll` loading happens on first resource access

## Error Handling

- **ImportError**: Raised on non-Windows platforms
- **WindowsError**: Registry access failures
- **ValueError**: Malformed timezone strings or data

## Dependencies

- `winreg`: Windows registry access
- `ctypes`: Windows API calls
- `struct`: Binary data parsing
- `six`: Python 2/3 compatibility