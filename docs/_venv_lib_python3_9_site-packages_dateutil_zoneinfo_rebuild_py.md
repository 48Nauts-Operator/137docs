<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Timezone Database Rebuild Module

## Overview

This module provides functionality to rebuild and update the internal timezone database used by the `dateutil` library. It processes timezone data from the official IANA timezone database and compiles it into a format that can be used by `dateutil`.

## Purpose

- **Rebuild timezone data**: Takes raw timezone data from IANA and processes it into dateutil's internal format
- **Maintain compatibility**: Ensures timezone data is compiled in a "fat" binary format for backward compatibility
- **Package timezone info**: Creates compressed tar archives containing the processed timezone database

## Key Functions

### `rebuild(filename, tag=None, format="gz", zonegroups=[], metadata=None)`

Main function that rebuilds the timezone database from IANA source files.

**Parameters:**
- `filename` (str): Path to the timezone tarball from `ftp.iana.org/tz`
- `tag` (optional): Version tag for the timezone data
- `format` (str): Compression format for output (default: "gz")
- `zonegroups` (list): List of timezone group files to extract and process
- `metadata` (dict): Metadata to include in the rebuilt database

**Process:**
1. Creates temporary directory for processing
2. Extracts specified timezone files from the source tarball
3. Compiles timezone data using the `zic` compiler
4. Writes metadata file
5. Creates final compressed archive
6. Cleans up temporary files

```python
rebuild(
    filename="tzdata2023c.tar.gz",
    format="gz",
    zonegroups=["africa", "asia", "europe"],
    metadata={"version": "2023c"}
)
```

### `_run_zic(zonedir, filepaths)`

Internal function that handles the compilation of timezone data using the `zic` compiler.

**Features:**
- **Compatibility handling**: Automatically detects `zic` version capabilities
- **Fat binary generation**: Ensures output uses "fat" binary format for compatibility
- **Error handling**: Provides helpful error messages if `zic` is not available

**Parameters:**
- `zonedir` (str): Output directory for compiled timezone files
- `filepaths` (list): List of source timezone files to compile

### `_print_on_nosuchfile(e)`

Helper function that provides user-friendly error messages when the `zic` compiler is not found.

**Parameters:**
- `e` (OSError): Exception raised when `zic` command is not found

## Dependencies

- **Standard Library**: `logging`, `os`, `tempfile`, `shutil`, `json`, `subprocess`, `tarfile`
- **External**: `dateutil.zoneinfo` (for constants)

## Important Notes

### System Requirements
- **zic compiler**: Must be installed on the system (usually part of `libc-bin` package)
- **PATH access**: The `zic` command must be accessible from PATH

### Compatibility Considerations
- **TZif format**: Forces "fat" binary format to maintain compatibility with dateutil
- **Version handling**: Automatically adapts to different versions of the `zic` compiler

### Error Handling
- **Temporary cleanup**: Uses try/finally to ensure temporary directories are cleaned up
- **Missing dependencies**: Provides helpful error messages for missing system tools

## Usage Example

```python
# Rebuild timezone database from IANA data
rebuild(
    filename="tzdata2023c.tar.gz",
    format="gz", 
    zonegroups=["africa", "asia", "europe", "northamerica", "southamerica"],
    metadata={
        "version": "2023c",
        "build_date": "2023-10-01"
    }
)
```

## Troubleshooting

If you encounter errors about missing `zic`:

- **Ubuntu/Debian**: `sudo apt-get install libc-bin`
- **RHEL/CentOS**: `sudo yum install glibc-common`
- **macOS**: `zic` should be available by default

Ensure the `zic` command is in your system's PATH.