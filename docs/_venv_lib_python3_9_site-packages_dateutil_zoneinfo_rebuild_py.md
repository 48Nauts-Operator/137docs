<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Timezone Data Rebuild Module

## Overview

This module provides functionality to rebuild the internal timezone information for the `dateutil` library. It processes timezone data from the official IANA timezone database and compiles it into a format suitable for use by `dateutil.zoneinfo`.

## Purpose

The primary purpose of this module is to:
- Extract timezone data from IANA timezone tarballs
- Compile timezone files using the `zic` (Zone Information Compiler) tool
- Package the compiled timezone data into a distributable format
- Ensure compatibility with dateutil's timezone handling requirements

## Functions

### `rebuild(filename, tag=None, format="gz", zonegroups=[], metadata=None)`

Main function that rebuilds timezone information from IANA timezone data.

**Parameters:**
- `filename` (str): Path to the timezone tarball from `ftp.iana.org/tz`
- `tag` (optional): Version tag for the timezone data
- `format` (str, default="gz"): Compression format for the output tarball
- `zonegroups` (list): List of timezone group files to extract and process
- `metadata` (dict, optional): Metadata to include in the generated timezone package

**Process:**
1. Creates a temporary directory for processing
2. Extracts specified timezone group files from the input tarball
3. Compiles timezone data using `zic`
4. Writes metadata file in JSON format
5. Creates a new tarball with compiled timezone data
6. Cleans up temporary files

**Example Usage:**
```python
rebuild(
    filename="tzdata2023c.tar.gz",
    format="gz",
    zonegroups=["africa", "antarctica", "asia", "europe"],
    metadata={"version": "2023c", "source": "IANA"}
)
```

### `_run_zic(zonedir, filepaths)`

Internal function that executes the `zic` (Zone Information Compiler) with appropriate compatibility options.

**Parameters:**
- `zonedir` (str): Directory where compiled timezone files will be output
- `filepaths` (list): List of timezone source file paths to compile

**Key Features:**
- Automatically detects `zic` version capabilities
- Forces "fat" binary format for compatibility with dateutil
- Handles both old and new versions of `zic`

**Compatibility Notes:**
- Newer `zic` versions default to "slim" binaries (`-b slim`)
- Older versions don't support the `-b` option but default to "fat" binaries
- This function ensures "fat" binaries are always generated for dateutil compatibility

### `_print_on_nosuchfile(e)`

Helper function that provides user-friendly error messages when `zic` is not found.

**Parameters:**
- `e` (Exception): Exception raised by subprocess operations

**Error Handling:**
- Detects when `zic` command is not available (errno 2)
- Provides helpful installation guidance

## Dependencies

### Required System Tools
- `zic` (Zone Information Compiler) - typically provided by `libc-bin` or similar packages

### Python Packages
- `logging` - Error and info logging
- `os` - File system operations
- `tempfile` - Temporary directory management
- `shutil` - File operations
- `json` - Metadata serialization
- `subprocess` - External command execution
- `tarfile` - Archive file handling
- `dateutil.zoneinfo` - Constants and timezone utilities

## Important Notes and Suggestions

### System Requirements
- Ensure `zic` is installed and available in your system PATH
- On Debian/Ubuntu systems: `sudo apt-get install libc-bin`
- On RHEL/CentOS systems: `zic` is typically included in `glibc-common`

### Version Compatibility
- This module specifically generates "fat" TZif binaries for dateutil compatibility
- May not support TZif Version 2+ files depending on dateutil version

### Error Handling
- The module includes robust error handling for missing system dependencies
- Temporary directories are automatically cleaned up using try/finally blocks

### Performance Considerations
- Processing large timezone datasets may require significant disk space
- Temporary files are created during processing but cleaned up automatically

### Usage Recommendations
- Always specify relevant `zonegroups` to avoid processing unnecessary timezone data
- Include appropriate metadata for version tracking and source attribution
- Test the generated timezone data with your specific dateutil version before deployment

## File Constants

The module uses constants from `dateutil.zoneinfo`:
- `METADATA_FN` - Filename for metadata storage
- `ZONEFILENAME` - Target filename for the generated timezone archive