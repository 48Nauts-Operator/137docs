<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# ghp-import Documentation

## Overview

`ghp-import` is a Python utility for importing documentation or static files into GitHub Pages branches. It provides a programmatic way to update `gh-pages` branches without manual Git operations, making it ideal for automated documentation deployment workflows.

**Version:** 2.1.0

## Purpose

This tool simplifies the process of publishing static content (like generated documentation) to GitHub Pages by:
- Creating commits directly to a GitHub Pages branch (typically `gh-pages`)
- Handling Git operations through Python's `subprocess` module
- Supporting various GitHub Pages configurations (Jekyll, CNAME, etc.)
- Providing both command-line and programmatic interfaces

## Key Classes

### `GhpError`
Custom exception class for handling ghp-import specific errors.

```python
class GhpError(Exception):
    def __init__(self, message):
        self.message = message
```

### `Git`
Main Git operations wrapper class that handles all Git interactions.

```python
class Git(object):
    def __init__(self, use_shell=False):
        self.use_shell = use_shell
```

**Key Methods:**
- `check_repo()` - Validates if current directory is a Git repository
- `try_rebase()` - Attempts to rebase the target branch
- `get_config()` - Retrieves Git configuration values
- `get_prev_commit()` - Gets the previous commit hash for a branch
- `call()` - Executes Git commands and returns exit code

## Important Functions

### `ghp_import(srcdir, **kwargs)`
Main function that orchestrates the import process.

**Parameters:**
- `srcdir` - Source directory containing files to import
- `**kwargs` - Configuration options (branch name, commit message, etc.)

**Process:**
1. Validates source directory exists
2. Checks Git repository status
3. Attempts to rebase target branch
4. Imports files using Git fast-import
5. Optionally pushes changes to remote

### File Processing Functions

#### `start_commit(pipe, git, branch, message, prefix=None)`
Initiates a Git commit using fast-import protocol.

#### `add_file(pipe, srcpath, tgtpath)`
Adds individual files to the Git commit, preserving executable permissions.

#### `add_nojekyll(pipe, prefix=None)`
Creates a `.nojekyll` file to disable Jekyll processing on GitHub Pages.

#### `add_cname(pipe, cname)`
Adds a CNAME file for custom domain configuration.

### Utility Functions

#### `mk_when(timestamp=None)`
Generates properly formatted Git timestamp with timezone information.

#### `gitpath(fname)`
Converts OS-specific file paths to Git-compatible forward-slash paths.

## Command Line Options

The tool supports the following command-line arguments:

- `-n, --no-jekyll` - Include `.nojekyll` file
- `-c, --cname` - Write CNAME file with specified domain
- `-m, --message` - Custom commit message (default: "Update documentation")
- `-p, --push` - Push to remote after committing
- `-x, --prefix` - Add prefix to imported file paths
- `-f, --force` - Force push to repository
- `-o, --no-history` - Create commit without parent history
- `-r, --remote` - Remote name (default: "origin")
- `-b, --branch` - Target branch name (default: "gh-pages")
- `-s, --shell` - Use shell for Git commands
- `-l, --follow-links` - Follow symbolic links when adding files

## Usage Examples

### Command Line Usage

```bash
# Basic usage
ghp-import docs/

# With custom branch and commit message
ghp-import -b main -m "Deploy documentation" build/

# Include .nojekyll and push to remote
ghp-import -n -p documentation/

# Force push with custom domain
ghp-import -f -c example.com -p site/
```

### Programmatic Usage

```python
from ghp_import import ghp_import, GhpError

try:
    ghp_import('docs/', 
               branch='gh-pages',
               mesg='Update docs',
               push=True,
               nojekyll=True)
except GhpError as e:
    print(f"Error: {e.message}")
```

## Notes and Considerations

### Python Version Compatibility
- Supports both Python 2 and Python 3
- Includes compatibility shims for text encoding/decoding
- Uses different import strategies for `shlex.quote` vs `pipes.quote`

### Git Requirements
- Must be run from within a Git repository
- Requires Git to be available in system PATH
- Uses Git's fast-import feature for efficient bulk operations

### Security Considerations
- Uses `shlex.quote()` for proper shell escaping when `use_shell=True`
- Handles subprocess operations safely with proper error checking

### Performance Notes
- Uses Git fast-import for efficient bulk file operations
- Processes files in a single Git transaction
- Suitable for large documentation sets

### Limitations
- Requires existing Git repository
- Target branch will be completely replaced (unless using prefix)
- No built-in conflict resolution for concurrent updates

## Error Handling

The module includes comprehensive error handling:
- Repository validation before operations
- Git command failure detection
- Proper exception propagation with descriptive messages
- Graceful handling of broken pipes in subprocess communication