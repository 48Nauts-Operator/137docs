<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Jinja2 Utils Module Documentation

This module provides utility functions, classes, and decorators used throughout the Jinja2 templating engine. It contains helper functions for template rendering, caching, string manipulation, and various utility classes.

## Purpose

The `utils.py` file serves as a collection of utility functions and classes that support the core functionality of Jinja2. It includes:

- Function decorators for passing context to template functions
- Utility functions for string manipulation and URL handling
- Caching mechanisms
- Helper classes for template operations
- Import and file handling utilities

## Important Classes and Functions

### Function Decorators

#### `pass_context(f)`
Pass the `Context` as the first argument to decorated functions during template rendering.

```python
@pass_context
def my_function(context, arg1, arg2):
    # Access the full template context
    return context.get('some_var', 'default')
```

#### `pass_eval_context(f)`
Pass the `EvalContext` as the first argument to decorated functions.

```python
@pass_eval_context
def my_filter(eval_ctx, value):
    # Access evaluation context for conditional escaping
    if eval_ctx.autoescape:
        return markupsafe.escape(value)
    return value
```

#### `pass_environment(f)`
Pass the `Environment` as the first argument to decorated functions.

```python
@pass_environment
def my_function(env, value):
    # Access the Jinja2 environment
    return env.get_template('helper.html').render(value=value)
```

### Utility Functions

#### `is_undefined(obj)`
Check if an object is an undefined value in Jinja2.

```python
def custom_filter(value):
    if is_undefined(value):
        return "No value provided"
    return str(value)
```

#### `import_string(import_name, silent=False)`
Import an object from a string path.

```python
# Import using dotted notation
func = import_string('mymodule.myfunction')

# Import using colon notation
cls = import_string('mymodule:MyClass')
```

#### `urlize(text, trim_url_limit=None, rel=None, target=None, extra_schemes=None)`
Convert URLs in text into clickable HTML links.

```python
text = "Visit https://example.com for more info"
html = urlize(text, target="_blank", rel="noopener")
# Result: 'Visit <a href="https://example.com" target="_blank" rel="noopener">https://example.com</a> for more info'
```

**Parameters:**
- `text`: Original text containing URLs
- `trim_url_limit`: Shorten displayed URLs to this length
- `target`: Add target attribute to links
- `rel`: Add rel attribute to links
- `extra_schemes`: Additional URL schemes to recognize

#### `generate_lorem_ipsum(n=5, html=True, min=20, max=100)`
Generate lorem ipsum text for templates.

```python
# Generate 3 paragraphs as HTML
lorem = generate_lorem_ipsum(n=3, html=True)

# Generate plain text
lorem_text = generate_lorem_ipsum(n=2, html=False)
```

#### `url_quote(obj, charset='utf-8', for_qs=False)`
Quote strings for safe use in URLs.

```python
safe_url = url_quote("hello world & more")
# Result: "hello%20world%20%26%20more"

# For query strings
qs_safe = url_quote("hello world", for_qs=True)
# Result: "hello+world"
```

### Cache Implementation

#### `LRUCache`
A Least Recently Used cache implementation optimized for small capacities.

```python
cache = LRUCache(capacity=100)
cache['key'] = 'value'
value = cache.get('key', 'default')
```

**Key Features:**
- Thread-safe operations
- MutableMapping interface
- Automatic eviction of least recently used items
- Optimized for template caching

**Methods:**
- `get(key, default=None)`: Get item with default fallback
- `setdefault(key, default=None)`: Set if key doesn't exist
- `clear()`: Remove all items
- `copy()`: Create shallow copy

### Template Helper Classes

#### `Cycler`
Cycle through values, useful for alternating classes or styles.

```python
# In template
{% set row_class = cycler("odd", "even") %}
{% for item in items %}
    <div class="{{ row_class.next() }}">{{ item }}</div>
{% endfor %}
```

**Methods:**
- `next()`: Get current item and advance to next
- `reset()`: Reset to first item
- `current`: Property to access current item without advancing

#### `Joiner`
Helper for joining template output with separators.

```python
# In template
{% set comma = joiner(", ") %}
{% for item in items %}
    {{ comma() }}{{ item }}
{% endfor %}
```

#### `Namespace`
A namespace object for holding arbitrary attributes in templates.

```python
# In template
{% set ns = namespace(counter=0, items=[]) %}
{% for item in data %}
    {% set ns.counter = ns.counter + 1 %}
{% endfor %}
```

### Auto-escaping Configuration

#### `select_autoescape(enabled_extensions=('html', 'htm', 'xml'), ...)`
Configure automatic HTML escaping based on template file extensions.

```python
from jinja2 import Environment, select_autoescape

env = Environment(
    autoescape=select_autoescape(
        enabled_extensions=('html', 'xml'),
        default_for_string=True
    )
)
```

#### `htmlsafe_json_dumps(obj, dumps=None, **kwargs)`
Serialize objects to JSON safe for HTML output.

```python
data = {'key': '<script>alert("xss")</script>'}
safe_json = htmlsafe_json_dumps(data)
# HTML-unsafe characters are escaped
```

## Special Objects

### `missing`
A special singleton representing missing values in the runtime.