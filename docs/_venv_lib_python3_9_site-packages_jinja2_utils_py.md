<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Jinja2 Utils Module Documentation

This file contains utility functions, classes, and decorators used throughout the Jinja2 templating engine. It provides core functionality for template rendering, caching, URL processing, and various helper utilities.

## Purpose

The `utils.py` module serves as a central collection of utility functions and classes that support Jinja2's template engine operations. It includes:

- Template context management decorators
- Caching mechanisms
- URL processing and validation
- String manipulation utilities
- Helper classes for template operations

## Important Classes

### LRUCache

A Least Recently Used (LRU) cache implementation optimized for small capacities.

```python
cache = LRUCache(capacity=100)
cache['key'] = 'value'
value = cache.get('key', default='default_value')
```

**Key Features:**
- Thread-safe operations with locking
- MutableMapping interface
- Efficient for capacities under 1000 items
- Automatic eviction of least recently used items

**Methods:**
- `get(key, default=None)` - Retrieve item with optional default
- `setdefault(key, default=None)` - Set if key doesn't exist
- `clear()` - Remove all items
- `copy()` - Create shallow copy

### Cycler

Cycles through values repeatedly, useful for alternating styles in templates.

```python
cycler = Cycler("odd", "even", "neutral")
print(cycler.next())  # "odd"
print(cycler.next())  # "even"
print(cycler.next())  # "neutral"
print(cycler.next())  # "odd" (cycles back)
```

**Methods:**
- `next()` - Get current item and advance to next
- `reset()` - Reset to first item
- `current` - Property to access current item without advancing

### Joiner

Helper for joining template output with separators.

```python
joiner = Joiner(", ")
# First call returns empty string, subsequent calls return separator
output = joiner() + "first" + joiner() + "second"  # "first, second"
```

### Namespace

Dynamic attribute container for templates.

```python
ns = Namespace(name="John", age=30)
print(ns.name)  # "John"
ns.city = "New York"  # Dynamic attribute assignment
```

## Important Functions

### Context Management Decorators

These decorators automatically pass Jinja2 context objects to functions:

```python
@pass_context
def my_filter(context, value):
    # Access full template context
    return modified_value

@pass_eval_context  
def my_filter(eval_ctx, value):
    # Access evaluation context only
    return modified_value

@pass_environment
def my_filter(env, value):
    # Access Jinja2 environment only
    return modified_value
```

### URL Processing

#### urlize()

Converts URLs in text to clickable HTML links.

```python
text = "Visit https://example.com for more info"
html = urlize(text, trim_url_limit=30, target="_blank", rel="nofollow")
```

**Parameters:**
- `trim_url_limit` - Maximum display length for URLs
- `target` - HTML target attribute
- `rel` - HTML rel attribute  
- `extra_schemes` - Additional URL schemes to recognize

#### url_quote()

URL-encode strings for safe use in URLs.

```python
safe_url = url_quote("hello world", charset="utf-8", for_qs=True)
# Returns: "hello+world"
```

### Utility Functions

#### import_string()

Dynamically import objects by string path.

```python
# Import using dotted notation
escape_func = import_string("xml.sax.saxutils.escape")

# Import using colon notation  
escape_func = import_string("xml.sax.saxutils:escape")
```

#### is_undefined()

Check if an object is a Jinja2 Undefined instance.

```python
if is_undefined(template_var):
    return "Default value"
```

#### generate_lorem_ipsum()

Generate placeholder text for templates.

```python
# Generate 3 paragraphs as HTML
lorem = generate_lorem_ipsum(n=3, html=True, min=20, max=50)

# Generate plain text
lorem = generate_lorem_ipsum(n=2, html=False)
```

#### select_autoescape()

Create intelligent autoescaping functions based on file extensions.

```python
autoescape = select_autoescape(
    enabled_extensions=('html', 'xml'),
    disabled_extensions=('txt',),
    default_for_string=True,
    default=False
)
```

#### htmlsafe_json_dumps()

Safely serialize JSON for HTML contexts.

```python
safe_json = htmlsafe_json_dumps({"key": "<script>alert('xss')</script>"})
# Escapes HTML-unsafe characters: <, >, &, '
```

### Cache Management

#### clear_caches()

Clear internal Jinja2 caches to free memory.

```python
clear_caches()  # Clears environment and lexer caches
```

## Special Objects

### missing

A sentinel object representing missing values in templates.

```python
if value is missing:
    # Handle missing template variable
    pass
```

### internal_code

Set containing code objects marked as internal to Jinja2.

```python
@internalcode
def internal_function():
    # This function's code will be added to internal_code set
    pass
```

## Notes and Suggestions

- **Performance**: The LRUCache is optimized for small capacities (< 1000 items)
- **Security**: Always use `htmlsafe_json_dumps()` when outputting JSON in HTML contexts
- **URL Processing**: The `urlize()` function provides basic URL detection; consider using dedicated Markdown libraries for comprehensive formatting
- **Thread Safety**: LRUCache operations are thread-safe, but other utilities may not be
- **Memory Management**: Use `clear_caches()` periodically in long-running applications to manage memory usage

## Dependencies

- `markupsafe` - For safe HTML string handling
- `typing` and `typing_extensions` -