<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Python Markdown Parser Documentation

## Overview

This module provides a Python implementation of John Gruber's Markdown specification. It converts Markdown-formatted text to HTML with support for extensions and customizable output formats.

**Key Links:**
- [Documentation](https://python-markdown.github.io/)
- [GitHub Repository](https://github.com/Python-Markdown/markdown/)
- [PyPI Package](https://pypi.org/project/Markdown/)

## Main Components

### `Markdown` Class

The core class that handles Markdown parsing and conversion to HTML.

#### Key Attributes

- **`tab_length`** (int): Number of spaces equivalent to a tab (default: 4)
- **`ESCAPED_CHARS`** (list[str]): Characters that receive backslash escape treatment
- **`block_level_elements`** (list[str]): HTML tags treated as block-level elements
- **`output_formats`** (dict): Mapping of supported output formats (`html`, `xhtml`)
- **`references`** (dict): Link references found in parsed document
- **`htmlStash`** (HtmlStash): Instance for stashing HTML content during processing

#### Processing Components

The parser uses five main processing stages:

- **`preprocessors`** (Registry): Text preprocessing before parsing
- **`parser`** (BlockParser): High-level structural element parsing  
- **`inlinePatterns`** (Registry): Inline markup pattern matching
- **`treeprocessors`** (Registry): ElementTree manipulation
- **`postprocessors`** (Registry): Final text post-processing

### Constructor

```python
def __init__(self, **kwargs):
```

**Parameters:**
- `extensions` (list): List of extension instances or names
- `extension_configs` (dict): Configuration settings per extension
- `output_format` (str): Output format (`html` or `xhtml`)
- `tab_length` (int): Tab width in spaces

### Core Methods

#### `convert(source: str) -> str`

Converts Markdown text to HTML through a 5-step process:

1. **Preprocessors** - Modify input text
2. **Block Parser** - Parse structural elements into ElementTree
3. **Tree Processors** - Process ElementTree (includes inline patterns)
4. **Serialization** - Convert ElementTree to text
5. **Post Processors** - Final text modifications

```python
md = Markdown()
html = md.convert("# Hello World\n\nThis is **bold** text.")
```

#### `convertFile(input, output, encoding) -> Markdown`

Converts Markdown files with proper encoding handling.

```python
md = Markdown()
md.convertFile(input='document.md', output='document.html', encoding='utf-8')
```

#### Extension Management

```python
def registerExtensions(extensions, configs) -> Markdown
def build_extension(ext_name: str, configs) -> Extension
def registerExtension(extension: Extension) -> Markdown
```

Handles loading and registering extensions either by:
- Entry point lookup in `markdown.extensions` group
- Dot notation import (`path.to.module:ClassName`)
- Module's `makeExtension()` function

#### Utility Methods

```python
def reset() -> Markdown                    # Reset parser state
def set_output_format(format: str)         # Set HTML/XHTML output
def is_block_level(tag) -> bool           # Check if tag is block-level
def build_parser() -> Markdown            # Initialize processing components
```

## Exported Functions

### `markdown(text: str, **kwargs) -> str`

Convenience function for simple Markdown conversion:

```python
import markdown

html = markdown.markdown("# Hello\n\nThis is **bold**.")
print(html)  # <h1>Hello</h1>\n<p>This is <strong>bold</strong>.</p>
```

### `markdownFromFile(**kwargs)`

Convenience function for file-based conversion:

```python
import markdown

markdown.markdownFromFile(
    input='README.md',
    output='README.html',
    encoding='utf-8'
)
```

## Usage Examples

### Basic Usage

```python
import markdown

# Simple conversion
md = markdown.Markdown()
html = md.convert("# Title\n\nParagraph with *emphasis*.")

# With extensions
md = markdown.Markdown(extensions=['codehilite', 'tables'])
html = md.convert(markdown_text)
```

### File Processing

```python
# Convert file
md = markdown.Markdown()
md.convertFile('input.md', 'output.html')

# Or use convenience function
markdown.markdownFromFile(input='input.md', output='output.html')
```

### Custom Configuration

```python
md = markdown.Markdown(
    extensions=['codehilite', 'toc'],
    extension_configs={
        'codehilite': {'css_class': 'highlight'},
        'toc': {'title': 'Table of Contents'}
    },
    output_format='html',
    tab_length=2
)
```

## Notes and Recommendations

### Performance Considerations
- **Reuse instances**: Call `reset()` between conversions rather than creating new instances
- **Memory management**: The parser maintains state between conversions

### Extension Development
- Extensions should inherit from `markdown.extensions.Extension`
- Use `registerExtension()` if your extension needs state reset capability
- Follow the entry point registration pattern for distributable extensions

### Error Handling
- Input must be Unicode strings
- Invalid extensions raise `ImportError` or `AttributeError`
- Invalid output formats raise `KeyError`

### Thread Safety
- **Not thread-safe**: Each thread should use separate `Markdown` instances
- Shared state in registries and references can cause issues in concurrent usage