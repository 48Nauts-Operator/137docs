<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Attribute List Extension for Python-Markdown

## Overview

This Python file implements an **Attribute List Extension** for Python-Markdown that adds support for HTML attribute syntax within Markdown documents. The extension allows users to add CSS classes, IDs, and other HTML attributes to Markdown elements using a special `{: }` syntax.

The implementation is inspired by [Maruku's attribute list feature](http://maruku.rubyforge.org/proposal.html#attribute_lists) and follows the same syntax conventions.

## Purpose

The extension enables Markdown authors to:
- Add CSS classes and IDs to elements
- Set custom HTML attributes on Markdown elements
- Enhance styling and JavaScript integration capabilities
- Maintain readable Markdown while adding semantic markup

## Key Components

### Functions

#### `get_attrs_and_remainder(attrs_string: str)`
Parses attribute list strings and returns parsed attributes along with any remaining text.

**Parameters:**
- `attrs_string`: The attribute string to parse (content between `{: }`)

**Returns:**
- Tuple containing:
  - List of attribute tuples `(key, value)`
  - Remaining unparsed text after `}`

**Example:**
```python
attrs, remainder = get_attrs_and_remainder('class="highlight" id="main"')
# Returns: ([('class', 'highlight'), ('id', 'main')], '')
```

#### `isheader(elem: Element)`
Utility function to check if an element is a header tag (h1-h6).

### Classes

#### `AttrListTreeprocessor`
The main processor class that traverses the document tree and applies attribute lists to elements.

**Key Features:**
- **Regex Patterns**: Defines different patterns for block-level, header, and inline attribute detection
- **Element Processing**: Handles both block-level and inline elements differently
- **Special Cases**: Includes logic for list items, headers, and table elements

**Important Methods:**

##### `run(doc: Element)`
Main processing method that iterates through all elements in the document tree.

##### `assign_attrs(elem: Element, attrs_string: str, *, strict: bool = False)`
Assigns parsed attributes to an XML element.

**Parameters:**
- `elem`: Target XML element
- `attrs_string`: Raw attribute string
- `strict`: Whether to enforce strict parsing (reject malformed input)

##### `sanitize_name(name: str)`
Sanitizes attribute names to comply with XML naming conventions.

#### `AttrListExtension`
Extension class that registers the tree processor with Python-Markdown.

## Syntax Support

The extension recognizes several attribute formats:

### CSS Classes
```markdown
# Header {: .highlight}
Text with class {: .important .red}
```

### IDs
```markdown
# Header {: #main-title}
Paragraph {: #intro}
```

### Key-Value Attributes
```markdown
Link {: target="_blank" rel="noopener"}
Image {: width="300" height="200"}
```

### Mixed Attributes
```markdown
# Header {: .title #main data-section="intro"}
```

## Processing Logic

### Block-Level Elements
- Searches for attribute lists at the end of element text or tail
- Special handling for headers, list items, and table cells
- Removes attribute syntax from text after processing

### Inline Elements
- Looks for attribute lists at the beginning of element tail
- Preserves remaining text after attribute removal

### List Items
Complex logic handles three scenarios:
1. No nested lists - uses tail of last child
2. Nested lists - uses tail of element before the nested list
3. Nested list as first child - uses element text

## Usage Notes

### Installation
```python
import markdown
md = markdown.Markdown(extensions=['attr_list'])
```

### Example Usage
```markdown
## Header with Class {: .section-title}

Paragraph with multiple attributes {: .highlight #important data-value="123"}

- List item {: .special}
- Another item {: #item-2}
```

## Important Considerations

‚ö†Ô∏è **Security**: The extension sanitizes attribute names but not values. Be cautious with user-generated content.

‚ö†Ô∏è **Performance**: The extension uses regex scanning which may impact performance on large documents.

üí° **Compatibility**: Designed to work with Python-Markdown's tree processor system and maintains compatibility with other extensions.

## Dependencies

- `xml.etree.ElementTree` for XML element manipulation
- `re` module for regex pattern matching
- Python-Markdown's extension framework