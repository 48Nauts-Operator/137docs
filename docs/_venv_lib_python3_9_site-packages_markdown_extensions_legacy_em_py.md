<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Legacy Em Extension for Python-Markdown

## Overview

This extension provides legacy behavior for underscore-based emphasis and strong formatting in Python-Markdown. It handles the processing of `_connected_words_` patterns that may differ from the standard Markdown emphasis handling.

**License:** BSD  
**Copyright:** 2015-2018 The Python Markdown Project

## Purpose

The Legacy Em Extension is designed to maintain backward compatibility for documents that rely on older underscore emphasis behavior. It specifically handles:

- Single underscore emphasis: `_text_` ‚Üí *text*
- Double underscore strong: `__text__` ‚Üí **text**
- Combined strong and emphasis patterns with underscores

## Key Components

### Regular Expression Patterns

The extension defines several regex patterns for matching different emphasis combinations:

```python
# Basic emphasis pattern
EMPHASIS_RE = r'(_)([^_]+)\1'

# Strong text pattern  
STRONG_RE = r'(_{2})(.+?)\1'

# Strong emphasis combination pattern
STRONG_EM_RE = r'(_)\1(?!\1)([^_]+?)\1(?!\1)(.+?)\1{3}'
```

### Classes

#### `LegacyUnderscoreProcessor`

Extends the base `UnderscoreProcessor` to handle legacy underscore emphasis patterns.

**Key Features:**
- Inherits from `UnderscoreProcessor`
- Defines a `PATTERNS` list with `EmStrongItem` objects
- Handles multiple emphasis/strong combinations with specific precedence

**Pattern Processing Order:**
1. Double emphasis-strong combinations (`EM_STRONG2_RE`)
2. Double strong-emphasis combinations (`STRONG_EM2_RE`) 
3. Custom strong-emphasis pattern (`STRONG_EM_RE`)
4. Basic strong pattern (`STRONG_RE`)
5. Basic emphasis pattern (`EMPHASIS_RE`)

#### `LegacyEmExtension`

Main extension class that integrates the legacy underscore processor into Python-Markdown.

**Methods:**
- `extendMarkdown(md)`: Registers the `LegacyUnderscoreProcessor` with the markdown parser

### Functions

#### `makeExtension(**kwargs)`

Factory function for creating extension instances.

```python
def makeExtension(**kwargs):
    """ Return an instance of the `LegacyEmExtension` """
    return LegacyEmExtension(**kwargs)
```

## Usage

To use this extension in your Python-Markdown setup:

```python
import markdown

# Method 1: Using the extension directly
md = markdown.Markdown(extensions=['legacy_em'])

# Method 2: Using the factory function
from markdown.extensions.legacy_em import makeExtension
md = markdown.Markdown(extensions=[makeExtension()])
```

## Technical Notes

### Pattern Registration
- The processor is registered with priority `50` under the name `'em_strong2'`
- Uses `re.DOTALL | re.UNICODE` flags for comprehensive pattern matching

### Dependencies
- Inherits from base Python-Markdown extension classes
- Imports inline pattern processors from the parent markdown package
- Uses predefined regex patterns from the main inline patterns module

## Suggestions and Considerations

‚ö†Ô∏è **Legacy Warning**: This extension is specifically for maintaining backward compatibility. For new projects, consider using standard Markdown emphasis patterns.

üìù **Testing**: When implementing this extension, test thoroughly with various underscore combinations to ensure expected behavior.

üîß **Performance**: The multiple regex patterns are processed in order, so complex documents with many emphasis patterns may see slight performance impacts.

## Related Components

This extension works alongside:
- `markdown.inlinepatterns.UnderscoreProcessor`
- `markdown.inlinepatterns.EmStrongItem`
- Core Python-Markdown extension framework