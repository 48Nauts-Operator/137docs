<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Smarty Extension for Python-Markdown

## Overview

The **Smarty Extension** is a Python-Markdown extension that automatically converts ASCII characters (dashes, quotes, and ellipses) to their corresponding HTML entity equivalents. This provides typographically correct characters in the final HTML output.

For example:
- `---` becomes `&mdash;` (em dash: —)
- `--` becomes `&ndash;` (en dash: –)
- `"quoted text"` becomes `&ldquo;quoted text&rdquo;` (smart quotes: "quoted text")
- `...` becomes `&hellip;` (ellipsis: …)

## Purpose

This extension enhances the typography of Markdown documents by:
- Converting straight quotes to curly quotes
- Converting multiple hyphens to em and en dashes
- Converting three dots to proper ellipsis characters
- Optionally handling angled quotes (`<<` and `>>`)

## Configuration Options

The extension supports several configuration options:

| Option | Default | Description |
|--------|---------|-------------|
| `smart_quotes` | `True` | Enable smart quote conversion |
| `smart_angled_quotes` | `False` | Enable angled quote conversion (`<<` and `>>`) |
| `smart_dashes` | `True` | Enable dash conversion (`--` and `---`) |
| `smart_ellipses` | `True` | Enable ellipsis conversion (`...`) |
| `substitutions` | `{}` | Override default HTML entity substitutions |

## Important Classes

### `SmartyExtension`

The main extension class that handles the configuration and registration of pattern processors.

**Key Methods:**
- `__init__(**kwargs)`: Initializes configuration options
- `extendMarkdown(md)`: Registers the extension with the Markdown processor
- `educateQuotes(md)`: Sets up smart quote conversion patterns
- `educateDashes(md)`: Sets up dash conversion patterns
- `educateEllipses(md)`: Sets up ellipsis conversion patterns
- `educateAngledQuotes(md)`: Sets up angled quote conversion patterns

### `SubstituteTextPattern`

A helper class that extends `HtmlInlineProcessor` to handle pattern matching and text substitution.

**Key Methods:**
- `handleMatch(m, data)`: Processes regex matches and performs substitutions

## Usage Examples

### Basic Usage

```python
import markdown

# Create Markdown instance with Smarty extension
md = markdown.Markdown(extensions=['smarty'])

# Convert text
text = 'He said, "Let\'s go---it\'ll be fun..."'
html = md.convert(text)
# Output: He said, &ldquo;Let&rsquo;s go&mdash;it&rsquo;ll be fun&hellip;
```

### Custom Configuration

```python
md = markdown.Markdown(
    extensions=['smarty'],
    extension_configs={
        'smarty': {
            'smart_angled_quotes': True,
            'substitutions': {
                'mdash': '—',  # Use Unicode instead of HTML entity
                'ndash': '–'
            }
        }
    }
)
```

## Pattern Processing

The extension uses regular expressions to identify and convert various character patterns:

### Quote Patterns
- **Opening quotes**: Detected after whitespace, dashes, or at the beginning of words
- **Closing quotes**: Detected before whitespace, punctuation, or at word boundaries
- **Special cases**: Handles decade abbreviations (`'80s`), nested quotes, and edge cases

### Dash Patterns
- `---` → `&mdash;` (em dash)
- `--` → `&ndash;` (en dash)
- Includes negative lookbehind/lookahead to prevent false matches

### Ellipsis Pattern
- `...` → `&hellip;` (but not `....` or more dots)

## Notes and Suggestions

### Important Considerations

1. **Processing Order**: The extension processes patterns in a specific priority order to handle complex cases correctly.

2. **HTML Preservation**: The extension is careful not to process text inside HTML tags.

3. **Escaped Characters**: Quotes and apostrophes are added to Markdown's escaped characters list.

### Performance Notes

- The extension uses multiple regex patterns, which may impact performance on very large documents
- Patterns are processed during the tree processing phase for optimal integration

### Compatibility

- Requires Python-Markdown 3.x
- Uses type hints for better IDE support and code clarity
- Compatible with other Markdown extensions

### Customization Tips

```python
# Example: Create custom substitutions for different languages
custom_substitutions = {
    'left-double-quote': '«',   # French-style quotes
    'right-double-quote': '»',
    'mdash': '—',               # Use Unicode directly
}

md = markdown.Markdown(
    extensions=['smarty'],
    extension_configs={
        'smarty': {
            'substitutions': custom_substitutions
        }
    }
)
```

## License

This extension is licensed under the BSD License and incorporates code from SmartyPants, which has its own BSD-style license. See the source file for complete license information.