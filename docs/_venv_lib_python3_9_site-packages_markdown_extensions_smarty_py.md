<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Smarty Extension for Python-Markdown

## Overview

The Smarty extension for Python-Markdown provides automatic conversion of ASCII typography characters to their proper HTML entity equivalents. This extension enhances text formatting by converting straight quotes, dashes, and ellipses into their typographically correct counterparts.

## Purpose

This extension "educates" plain ASCII characters into proper typography:
- Converts straight quotes (`"` and `'`) to curly quotes (`"`, `"`, `'`, `'`)
- Transforms double and triple hyphens (`--`, `---`) into en-dashes and em-dashes (`–`, `—`)
- Replaces three dots (`...`) with proper ellipses (`…`)
- Optionally converts angled quotes (`<<`, `>>`) to guillemets (`«`, `»`)

## Key Components

### Classes

#### `SubstituteTextPattern`

A specialized inline processor that handles pattern matching and replacement.

```python
class SubstituteTextPattern(HtmlInlineProcessor):
    def __init__(self, pattern: str, replace: Sequence[int | str | etree.Element], md: Markdown):
        # Replaces matches with specified text or HTML entities
```

**Key Features:**
- Extends `HtmlInlineProcessor` for inline text processing
- Handles regex pattern matching and substitution
- Supports both literal text and regex group references

#### `SmartyExtension`

The main extension class that orchestrates all smart typography conversions.

```python
class SmartyExtension(Extension):
    def __init__(self, **kwargs):
        self.config = {
            'smart_quotes': [True, 'Educate quotes'],
            'smart_angled_quotes': [False, 'Educate angled quotes'], 
            'smart_dashes': [True, 'Educate dashes'],
            'smart_ellipses': [True, 'Educate ellipses'],
            'substitutions': [{}, 'Overwrite default substitutions'],
        }
```

### Important Methods

#### Education Methods

- **`educateQuotes()`**: Handles conversion of straight quotes to curly quotes
- **`educateDashes()`**: Converts hyphens to en-dashes and em-dashes
- **`educateEllipses()`**: Transforms three dots into proper ellipses
- **`educateAngledQuotes()`**: Converts `<<` and `>>` to guillemets

#### Core Processing

- **`extendMarkdown()`**: Main method that registers all processors with the Markdown instance
- **`_addPatterns()`**: Helper method to register multiple patterns with priorities

## Configuration Options

| Option | Default | Description |
|--------|---------|-------------|
| `smart_quotes` | `True` | Enable smart quote conversion |
| `smart_angled_quotes` | `False` | Enable angled quote conversion |
| `smart_dashes` | `True` | Enable dash conversion |
| `smart_ellipses` | `True` | Enable ellipsis conversion |
| `substitutions` | `{}` | Override default HTML entities |

## Usage Example

```python
import markdown

# Basic usage
md = markdown.Markdown(extensions=['smarty'])
result = md.convert('He said, "Hello there..."')
# Output: He said, &ldquo;Hello there&hellip;&rdquo;

# With custom configuration  
md = markdown.Markdown(extensions=['smarty'], 
                      extension_configs={
                          'smarty': {
                              'smart_angled_quotes': True,
                              'smart_quotes': False
                          }
                      })
```

## Technical Notes

### Pattern Processing Order
The extension processes patterns with specific priorities to ensure correct conversion:
1. Em-dashes (`---`) - Priority 50
2. En-dashes (`--`) - Priority 45  
3. Angled quotes - Priority 40/35
4. Quote patterns - Priority 30 and below
5. Ellipses - Priority 10

### Special Cases Handled
- **Decade abbreviations**: `'80s` → `'80s` (preserves apostrophe)
- **Nested quotes**: `"'word'"` → `"'word'"`  
- **Punctuation context**: Handles quotes near punctuation correctly
- **Word boundaries**: Respects word boundaries for proper quote placement

## Important Considerations

⚠️ **HTML Compatibility**: When angled quotes are enabled, the extension modifies HTML processing to prevent conflicts with HTML tags.

⚠️ **Escaped Characters**: The extension adds `"` and `'` to Markdown's escaped characters list.

⚠️ **Processing Order**: Uses tree processors with priority 6 to ensure proper integration with other Markdown extensions.

## License

This extension incorporates code from SmartyPants and smartypants.py, both with BSD-style licenses. See the source file for complete license information.