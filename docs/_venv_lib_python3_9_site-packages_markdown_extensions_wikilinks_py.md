<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# WikiLinks Extension for Python-Markdown

## Overview

This extension for Python-Markdown converts wiki-style links in the format `[[WikiLinks]]` to HTML anchor tags with relative URLs. It's designed to facilitate linking between documents in a wiki-like manner within Markdown documents.

## Purpose

The primary purpose of this extension is to:
- Convert wiki-style double-bracket links (`[[text]]`) into HTML anchor tags
- Generate clean URLs by replacing spaces with underscores
- Provide configurable URL structure and CSS styling
- Support both configuration-based and metadata-based customization

## Key Components

### Functions

#### `build_url(label: str, base: str, end: str) -> str`
Constructs a URL from the wiki link label and URL components.

**Parameters:**
- `label`: The text inside the wiki link brackets
- `base`: Base URL prefix (default: "/")
- `end`: URL suffix (default: "/")

**Behavior:**
- Replaces spaces with underscores using regex pattern `r'([ ]+_)|(_[ ]+)|([ ]+)'`
- Returns formatted URL as `{base}{clean_label}{end}`

#### `makeExtension(**kwargs)`
Factory function to create a `WikiLinkExtension` instance.

### Classes

#### `WikiLinkExtension(Extension)`
Main extension class that integrates with Python-Markdown.

**Configuration Options:**
- `base_url`: String prepended to URLs (default: "/")
- `end_url`: String appended to URLs (default: "/")  
- `html_class`: CSS class for generated links (default: "wikilink")
- `build_url`: Callable function for URL formatting (default: `build_url` function)

**Key Methods:**
- `extendMarkdown(md)`: Registers the wiki link processor with the Markdown parser

#### `WikiLinksInlineProcessor(InlineProcessor)`
Processes wiki link patterns and converts them to HTML anchor elements.

**Pattern:** `r'\[\[([\w0-9_ -]+)\]\]'` - Matches text within double square brackets

**Key Methods:**
- `handleMatch()`: Converts matched wiki links to HTML anchor tags
- `_getMeta()`: Retrieves configuration from metadata or default config

## Usage Example

```python
import markdown

# Basic usage
md = markdown.Markdown(extensions=['wikilinks'])
result = md.convert('This is a [[Wiki Link]] example.')
# Output: <p>This is a <a class="wikilink" href="/Wiki_Link/">Wiki Link</a> example.</p>

# With custom configuration  
md = markdown.Markdown(
    extensions=['wikilinks'],
    extension_configs={
        'wikilinks': {
            'base_url': '/wiki/',
            'end_url': '.html',
            'html_class': 'internal-link'
        }
    }
)
```

## Metadata Support

The extension supports document-level metadata overrides:

```markdown
wiki_base_url: /docs/
wiki_end_url: .html
wiki_html_class: doc-link

This [[Example Link]] will use the metadata configuration.
```

## Notes and Suggestions

### Important Considerations

- **URL Sanitization**: The extension cleans labels by replacing spaces with underscores, but doesn't handle special characters that might be problematic in URLs
- **Pattern Limitations**: The regex pattern only matches alphanumeric characters, spaces, underscores, and hyphens
- **No Link Validation**: The extension doesn't verify that target pages exist

### Potential Improvements

1. **Enhanced URL Sanitization**: Consider adding more robust URL encoding for special characters
2. **Custom Pattern Support**: Allow users to define custom regex patterns for wiki links
3. **Link Validation**: Add optional validation to check if target pages exist
4. **Title Attribute Support**: Consider adding support for custom link titles

### Performance Notes

- The extension registers at priority 75 in the inline patterns queue
- Regex compilation happens once during initialization for efficiency
- Metadata lookup occurs for each processed link, which may impact performance with many wiki links

## Dependencies

- `xml.etree.ElementTree`: For HTML element creation
- `re`: For regex pattern matching and text processing
- Parent classes from Python-Markdown framework