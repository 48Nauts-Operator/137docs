<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Python Markdown Inline Patterns Module

This module is part of the Python Markdown library and handles inline pattern matching and processing for Markdown syntax elements like links, images, emphasis, code blocks, and HTML tags.

## Overview

The module provides two main approaches for processing inline Markdown patterns:

1. **Legacy Pattern Class**: The older `Pattern` class (deprecated but maintained for compatibility)
2. **Modern InlineProcessor Class**: The newer, more efficient `InlineProcessor` class

## Key Components

### Main Functions

#### `build_inlinepatterns(md: Markdown, **kwargs: Any) -> util.Registry[InlineProcessor]`

Builds and registers the default set of inline patterns for Markdown processing. The patterns are applied in a specific order of priority:

- **High Priority (190-180)**: Backticks and escaped characters
- **Medium Priority (170-120)**: Links, images, and references  
- **Low Priority (110-50)**: HTML, entities, emphasis, and strong formatting

```python
# Example usage
inlinePatterns = build_inlinepatterns(md_instance)
```

### Base Classes

#### `Pattern` (Legacy - Deprecated)

The original base class for inline patterns. **Note: This is deprecated in favor of `InlineProcessor`.**

- Requires patterns to match entire blocks
- Automatically wraps regex with `^(.*)` and `(.*)$`
- Less efficient than the newer approach

#### `InlineProcessor` (Recommended)

The modern base class for inline pattern processing with improved efficiency:

```python
class InlineProcessor(Pattern):
    def handleMatch(self, m: re.Match[str], data: str) -> tuple[etree.Element | str | None, int | None, int | None]:
        # Return: (element, start_index, end_index)
        pass
```

**Key advantages:**
- More flexible regex patterns (no need to match entire blocks)
- Better performance
- Explicit control over consumed text spans
- Can handle complex nested constructs

### Important Processor Classes

#### Text Processing

- **`BacktickInlineProcessor`**: Handles inline code blocks (`` `code` ``)
- **`EscapeInlineProcessor`**: Processes backslash-escaped characters
- **`SimpleTextInlineProcessor`**: Returns simple text content

#### Link Processing

- **`LinkInlineProcessor`**: Processes inline links `[text](url "title")`
- **`ReferenceInlineProcessor`**: Handles reference links `[text][ref]`
- **`AutolinkInlineProcessor`**: Auto-links URLs `<http://example.com>`
- **`AutomailInlineProcessor`**: Auto-links email `<user@example.com>`

#### Image Processing

- **`ImageInlineProcessor`**: Handles inline images `![alt](src "title")`
- **`ImageReferenceInlineProcessor`**: Processes image references `![alt][ref]`

#### Emphasis Processing

- **`AsteriskProcessor`**: Handles `*emphasis*` and `**strong**` with asterisks
- **`UnderscoreProcessor`**: Handles `_emphasis_` and `__strong__` with underscores

#### HTML Processing

- **`HtmlInlineProcessor`**: Stores raw HTML and returns placeholders

### Regular Expression Patterns

The module defines numerous regex patterns for matching Markdown syntax:

```python
BACKTICK_RE = r'(?:(?<!\\)((?:\\{2})+)(?=`+)|(?<!\\)(`+)(.+?)(?<!`)\2(?!`))'
LINK_RE = NOIMG + r'\['  # Matches start of links (not images)
IMAGE_LINK_RE = r'\!\['  # Matches start of image links
AUTOLINK_RE = r'<((?:[Ff]|[Hh][Tt])[Tt][Pp][Ss]?://[^<>]*)>'
```

## Usage Examples

### Creating a Custom Inline Processor

```python
class CustomInlineProcessor(InlineProcessor):
    def handleMatch(self, m: re.Match[str], data: str) -> tuple[etree.Element, int, int]:
        el = etree.Element('span')
        el.text = m.group(1)
        el.set('class', 'custom')
        return el, m.start(0), m.end(0)

# Register the processor
md.inlinePatterns.register(CustomInlineProcessor(r'~~(.+?)~~'), 'strikethrough', 175)
```

### Processing Priority

Processors are executed in order of priority (higher numbers first):

1. **190**: Backticks - Must be processed first to prevent other patterns from interfering
2. **180**: Escape sequences - Handle escaped characters early
3. **170-120**: Links and images - Process before HTML to avoid conflicts
4. **110-90**: HTML and entities - Handle raw HTML
5. **80-50**: Text formatting - Emphasis, strong, etc.

## Important Notes

### Migration from Pattern to InlineProcessor

When migrating from the legacy `Pattern` class:

- Remove `^(.*?)` and `(.*?)$` from regex patterns
- Update `handleMatch` to return `(element, start, end)` tuple
- Use `m.group(1)` instead of `m.group(2)` for the first capture group

### Performance Considerations

- Use `InlineProcessor` for new implementations
- The order of pattern registration significantly impacts performance
- Patterns are processed in priority order, so place more common patterns at appropriate priorities

### Error Handling

- Return `(None, None, None)` from `handleMatch` if no valid match is found
- The processor will skip the match and continue processing

This module is essential for converting Markdown inline syntax to HTML elements and requires careful attention to pattern ordering and regex design.