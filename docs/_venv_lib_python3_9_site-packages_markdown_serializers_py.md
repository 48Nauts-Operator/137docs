<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# ElementTree HTML Serialization Module

## Overview

This module extends Python's ElementTree functionality by providing HTML and XHTML serialization capabilities. It allows you to convert `xml.etree.ElementTree.Element` objects into properly formatted HTML or XHTML strings.

**Source**: Based on ElementTree 1.3 preview with modifications  
**Copyright**: Fredrik Lundh (1999-2007)  
**License**: BSD-style license (see source header for full terms)

## Purpose

The module addresses the need to serialize XML ElementTree structures to HTML/XHTML format with proper:
- Entity escaping
- Boolean attribute handling
- Self-closing tag formatting
- Namespace support

## Key Differences Between HTML and XHTML Output

| Feature | HTML Output | XHTML Output |
|---------|-------------|--------------|
| Empty tags | `<br>` | `<br />` |
| Boolean attributes | `checked` | `checked="checked"` |

## Public Functions

### `to_html_string(element: Element) -> str`

Serializes an ElementTree Element and its children to an HTML5 string.

**Parameters:**
- `element`: An `xml.etree.ElementTree.Element` object to serialize

**Returns:**
- A string containing the HTML5 representation

**Example:**
```python
from xml.etree.ElementTree import Element
element = Element('div')
element.text = 'Hello World'
html_output = to_html_string(element)
# Result: <div>Hello World</div>
```

### `to_xhtml_string(element: Element) -> str`

Serializes an ElementTree Element and its children to an XHTML string.

**Parameters:**
- `element`: An `xml.etree.ElementTree.Element` object to serialize

**Returns:**
- A string containing the XHTML representation

**Example:**
```python
from xml.etree.ElementTree import Element
element = Element('br')
xhtml_output = to_xhtml_string(element)
# Result: <br />
```

## Internal Functions

### Text Escaping Functions

- **`_escape_cdata(text) -> str`**: Escapes character data for HTML content
  - Converts `&`, `<`, `>` to their HTML entities
  - Preserves existing valid HTML entities

- **`_escape_attrib(text: str) -> str`**: Escapes text for XHTML attribute values
  - Includes newline escaping (`\n` â†’ `&#10;`)

- **`_escape_attrib_html(text: str) -> str`**: Escapes text for HTML attribute values
  - Similar to `_escape_attrib` but without newline escaping

### Core Serialization

- **`_serialize_html(write, elem, format)`**: Recursive function that handles the actual serialization logic
- **`_write_html(root, format)`**: Orchestrates the serialization process

## Special Handling

### Element Types
- **Comments**: Rendered as `<!-- content -->`
- **Processing Instructions**: Rendered as `<? content ?>`
- **QName objects**: Namespace-aware element handling

### Script and Style Tags
Content within `<script>` and `<style>` tags is **not escaped** to preserve functionality of embedded code.

### HTML Empty Elements
The module recognizes standard HTML empty elements (like `br`, `img`, `input`) and formats them according to the target format.

## Usage Notes

### Error Handling
- Raises `TypeError` for non-serializable content
- Validates QName objects have proper tag definitions

### Performance Considerations
- Text escaping is optimized for strings shorter than 500 characters
- Uses regex for efficient entity detection and replacement

### Boolean Attributes
```python
# HTML output
<input checked>

# XHTML output  
<input checked="checked">
```

## Dependencies

```python
from xml.etree.ElementTree import ProcessingInstruction, Comment, ElementTree, Element, QName, HTML_EMPTY
import re
from typing import Callable, Literal, NoReturn
```

## Module Constants

- **`RE_AMP`**: Compiled regex pattern for detecting unescaped ampersands
- **`__all__`**: Exports `['to_html_string', 'to_xhtml_string']`

## Recommendations

1. **Use appropriate format**: Choose `to_html_string` for modern web applications, `to_xhtml_string` for strict XHTML compliance
2. **Validate input**: Ensure ElementTree elements are properly constructed before serialization  
3. **Handle exceptions**: Wrap calls in try-catch blocks to handle serialization errors gracefully
4. **Test output**: Validate generated HTML/XHTML with appropriate validators for your use case