<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# MkDocs Build Module Documentation

This module is responsible for the core build functionality of MkDocs, handling the process of converting Markdown documentation into a complete static website.

## Purpose

The `mkdocs.commands.build` module orchestrates the entire documentation build process, including:
- Reading and processing Markdown files
- Applying themes and templates
- Generating navigation structures
- Creating the final static site output
- Managing plugins throughout the build lifecycle

## Key Functions

### `build(config, *, serve_url=None, dirty=False)`

The main entry point for building a complete MkDocs site.

**Parameters:**
- `config` (MkDocsConfig): The MkDocs configuration object
- `serve_url` (str, optional): URL for serving mode
- `dirty` (bool): Whether to perform an incremental build

**Key Operations:**
1. Cleans the site directory (unless dirty build)
2. Gathers all files and creates navigation structure
3. Processes Markdown content and applies plugins
4. Copies static assets and builds templates
5. Generates final HTML pages
6. Validates links and anchors

```python
# Example usage
from mkdocs.config import load_config
from mkdocs.commands.build import build

config = load_config()
build(config)
```

### `get_context(nav, files, config, page=None, base_url='')`

Creates the template context used for rendering pages and templates.

**Returns:** `TemplateContext` object containing:
- Navigation structure
- Page collection
- CSS and JavaScript assets
- MkDocs version and build metadata
- Configuration settings

### Page Processing Functions

#### `_populate_page(page, config, files, dirty=False)`

Reads page content from source files and converts Markdown to HTML.

**Process:**
1. Reads source Markdown content
2. Runs `pre_page` plugin events
3. Processes Markdown through plugins
4. Renders content to HTML
5. Applies `page_content` plugin events

#### `_build_page(page, config, doc_files, nav, env, dirty=False, excluded=False)`

Renders a page using the theme template and writes output to the site directory.

**Features:**
- Supports template overrides via page metadata
- Handles draft page markers for excluded content
- Applies plugin events at multiple stages
- Writes final HTML output with proper encoding

### Template Building Functions

#### `_build_theme_template(template_name, env, files, config, nav)`

Builds templates that are part of the active theme.

**Special Handling:**
- Automatically gzips `sitemap.xml` for better performance
- Skips templates that generate empty output
- Logs warnings for missing templates

#### `_build_extra_template(template_name, files, config, nav)`

Processes user-defined templates outside the theme structure.

## Important Classes and Types

### Template Context

The module uses `templates.TemplateContext` to pass data to Jinja2 templates:

```python
context = templates.TemplateContext(
    nav=nav,
    pages=files,
    base_url=base_url,
    extra_css=extra_css,
    extra_javascript=extra_javascript,
    mkdocs_version=mkdocs.__version__,
    build_date_utc=utils.get_build_datetime(),
    config=config,
    page=page,
)
```

## Plugin Integration

The build process integrates extensively with MkDocs plugins through event hooks:

- **`on_config`**: Modify configuration before build
- **`on_pre_build`**: Execute setup tasks
- **`on_files`**: Process file collection
- **`on_nav`**: Modify navigation structure  
- **`on_pre_page`**: Process pages before content reading
- **`on_page_markdown`**: Transform Markdown content
- **`on_page_content`**: Modify rendered HTML
- **`on_page_context`**: Alter template context
- **`on_post_page`**: Final page processing
- **`on_post_build`**: Cleanup and finalization
- **`on_build_error`**: Handle build failures

## Notes and Best Practices

### Performance Considerations

- **Dirty Builds**: Use `dirty=True` for development to skip unchanged files
- **Static Assets**: Files are copied with modification time checking
- **Template Caching**: Jinja2 environment caching improves rebuild performance

### Error Handling

- Comprehensive error catching with detailed logging
- Strict mode stops builds on warnings
- Plugin errors are properly propagated
- File encoding issues are handled gracefully

### Development vs Production

```python
# Development build with incremental updates
build(config, dirty=True)

# Production build with full regeneration  
build(config, dirty=False)
```

### Warning

The dirty build option should only be used during development as it may lead to:
- Inaccurate navigation links
- Stale cross-references
- Inconsistent site structure

## Utility Functions

### `site_directory_contains_stale_files(site_directory)`

Checks if the output directory contains files from previous builds, useful for cleanup warnings.

## Dependencies

- **Jinja2**: Template engine for HTML generation
- **Python gzip**: Compression for sitemap files
- **MkDocs utils**: File operations and URL handling
- **Plugin system**: Extensible build pipeline

This module forms the core of MkDocs' build system and is essential for converting documentation source into deployable websites.