<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# MkDocs Build Module Documentation

This module (`mkdocs/commands/build.py`) is the core build engine for MkDocs, responsible for transforming Markdown documentation into a complete static website. It orchestrates the entire build process, from reading source files to generating the final HTML output.

## Purpose

The module handles:
- Reading and processing Markdown files
- Rendering templates using Jinja2
- Managing static assets and theme files
- Building navigation structure
- Generating final HTML pages
- Plugin event management throughout the build process

## Main Functions

### `build(config, *, serve_url=None, dirty=False)`

The primary entry point that performs a complete site build.

**Parameters:**
- `config` (MkDocsConfig): The site configuration
- `serve_url` (str, optional): URL for serve mode
- `dirty` (bool): Whether to perform incremental build (only modified files)

**Process:**
1. Sets up logging and validation
2. Cleans or prepares output directory  
3. Gathers all files and builds navigation
4. Processes Markdown content
5. Copies static assets
6. Renders templates and pages
7. Validates links and anchors
8. Triggers plugin events at each stage

```python
# Example usage
build(config, dirty=False)
```

### `get_context(nav, files, config, page=None, base_url='')`

Creates the template context used for rendering pages and templates.

**Returns:** `TemplateContext` containing:
- Navigation structure
- File listings
- Configuration data
- CSS/JavaScript assets
- Build metadata
- Current page information

## Helper Functions

### `_populate_page(page, config, files, dirty=False)`

Reads page content from source files and renders Markdown to HTML.

**Key operations:**
- Reads source Markdown content
- Processes through plugin events (`pre_page`, `page_markdown`, `page_content`)
- Renders Markdown to HTML
- Handles error reporting

### `_build_page(page, config, doc_files, nav, env, dirty=False, excluded=False)`

Renders a page using the theme template and writes output to the site directory.

**Features:**
- Template selection (supports `template:` metadata override)
- Plugin event processing (`page_context`, `post_page`)
- Draft page marking for excluded content
- Incremental build support

### `_build_theme_template(template_name, env, files, config, nav)`

Builds templates that are part of the theme (e.g., `sitemap.xml`, `404.html`).

**Special handling:**
- Automatic gzip compression for `sitemap.xml`
- Template existence validation
- Empty output detection

### `_build_extra_template(template_name, files, config, nav)`

Processes user-defined templates located in the docs directory.

## Utility Functions

### `site_directory_contains_stale_files(site_directory)`

Checks if the output directory contains files from previous builds.

**Returns:** Boolean indicating presence of existing files

## Plugin Integration

The build process integrates extensively with MkDocs plugins through event hooks:

- `on_config` - Configuration processing
- `on_pre_build` - Pre-build setup
- `on_files` - File discovery and processing
- `on_nav` - Navigation structure
- `on_env` - Template environment
- `on_pre_page` - Before page processing
- `on_page_markdown` - Markdown content processing
- `on_page_content` - HTML content processing
- `on_page_context` - Template context
- `on_post_page` - After page rendering
- `on_post_build` - Build completion
- `on_build_error` - Error handling

## Important Notes

### Performance Considerations
- **Dirty builds** (`dirty=True`) only process modified files for faster development builds
- Static file copying respects modification times
- Template caching through Jinja2 environment

### Error Handling
- Comprehensive error reporting with file context
- Strict mode support with warning counting
- Graceful handling of missing templates and files

### File Processing Order
1. Static assets (lowest precedence)
2. Theme templates  
3. Extra user templates
4. Documentation pages (highest precedence)

This ordering ensures that user content can override theme defaults when necessary.

### Draft Content Support
- Pages excluded from production builds are marked with draft indicators in serve mode
- Exclusion rules respect `draft_docs` configuration

## Suggestions

- Use dirty builds during development for faster iteration
- Monitor build times and file counts for large documentation sites
- Leverage plugin events for custom processing needs
- Consider template inheritance for consistent theming across custom templates