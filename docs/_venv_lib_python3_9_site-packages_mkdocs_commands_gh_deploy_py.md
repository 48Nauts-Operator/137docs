<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# MkDocs GitHub Pages Deployment Module

## Overview

This module provides functionality for deploying MkDocs documentation sites to GitHub Pages. It handles the entire deployment process including Git repository validation, version checking, and automated pushing to the designated GitHub Pages branch.

## Purpose

The primary purpose of this module is to:
- Automate the deployment of MkDocs sites to GitHub Pages
- Validate Git repository status and configuration
- Check version compatibility between deployments
- Generate deployment URLs for both custom domains and default GitHub Pages URLs

## Key Functions

### `gh_deploy(config, message=None, force=False, no_history=False, ignore_version=False, shell=False)`

**Main deployment function** that orchestrates the entire GitHub Pages deployment process.

**Parameters:**
- `config`: MkDocs configuration object
- `message`: Custom commit message (optional)
- `force`: Force push to remote branch
- `no_history`: Deploy without preserving git history
- `ignore_version`: Skip version compatibility checks
- `shell`: Use shell for git operations

**Workflow:**
1. Validates current directory is a Git repository
2. Performs version compatibility checks
3. Generates deployment commit message
4. Copies site files to specified branch
5. Pushes to GitHub and provides deployment URL

### Git Repository Utilities

#### `_is_cwd_git_repo() -> bool`
- Checks if the current working directory is a Git repository
- Uses `git rev-parse --is-inside-work-tree` command
- Returns `True` if valid Git repo, `False` otherwise

#### `_get_current_sha(repo_path) -> str`
- Retrieves the short SHA hash of the current Git commit
- Used for generating deployment commit messages

#### `_get_remote_url(remote_name: str) -> tuple[str, str] | tuple[None, None]`
- Extracts GitHub repository information from Git remote URL
- Supports both HTTPS and SSH GitHub URLs
- Returns host and path components or `None` values if not a GitHub repo

### Version Management

#### `_check_version(branch: str) -> None`
- Compares current MkDocs version with the version used in previous deployment
- Prevents deployment with older MkDocs versions unless explicitly ignored
- Parses version information from previous commit messages

## Dependencies

- **ghp_import**: Third-party library for GitHub Pages deployment
- **packaging**: For version parsing and comparison
- **mkdocs**: Core MkDocs functionality
- **subprocess**: For Git command execution
- **re**: Regular expressions for version parsing

## Error Handling

The module includes comprehensive error handling for:

- **Git not found**: Raises `Abort` exception if Git is not installed
- **Non-Git repository**: Logs error and exits if not in a Git repo
- **Version conflicts**: Prevents deployment with older MkDocs versions
- **Deployment failures**: Catches `ghp_import.GhpError` and provides user-friendly messages

## URL Generation

After successful deployment, the module automatically determines and displays the deployment URL:

### Custom Domain (CNAME)
```python
# Checks for CNAME file in site directory
if os.path.isfile(cname_file):
    # Reads custom domain from CNAME file
    # Displays custom URL and DNS configuration reminder
```

### Default GitHub Pages URL
```python
# Extracts username and repository from Git remote
# Generates standard GitHub Pages URL format
url = f'https://{username}.github.io/{repo}/'
```

## Usage Notes

⚠️ **Important Considerations:**

- Ensure Git is installed and accessible in your PATH
- The current directory must be a Git repository
- Default deployment branch is typically `gh-pages`
- Version checking helps maintain consistency across deployments
- Custom domains require proper DNS configuration

## Configuration

The module relies on MkDocs configuration settings:
- `config.site_dir`: Directory containing built site files
- `config.remote_branch`: Target branch for deployment (usually `gh-pages`)
- `config.remote_name`: Git remote name (usually `origin`)
- `config.config_file_path`: Path to MkDocs configuration file

## Example Usage

```python
from mkdocs.commands.gh_deploy import gh_deploy

# Basic deployment
gh_deploy(config)

# Deployment with custom message and force push
gh_deploy(
    config, 
    message="Custom deployment message",
    force=True,
    ignore_version=True
)
```