<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# GitHub Pages Deployment Module

This Python module provides functionality for deploying MkDocs documentation sites to GitHub Pages. It handles the complete deployment process, including Git repository validation, version checking, and automated publishing to the specified GitHub Pages branch.

## Purpose

The module automates the deployment of MkDocs-generated static sites to GitHub Pages by:
- Validating the current directory as a Git repository
- Checking MkDocs version compatibility with previous deployments
- Using `ghp-import` to push the built site to the GitHub Pages branch
- Providing helpful feedback about the deployed site's URL

## Main Functions

### `gh_deploy(config, message=None, force=False, no_history=False, ignore_version=False, shell=False)`

The primary deployment function that orchestrates the entire GitHub Pages deployment process.

**Parameters:**
- `config`: MkDocs configuration object containing site settings
- `message`: Optional custom commit message (defaults to version and SHA info)
- `force`: Force push to remote branch
- `no_history`: Create a new commit without preserving history
- `ignore_version`: Skip version compatibility checks
- `shell`: Use shell for Git operations

**Example:**
```python
gh_deploy(config, message="Deploy documentation update")
```

## Utility Functions

### `_is_cwd_git_repo() -> bool`

Validates that the current working directory is inside a Git repository.

**Returns:** `True` if inside a Git repository, `False` otherwise

**Raises:** `Abort` exception if Git is not installed or accessible

### `_get_current_sha(repo_path) -> str`

Retrieves the short SHA hash of the current Git commit.

**Parameters:**
- `repo_path`: Path to the Git repository

**Returns:** Short SHA string of the current HEAD commit

### `_get_remote_url(remote_name: str) -> tuple[str, str] | tuple[None, None]`

Extracts GitHub repository information from the Git remote URL.

**Parameters:**
- `remote_name`: Name of the Git remote (typically 'origin')

**Returns:** Tuple of `(host, path)` for GitHub URLs, or `(None, None)` for non-GitHub remotes

### `_check_version(branch: str) -> None`

Compares the current MkDocs version with the version used in the previous deployment.

**Parameters:**
- `branch`: Git branch to check for previous deployment version

**Behavior:**
- ⚠️ **Warning**: If no previous version is found
- ✅ **Info**: If deploying with a newer version
- ❌ **Error**: If attempting to deploy with an older version (raises `Abort`)

## Key Features

### Version Safety
The module includes built-in version checking to prevent accidental deployments with older MkDocs versions, which could potentially break existing functionality.

### Automatic URL Detection
After successful deployment, the module automatically determines and displays the correct GitHub Pages URL by:
1. Checking for a `CNAME` file (custom domain)
2. Parsing the Git remote URL to construct the default GitHub Pages URL
3. Handling GitHub Enterprise deployments

### Error Handling
Comprehensive error handling for common deployment issues:
- Missing Git installation
- Invalid Git repositories
- Version conflicts
- GitHub deployment failures

## Dependencies

- `ghp-import`: Handles the actual Git operations for GitHub Pages deployment
- `packaging`: Used for version comparison logic
- `mkdocs`: Core MkDocs functionality and version information

## Usage Notes

### Prerequisites
- Git must be installed and accessible in the system PATH
- The current directory must be a Git repository
- The repository should have a configured remote (typically 'origin')

### Configuration
The function relies on MkDocs configuration settings:
- `site_dir`: Directory containing the built documentation
- `remote_branch`: Target branch for deployment (usually 'gh-pages')
- `remote_name`: Git remote name (usually 'origin')

### Custom Domains
If a `CNAME` file exists in the site directory, the module will detect it and provide appropriate DNS configuration guidance.

## Example Integration

```python
from mkdocs.commands.gh_deploy import gh_deploy
from mkdocs.config import load_config

# Load MkDocs configuration
config = load_config()

# Deploy with custom message
gh_deploy(
    config=config,
    message="Deploy documentation v2.1.0",
    force=False,
    ignore_version=False
)
```

## Security Considerations

- The module executes Git commands using `subprocess`, which could be a security consideration in untrusted environments
- Version checking helps prevent accidental downgrades that might introduce vulnerabilities
- Force pushing should be used cautiously as it can overwrite remote history