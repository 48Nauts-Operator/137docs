<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# MkDocs Development Server Module

## Overview

This module provides the core functionality for running the MkDocs development server. It enables live development of MkDocs documentation sites with automatic rebuilding and browser refresh capabilities when source files are modified.

## Purpose

The primary purpose of this module is to:
- Start a local development server for MkDocs documentation
- Provide live reload functionality for real-time preview of changes
- Handle automatic rebuilding when documentation files are modified
- Serve documentation from a temporary build directory
- Support custom error page handling (404, 500 errors)

## Main Function

### `serve()`

The main entry point for starting the MkDocs development server.

```python
def serve(
    config_file: str | None = None,
    livereload: bool = True,
    build_type: str | None = None,
    watch_theme: bool = False,
    watch: list[str] = [],
    *,
    open_in_browser: bool = False,
    **kwargs,
) -> None:
```

#### Parameters

- **`config_file`**: Path to the MkDocs configuration file (optional)
- **`livereload`**: Enable/disable live reload functionality (default: `True`)
- **`build_type`**: Type of build to perform (`'clean'` or `'dirty'`)
- **`watch_theme`**: Whether to watch theme files for changes (default: `False`)
- **`watch`**: List of additional paths to watch for changes
- **`open_in_browser`**: Automatically open the documentation in browser (default: `False`)
- **`**kwargs`**: Additional configuration options

#### Key Features

- **Temporary Build Directory**: Creates a temporary directory with `mkdocs_` prefix for serving files
- **Live Reload**: Automatically refreshes the browser when files change
- **Multi-path Watching**: Monitors documentation files, config files, and optionally theme files
- **Error Handling**: Serves custom 404 and 500 error pages when available
- **Plugin Integration**: Supports MkDocs plugin lifecycle events

## Internal Components

### Configuration Management

```python
def get_config():
    config = load_config(
        config_file=config_file,
        site_dir=site_dir,
        **kwargs,
    )
    config.watch.extend(watch)
    return config
```

- Loads MkDocs configuration
- Sets up temporary site directory
- Extends watch list with additional paths

### Builder Function

```python
def builder(config: MkDocsConfig | None = None):
    log.info("Building documentation...")
    if config is None:
        config = get_config()
        config.site_url = serve_url
    build(config, serve_url=None if is_clean else serve_url, dirty=is_dirty)
```

- Handles the documentation building process
- Supports both clean and dirty builds
- Configures appropriate serve URL

### Error Handler

```python
def error_handler(code) -> bytes | None:
    if code in (404, 500):
        error_page = join(site_dir, f'{code}.html')
        if isfile(error_page):
            with open(error_page, 'rb') as f:
                return f.read()
    return None
```

- Serves custom error pages for 404 and 500 errors
- Falls back to default handling if custom pages don't exist

## Workflow

1. **Setup**: Creates temporary build directory and loads configuration
2. **Initial Build**: Performs first documentation build
3. **Server Setup**: Configures LiveReloadServer with appropriate settings
4. **File Watching**: Sets up file watchers for documentation, config, and theme files
5. **Plugin Events**: Triggers plugin lifecycle events
6. **Serving**: Starts the development server
7. **Cleanup**: Removes temporary directory and shuts down plugins on exit

## Dependencies

- `mkdocs.commands.build`: For building documentation
- `mkdocs.config`: For configuration loading
- `mkdocs.livereload`: For live reload server functionality
- Standard library modules for file operations and URL parsing

## Usage Notes

### Development Workflow
- Default server runs on `http://localhost:8000/`
- Automatically rebuilds on file changes when `livereload=True`
- Gracefully handles `KeyboardInterrupt` (Ctrl+C) for shutdown

### Build Types
- **Clean Build**: `build_type='clean'` - Full rebuild without serve URL optimization
- **Dirty Build**: `build_type='dirty'` - Incremental build for faster development

### File Watching
- Always watches documentation directory (`docs_dir`)
- Optionally watches theme directories when `watch_theme=True`
- Supports additional custom watch paths via `watch` parameter

## Best Practices

- Use clean builds for production-like testing
- Enable theme watching during theme development
- Add custom paths to watch list for non-standard documentation structures
- Leverage plugin system for custom development server behavior

## Cleanup and Resource Management

The module ensures proper cleanup by:
- Removing temporary build directories on exit
- Shutting down the live reload server
- Triggering plugin shutdown events
- Handling both normal exit and interrupt signals