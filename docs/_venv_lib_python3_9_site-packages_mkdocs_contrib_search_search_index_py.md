<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Search Index Module Documentation

## Overview

This module provides functionality for building and managing search indexes for MkDocs documentation sites. It parses HTML content, extracts searchable text and sections, and can generate pre-built search indexes using either Node.js or Python's Lunr library.

## Purpose

The module enables full-text search capabilities in documentation by:
- Parsing HTML pages to extract content and sections
- Creating searchable entries for pages and their headings
- Generating JSON search indexes
- Supporting pre-built indexes for improved performance

## Classes

### SearchIndex

The main class responsible for building and managing search indexes.

#### Constructor
```python
def __init__(self, **config) -> None
```
- **Parameters**: `config` - Configuration dictionary containing indexing options
- **Purpose**: Initializes the search index with configuration settings

#### Key Methods

##### `add_entry_from_context(page: Page) -> None`
Processes a complete page and adds it to the search index.
- Parses the page's HTML content
- Creates an entry for the full page
- Extracts and indexes individual sections based on heading tags

##### `create_entry_for_section(section: ContentSection, toc: TableOfContents, abs_url: str) -> None`
Creates search index entries for individual page sections.
- Links sections to table of contents items
- Generates proper URLs for section anchors

##### `generate_search_index() -> str`
Generates the final JSON search index.
- Converts collected entries to JSON format
- Optionally creates pre-built indexes using Node.js or Python Lunr
- Returns serialized JSON data ready for client-side search

#### Private Methods

##### `_find_toc_by_id(toc, id_: str | None) -> AnchorLink | None`
Recursively searches through table of contents to find items by HTML ID.

##### `_add_entry(title: str | None, text: str, loc: str) -> None`
Adds a cleaned entry to the search index, removing unwanted characters and normalizing whitespace.

### ContentSection

A data class representing a section of content within a page.

```python
def __init__(self, text: list[str] | None = None, id_: str | None = None, title: str | None = None)
```

**Attributes:**
- `text`: List of text content in the section
- `id`: HTML ID of the section (from heading tag)
- `title`: Title of the section (heading text)

### ContentParser

An HTML parser that extracts structured content from HTML pages.

**Inherits from**: `HTMLParser`

#### Key Methods

##### `handle_starttag(tag: str, attrs: list[tuple[str, str | None]]) -> None`
Processes HTML opening tags, specifically targeting heading tags (h1-h6).

##### `handle_endtag(tag: str) -> None`
Processes HTML closing tags for headings.

##### `handle_data(data: str) -> None`
Extracts text content from HTML elements.

#### Properties

##### `stripped_html -> str`
Returns the complete text content with HTML tags removed.

## Configuration Options

The module supports several indexing modes through the `config` parameter:

- **`indexing`**: 
  - `'full'` - Index complete page content and sections
  - `'sections'` - Index only section headings
  - Other values - Index only page titles

- **`prebuild_index`**:
  - `True` or `'node'` - Use Node.js to pre-build index
  - `'python'` - Use Python Lunr library to pre-build index
  - `False` - Generate index on client-side

## Dependencies

### Required
- `json` (standard library)
- `logging` (standard library)
- `os` (standard library)
- `re` (standard library)
- `subprocess` (standard library)
- `html.parser.HTMLParser` (standard library)

### Optional
- `lunr` - Required for Python-based pre-built indexes
- Node.js - Required for Node.js-based pre-built indexes

## Usage Notes

### Pre-built Index Requirements

- **Node.js method**: Requires Node.js to be installed and a `prebuild-index.js` script in the same directory
- **Python method**: Requires the `lunr` package (`pip install lunr`)
- For non-English languages with Python method: Install `lunr[languages]`

### Content Processing

- Automatically normalizes whitespace and removes non-breaking spaces
- Only processes heading tags (h1 through h6) as section boundaries
- Ignores content before the first heading tag for section indexing

### Error Handling

The module includes robust error handling:
- Graceful fallback when pre-build methods fail
- Detailed logging for debugging
- Continues operation even if optional dependencies are missing

## Constants

```python
_HEADER_TAGS = tuple(f"h{x}" for x in range(1, 7))  # ('h1', 'h2', 'h3', 'h4', 'h5', 'h6')
```

Defines the HTML heading tags that are recognized as section boundaries.