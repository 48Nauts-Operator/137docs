<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Search Index Module Documentation

## Overview

This module implements a search indexing system for MkDocs documentation. It parses HTML content from documentation pages, extracts searchable text, and generates a search index that can be used for client-side search functionality.

## Purpose

The module serves to:
- Parse HTML content from documentation pages
- Extract text content from sections defined by heading tags
- Create searchable entries for full pages and individual sections
- Generate JSON search indexes with optional pre-building using Node.js or Python's Lunr library
- Support multiple indexing strategies (full content, sections only, or titles only)

## Classes

### `SearchIndex`

The main class responsible for managing the search index creation process.

#### Constructor
```python
def __init__(self, **config) -> None
```
- **Parameters**: `config` - Configuration dictionary containing indexing options
- **Attributes**:
  - `_entries`: List of search index entries
  - `config`: Configuration settings

#### Key Methods

##### `add_entry_from_context(page: Page) -> None`
Creates search index entries for a given page and its sections.
- Parses the page's HTML content
- Creates one entry for the full page
- Creates additional entries for each heading section (if configured)

##### `create_entry_for_section(section: ContentSection, toc: TableOfContents, abs_url: str) -> None`
Creates a search index entry for a specific section within a page.
- Links sections to table of contents items
- Generates appropriate URLs for sections

##### `generate_search_index() -> str`
Generates the final search index as a JSON string.
- Supports multiple pre-building options:
  - **Node.js**: Uses external JavaScript script
  - **Python**: Uses lunr.py library (requires separate installation)
  - **None**: Returns raw JSON without pre-built index

#### Private Methods

- `_find_toc_by_id()`: Recursively searches table of contents for matching ID
- `_add_entry()`: Sanitizes and adds entries to the index

### `ContentSection`

A data class representing a section of content within a page.

```python
def __init__(self, text: list[str] = None, id_: str = None, title: str = None)
```

**Attributes**:
- `text`: List of text content within the section
- `id`: HTML ID attribute of the section
- `title`: Section title (usually from heading tag)

### `ContentParser`

HTML parser that extracts structured content from HTML pages.

Inherits from `html.parser.HTMLParser` and implements:

#### Key Methods

##### `handle_starttag(tag: str, attrs: list[tuple[str, str | None]]) -> None`
- Processes HTML opening tags
- Creates new sections when encountering heading tags (h1-h6)
- Extracts ID attributes from heading tags

##### `handle_endtag(tag: str) -> None`
- Processes HTML closing tags
- Manages state transitions for heading tags

##### `handle_data(data: str) -> None`
- Processes text content within HTML tags
- Assigns text as section titles or content based on context

#### Properties

##### `stripped_html`
Returns the complete text content with HTML tags removed.

## Configuration Options

The module supports several configuration options:

- **`indexing`**: Controls what content to index
  - `'full'`: Index complete page content and sections
  - `'sections'`: Index section titles and content
  - `'titles'`: Index only titles
  
- **`prebuild_index`**: Pre-build search index for better performance
  - `True` or `'node'`: Use Node.js for pre-building
  - `'python'`: Use Python's lunr library
  - `False`: No pre-building

- **`lang`**: Language configuration for lunr.py indexing

## Dependencies

### Required
- `json`: JSON serialization
- `logging`: Logging functionality
- `os`: Operating system interface
- `re`: Regular expressions
- `subprocess`: Process management
- `html.parser.HTMLParser`: HTML parsing

### Optional
- `lunr`: Python Lunr library for search indexing (install with `pip install lunr`)
- Node.js: Required for JavaScript-based pre-building

## Usage Notes

### Performance Considerations
- Pre-building the search index significantly improves client-side search performance
- The Node.js method generally provides better performance than Python lunr
- Full content indexing increases index size but improves search accuracy

### Error Handling
- The module gracefully handles missing dependencies
- Failed pre-building operations fall back to basic JSON output
- Warnings are logged for configuration issues

### Text Processing
- Non-breaking spaces (`\u00a0`) are converted to regular spaces
- Multiple whitespace characters are collapsed to single spaces
- Content before the first heading is ignored (included only in page-level entry)

## Example Usage

```python
# Initialize search index with configuration
search_index = SearchIndex(
    indexing='full',
    prebuild_index='node',
    lang=['en']
)

# Add a page to the index
search_index.add_entry_from_context(page)

# Generate the final search index
json_index = search_index.generate_search_index()
```