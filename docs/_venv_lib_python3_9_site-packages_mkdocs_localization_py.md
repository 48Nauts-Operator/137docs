<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# MkDocs Internationalization Module

## Overview

This module provides internationalization (i18n) support for MkDocs themes by integrating with Jinja2 templating and the Babel library. It handles locale parsing, translation loading, and provides fallback functionality when Babel is not available.

## Purpose

- **Locale Management**: Parse and validate locale strings for internationalization
- **Translation Loading**: Load and merge translation files from multiple theme directories
- **Jinja2 Integration**: Set up Jinja2 environment with appropriate i18n extensions
- **Graceful Degradation**: Provide fallback functionality when Babel is not installed

## Dependencies

### Required
- `jinja2` - Template engine with i18n extension support
- `mkdocs` - Core MkDocs functionality for configuration and utilities

### Optional
- `babel` - Full internationalization support (gracefully handles absence)

## Classes

### `NoBabelExtension`

```python
class NoBabelExtension(InternationalizationExtension)
```

A fallback Jinja2 extension that provides basic i18n block support when Babel is not available.

**Features:**
- Extends Jinja2's `InternationalizationExtension`
- Installs null translations (no actual translation occurs)
- Enables `trans`/`endtrans` template blocks without errors

## Functions

### `parse_locale(locale: str) -> Locale`

Parses a locale string into a `Locale` object with proper error handling.

**Parameters:**
- `locale`: String representation of locale (e.g., "en_US", "fr", "de_DE")

**Returns:**
- `Locale` object representing the parsed locale

**Raises:**
- `ValidationError`: When locale string is invalid or malformed

**Example:**
```python
locale = parse_locale("en_US")  # Returns Locale object
locale = parse_locale("invalid")  # Raises ValidationError
```

### `install_translations(env, locale, theme_dirs)`

Sets up internationalization support in a Jinja2 environment.

**Parameters:**
- `env`: Jinja2 environment to configure
- `locale`: Target locale for translations
- `theme_dirs`: Sequence of theme directories to search for translations

**Behavior:**
- **With Babel**: Loads actual translations and installs gettext support
- **Without Babel**: Installs null translations with dummy i18n support
- **Warnings**: Logs warning if no translations found for non-English locales

### `_get_merged_translations(theme_dirs, locales_dir, locale)`

Internal function that loads and merges translation files from multiple directories.

**Parameters:**
- `theme_dirs`: Directories to search (processed in reverse order)
- `locales_dir`: Subdirectory name containing locale files (typically "locales")
- `locale`: Target locale object

**Returns:**
- `Translations` object with merged translations, or `None` if no translations found

**Features:**
- **Directory Precedence**: Later directories in the list take precedence
- **Locale Fallback**: Handles both full locales (`en_US`) and language-only (`en`)
- **Debug Logging**: Provides detailed logging of translation discovery

## Configuration Notes

### Locale Directory Structure

The module expects translations to be organized as:
```
theme_dir/
└── locales/
    ├── en/
    │   └── LC_MESSAGES/
    ├── fr/
    │   └── LC_MESSAGES/
    └── de_DE/
        └── LC_MESSAGES/
```

### Installation Recommendations

- **Full i18n support**: Install with `pip install babel`
- **Basic support**: Module works without Babel but with limited functionality
- **Theme developers**: Include translation files in the `locales/` subdirectory

## Error Handling

- **Graceful Babel fallback**: Continues operation when Babel is unavailable
- **Locale validation**: Provides clear error messages for invalid locales
- **Missing translations**: Warns users but continues with English defaults

## Logging

The module uses Python's logging system with logger name matching the module. Enable debug logging to see detailed translation discovery information:

```python
logging.getLogger('mkdocs.commands.build').setLevel(logging.DEBUG)
```