<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# MkDocs Internationalization Module

## Overview

This module provides internationalization (i18n) support for MkDocs, enabling the rendering of multilingual documentation. It handles locale parsing, translation loading, and Jinja2 template environment configuration for different languages.

## Purpose

The primary purpose of this module is to:
- Parse and validate locale strings
- Load translation files from theme directories
- Configure Jinja2 templates with appropriate translation support
- Provide fallback functionality when Babel is not available

## Dependencies

### Required
- `jinja2` - Template engine with internationalization extensions
- `mkdocs.config.base` - For validation error handling

### Optional
- `babel` - Provides advanced locale handling and translation support
- If Babel is not installed, the module falls back to stub implementations

## Classes

### `NoBabelExtension`

```python
class NoBabelExtension(InternationalizationExtension)
```

A fallback Jinja2 extension that provides basic internationalization support when Babel is not available.

**Features:**
- Inherits from Jinja2's `InternationalizationExtension`
- Installs null translations (no actual translation occurs)
- Enables `trans`/`endtrans` template blocks without throwing errors

## Functions

### `parse_locale(locale: str) -> Locale`

Parses a locale string into a Babel `Locale` object.

**Parameters:**
- `locale` (str): Locale string (e.g., "en_US", "fr_FR")

**Returns:**
- `Locale`: Parsed locale object

**Raises:**
- `ValidationError`: If the locale string is invalid

**Example:**
```python
locale = parse_locale("en_US")  # Returns Locale object for US English
```

### `install_translations(env, locale, theme_dirs)`

Configures a Jinja2 environment with internationalization support.

**Parameters:**
- `env` (jinja2.Environment): Jinja2 template environment
- `locale` (Locale): Target locale for translations
- `theme_dirs` (Sequence[str]): List of theme directories to search for translations

**Behavior:**
- If Babel is available: Loads and merges translations from theme directories
- If Babel is unavailable: Installs fallback extension with null translations
- Logs warnings when translations aren't found for non-English locales

### `_get_merged_translations(theme_dirs, locales_dir, locale)`

**Internal function** that searches for and merges translation files across multiple theme directories.

**Parameters:**
- `theme_dirs` (Sequence[str]): Theme directories to search
- `locales_dir` (str): Subdirectory name containing translations (typically "locales")
- `locale` (Locale): Target locale

**Returns:**
- `Translations | None`: Merged translations object or None if no translations found

**Process:**
1. Searches each theme directory in reverse order
2. Loads translations for the specified locale
3. Merges multiple translation sources
4. Handles both language-only and language_territory locale formats

## Usage Example

```python
from jinja2 import Environment
from mkdocs.localization import parse_locale, install_translations

# Parse locale
locale = parse_locale("fr_FR")

# Configure Jinja2 environment
env = Environment()
theme_directories = ["/path/to/theme1", "/path/to/theme2"]
install_translations(env, locale, theme_directories)
```

## File Structure Assumptions

The module expects translation files to be organized as follows:
```
theme_directory/
└── locales/
    ├── en/
    │   └── LC_MESSAGES/
    ├── fr/
    │   └── LC_MESSAGES/
    └── es_ES/
        └── LC_MESSAGES/
```

## Notes and Recommendations

### Important Considerations
- **Graceful Degradation**: The module handles missing Babel dependency gracefully
- **Translation Merging**: Multiple theme directories are supported with proper translation merging
- **Locale Validation**: Input validation prevents runtime errors from malformed locale strings

### Performance Notes
- Translation loading occurs during environment setup, not per-request
- Theme directories are processed in reverse order for proper precedence

### Debugging
- Enable debug logging to track translation file discovery
- The module provides detailed logging for troubleshooting translation issues

```python
import logging
logging.getLogger('mkdocs.localization').setLevel(logging.DEBUG)
```

### Best Practices
1. Install Babel for full internationalization support
2. Organize translation files following Babel conventions
3. Test locale strings before deployment
4. Monitor logs for translation loading warnings