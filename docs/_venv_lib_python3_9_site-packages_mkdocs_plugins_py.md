<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# MkDocs Plugin API Documentation

This module implements the plugin system for MkDocs, providing the core infrastructure for creating and managing plugins that extend MkDocs functionality.

## Purpose

The plugin API allows developers to:
- Create custom plugins that hook into various stages of the MkDocs build process
- Modify configuration, content, templates, and output during builds
- Extend MkDocs with additional functionality through a well-defined event system

## Key Functions

### `get_plugins()`

```python
def get_plugins() -> dict[str, EntryPoint]:
```

Returns a dictionary of all installed MkDocs plugins discovered through entry points.

- **Returns**: Dictionary mapping plugin names to their entry points
- **Note**: Third-party plugins can override core plugins, except those prefixed with `mkdocs.contrib.`

### `event_priority(priority: float)`

```python
def event_priority(priority: float) -> Callable[[T], T]:
```

A decorator to set execution priority for event handler methods.

- **Parameters**: 
  - `priority`: Float value determining execution order
- **Recommended values**:
  - `100`: "first"
  - `50`: "early" 
  - `0`: "default"
  - `-50`: "late"
  - `-100`: "last"

**Usage Example:**
```python
@event_priority(-100)
def on_files(self, files, config, **kwargs):
    # This runs after other plugins' on_files events
    pass
```

### `get_plugin_logger(name: str)`

```python
def get_plugin_logger(name: str) -> PrefixedLogger:
```

Creates a logger specifically for plugins with automatic message prefixing.

- **Parameters**: `name` - Plugin name for the logger
- **Returns**: Configured logger that prefixes messages with plugin name

**Usage Example:**
```python
from mkdocs.plugins import get_plugin_logger

log = get_plugin_logger(__name__)
log.info("My plugin message")  # Output: "plugin_name: My plugin message"
```

## Key Classes

### `BasePlugin[SomeConfig]`

The base class that all MkDocs plugins must inherit from. It provides a generic type parameter for configuration.

#### Key Attributes

- `config_class`: Type of configuration class (defaults to `LegacyConfig`)
- `config_scheme`: Configuration schema tuple
- `config`: Plugin configuration instance
- `supports_multiple_instances`: Boolean flag for multi-instance support

#### Important Methods

##### `load_config(options, config_file_path=None)`

Loads and validates plugin configuration from options dictionary.

- **Returns**: Tuple of `(errors, warnings)`

#### Event Methods

The plugin provides numerous event hooks organized into categories:

##### One-time Events
- `on_startup()`: Called once at MkDocs invocation start
- `on_shutdown()`: Called once before MkDocs exits  
- `on_serve()`: Called only during `mkdocs serve` command

##### Global Events
- `on_config()`: Modify global configuration
- `on_pre_build()`: Execute pre-build scripts
- `on_files()`: Modify the files collection
- `on_nav()`: Modify site navigation
- `on_env()`: Modify Jinja2 environment
- `on_post_build()`: Execute post-build scripts
- `on_build_error()`: Handle build errors

##### Template Events  
- `on_pre_template()`: Modify templates before rendering
- `on_template_context()`: Modify template context
- `on_post_template()`: Modify rendered template output

##### Page Events
- `on_pre_page()`: Modify page before processing
- `on_page_read_source()`: ⚠️ **Deprecated** - Custom page source reading
- `on_page_markdown()`: Modify page Markdown content
- `on_page_content()`: Modify rendered HTML content
- `on_page_context()`: Modify page template context
- `on_post_page()`: Modify final page output

### `PluginCollection`

A specialized dictionary that manages plugin instances and their event handlers.

#### Key Features

- Automatically registers event methods when plugins are added
- Manages event execution order based on priorities
- Provides logging and debugging for event execution
- Implements all event methods to coordinate plugin execution

#### Important Methods

##### `run_event(name, item=None, **kwargs)`

Executes all registered handlers for a specific event.

- **Parameters**:
  - `name`: Event name
  - `item`: Object to be modified (optional)
  - `**kwargs`: Context variables
- **Returns**: Modified item or result from event handlers

### `CombinedEvent[P, T]`

A descriptor for defining multiple event handlers under a single event name.

**Usage Example:**
```python
@event_priority(100)
def _on_page_markdown_1(self, markdown: str, **kwargs):
    # High priority handler
    return markdown

@event_priority(-50)  
def _on_page_markdown_2(self, markdown: str, **kwargs):
    # Low priority handler
    return markdown

# Combine both handlers under one event
on_page_markdown = CombinedEvent(_on_page_markdown_1, _on_page_markdown_2)
```

### `PrefixedLogger`

A logging adapter that automatically prefixes log messages with the plugin name.

## Usage Notes

### Creating a Plugin

```python
from mkdocs.plugins import BasePlugin
from mkdocs.config import config_options

class MyPluginConfig(Config):
    option1 = config_options.Type(str, default='default_value')

class MyPlugin(BasePlugin[MyPluginConfig]):
    def on_config(self, config):
        # Modify configuration
        return config
    
    def on_page_markdown(self, markdown, **kwargs):
        # Process markdown content
        return markdown
```

### Plugin Discovery

Plugins must be registered as entry points in `setup.py` or `pyproject.toml`:

```python
# setup.py
entry_points={
    'mkdocs.plugins': [
        'myplugin = mypackage.plugin:MyPlugin',
    ]
}
```

## Important Considerations

- **Event Order