<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# MkDocs Plugin API Documentation

## Overview

This file implements the plugin API for MkDocs, providing the foundation for creating and managing plugins in MkDocs static site generator. It defines the plugin system architecture, event handling mechanisms, and base classes that all MkDocs plugins should inherit from.

## Purpose

The plugin API enables developers to:
- Extend MkDocs functionality through custom plugins
- Hook into various stages of the documentation build process
- Modify content, configuration, and output at different lifecycle events
- Manage plugin discovery, loading, and execution

## Key Components

### Functions

#### `get_plugins()`
```python
def get_plugins() -> dict[str, EntryPoint]:
```
- **Purpose**: Discovers and returns all installed MkDocs plugins
- **Returns**: Dictionary mapping plugin names to their entry points
- **Note**: Third-party plugins can override core plugins, except those prefixed with `mkdocs.contrib.`

#### `get_plugin_logger(name: str)`
```python
def get_plugin_logger(name: str) -> PrefixedLogger:
```
- **Purpose**: Creates a logger specifically for plugins with automatic prefixing
- **Usage**: 
  ```python
  log = get_plugin_logger(__name__)
  log.info("My plugin message")
  ```

#### `event_priority(priority: float)`
```python
def event_priority(priority: float) -> Callable[[T], T]:
```
- **Purpose**: Decorator to set execution priority for event handlers
- **Priority Values**:
  - `100`: "first"
  - `50`: "early" 
  - `0`: "default"
  - `-50`: "late"
  - `-100`: "last"
- **Example**:
  ```python
  @event_priority(-100)
  def on_files(self, files, config, **kwargs):
      # Runs after other plugins
      pass
  ```

### Core Classes

#### `BasePlugin[SomeConfig]`

The base class that all MkDocs plugins must inherit from.

**Key Attributes:**
- `config_class`: Type of configuration class to use
- `config_scheme`: Configuration schema (for legacy support)
- `config`: Plugin configuration instance
- `supports_multiple_instances`: Boolean indicating if plugin can be used multiple times

**Important Methods:**
- `load_config()`: Loads and validates plugin configuration
- `__class_getitem__()`: Enables generic syntax like `BasePlugin[MyConfig]`

**Event Handler Methods:**

##### One-time Events
- `on_startup()`: Called once at MkDocs invocation start *(New in 1.4)*
- `on_shutdown()`: Called once before MkDocs exits *(New in 1.4)*
- `on_serve()`: Called only during `mkdocs serve` command

##### Global Events
- `on_config()`: First event called, for modifying global configuration
- `on_pre_build()`: Called before build starts
- `on_files()`: Called after files collection is populated
- `on_nav()`: Called after site navigation is created
- `on_env()`: Called after Jinja environment is created
- `on_post_build()`: Called after build completes
- `on_build_error()`: Called when build errors occur

##### Template Events
- `on_pre_template()`: Called before template rendering
- `on_template_context()`: Called after template context creation
- `on_post_template()`: Called after template rendering

##### Page Events
- `on_pre_page()`: Called before page processing
- `on_page_read_source()`: Can replace default file reading *(Deprecated)*
- `on_page_markdown()`: Called after markdown is loaded
- `on_page_content()`: Called after markdown is rendered to HTML
- `on_page_context()`: Called after page context creation
- `on_post_page()`: Called after page template rendering

#### `CombinedEvent[P, T]`

A descriptor for combining multiple event handlers under one event name.

**Usage Example:**
```python
@event_priority(100)
def _on_page_markdown_1(self, markdown: str, **kwargs):
    # High priority handler
    pass

@event_priority(-50)  
def _on_page_markdown_2(self, markdown: str, **kwargs):
    # Low priority handler
    pass

on_page_markdown = CombinedEvent(_on_page_markdown_1, _on_page_markdown_2)
```

#### `PluginCollection`

Manages the collection of loaded plugins and orchestrates event execution.

**Key Features:**
- Extends `dict` to store plugin instances
- Automatically registers event methods when plugins are added
- Executes events in priority order
- Provides logging and error handling during event execution

**Important Methods:**
- `run_event()`: Executes all registered handlers for a specific event
- Event-specific methods (e.g., `on_config()`, `on_files()`, etc.)

#### `PrefixedLogger`

A logging adapter that automatically prefixes log messages with the plugin name.

## Usage Guidelines

### Creating a Plugin

```python
from mkdocs.plugins import BasePlugin
from mkdocs.config import config_options

class MyPluginConfig(Config):
    option1 = config_options.Type(str, default='default_value')

class MyPlugin(BasePlugin[MyPluginConfig]):
    def on_config(self, config):
        # Modify global config
        return config
    
    def on_page_markdown(self, markdown, page, config, files):
        # Process markdown content
        return markdown
```

### Event Handler Best Practices

- **Return Values**: Most event handlers should return the modified object or `None` to keep unchanged
- **Error Handling**: Use try-catch blocks in event handlers to prevent breaking the build
- **Logging**: Use `get_plugin_logger(__name__)` for consistent logging
- **Priority**: Use `@event_priority()` decorator when execution order matters

## Important Notes

### Migration to New System (MkDocs 1.4+)

- Plugins with `on_startup()` or `on_shutdown()` methods migrate to the new system
- Plugin objects persist across builds in `mkdocs serve`
- Use `on_config()` for per-build variable initialization