<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Table of Contents Generator Module

## Overview

This module handles the generation of per-page table of contents (TOC) for MkDocs documentation. It processes TOC tokens generated by Python-Markdown's `toc` extension and converts them into a structured format that maintains compatibility with older versions of MkDocs.

## Purpose

- Parse table of contents data from Python-Markdown
- Create a hierarchical structure of navigation links
- Maintain backward compatibility with legacy MkDocs versions
- Provide easy access to TOC items with proper formatting and linking

## Classes

### `AnchorLink`

Represents a single entry in the table of contents.

#### Attributes

- **`title: str`** - The text of the item, stored as HTML
- **`id: str`** - The unique identifier for the anchor
- **`level: int`** - The zero-based hierarchical level of the item
- **`children: list[AnchorLink]`** - List of child items for nested TOC structures

#### Properties

- **`url: str`** - Returns the hash fragment URL pointing to the item (e.g., `#section-name`)

#### Methods

- **`__init__(title: str, id: str, level: int)`** - Initialize a new anchor link
- **`indent_print(depth: int = 0) -> str`** - Generate indented string representation for debugging
- **`__str__() -> str`** - String representation using `indent_print()`

#### Example Usage

```python
# Create an anchor link
link = AnchorLink("Introduction", "intro", 0)
print(link.url)  # Output: #intro
print(link.title)  # Output: Introduction
```

### `TableOfContents`

Container class that represents the complete table of contents for a page.

#### Features

- Implements `Iterable[AnchorLink]` for easy iteration
- Supports `len()` operations
- Provides string representation of the entire TOC

#### Methods

- **`__init__(items: list[AnchorLink])`** - Initialize with a list of anchor links
- **`__iter__() -> Iterator[AnchorLink]`** - Enable iteration over TOC items
- **`__len__() -> int`** - Return the number of top-level TOC items
- **`__str__() -> str`** - Generate string representation of entire TOC

#### Example Usage

```python
# Create a table of contents
toc_items = [AnchorLink("Chapter 1", "ch1", 0), AnchorLink("Chapter 2", "ch2", 0)]
toc = TableOfContents(toc_items)

# Iterate through items
for item in toc:
    print(f"{item.title}: {item.url}")
```

## Functions

### `get_toc(toc_tokens: list[_TocToken]) -> TableOfContents`

Main entry point for generating a table of contents from parsed tokens.

#### Parameters
- **`toc_tokens`** - List of token dictionaries from Python-Markdown's TOC extension

#### Returns
- **`TableOfContents`** - Complete TOC structure with the first item marked as active

#### Behavior
- Converts raw TOC tokens into `AnchorLink` objects
- Automatically marks the first TOC item as active
- Handles nested hierarchical structures

## Internal Components

### `_TocToken` (TypedDict)

Internal type definition for TOC tokens with the following structure:

```python
{
    'level': int,      # Heading level (1-6)
    'id': str,         # Anchor ID
    'name': str,       # Display text
    'children': list   # Nested tokens
}
```

### `_parse_toc_token(token: _TocToken) -> AnchorLink`

Private function that recursively converts TOC tokens into `AnchorLink` objects.

## Usage Notes

### ⚠️ Important Considerations

- **Compatibility**: This module maintains backward compatibility with older MkDocs versions
- **Dependencies**: Relies on Python-Markdown's `toc` extension for initial token generation
- **Active State**: The first TOC item is automatically marked as active

### 💡 Best Practices

- Use the `get_toc()` function as the primary interface
- The module handles nested TOC structures automatically
- String representations are available for debugging purposes

### 🔧 Integration Example

```python
# Typical usage in MkDocs context
markdown_toc_tokens = [
    {'level': 1, 'id': 'overview', 'name': 'Overview', 'children': []},
    {'level': 2, 'id': 'features', 'name': 'Features', 'children': []}
]

toc = get_toc(markdown_toc_tokens)
print(f"TOC has {len(toc)} items")

# Access individual items
for item in toc:
    print(f"Link: {item.title} -> {item.url}")
```