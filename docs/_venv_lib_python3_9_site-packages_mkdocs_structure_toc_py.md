<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Table of Contents Generator

## Overview

This module handles the generation of per-page table of contents (TOC) for documentation pages. It provides a compatibility layer that converts Python-Markdown `toc` extension output into `AnchorLink` objects to maintain backward compatibility with older versions of MkDocs.

## Purpose

- Parse table of contents tokens from Python-Markdown's `toc` extension
- Convert parsed data into structured `AnchorLink` objects
- Provide a hierarchical representation of page headings
- Maintain compatibility with legacy MkDocs versions

## Classes

### `AnchorLink`

Represents a single entry in the table of contents with support for nested structure.

#### Properties

- **`title: str`** - The text content of the heading (as HTML)
- **`id: str`** - The unique identifier for the heading
- **`level: int`** - The zero-based nesting level of the heading
- **`children: list[AnchorLink]`** - List of child/nested headings
- **`url: str`** (property) - Returns the URL hash fragment (`#id`)

#### Methods

- **`__init__(title: str, id: str, level: int)`** - Initialize a new anchor link
- **`__str__()`** - Returns formatted string representation
- **`indent_print(depth: int = 0)`** - Returns indented string representation for debugging

#### Example Usage

```python
link = AnchorLink("Introduction", "intro", 0)
print(link.url)  # Output: #intro
print(link.title)  # Output: Introduction
```

### `TableOfContents`

A container class that holds all table of contents items for a page and provides iteration capabilities.

#### Features

- Implements `Iterable[AnchorLink]` for easy iteration
- Supports `len()` operation
- Provides string representation of the entire TOC

#### Methods

- **`__init__(items: list[AnchorLink])`** - Initialize with list of anchor links
- **`__iter__()`** - Returns iterator over items
- **`__len__()`** - Returns number of top-level items
- **`__str__()`** - Returns formatted string of all items

#### Example Usage

```python
toc = TableOfContents([link1, link2, link3])
for item in toc:
    print(f"- {item.title}")
```

## Functions

### `get_toc(toc_tokens: list[_TocToken]) -> TableOfContents`

Main entry point that converts TOC tokens into a structured table of contents.

#### Parameters

- **`toc_tokens`** - List of token dictionaries from Python-Markdown's toc extension

#### Returns

- `TableOfContents` object with parsed anchor links

#### Behavior

- Parses each token recursively to handle nested headings
- Automatically marks the first TOC item as active
- Returns empty TOC if no tokens provided

### `_parse_toc_token(token: _TocToken) -> AnchorLink`

Internal function that recursively converts a single TOC token into an `AnchorLink`.

#### Parameters

- **`token`** - A single TOC token dictionary

#### Returns

- `AnchorLink` object with populated children

## Type Definitions

### `_TocToken` (TypedDict)

Internal type definition for TOC tokens from Python-Markdown:

```python
{
    'level': int,      # Heading level (1-6)
    'id': str,         # HTML id attribute
    'name': str,       # Heading text content
    'children': list   # Nested heading tokens
}
```

## Notes and Suggestions

### Best Practices

- The module automatically handles the active state for the first TOC item
- Use the `url` property rather than manually constructing hash fragments
- The hierarchical structure is preserved through the `children` attribute

### Potential Improvements

- Consider adding validation for heading levels to ensure they follow proper nesting
- Add error handling for malformed TOC tokens
- Consider adding methods to find specific TOC items by ID or title
- The `active` attribute setting could be made more flexible to support different active item strategies

### Usage Context

This module is typically used within MkDocs themes and plugins that need to display navigation sidebars or in-page table of contents. The conversion from Python-Markdown tokens ensures compatibility while providing a clean object-oriented interface.