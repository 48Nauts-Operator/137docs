<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# MkDocs Template Context and Filters

## Overview

This module provides template context definitions and Jinja2 filters for MkDocs documentation generation. It defines the structure of data available to templates and provides utility filters for URL normalization and script tag generation.

## Purpose

- Define the template context structure that MkDocs passes to Jinja2 templates
- Provide custom Jinja2 filters for common template operations
- Handle URL normalization and HTML script tag generation in templates

## Classes

### `TemplateContext`

A TypedDict that defines the structure of the context object passed to MkDocs templates.

#### Fields

- `nav`: Navigation structure of the documentation
- `pages`: Sequence of all files in the documentation
- `base_url`: Base URL for the documentation site
- `extra_css`: Additional CSS files (deprecated - use `config.extra_css` instead)
- `extra_javascript`: Additional JavaScript files (deprecated - use `config.extra_javascript` instead)
- `mkdocs_version`: Version of MkDocs being used
- `build_date_utc`: UTC timestamp of when the documentation was built
- `config`: Complete MkDocs configuration object
- `page`: Current page being rendered (None for non-page templates)

## Functions

### `url_filter(context, value)`

A Jinja2 template filter that normalizes URLs for use in templates.

**Parameters:**
- `context` (TemplateContext): The template context containing page and base URL information
- `value` (str): The URL to normalize

**Returns:**
- `str`: Normalized URL relative to the current page and base URL

**Usage in templates:**
```jinja2
{{ "path/to/page.md" | url }}
```

### `script_tag_filter(context, extra_script)`

A Jinja2 template filter that converts an ExtraScript configuration value into a properly formatted HTML `<script>` tag.

**Parameters:**
- `context` (TemplateContext): The template context for URL normalization
- `extra_script` (ExtraScriptValue): Script configuration object or string

**Returns:**
- `str`: HTML script tag with appropriate attributes

**Usage in templates:**
```jinja2
{{ script_config | script_tag }}
```

**Generated HTML examples:**
```html
<!-- Simple string -->
<script src="path/to/script.js"></script>

<!-- With attributes -->
<script src="path/to/script.js" type="module" defer async></script>
```

## Implementation Notes

### Compatibility Handling

The module handles Jinja2 version compatibility by trying to import `pass_context` (newer versions) and falling back to `contextfilter` (older versions):

```python
try:
    from jinja2 import pass_context as contextfilter
except ImportError:
    from jinja2 import contextfilter
```

### Type Checking

The module uses `TYPE_CHECKING` blocks to avoid runtime imports of modules only needed for type annotations, improving performance and avoiding circular imports.

### Security

The `script_tag_filter` uses `Markup` from `markupsafe` to ensure the generated HTML is properly marked as safe for template rendering.

## Usage Recommendations

- **URL Normalization**: Always use the `url` filter when linking between pages in templates
- **Deprecated Fields**: Avoid using `extra_css` and `extra_javascript` from the context; use `config.extra_css` and `config.extra_javascript` instead
- **Script Tags**: Use the `script_tag` filter for consistent script tag generation with proper attribute handling

## Dependencies

- `markupsafe`: For safe HTML markup generation
- `jinja2`: Template engine (version-compatible import)
- `mkdocs.utils`: For URL normalization utilities