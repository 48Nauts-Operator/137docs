<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# MkDocs Template Context and Filters

## Overview

This module provides template context definitions and custom Jinja2 filters for MkDocs, a static site generator. It enables proper URL normalization and script tag generation within MkDocs templates.

## Purpose

- Define the structure of template context data available in MkDocs themes
- Provide custom Jinja2 filters for URL handling and script tag generation
- Ensure consistent URL normalization across templates
- Generate proper HTML script tags with various attributes

## Dependencies

The module handles compatibility across different versions of Jinja2 and includes the following key dependencies:

```python
from markupsafe import Markup
from jinja2 import pass_context as contextfilter  # or contextfilter for older versions
from mkdocs.utils import normalize_url
```

## Classes

### `TemplateContext`

A TypedDict that defines the structure of the template context available in MkDocs themes.

**Available Context Variables:**

- `nav`: Navigation structure
- `pages`: Sequence of all site files
- `base_url`: Base URL for the site
- `extra_css`: Additional CSS files ⚠️ *Deprecated - use `config.extra_css` instead*
- `extra_javascript`: Additional JavaScript files ⚠️ *Deprecated - use `config.extra_javascript` instead*
- `mkdocs_version`: Version of MkDocs being used
- `build_date_utc`: UTC timestamp of when the site was built
- `config`: Complete MkDocs configuration object
- `page`: Current page being rendered (can be None)

## Functions

### `url_filter(context, value)`

A Jinja2 template filter that normalizes URLs for consistent linking.

**Parameters:**
- `context`: Template context containing page and base URL information
- `value`: The URL string to normalize

**Returns:** 
- Normalized URL string

**Usage in templates:**
```jinja2
{{ "path/to/page.md" | url }}
```

### `script_tag_filter(context, extra_script)`

Converts an ExtraScript configuration value into a properly formatted HTML `<script>` tag.

**Parameters:**
- `context`: Template context for URL resolution
- `extra_script`: Either a string URL or an ExtraScriptValue object with additional properties

**Returns:** 
- HTML `<script>` tag as a Markup object

**Generated attributes:**
- `src`: Script source URL (normalized)
- `type`: Script MIME type (if specified)
- `defer`: Defer attribute (if enabled)
- `async`: Async attribute (if enabled)

**Usage in templates:**
```jinja2
{{ extra_script | script_tag }}
```

## Notes and Suggestions

### ⚠️ Deprecation Warning
The `extra_css` and `extra_javascript` fields in `TemplateContext` are marked as deprecated. Use `config.extra_css` and `config.extra_javascript` instead for accessing additional stylesheets and scripts.

### Compatibility
The module includes compatibility handling for different Jinja2 versions:
- Uses `pass_context` for newer versions
- Falls back to `contextfilter` for older versions

### Security
The `script_tag_filter` uses `Markup` from MarkupSafe to ensure the generated HTML is properly marked as safe and won't be escaped by Jinja2.

### Usage in Theme Development
Theme developers should use these filters to ensure:
- All URLs are properly normalized relative to the site structure
- Script tags are generated with appropriate attributes
- Consistent behavior across different MkDocs configurations