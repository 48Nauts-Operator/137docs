<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# MkDocs YAML Configuration Loader

This module provides enhanced YAML loading functionality for MkDocs configuration files, including support for environment variables, directory placeholders, and configuration inheritance.

## Overview

The module extends Python's standard PyYAML library to support MkDocs-specific features:
- **Environment variable substitution** using `!ENV` tags
- **Directory placeholders** using `!relative` tags for dynamic path resolution
- **Configuration inheritance** through the `INHERIT` keyword
- **Deep merging** of inherited configuration files

## Key Components

### Directory Placeholder Classes

#### `_DirPlaceholder` (Base Class)
Abstract base class for all directory placeholder implementations.

```python
class _DirPlaceholder(os.PathLike):
    def __init__(self, config: MkDocsConfig, suffix: str = '')
    def value(self) -> str  # Abstract method
    def __fspath__(self) -> str  # Returns full resolved path
```

#### `ConfigDirPlaceholder`
Resolves to the directory containing the MkDocs configuration file.

- **Usage**: `!relative $config_dir/path/to/resource`
- **Purpose**: Reference files relative to the config file location
- **Example**: If config is at `/project/mkdocs.yml`, `$config_dir` resolves to `/project`

#### `DocsDirPlaceholder`
Resolves to the configured documentation source directory.

- **Usage**: `!relative $docs_dir/path/to/file`
- **Purpose**: Reference files relative to the docs directory
- **Example**: References files within the documentation source tree

#### `RelativeDirPlaceholder`
Resolves to the directory of the currently processed Markdown file.

- **Usage**: `!relative`
- **Purpose**: Dynamic path resolution during page rendering
- **Limitation**: Only available during page processing context

### Core Functions

#### `get_yaml_loader(loader=yaml.Loader, config=None)`
Creates a custom YAML loader with MkDocs-specific constructors.

**Features:**
- Adds `!ENV` tag support for environment variables
- Adds `!relative` tag support for directory placeholders (when config provided)
- Extends base loader without modifying global PyYAML settings

**Parameters:**
- `loader`: Base PyYAML loader class (default: `yaml.Loader`)
- `config`: MkDocsConfig instance for placeholder resolution

#### `yaml_load(source, loader=None)`
Enhanced YAML loading with inheritance support and error handling.

**Features:**
- **Configuration Inheritance**: Processes `INHERIT` keyword to merge parent configs
- **Deep Merging**: Uses `mergedeep` library for recursive dictionary merging
- **Error Handling**: Converts YAML errors to MkDocs configuration errors
- **Recursive Loading**: Supports nested inheritance chains

**Parameters:**
- `source`: File object or string containing YAML content
- `loader`: Custom YAML loader class

## Usage Examples

### Environment Variables
```yaml
site_name: !ENV SITE_NAME
api_key: !ENV [API_KEY, "default_value"]
```

### Directory Placeholders
```yaml
plugins:
  - plugin_name:
      template_dir: !relative $config_dir/templates
      docs_path: !relative $docs_dir/api
```

### Configuration Inheritance
```yaml
# child-config.yml
INHERIT: ../base-config.yml
site_name: "Child Site"
nav:
  - Home: index.md
```

## Important Notes

### Security Considerations
- The default loader (`yaml.Loader`) can execute arbitrary Python code
- Consider using `yaml.SafeLoader` for untrusted input
- Environment variable access may expose sensitive information

### Path Resolution
- Paths are resolved at access time, not load time
- `!relative` tag requires active page context
- Relative paths in `INHERIT` are resolved relative to the current config file

### Error Handling
- YAML parsing errors are wrapped as `ConfigurationError`
- Missing inherited files raise configuration errors
- Invalid placeholder prefixes are rejected with descriptive messages

## Dependencies

- **PyYAML**: Core YAML parsing functionality
- **yaml-env-tag**: Environment variable tag support  
- **mergedeep**: Deep dictionary merging for inheritance
- **MkDocs**: Configuration types and exception classes

This module is essential for MkDocs' flexible configuration system, enabling dynamic path resolution and modular configuration management.