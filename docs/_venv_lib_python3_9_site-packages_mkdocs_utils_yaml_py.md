<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# YAML Configuration Loader Module

This module provides YAML configuration loading functionality with enhanced features for MkDocs. It extends standard YAML loading with custom tags, environment variable support, and configuration inheritance capabilities.

## Purpose

The module serves as a specialized YAML processor for MkDocs configuration files, offering:

- **Custom YAML Tags**: Support for `!relative`, `!ENV` tags
- **Configuration Inheritance**: Ability to inherit from parent config files using `INHERIT` key
- **Path Placeholders**: Dynamic path resolution relative to config directories
- **Environment Variables**: Integration with environment variable substitution

## Key Classes

### `_DirPlaceholder`

Base class for directory placeholder objects that implement `os.PathLike`.

**Key Methods:**
- `value()`: Abstract method to return the resolved directory path
- `__fspath__()`: Returns the full path including suffix
- `__str__()`: String representation of the path

### `ConfigDirPlaceholder`

```python
ConfigDirPlaceholder(config, suffix='')
```

Resolves to the directory containing the MkDocs configuration file.

- **Implementation of**: `!relative $config_dir/suffix` YAML tag
- **Use Case**: Reference files relative to the config file location

### `DocsDirPlaceholder`

```python
DocsDirPlaceholder(config, suffix='')
```

Resolves to the configured docs directory.

- **Implementation of**: `!relative $docs_dir/suffix` YAML tag  
- **Use Case**: Reference files relative to the documentation source directory

### `RelativeDirPlaceholder`

```python
RelativeDirPlaceholder(config, suffix='')
```

Resolves to the directory of the currently rendered Markdown file.

- **Implementation of**: `!relative` YAML tag
- **Limitation**: Can only be used when a current page context exists
- **Primary Use**: Within `markdown_extensions` configuration

## Important Functions

### `get_yaml_loader(loader=yaml.Loader, config=None)`

Creates a custom YAML loader with MkDocs-specific enhancements.

**Features Added:**
- `!ENV` tag for environment variable substitution
- `!relative` tag for dynamic path resolution (when config provided)

**Parameters:**
- `loader`: Base PyYAML loader class (default: `yaml.Loader`)
- `config`: MkDocsConfig instance for path resolution context

**Returns:** Enhanced loader class

### `yaml_load(source, loader=None)`

Loads and processes YAML configuration with inheritance support.

**Parameters:**
- `source`: File-like object or string containing YAML content
- `loader`: Custom YAML loader class

**Features:**
- **Deep Merging**: Recursively merges inherited configurations
- **INHERIT Support**: Processes `INHERIT` key to load parent configs
- **Error Handling**: Converts YAML errors to MkDocs ConfigurationError

**Returns:** Dictionary containing merged configuration

## Usage Examples

### Using Path Placeholders in YAML

```yaml
# In mkdocs.yml
theme:
  custom_dir: !relative $config_dir/custom_theme
  
markdown_extensions:
  - include:
      base_path: !relative $docs_dir/includes
```

### Configuration Inheritance

```yaml
# child-config.yml
INHERIT: ../base-config.yml

site_name: "Child Site"
# Additional configurations merge with base-config.yml
```

### Programmatic Usage

```python
from mkdocs.config.base import yaml_load

# Load configuration with inheritance
with open('mkdocs.yml', 'rb') as f:
    config_data = yaml_load(f)
```

## Notes and Considerations

### ‚ö†Ô∏è Important Limitations

- **Context Dependency**: `!relative` tag requires an active page context
- **File-based Inheritance**: `INHERIT` only works with file objects, not string sources
- **Path Resolution**: All placeholders resolve at access time, not load time

### üîß Error Handling

The module converts various error types into `MkDocsConfig.ConfigurationError`:
- Invalid YAML syntax
- Missing inherited configuration files  
- Invalid placeholder prefixes
- Context-dependent tag usage errors

### üí° Best Practices

- Use `$config_dir` for theme files and assets
- Use `$docs_dir` for content-related includes
- Reserve `!relative` for dynamic, page-specific paths
- Keep inherited config files in predictable relative locations

## Dependencies

- **PyYAML**: Core YAML processing
- **yaml-env-tag**: Environment variable tag support  
- **mergedeep**: Deep dictionary merging for inheritance
- **MkDocs**: Configuration and exception types