<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Python Handler Documentation

## Overview

This module implements a Python language handler for the mkdocstrings documentation generator. It provides functionality to collect, process, and render Python code documentation by parsing Python modules and their docstrings.

## Purpose

The Python handler serves as a bridge between Python source code and documentation generation systems. It:

- **Collects** Python objects (modules, classes, functions, etc.) and their documentation
- **Processes** docstrings using various parsing styles (Google, NumPy, Sphinx, etc.)
- **Renders** documentation into HTML format using Jinja2 templates
- **Manages** cross-references and inventory files for inter-documentation linking

## Main Classes

### `PythonHandler`

The core handler class that extends `BaseHandler` from mkdocstrings.

#### Key Attributes

```python
name: ClassVar[str] = "python"           # Handler identifier
domain: ClassVar[str] = "py"             # Cross-documentation domain
enable_inventory: ClassVar[bool] = True   # Enables objects.inv creation
fallback_theme: ClassVar[str] = "material" # Default theme
```

#### Constructor Parameters

- `config: PythonConfig` - Handler configuration settings
- `base_dir: Path` - Base directory of the project
- `**kwargs` - Additional arguments passed to parent constructor

## Important Methods

### Collection Methods

#### `collect(identifier: str, options: PythonOptions) -> CollectorItem`

Collects documentation for a specific Python object.

**Process:**
1. Extracts module name from identifier
2. Creates a Griffe loader with specified extensions and search paths
3. Loads the module and resolves aliases
4. Returns the collected documentation object

**Parameters:**
- `identifier` - Python object identifier (e.g., "mymodule.MyClass")
- `options` - Collection options (docstring style, extensions, etc.)

### Rendering Methods

#### `render(data: CollectorItem, options: PythonOptions) -> str`

Renders collected data into HTML format.

**Features:**
- Uses Jinja2 templates
- Supports configurable heading levels
- Includes cross-referencing capabilities
- Handles localization

#### `update_env(config: Any) -> None`

Configures the Jinja2 environment with custom filters and globals:

```python
# Custom filters
env.filters["crossref"] = rendering.do_crossref
env.filters["format_code"] = rendering.do_format_code
env.filters["format_signature"] = rendering.do_format_signature
# ... and more

# Global variables
env.globals["AutorefsHook"] = rendering.AutorefsHook
```

### Inventory Management

#### `get_inventory_urls() -> list[tuple[str, dict[str, Any]]]`

Returns URLs of inventory files to download for cross-documentation linking.

#### `load_inventory(...) -> Iterator[tuple[str, str]]`

Parses Sphinx inventory files and yields item identifiers with their URLs.

### Utility Methods

#### `get_aliases(identifier: str) -> tuple[str, ...]`

Retrieves all aliases for a given identifier, including canonical paths.

#### `normalize_extension_paths(extensions: Sequence) -> Sequence`

Resolves extension paths relative to the configuration file location.

## Configuration

The handler uses two main configuration classes:

- **`PythonConfig`** - Overall handler configuration
- **`PythonOptions`** - Per-collection options (docstring styles, extensions, etc.)

### Key Configuration Options

- `paths` - Search paths for Python modules
- `extensions` - Griffe extensions to load
- `docstring_style` - Parser for docstrings (google, numpy, sphinx)
- `allow_inspection` - Whether to allow runtime inspection
- `preload_modules` - Modules to preload before collection

## Entry Point

### `get_handler(handler_config, tool_config, **kwargs) -> PythonHandler`

Factory function that creates and configures a `PythonHandler` instance.

**Key Features:**
- Resolves base directory from MkDocs config
- Handles legacy configuration key migration (`import` → `inventories`)
- Validates and processes handler configuration

## Compatibility Notes

### Python Version Compatibility

The code includes compatibility handling for Python versions:

```python
# Context manager for directory changes
if sys.version_info >= (3, 11):
    from contextlib import chdir
else:
    # Custom implementation for older Python versions
    @contextmanager
    def chdir(path: str) -> Iterator[None]:
        # Implementation details...
```

### Deprecation Warnings

The handler includes deprecation warnings for configuration changes:

- Extra options should be passed under `options.extra` instead of directly under `options`
- The `import` configuration key is deprecated in favor of `inventories`

## Usage Notes

### Search Path Resolution

The handler intelligently manages Python search paths:

1. Expands glob patterns in configured paths
2. Adds the base directory if no paths are specified
3. Prioritizes user-provided paths over system paths
4. Removes duplicates and ensures absolute paths

### Template Overrides

⚠️ **Warning**: Overriding base templates is not supported. Override theme-specific templates instead:

- ❌ `python/theme/_base/template.html.jinja`
- ✅ `python/theme/template.html.jinja`

### Error Handling

The handler provides comprehensive error handling:

- `CollectionError` - When objects cannot be found or loaded
- `PluginError` - For invalid configuration options
- `AliasResolutionError` - When cross-references cannot be resolved

## Dependencies

Key dependencies include:

- **Griffe** - Python code analysis and documentation extraction
- **mkdocstrings** - Base documentation generation framework
- **Jinja2** - Template rendering (via mkdocstrings)