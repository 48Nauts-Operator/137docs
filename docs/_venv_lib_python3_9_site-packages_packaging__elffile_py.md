<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# ELF File Parser

## Overview

This module provides a lightweight ELF (Executable and Linkable Format) file parser for Python. It implements a read-only interface similar to `ZipFile` for parsing ELF executables and extracting basic information about the binary format.

## Purpose

The ELF parser is designed to:
- Parse ELF executable headers
- Extract architecture and encoding information
- Retrieve the interpreter path from ELF binaries
- Provide a simple interface for basic ELF file analysis

## Classes and Enums

### Exception Classes

#### `ELFInvalid`
```python
class ELFInvalid(ValueError):
    pass
```
- Custom exception raised when ELF parsing fails
- Inherits from `ValueError`

### Enumeration Classes

#### `EIClass`
```python
class EIClass(enum.IntEnum):
    C32 = 1  # 32-bit format
    C64 = 2  # 64-bit format
```
- Defines ELF file class (bitness)

#### `EIData`
```python
class EIData(enum.IntEnum):
    Lsb = 1  # Little-endian
    Msb = 2  # Big-endian
```
- Defines data encoding (endianness)

#### `EMachine`
```python
class EMachine(enum.IntEnum):
    I386 = 3      # Intel 80386
    S390 = 22     # IBM S/390
    Arm = 40      # ARM
    X8664 = 62    # AMD x86-64
    AArc64 = 183  # ARM AArch64
```
- Defines supported machine architectures

### Main Class

#### `ELFFile`

The primary class for parsing ELF files.

##### Constructor
```python
def __init__(self, f: IO[bytes]) -> None
```
- **Parameters**: `f` - File-like object opened in binary mode
- **Raises**: `ELFInvalid` if the file is not a valid ELF format

##### Attributes
- `capacity`: File class (32-bit or 64-bit)
- `encoding`: Data encoding (endianness)
- `machine`: Target architecture
- `flags`: Processor-specific flags

##### Methods

###### `interpreter` (Property)
```python
@property
def interpreter(self) -> str | None
```
- **Returns**: Path to the dynamic linker/interpreter or `None` if not found
- **Purpose**: Extracts the interpreter path from the `PT_INTERP` program header

###### `_read` (Private Method)
```python
def _read(self, fmt: str) -> tuple[int, ...]
```
- **Parameters**: `fmt` - struct format string
- **Returns**: Tuple of unpacked values
- **Purpose**: Helper method for reading and unpacking binary data

## Usage Example

```python
with open('executable_file', 'rb') as f:
    elf = ELFFile(f)
    
    print(f"Architecture: {elf.machine}")
    print(f"Bitness: {elf.capacity}")
    print(f"Endianness: {elf.encoding}")
    print(f"Interpreter: {elf.interpreter}")
```

## Implementation Notes

### Format Support
The parser supports the following ELF format combinations:
- 32-bit Little-endian
- 32-bit Big-endian  
- 64-bit Little-endian
- 64-bit Big-endian

### Structure Parsing
The implementation uses Python's `struct` module with format strings that vary based on:
- **Bitness**: Different field sizes for 32-bit vs 64-bit
- **Endianness**: Different byte order (`<` for little-endian, `>` for big-endian)

## Limitations and Suggestions

### Current Limitations
- **Read-only**: No support for modifying ELF files
- **Limited parsing**: Only extracts basic header information and interpreter
- **No section parsing**: Does not parse individual ELF sections beyond headers
- **Architecture support**: Limited to specific architectures defined in `EMachine`

### Suggestions for Enhancement
1. **Add section parsing**: Implement methods to read and parse ELF sections
2. **Symbol table support**: Add functionality to extract symbol information
3. **Dependency analysis**: Parse dynamic dependencies beyond just the interpreter
4. **Validation**: Add more comprehensive ELF format validation
5. **Error handling**: Provide more specific error messages for different failure modes
6. **Context manager**: Implement `__enter__` and `__exit__` methods for better resource management

### Usage Recommendations
- Always use binary mode when opening files
- Handle `ELFInvalid` exceptions appropriately
- Consider file size and memory usage for large ELF files
- Use within a context manager or ensure proper file handle management

## References
- Based on: https://gist.github.com/lyssdod/f51579ae8d93c8657a5564aefc2ffbca
- ELF specification: https://refspecs.linuxfoundation.org/elf/gabi4+/ch4.eheader.html