<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Manylinux Platform Tags Generator

This Python module generates manylinux platform tags that are compatible with the current Linux platform. It's designed to help determine which manylinux wheel packages can be installed on a given system based on the system's architecture and glibc version.

## Purpose

The module serves as a compatibility checker for Python wheel packages on Linux systems, specifically for manylinux wheels. It:

- Detects the system's architecture and ABI compatibility
- Determines the installed glibc version
- Generates appropriate manylinux tags that the system can support
- Handles legacy manylinux tags (manylinux1, manylinux2010, manylinux2014)

## Key Components

### Constants

```python
EF_ARM_ABIMASK = 0xFF000000
EF_ARM_ABI_VER5 = 0x05000000
EF_ARM_ABI_FLOAT_HARD = 0x00000400
```

ARM-specific ELF flags used to detect hard-float ABI compatibility.

### Core Classes

#### `_GLibCVersion`

```python
class _GLibCVersion(NamedTuple):
    major: int
    minor: int
```

A named tuple representing glibc version with major and minor components.

### Important Functions

#### `platform_tags(archs: Sequence[str]) -> Iterator[str]`

**Main public function** that generates manylinux tags compatible with the current platform.

**Parameters:**
- `archs`: Sequence of compatible architectures (e.g., `["x86_64"]`)

**Returns:** Iterator of compatible manylinux tag strings

**Example usage:**
```python
tags = list(platform_tags(["x86_64"]))
# Returns tags like: ["manylinux_2_17_x86_64", "manylinux2014_x86_64", ...]
```

#### Architecture Detection Functions

- **`_is_linux_armhf(executable: str) -> bool`**: Detects ARM hard-float ABI
- **`_is_linux_i686(executable: str) -> bool`**: Detects i686 architecture
- **`_have_compatible_abi(executable: str, archs: Sequence[str]) -> bool`**: Checks overall ABI compatibility

#### Glibc Version Detection

- **`_glibc_version_string() -> str | None`**: Gets glibc version string
- **`_get_glibc_version() -> tuple[int, int]`**: Returns parsed glibc version (cached)
- **`_parse_glibc_version(version_str: str) -> tuple[int, int]`**: Parses version string

#### Compatibility Checking

- **`_is_compatible(arch: str, version: _GLibCVersion) -> bool`**: Checks if a specific glibc version is compatible

### Context Managers

#### `_parse_elf(path: str)`

Safely parses ELF files to extract architecture information.

```python
with _parse_elf("/usr/bin/python") as elf_file:
    if elf_file:
        # Process ELF file
```

## Supported Architectures

### Architectures requiring special ABI checks:
- **armv7l**: Requires hard-float ABI detection
- **i686**: Requires 32-bit x86 detection

### Architectures with automatic compatibility:
- x86_64
- aarch64  
- ppc64
- ppc64le
- s390x
- loongarch64
- riscv64

## Legacy Manylinux Tags

The module supports legacy manylinux specifications:

```python
_LEGACY_MANYLINUX_MAP = {
    (2, 17): "manylinux2014",  # CentOS 7
    (2, 12): "manylinux2010",  # CentOS 6  
    (2, 5): "manylinux1",      # CentOS 5
}
```

## Implementation Notes

### Glibc Detection Strategy

1. **Primary method**: Uses `os.confstr("CS_GNU_LIBC_VERSION")` (faster, more reliable)
2. **Fallback method**: Uses `ctypes` to call `gnu_get_libc_version()` directly

### Error Handling

- Gracefully handles missing ELF files or parsing errors
- Returns `None` or empty results when glibc detection fails  
- Issues warnings for unexpected glibc version formats

### Performance Considerations

- Uses `@functools.lru_cache` on `_get_glibc_version()` to avoid repeated system calls
- Uses context managers for safe file handling

## Dependencies

- Standard library modules: `os`, `sys`, `re`, `collections`, `contextlib`, `functools`, `warnings`
- Internal module: `._elffile` for ELF file parsing

## Usage Example

```python
from packaging._manylinux import platform_tags

# Get all compatible manylinux tags for x86_64
compatible_tags = list(platform_tags(["x86_64"]))
print(compatible_tags)
# Output: ['manylinux_2_35_x86_64', 'manylinux_2_34_x86_64', ..., 'manylinux2014_x86_64', 'manylinux1_x86_64']
```

## Notes

- This module is typically used internally by packaging tools
- The `os.PathLike` type annotation is avoided until Python 3.9+ for compatibility
- Version detection handles patched/forked glibc versions by using regex parsing