<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Python Packaging Specifiers Module Documentation

## Overview

This module provides functionality for parsing, validating, and working with version specifiers in Python packaging. It implements the version specifier syntax defined in PEP 440, allowing you to specify version constraints like `>=1.2.3`, `~=2.0`, or `!=1.0.1`.

## Purpose

The module serves as a core component of Python's packaging infrastructure, enabling:
- **Version constraint specification**: Define acceptable version ranges for dependencies
- **Version matching**: Check if a given version satisfies specified constraints
- **Version filtering**: Filter collections of versions based on specifier rules
- **Prerelease handling**: Intelligent handling of prerelease versions

## Key Classes

### `InvalidSpecifier`

```python
class InvalidSpecifier(ValueError)
```

Exception raised when attempting to create a `Specifier` with invalid syntax.

**Example:**
```python
>>> Specifier("lolwat")
Traceback (most recent call last):
    ...
packaging.specifiers.InvalidSpecifier: Invalid specifier: 'lolwat'
```

### `BaseSpecifier`

Abstract base class that defines the interface for all specifier-like objects. Provides abstract methods for:
- String representation (`__str__`)
- Hashing (`__hash__`)
- Equality comparison (`__eq__`)
- Version containment checking (`contains`)
- Version filtering (`filter`)
- Prerelease handling (`prereleases` property)

### `Specifier`

```python
class Specifier(BaseSpecifier)
```

Handles individual version specifiers with operators and version constraints.

#### Supported Operators

| Operator | Name | Description |
|----------|------|-------------|
| `~=` | Compatible release | Compatible version (e.g., `~=1.4` matches `>=1.4, <1.5`) |
| `==` | Equal | Exact version match (supports prefix matching with `.*`) |
| `!=` | Not equal | Excludes specific versions |
| `<=` | Less than or equal | Maximum version constraint |
| `>=` | Greater than or equal | Minimum version constraint |
| `<` | Less than | Strict maximum version |
| `>` | Greater than | Strict minimum version |
| `===` | Arbitrary equality | Exact string match (discouraged) |

#### Key Properties

- **`operator`**: Returns the operator string (e.g., `>=`)
- **`version`**: Returns the version string (e.g., `1.2.3`)
- **`prereleases`**: Controls prerelease version acceptance

#### Usage Examples

```python
# Create specifiers
spec = Specifier(">=1.2.3")
spec_with_prereleases = Specifier(">=1.0.0", prereleases=True)

# Check version containment
"1.3.0" in spec  # True
"1.1.0" in spec  # False

# Filter versions
versions = ["1.1.0", "1.2.3", "1.3.0", "2.0.0a1"]
list(spec.filter(versions))  # ['1.2.3', '1.3.0']
```

### `SpecifierSet`

```python
class SpecifierSet(BaseSpecifier)
```

Handles collections of specifiers, supporting comma-separated specifier strings.

#### Key Features

- **Multiple constraints**: Combines multiple specifiers with logical AND
- **Comma separation**: Parses strings like `">=1.0.0,!=1.0.1,<2.0.0"`
- **Set operations**: Supports combination with other SpecifierSets using `&`
- **Smart prerelease handling**: Automatically determines prerelease acceptance

#### Usage Examples

```python
# Create from string
spec_set = SpecifierSet(">=1.0.0,!=1.0.1,<2.0.0")

# Create from Specifier objects
specs = [Specifier(">=1.0.0"), Specifier("!=1.0.1")]
spec_set = SpecifierSet(specs)

# Combine SpecifierSets
combined = SpecifierSet(">=1.0.0") & SpecifierSet("<2.0.0")

# Check containment
"1.5.0" in spec_set  # True
"1.0.1" in spec_set  # False

# Iterate over individual specifiers
for spec in spec_set:
    print(f"Operator: {spec.operator}, Version: {spec.version}")
```

## Important Functions

### `_coerce_version(version: UnparsedVersion) -> Version`

Converts string versions to `Version` objects for consistent handling.

### Version Utility Functions

- **`_version_split(version: str) -> list[str]`**: Splits version strings into components
- **`_version_join(components: list[str]) -> str`**: Joins components back into version strings
- **`_pad_version(left, right)`**: Pads version components for comparison
- **`_is_not_suffix(segment: str) -> bool`**: Identifies non-suffix version segments

## Prerelease Handling

The module implements sophisticated prerelease logic:

### Automatic Detection
- Specifiers automatically detect if they should accept prereleases
- Based on whether the specifier itself contains prerelease versions

### Override Control
```python
# Force prerelease acceptance
spec = Specifier(">=1.0.0", prereleases=True)

# Disable prerelease acceptance
spec = Specifier(">=1.0.0", prereleases=False)

# Auto-detect (default)
spec = Specifier(">=1.0.0", prereleases=None)
```

### Fallback Behavior
When filtering versions, if no stable releases match but prereleases do, the prereleases will be included automatically.

## Usage Notes and Best Practices

### âœ… Recommended Practices

1. **Use SpecifierSet for most cases**:
   ```python
   # Preferred
   spec_set = SpecifierSet(">=1.0.0,<2.0.0")
   
   # Instead of managing individual Specifiers
   ```

2. **Let prerelease detection work automatically**: