<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Python Packaging Utilities Documentation

## Overview

This module provides utilities for handling Python package names and distribution filenames according to Python packaging standards. It implements functionality for canonicalizing package names, parsing wheel and source distribution filenames, and validating package naming conventions as specified in various Python Enhancement Proposals (PEPs).

## Purpose

The primary purpose of this module is to:
- Normalize and validate Python package names according to PEP 503
- Parse wheel filenames according to PEP 427
- Parse source distribution (sdist) filenames
- Canonicalize version strings according to PEP 625
- Provide consistent handling of package metadata

## Type Definitions

### `BuildTag`
```python
BuildTag = Union[Tuple[()], Tuple[int, str]]
```
Represents a build tag in wheel filenames - either empty or containing a build number and string.

### `NormalizedName`
```python
NormalizedName = NewType("NormalizedName", str)
```
A type alias for normalized package names to ensure type safety.

## Exception Classes

### `InvalidName`
- **Inherits from**: `ValueError`
- **Purpose**: Raised when an invalid distribution name is encountered
- **Note**: Users should refer to the packaging user guide for naming conventions

### `InvalidWheelFilename`
- **Inherits from**: `ValueError`
- **Purpose**: Raised when parsing an invalid wheel filename
- **Note**: Users should refer to PEP 427 for wheel filename specifications

### `InvalidSdistFilename`
- **Inherits from**: `ValueError`
- **Purpose**: Raised when parsing an invalid source distribution filename
- **Note**: Users should refer to the packaging user guide

## Core Functions

### `canonicalize_name(name: str, *, validate: bool = False) -> NormalizedName`

Converts a package name to its canonical form according to PEP 503.

**Parameters:**
- `name`: The package name to canonicalize
- `validate`: Whether to validate the name format before canonicalizing

**Returns:** Normalized package name with lowercase letters and consolidated separators

**Example:**
```python
canonicalize_name("My-Package_Name")  # Returns: "my-package-name"
```

**Notes:**
- Replaces runs of `[-_.]` with single hyphens
- Converts to lowercase
- Raises `InvalidName` if validation fails

### `is_normalized_name(name: str) -> bool`

Checks if a package name is already in normalized form.

**Parameters:**
- `name`: The package name to check

**Returns:** `True` if the name is normalized, `False` otherwise

### `canonicalize_version(version: Version | str, *, strip_trailing_zero: bool = True) -> str`

Returns the canonical form of a version string according to PEP 625.

**Parameters:**
- `version`: Version object or string to canonicalize
- `strip_trailing_zero`: Whether to remove trailing zeros from version

**Returns:** Canonical version string

**Examples:**
```python
canonicalize_version('1.0.1')  # Returns: '1.0.1'
canonicalize_version('1.0.0')  # Returns: '1'
canonicalize_version('1.0.0', strip_trailing_zero=False)  # Returns: '1.0.0'
```

**Notes:**
- Uses `@functools.singledispatch` for type-specific handling
- Invalid versions are returned unaltered
- Supports multiple canonical forms per PEP 625

### `parse_wheel_filename(filename: str) -> tuple[NormalizedName, Version, BuildTag, frozenset[Tag]]`

Parses a wheel filename according to PEP 427 specifications.

**Parameters:**
- `filename`: The wheel filename to parse (must end with `.whl`)

**Returns:** Tuple containing:
- Normalized package name
- Version object
- Build tag (empty tuple or build number/string pair)
- Set of compatibility tags

**Validation Rules:**
- Must have `.whl` extension
- Must have 4 or 5 dash-separated parts
- Project name cannot contain `__` or invalid characters
- Build number must start with a digit (if present)

**Raises:** `InvalidWheelFilename` for malformed filenames

### `parse_sdist_filename(filename: str) -> tuple[NormalizedName, Version]`

Parses a source distribution filename.

**Parameters:**
- `filename`: The sdist filename to parse

**Returns:** Tuple containing normalized package name and version

**Supported Extensions:**
- `.tar.gz`
- `.zip`

**Notes:**
- Splits on the last dash to separate name from version
- Requires PEP 440 compliant version (no dashes allowed)

**Raises:** `InvalidSdistFilename` for malformed filenames

## Regular Expressions

The module uses several compiled regex patterns for validation:

- `_validate_regex`: Validates package name format
- `_canonicalize_regex`: Identifies characters to normalize in package names
- `_normalized_regex`: Checks if a name is already normalized
- `_build_tag_regex`: Parses build tags in wheel filenames

## Usage Recommendations

1. **Always use `canonicalize_name()`** when comparing package names to ensure consistency
2. **Enable validation** when processing user input: `canonicalize_name(name, validate=True)`
3. **Handle exceptions appropriately** when parsing filenames in production code
4. **Consider version canonicalization options** based on your specific use case

## Dependencies

This module depends on:
- `.tags` module for tag parsing functionality
- `.version` module for version handling and validation