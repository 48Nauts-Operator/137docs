<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# RedisCache Documentation

## Overview

This module provides a Redis-based cache implementation for pip's cachecontrol library. It implements a Redis backend that extends the `BaseCache` class to provide caching functionality using Redis as the storage mechanism.

## Purpose

The `RedisCache` class serves as an adapter between pip's caching system and Redis, allowing pip to store and retrieve cached HTTP responses and other data in a Redis database for improved performance and persistence across sessions.

## Classes

### RedisCache

A Redis-based cache implementation that inherits from `BaseCache`.

#### Constructor

```python
def __init__(self, conn: Redis[bytes]) -> None:
    self.conn = conn
```

**Parameters:**
- `conn`: A Redis connection object that handles byte data

#### Methods

##### `get(key: str) -> bytes | None`

Retrieves a value from the Redis cache.

**Parameters:**
- `key`: The cache key to retrieve

**Returns:**
- The cached value as bytes, or `None` if the key doesn't exist

##### `set(key: str, value: bytes, expires: int | datetime | None = None) -> None`

Stores a value in the Redis cache with optional expiration.

**Parameters:**
- `key`: The cache key
- `value`: The value to store (as bytes)
- `expires`: Optional expiration time as:
  - `int`: Number of seconds until expiration
  - `datetime`: Absolute expiration time
  - `None`: No expiration (default)

**Behavior:**
- If no expiration is provided, the key persists indefinitely
- If a `datetime` is provided, calculates the time difference from now
- Handles both timezone-aware and timezone-naive datetime objects
- If an integer is provided, treats it as seconds until expiration

##### `delete(key: str) -> None`

Removes a key from the Redis cache.

**Parameters:**
- `key`: The cache key to delete

##### `clear() -> None`

**⚠️ Warning: Use with caution!**

Clears all keys from the Redis database. This operation:
- Iterates through all keys in the database
- Deletes each key individually
- Can impact performance on large databases
- Affects the entire Redis database, not just cache-related keys

##### `close() -> None`

Handles connection cleanup. Currently a no-op since Redis uses connection pooling and doesn't require explicit connection closing.

## Dependencies

- `datetime`: For handling expiration times
- `typing`: For type hints
- `pip._vendor.cachecontrol.cache.BaseCache`: Parent class
- `redis.Redis`: Redis client (imported conditionally for type checking)

## Usage Notes

### Timezone Handling
The `set` method includes intelligent timezone handling:
- Converts current time to UTC for consistent calculations
- Strips timezone info from current time if the provided expiration datetime is timezone-naive
- Ensures accurate expiration calculations regardless of timezone configuration

### Connection Management
- Uses Redis connection pooling
- No explicit connection closing required
- Connection lifecycle managed by the Redis client

### Performance Considerations
- The `clear()` method can be slow on large databases as it iterates through all keys
- Consider using Redis's `FLUSHDB` command for faster database clearing if appropriate for your use case

## Example Usage

```python
import redis
from pip._vendor.cachecontrol.caches import RedisCache

# Create Redis connection
redis_conn = redis.Redis(host='localhost', port=6379, db=0)

# Initialize cache
cache = RedisCache(redis_conn)

# Store data
cache.set('my_key', b'my_value')

# Retrieve data
value = cache.get('my_key')

# Store with expiration (60 seconds)
cache.set('temp_key', b'temp_value', expires=60)
```