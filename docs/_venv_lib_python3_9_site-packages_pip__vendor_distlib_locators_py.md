<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Locator Module Documentation

This module provides functionality for locating Python distributions from various sources including PyPI, local directories, and custom indexes. It implements multiple locator classes that can find, download, and manage Python package distributions.

## Purpose

The module serves as a comprehensive package discovery and location system that can:
- Search for Python packages across multiple sources
- Parse package metadata and version information
- Handle different package formats (wheels, source distributions)
- Resolve dependencies between packages
- Cache results for improved performance

## Key Classes

### `Locator` (Base Class)

The abstract base class for all locators that defines the common interface and functionality.

**Key Features:**
- Version scheme handling
- URL scoring and preference logic
- Digest validation support
- Wheel compatibility checking

**Important Methods:**
```python
def locate(self, requirement, prereleases=False)
def get_project(self, name)
def score_url(self, url)
def convert_url_to_download_info(self, url, project_name)
```

### `SimpleScrapingLocator`

Scrapes HTML pages to locate package downloads, similar to pip's functionality.

**Features:**
- Multi-threaded I/O for performance
- HTML page parsing and link extraction
- Configurable worker threads
- Content encoding support (gzip, deflate)

**Usage:**
```python
locator = SimpleScrapingLocator('https://pypi.org/simple/', timeout=3.0, num_workers=10)
distribution = locator.locate('requests >= 2.0')
```

### `PyPIRPCLocator`

Uses XML-RPC to communicate with PyPI for package information.

**Limitations:**
- Cannot work with simple mirrors
- Requires full PyPI-compatible XML-RPC interface

**Usage:**
```python
locator = PyPIRPCLocator('https://pypi.org/pypi')
names = locator.get_distribution_names()
```

### `PyPIJSONLocator`

Uses PyPI's JSON API for package discovery (limited functionality).

**Note:** This locator has very limited functionality and may not be suitable for most use cases.

### `DirectoryLocator`

Searches local directory trees for package distributions.

**Features:**
- Recursive directory scanning
- Support for various archive formats
- File URL generation

**Usage:**
```python
locator = DirectoryLocator('/path/to/packages', recursive=True)
project_info = locator.get_project('mypackage')
```

### `AggregatingLocator`

Combines multiple locators to search across different sources.

**Features:**
- Chain multiple locators
- Merge or first-match strategies
- Automatic cache management

**Usage:**
```python
locator = AggregatingLocator(
    DirectoryLocator('/local/packages'),
    SimpleScrapingLocator('https://pypi.org/simple/'),
    merge=False
)
```

### `DependencyFinder`

Resolves package dependencies using a specified locator.

**Key Methods:**
```python
def find(self, requirement, meta_extras=None, prereleases=False)
def find_providers(self, reqt)
def add_distribution(self, dist)
```

## Utility Classes

### `Page`

Represents a scraped HTML page with link extraction capabilities.

**Features:**
- Base URL handling
- Link extraction with regex
- URL cleaning and normalization

### `RedirectHandler`

Custom HTTP redirect handler to work around bugs in some Python versions.

## Important Functions

### `get_all_distribution_names(url=None)`

Returns all distribution names known by a package index.

```python
# Get all package names from PyPI
names = get_all_distribution_names()
```

## Configuration and Constants

```python
DEFAULT_INDEX = 'https://pypi.org/pypi'  # Default PyPI index
HASHER_HASH = re.compile(r'^(\w+)=([a-f0-9]+)')  # Hash pattern matching
```

## Usage Examples

### Basic Package Location

```python
from distlib.locators import default_locator

# Find a specific package
dist = default_locator.locate('requests >= 2.20.0')
if dist:
    print(f"Found: {dist.name} {dist.version}")
    print(f"Download URL: {dist.source_url}")
```

### Custom Locator Setup

```python
from distlib.locators import SimpleScrapingLocator, DirectoryLocator, AggregatingLocator

# Create a custom aggregating locator
locator = AggregatingLocator(
    DirectoryLocator('/home/user/packages'),
    SimpleScrapingLocator('https://pypi.org/simple/'),
    merge=False
)

# Use it to find packages
dist = locator.locate('numpy')
```

### Dependency Resolution

```python
from distlib.locators import DependencyFinder, default_locator

finder = DependencyFinder(default_locator)
dists, problems = finder.find('Django >= 3.0', prereleases=False)

print(f"Found {len(dists)} distributions")
for problem in problems:
    print(f"Problem: {problem}")
```

## Notes and Suggestions

### Performance Considerations
- Use caching when possible - most locators implement internal caching
- For `SimpleScrapingLocator`, adjust `num_workers` based on your needs
- Consider using `AggregatingLocator` with local sources first for better performance

### Error Handling
- Always check for `None` return values from `locate()` calls
- Use `get_errors()` and `clear_errors()` methods to handle locator errors
- The `DependencyFinder.find()` method returns problems as part of its result

### Security Notes
- Be cautious with untrusted package sources
- Verify digests when available
- Consider using HTTPS-only sources in production

### Version Schemes
- Use `'legacy'` scheme for compatibility with existing PyPI packages
- Default scheme follows PEP recommendations but may not work with all packages

### Threading
- `SimpleScrapingLocator` uses threading internally - ensure thread safety in your application
- Multiple locator instances can be used concurrently, but individual instances may not be thread-safe