<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Manifest Module Documentation

## Overview

This module provides the `Manifest` class, which represents a list of files in a distribution. It serves as an improved equivalent to `distutils.filelist`, fixing various problems found in the original implementation.

The primary purpose is to build and manage file lists by exploring the filesystem and applying various inclusion/exclusion patterns, commonly used for creating source distributions in Python packaging.

## Key Features

- **File Discovery**: Recursively finds all files under a base directory
- **Pattern Matching**: Supports Unix-style wildcard patterns for including/excluding files
- **Manifest Directives**: Processes `MANIFEST.in`-style directives for fine-grained control
- **Cross-Platform**: Handles platform-specific path separators and special characters

## Classes

### `Manifest`

A list of files built by exploring the filesystem and filtered by applying various patterns.

#### Constructor

```python
def __init__(self, base=None):
```

**Parameters:**
- `base` (str, optional): The base directory to explore under. Defaults to current working directory.

**Attributes:**
- `base`: Absolute path to the base directory
- `prefix`: Base directory with trailing separator
- `allfiles`: List of all discovered files (populated by `findall()`)
- `files`: Set of files matching the current filters

## Public Methods

### File Discovery

#### `findall()`
```python
def findall(self):
```
Recursively discovers all files under the base directory and populates the `allfiles` attribute with absolute pathnames.

- Uses efficient stack-based traversal
- Follows regular files and directories
- Ignores symbolic links to directories to prevent infinite loops

### File Management

#### `add(item)`
```python
def add(self, item):
```
Adds a single file to the manifest.

**Parameters:**
- `item` (str): Pathname to add (can be relative to base directory)

#### `add_many(items)`
```python
def add_many(self, items):
```
Adds multiple files to the manifest.

**Parameters:**
- `items` (iterable): Collection of pathnames to add

#### `clear()`
```python
def clear(self):
```
Removes all collected files from the manifest.

### File Retrieval

#### `sorted(wantdirs=False)`
```python
def sorted(self, wantdirs=False):
```
Returns files in sorted directory order.

**Parameters:**
- `wantdirs` (bool): If True, includes parent directories in the result

**Returns:**
- List of sorted file paths

### Pattern Processing

#### `process_directive(directive)`
```python
def process_directive(self, directive):
```
Processes a `MANIFEST.in`-style directive to include or exclude files.

**Parameters:**
- `directive` (str): Directive string (e.g., "include *.py", "exclude tests/*")

**Supported Directives:**
- `include <pattern>...`: Include files matching patterns
- `exclude <pattern>...`: Exclude files matching patterns  
- `global-include <pattern>...`: Include files anywhere in the tree
- `global-exclude <pattern>...`: Exclude files anywhere in the tree
- `recursive-include <dir> <pattern>...`: Include files in directory tree
- `recursive-exclude <dir> <pattern>...`: Exclude files in directory tree
- `graft <dir>`: Include entire directory tree
- `prune <dir>`: Exclude entire directory tree

## Usage Examples

### Basic Usage
```python
from distlib.manifest import Manifest

# Create manifest for current directory
manifest = Manifest()

# Discover all files
manifest.findall()

# Add specific files
manifest.add("setup.py")
manifest.add_many(["README.md", "LICENSE"])

# Get sorted file list
files = manifest.sorted()
```

### Using Directives
```python
manifest = Manifest("/path/to/project")

# Process MANIFEST.in-style directives
manifest.process_directive("include *.py")
manifest.process_directive("exclude tests/*")
manifest.process_directive("recursive-include docs *.rst")
manifest.process_directive("prune build")

# Get final file list
files = manifest.sorted()
```

## Important Notes

### Pattern Matching Behavior
- Patterns use Unix-style wildcards (`*`, `?`)
- `*` and `?` do **not** match path separators (unlike standard `fnmatch`)
- This prevents `*.py` from matching `subdir/file.py` when anchored
- Platform-specific path handling is automatically applied

### Performance Considerations
- File discovery (`findall()`) is performed lazily when needed
- Uses efficient stack-based directory traversal
- File sets use Python's optimized `set` data structure

### Cross-Platform Compatibility
- Handles different path separators across platforms
- Properly escapes regex patterns for Windows paths
- Version-specific handling for Python 2.7, 3.2+ differences

## Module Constants

- `_COLLAPSE_PATTERN`: Regex for collapsing line continuations
- `_COMMENTED_LINE`: Regex for handling commented lines  
- `_PYTHON_VERSION`: Python version tuple for compatibility handling

## Dependencies

- `fnmatch`: For basic glob pattern translation
- `os`, `sys`: For filesystem and platform operations
- `re`: For regular expression processing
- `logging`: For debug and warning messages

## Error Handling

The module raises `DistlibException` for:
- Invalid directive syntax
- Unknown directive actions
- Missing required parameters in directives

Warnings are logged for:
- Patterns that match no files
- Directory operations that find no matches