<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# ScriptMaker Module Documentation

## Overview

The `ScriptMaker` module is part of the `distlib` package and provides functionality for creating and copying Python scripts from source scripts or callable specifications. It handles platform-specific requirements such as shebang lines, Windows executable launchers, and proper file permissions.

## Purpose

This module is primarily used by Python packaging tools to:
- Generate executable scripts from entry point specifications
- Copy and adjust existing Python scripts 
- Handle cross-platform script execution requirements
- Create Windows executable launchers when needed

## Key Components

### Constants and Templates

#### `_DEFAULT_MANIFEST`
```python
_DEFAULT_MANIFEST = '''<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
...
</assembly>'''
```
Default Windows manifest template for executable launchers.

#### `SCRIPT_TEMPLATE`
```python
SCRIPT_TEMPLATE = r'''# -*- coding: utf-8 -*-
import re
import sys
from %(module)s import %(import_name)s
if __name__ == '__main__':
    sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])
    sys.exit(%(func)s())
'''
```
Template for generating Python scripts from entry point specifications.

#### `FIRST_LINE_RE`
Regular expression to detect Python shebang lines in existing scripts.

### Utility Functions

#### `enquote_executable(executable)`
```python
def enquote_executable(executable):
    if ' ' in executable:
        # Handle paths with spaces, especially for /usr/bin/env usage
        ...
    return executable
```
- **Purpose**: Properly quotes executable paths containing spaces
- **Returns**: Quoted executable path string
- **Note**: Handles special cases like `/usr/bin/env` prefixes

### Main Class: ScriptMaker

```python
class ScriptMaker(object):
    """
    A class to copy or create scripts from source scripts or callable
    specifications.
    """
```

#### Constructor Parameters
- `source_dir`: Directory containing source scripts
- `target_dir`: Directory where generated scripts will be written
- `add_launchers`: Whether to add Windows executable launchers (default: True)
- `dry_run`: If True, don't actually write files (default: False)  
- `fileop`: Custom FileOperator instance (optional)

#### Key Attributes
- `executable`: Custom Python executable for shebang lines
- `variants`: Set of script name variants to generate (e.g., `script`, `script3`, `script3.9`)
- `force`: Force overwrite existing files
- `clobber`: Allow overwriting existing files
- `set_mode`: Whether to set executable permissions (POSIX only)

#### Important Methods

##### `make(specification, options=None)`
```python
def make(self, specification, options=None):
    """
    Make a script.
    
    :param specification: Export entry specification or filename
    :param options: Dictionary of options controlling script generation
    :return: List of all absolute pathnames written
    """
```
- **Purpose**: Main method to create a single script
- **Parameters**:
  - `specification`: Either an entry point spec (e.g., `"pkg:module.func"`) or source filename
  - `options`: Dictionary with keys like `gui`, `interpreter_args`
- **Returns**: List of created file paths

##### `make_multiple(specifications, options=None)`
```python
def make_multiple(self, specifications, options=None):
    """
    Take a list of specifications and make scripts from them.
    
    :param specifications: List of specifications
    :return: List of all absolute pathnames written
    """
```
- **Purpose**: Create multiple scripts in one call
- **Returns**: Combined list of all created file paths

##### `_get_shebang(encoding, post_interp=b'', options=None)`
- **Purpose**: Generate appropriate shebang line for the target platform
- **Features**:
  - Handles length limitations on different platforms
  - Uses complex shell scripting for long shebangs
  - Ensures UTF-8 compatibility
  - Platform-specific executable detection

##### `_write_script(names, shebang, script_bytes, filenames, ext)`
- **Purpose**: Write script files to disk
- **Features**:
  - Creates Windows `.exe` launchers when needed
  - Handles file replacement for in-use executables
  - Sets proper file permissions on POSIX systems

## Platform-Specific Features

### Windows Support
- **Executable Launchers**: Creates `.exe` wrappers for Python scripts
- **GUI Support**: Uses `pythonw.exe` for GUI applications
- **Manifest Generation**: Includes Windows manifests for executables
- **File Replacement**: Handles replacing executables that are currently in use

### POSIX Support  
- **Shebang Optimization**: Creates efficient shebang lines within length limits
- **Complex Shebangs**: Uses `/bin/sh` wrapper for long or complex executable paths
- **File Permissions**: Sets executable bits automatically

### Cross-Platform Compatibility
- **Jython Support**: Special handling for Jython executables
- **Virtual Environment Detection**: Proper executable paths in venvs
- **Encoding Handling**: Ensures scripts work with various text encodings

## Usage Examples

### Basic Script Creation
```python
from distlib.scripts import ScriptMaker

# Create a script maker
sm = ScriptMaker('/src', '/dest')

# Create script from entry point
files = sm.make('mypackage:main.run_app')

# Create GUI script
files = sm.make('mypackage:gui.main', {'gui': True})
```

### Copying Existing Scripts
```python
# Copy and adjust existing script
files = sm.make('my_script.py')
```

### Batch Creation
```python
specs = [
    'mypackage:cli.main',
    'mypackage:gui.app',
    'existing_script.py'
]
all_files = sm.make_multiple(specs)
```

## Notes and Considerations

### Performance Optimization
- Pre-loads all Windows launcher executables into memory to avoid issues during package updates
- Addresses