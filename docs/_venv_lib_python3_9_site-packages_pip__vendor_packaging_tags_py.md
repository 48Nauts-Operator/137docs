<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Python Packaging Tags Module

This module provides functionality for generating and parsing platform tags used in Python package distribution (wheels). It determines compatibility tags that indicate which Python interpreter versions, ABIs, and platforms a package can run on.

## Purpose

The primary purpose of this module is to:
- Generate appropriate tags for wheel files based on the current Python environment
- Parse existing tags to determine package compatibility
- Support multiple Python implementations (CPython, PyPy, etc.)
- Handle platform-specific considerations (Linux, macOS, Windows, iOS, Android)

## Key Classes

### `Tag`

Represents a wheel tag triple consisting of interpreter, ABI, and platform components.

```python
class Tag:
    def __init__(self, interpreter: str, abi: str, platform: str) -> None:
        # Creates a tag with normalized lowercase components
```

**Key Features:**
- **Immutable and hashable** - Can be used in sets and as dictionary keys
- **Performance optimized** - Pre-computes hash values for faster set operations
- **String representation** - Format: `interpreter-abi-platform`

**Properties:**
- `interpreter`: Python interpreter (e.g., "cp39", "pp38")
- `abi`: Application Binary Interface (e.g., "cp39m", "abi3", "none")
- `platform`: Target platform (e.g., "linux_x86_64", "win_amd64")

## Important Functions

### Tag Generation Functions

#### `sys_tags(*, warn: bool = False) -> Iterator[Tag]`
**Primary function** that returns all compatible tags for the current Python interpreter in priority order.

```python
# Get all tags for current system
tags = list(sys_tags())
```

#### `cpython_tags(python_version, abis, platforms, *, warn: bool = False) -> Iterator[Tag]`
Generates tags specifically for CPython interpreters, including:
- Standard CPython tags (`cp39-cp39-linux_x86_64`)
- ABI3 stable ABI tags for compatible versions
- Generic "none" ABI tags

#### `generic_tags(interpreter, abis, platforms, *, warn: bool = False) -> Iterator[Tag]`
Generates tags for non-CPython interpreters (PyPy, Jython, etc.).

#### `compatible_tags(python_version, interpreter, platforms) -> Iterator[Tag]`
Generates backward-compatible tags using the `py*` interpreter prefix.

### Platform Detection Functions

#### `platform_tags() -> Iterator[str]`
Auto-detects the current platform and returns appropriate platform tags.

#### Platform-Specific Functions:
- `mac_platforms(version, arch) -> Iterator[str]` - macOS platform tags
- `ios_platforms(version, multiarch) -> Iterator[str]` - iOS platform tags  
- `android_platforms(api_level, abi) -> Iterator[str]` - Android platform tags
- `_linux_platforms(is_32bit) -> Iterator[str]` - Linux platform tags (includes manylinux/musllinux)

### Utility Functions

#### `parse_tag(tag: str) -> frozenset[Tag]`
Parses compressed tag strings into Tag objects.

```python
# Parse a compressed tag
tags = parse_tag("cp39.cp310-none-linux_x86_64.win_amd64")
# Returns multiple Tag objects for all combinations
```

#### `interpreter_name() -> str`
Returns the current interpreter's short name (`cp`, `pp`, `py`, etc.).

#### `interpreter_version(*, warn: bool = False) -> str`
Returns the current interpreter's version string (e.g., `39`, `310`).

## Constants and Type Definitions

```python
# Type aliases
PythonVersion = Sequence[int]  # e.g., (3, 9, 1)
AppleVersion = Tuple[int, int]  # e.g., (10, 15)

# Interpreter short names mapping
INTERPRETER_SHORT_NAMES = {
    "python": "py",
    "cpython": "cp", 
    "pypy": "pp",
    "ironpython": "ip",
    "jython": "jy",
}
```

## Usage Examples

```python
# Get all compatible tags for current system
for tag in sys_tags():
    print(tag)
# Output: cp39-cp39-linux_x86_64, cp39-abi3-linux_x86_64, etc.

# Parse a wheel filename tag
wheel_tag = "cp39-cp39-win_amd64"
parsed_tags = parse_tag(wheel_tag)

# Generate tags for specific Python version
cpython_312_tags = list(cpython_tags(python_version=(3, 12)))

# Check current interpreter
print(f"Running {interpreter_name()} {interpreter_version()}")
```

## Notes and Considerations

### Performance Optimizations
- **Pre-computed hashes** in Tag class for faster set operations
- **Cached platform detection** to avoid repeated system calls
- **Generator-based functions** for memory efficiency with large tag sets

### Platform-Specific Behavior
- **macOS**: Handles version compatibility and universal binaries
- **Linux**: Integrates with manylinux and musllinux compatibility
- **Mobile platforms**: Supports iOS and Android with appropriate API level handling
- **Windows**: Detects debug builds and architecture variants

### Threading Support
- **Python 3.13+**: Detects `--disable-gil` builds and applies threading flags
- **ABI3 incompatibility**: Threaded builds don't support stable ABI

### Warnings
Use `warn=True` parameter to enable debug logging for missing configuration variables that might affect tag generation accuracy.

## Dependencies

- **Internal modules**: `_manylinux`, `_musllinux` for Linux compatibility
- **Standard library**: `platform`, `sysconfig`, `sys`, `subprocess`
- **External**: None (part of packaging ecosystem)

This module is essential for Python package managers and build tools to determine package compatibility across different environments.