<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Package Utils Module

This module provides utilities for handling Python package names, versions, and distribution filenames. It supports parsing and validation of wheel files (`.whl`) and source distribution (sdist) files according to Python packaging standards.

## Purpose

The module serves as a core component for Python packaging tools, providing:
- Name canonicalization and validation
- Version canonicalization 
- Wheel filename parsing and validation (PEP 427)
- Source distribution filename parsing and validation
- Build tag handling

## Type Definitions

```python
BuildTag = Union[Tuple[()], Tuple[int, str]]
NormalizedName = NewType("NormalizedName", str)
```

- **`BuildTag`**: Represents optional build information in wheel filenames
- **`NormalizedName`**: Type-safe wrapper for canonicalized package names

## Exception Classes

### `InvalidName`
Raised when a distribution name doesn't conform to packaging standards.

### `InvalidWheelFilename` 
Raised when a wheel filename violates PEP 427 specifications.

### `InvalidSdistFilename`
Raised when a source distribution filename is malformed.

## Key Functions

### `canonicalize_name(name: str, *, validate: bool = False) -> NormalizedName`

Converts package names to their canonical form following PEP 503.

**Parameters:**
- `name`: The package name to canonicalize
- `validate`: Whether to validate the name format (default: False)

**Returns:** Normalized package name (lowercase, hyphens replace dots/underscores)

**Example:**
```python
canonicalize_name("My_Package.Name")  # Returns: "my-package-name"
```

### `is_normalized_name(name: str) -> bool`

Checks if a package name is already in normalized form.

### `canonicalize_version(version: Version | str, *, strip_trailing_zero: bool = True) -> str`

Returns the canonical string representation of a version following PEP 625.

**Parameters:**
- `version`: Version object or string to canonicalize
- `strip_trailing_zero`: Whether to remove trailing zeros (default: True)

**Examples:**
```python
canonicalize_version('1.0.0')  # Returns: '1'
canonicalize_version('1.0.0', strip_trailing_zero=False)  # Returns: '1.0.0'
```

### `parse_wheel_filename(filename: str) -> tuple[NormalizedName, Version, BuildTag, frozenset[Tag]]`

Parses a wheel filename according to PEP 427 specifications.

**Parameters:**
- `filename`: The wheel filename to parse

**Returns:** Tuple containing:
1. Canonicalized package name
2. Version object
3. Build tag (empty tuple if no build number)
4. Set of compatibility tags

**Raises:** `InvalidWheelFilename` for malformed filenames

**Example:**
```python
name, version, build, tags = parse_wheel_filename("package-1.0-py3-none-any.whl")
```

### `parse_sdist_filename(filename: str) -> tuple[NormalizedName, Version]`

Parses source distribution filenames (`.tar.gz` or `.zip`).

**Parameters:**
- `filename`: The sdist filename to parse

**Returns:** Tuple of (canonicalized name, version)

**Raises:** `InvalidSdistFilename` for invalid filenames

## Internal Components

### Regular Expressions

- `_validate_regex`: Validates package name format
- `_canonicalize_regex`: Matches characters to replace during canonicalization  
- `_normalized_regex`: Validates normalized name format
- `_build_tag_regex`: Parses build numbers in wheel filenames

## Usage Notes

⚠️ **Important Considerations:**

- **Legacy Versions**: Invalid versions are returned unaltered by `canonicalize_version`
- **Wheel Validation**: Strict validation according to PEP 427 - project names cannot contain `__` or invalid characters
- **Build Tags**: Must start with a digit as per PEP 427
- **Sdist Parsing**: Requires PEP 440 compliant versions (no dashes allowed)

## Dependencies

This module depends on:
- `.tags` - For parsing compatibility tags
- `.version` - For version handling and validation

## Standards Compliance

- **PEP 427**: Wheel filename format
- **PEP 503**: Package name normalization  
- **PEP 625**: Version canonicalization
- **PEP 440**: Version identification and dependency specification