<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.auth Module Documentation

## Overview

The `requests.auth` module provides authentication handlers for the Python Requests library. This module implements various HTTP authentication schemes that can be attached to HTTP requests to handle server authentication challenges.

## Purpose

This module enables automatic handling of different authentication methods when making HTTP requests, including:
- HTTP Basic Authentication
- HTTP Proxy Authentication  
- HTTP Digest Authentication

## Constants

```python
CONTENT_TYPE_FORM_URLENCODED = "application/x-www-form-urlencoded"
CONTENT_TYPE_MULTI_PART = "multipart/form-data"
```

Standard content type constants used for form submissions.

## Utility Functions

### `_basic_auth_str(username, password)`

**Purpose**: Generates a Basic Authentication header string.

**Parameters**:
- `username`: Username for authentication
- `password`: Password for authentication

**Returns**: Base64-encoded Basic Auth string

**Notes**:
- ⚠️ **Deprecation Warning**: Non-string usernames and passwords will be deprecated in Requests 3.0.0
- Automatically converts inputs to appropriate string/bytes format
- Uses Latin-1 encoding for compatibility

## Classes

### `AuthBase`

**Purpose**: Abstract base class for all authentication implementations.

**Key Methods**:
- `__call__(self, r)`: Must be implemented by subclasses to modify the request object

**Usage**: 
```python
class CustomAuth(AuthBase):
    def __call__(self, r):
        # Modify request r here
        return r
```

### `HTTPBasicAuth(AuthBase)`

**Purpose**: Implements HTTP Basic Authentication (RFC 7617).

**Constructor**:
```python
HTTPBasicAuth(username, password)
```

**Key Features**:
- Adds `Authorization` header with Basic auth credentials
- Supports equality comparison between instances
- Thread-safe

**Example Usage**:
```python
auth = HTTPBasicAuth('user', 'password')
response = requests.get('https://api.example.com', auth=auth)
```

### `HTTPProxyAuth(HTTPBasicAuth)`

**Purpose**: Implements HTTP Proxy Authentication using Basic Auth.

**Key Differences from HTTPBasicAuth**:
- Uses `Proxy-Authorization` header instead of `Authorization`
- Otherwise identical to Basic Auth

**Example Usage**:
```python
proxy_auth = HTTPProxyAuth('proxy_user', 'proxy_pass')
```

### `HTTPDigestAuth(AuthBase)`

**Purpose**: Implements HTTP Digest Authentication (RFC 7616) with advanced security features.

**Constructor**:
```python
HTTPDigestAuth(username, password)
```

**Key Features**:
- **Thread-safe**: Uses `threading.local()` for per-thread state management
- **Stateful**: Maintains nonce counts and challenge information
- **Multiple algorithms**: Supports MD5, MD5-SESS, SHA, SHA-256, SHA-512
- **Quality of Protection (QoP)**: Handles 'auth' QoP
- **Automatic retry**: Handles 401 challenges automatically

#### Important Methods

**`init_per_thread_state()`**
- Initializes thread-local storage for authentication state
- Called automatically when needed

**`build_digest_header(method, url)`**
- Constructs the digest authentication header
- Supports multiple hashing algorithms
- Handles nonce counting and client nonce generation

**`handle_401(r, **kwargs)`**
- Processes 401 Unauthorized responses
- Automatically retries with proper authentication
- Limits retry attempts to prevent infinite loops

**`handle_redirect(r, **kwargs)`**
- Resets authentication state on redirects
- Prevents authentication issues across redirects

## Important Notes and Suggestions

### Security Considerations

- **Basic Auth**: Credentials are only base64-encoded (not encrypted). Always use HTTPS in production
- **Digest Auth**: More secure than Basic Auth but still vulnerable without HTTPS
- **Password Storage**: Never hardcode credentials in source code

### Best Practices

1. **Use Environment Variables**:
   ```python
   import os
   auth = HTTPBasicAuth(
       os.environ.get('API_USERNAME'),
       os.environ.get('API_PASSWORD')
   )
   ```

2. **Error Handling**:
   ```python
   try:
       response = requests.get(url, auth=auth)
       response.raise_for_status()
   except requests.exceptions.HTTPError as e:
       print(f"Authentication failed: {e}")
   ```

3. **Session Reuse**: Use sessions for multiple requests to the same server:
   ```python
   session = requests.Session()
   session.auth = HTTPDigestAuth('user', 'pass')
   ```

### Threading Considerations

- `HTTPDigestAuth` is thread-safe due to `threading.local()` usage
- Each thread maintains separate authentication state
- Safe to share auth objects across threads

### Limitations

- **Digest Auth**: `auth-int` QoP is not fully implemented (marked with XXX comments)
- **Algorithm Support**: Some digest algorithms may not be supported on all systems
- **Retry Logic**: Limited to 2 attempts to prevent infinite authentication loops

### Migration Notes

- **Requests 3.0.0**: Non-string usernames/passwords will no longer be supported
- Update code to ensure credentials are strings or bytes objects