<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.cookies

## Overview

This module provides compatibility code that enables the use of Python's `http.cookiejar.CookieJar` with the requests library. It bridges the gap between the standard library's cookie handling and requests' interface, allowing seamless cookie management across HTTP requests.

## Purpose

- **Cookie Compatibility**: Adapts `http.cookiejar.CookieJar` to work with requests
- **Interface Translation**: Provides wrapper classes to mimic urllib2 interfaces expected by cookiejar
- **Enhanced Cookie Management**: Offers a dict-like interface for easier cookie manipulation
- **Cross-domain Support**: Handles cookies across multiple domains and paths

## Important Classes

### MockRequest

```python
class MockRequest:
    """Wraps a `requests.Request` to mimic a `urllib2.Request`."""
```

**Purpose**: Adapts a requests.Request object to the interface expected by `http.cookiejar.CookieJar`.

**Key Methods**:
- `get_type()`: Returns the URL scheme (http/https)
- `get_host()`: Returns the netloc from the URL
- `get_full_url()`: Returns the complete URL, handling Host header overrides
- `add_unredirected_header()`: Adds headers that won't be redirected
- `get_new_headers()`: Retrieves newly added headers

### MockResponse

```python
class MockResponse:
    """Wraps a `httplib.HTTPMessage` to mimic a `urllib.addinfourl`."""
```

**Purpose**: Exposes HTTP headers from server responses in the format expected by `http.cookiejar`.

**Key Methods**:
- `info()`: Returns the headers object
- `getheaders()`: Gets headers by name

### RequestsCookieJar

```python
class RequestsCookieJar(cookielib.CookieJar, MutableMapping):
    """Compatibility class; is a http.cookiejar.CookieJar, but exposes a dict interface."""
```

**Purpose**: The main cookie jar used by requests, combining standard CookieJar functionality with dict-like operations.

**Key Features**:
- **Dict Interface**: Supports `[]`, `get()`, `set()`, `keys()`, `values()`, `items()`
- **Domain/Path Support**: Methods accept optional domain and path parameters
- **Pickleable**: Unlike standard CookieJar, can be serialized
- **Multi-domain**: Handles cookies across multiple domains

**Important Methods**:
- `get(name, default=None, domain=None, path=None)`: Get cookie value with optional domain/path
- `set(name, value, **kwargs)`: Set cookie with optional parameters
- `get_dict(domain=None, path=None)`: Get plain dict of cookies for specific domain/path
- `list_domains()`: List all domains in the jar
- `list_paths()`: List all paths in the jar

## Important Functions

### extract_cookies_to_jar()

```python
def extract_cookies_to_jar(jar, request, response):
    """Extract the cookies from the response into a CookieJar."""
```

Extracts cookies from an HTTP response and adds them to a CookieJar.

### get_cookie_header()

```python
def get_cookie_header(jar, request):
    """Produce an appropriate Cookie header string to be sent with `request`, or None."""
```

Generates the Cookie header string for outgoing requests.

### create_cookie()

```python
def create_cookie(name, value, **kwargs):
    """Make a cookie from underspecified parameters."""
```

Creates a cookie object from basic parameters, filling in defaults for unspecified attributes.

### cookiejar_from_dict()

```python
def cookiejar_from_dict(cookie_dict, cookiejar=None, overwrite=True):
    """Returns a CookieJar from a key/value dictionary."""
```

Converts a dictionary to a CookieJar object.

### merge_cookies()

```python
def merge_cookies(cookiejar, cookies):
    """Add cookies to cookiejar and returns a merged CookieJar."""
```

Merges cookies from various sources into an existing CookieJar.

## Usage Examples

```python
# Create a cookie jar
jar = RequestsCookieJar()

# Set a cookie
jar.set('session_id', 'abc123', domain='example.com', path='/')

# Get a cookie
value = jar.get('session_id', domain='example.com')

# Use dict-like interface
jar['user'] = 'john_doe'
print(jar['user'])

# Get all cookies as dict
cookies_dict = jar.get_dict()

# Create from dictionary
jar = cookiejar_from_dict({'key': 'value'})
```

## Performance Notes

⚠️ **Warning**: Dictionary operations that are normally O(1) may be O(n) due to the underlying CookieJar implementation that stores cookies in a list structure.

## Exception Classes

### CookieConflictError

```python
class CookieConflictError(RuntimeError):
    """There are two cookies that meet the criteria specified in the cookie jar."""
```

Raised when multiple cookies match the same criteria and disambiguation is required.

## Important Notes

- **Import Sensitivity**: Be careful with imports as `requests.utils` imports from this module
- **Thread Safety**: Uses threading locks for safe concurrent access
- **Compatibility**: Maintains compatibility with external CookieJar instances like `LWPCookieJar` and `FileCookieJar`
- **Default Behavior**: Creates "supercookies" by default (domain='' and path='/') that are sent with every request

## Dependencies

- `calendar`: For date/time handling
- `copy`: For object copying
- `time`: For timestamp operations
- `threading`: For thread safety (falls back to `dummy_threading` if unavailable)