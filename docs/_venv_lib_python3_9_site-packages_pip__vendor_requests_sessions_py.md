<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.sessions

## Overview

The `requests.sessions` module provides a `Session` object that enables persistent settings and state management across multiple HTTP requests. This is the core functionality that allows you to maintain cookies, authentication, proxies, and other configuration settings throughout a series of HTTP requests.

## Purpose

This module serves to:
- **Persist cookies** across requests automatically
- **Maintain connection pooling** for improved performance
- **Share configuration** (headers, auth, proxies) across multiple requests
- **Handle redirects** intelligently with proper state management
- **Provide a clean API** for making HTTP requests with consistent settings

## Key Classes

### `Session`

The main class that provides persistent HTTP session functionality.

```python
import requests

# Basic usage
s = requests.Session()
s.get('https://httpbin.org/get')

# Context manager usage
with requests.Session() as s:
    s.get('https://httpbin.org/get')
```

#### Key Attributes

- **`headers`**: Default headers sent with each request
- **`cookies`**: Cookie jar for automatic cookie persistence
- **`auth`**: Default authentication credentials
- **`proxies`**: Proxy configuration dictionary
- **`verify`**: SSL certificate verification setting (default: `True`)
- **`cert`**: SSL client certificate
- **`stream`**: Whether to stream response content
- **`trust_env`**: Whether to trust environment variables for configuration
- **`max_redirects`**: Maximum number of redirects to follow (default: 30)

#### HTTP Methods

The Session class provides convenience methods for all common HTTP verbs:

```python
session.get(url, **kwargs)
session.post(url, data=None, json=None, **kwargs)
session.put(url, data=None, **kwargs)
session.patch(url, data=None, **kwargs)
session.delete(url, **kwargs)
session.head(url, **kwargs)
session.options(url, **kwargs)
```

### `SessionRedirectMixin`

A mixin class that handles HTTP redirect logic, providing sophisticated redirect handling capabilities.

#### Key Methods

- **`resolve_redirects()`**: Handles the redirect chain and manages state
- **`should_strip_auth()`**: Determines when to remove authentication headers during redirects
- **`rebuild_auth()`**: Manages authentication during redirects
- **`rebuild_proxies()`**: Updates proxy configuration during redirects

## Important Functions

### `merge_setting(request_setting, session_setting, dict_class=OrderedDict)`

Intelligently merges request-specific settings with session defaults.

```python
# Session has default headers, request adds specific ones
merged_headers = merge_setting(request_headers, session_headers)
```

### `merge_hooks(request_hooks, session_hooks, dict_class=OrderedDict)`

Properly combines request and session event hooks.

## Usage Examples

### Basic Session Usage

```python
import requests

# Create a session
session = requests.Session()

# Set default headers
session.headers.update({'User-Agent': 'My App 1.0'})

# Make requests - headers persist
response1 = session.get('https://api.example.com/data')
response2 = session.post('https://api.example.com/submit', json={'key': 'value'})
```

### Authentication and Cookies

```python
# Set authentication
session.auth = ('username', 'password')

# Login (cookies automatically stored)
session.post('https://example.com/login', data={'user': 'me', 'pass': 'secret'})

# Subsequent requests automatically include cookies
session.get('https://example.com/protected-resource')
```

### Proxy Configuration

```python
session.proxies = {
    'http': 'http://proxy.example.com:8080',
    'https': 'https://proxy.example.com:8080',
}
```

## Important Notes and Suggestions

### Security Considerations

⚠️ **SSL Verification**: The default `verify=True` should be maintained in production. Only set to `False` for testing:

```python
# Don't do this in production!
session.verify = False  # Makes you vulnerable to MITM attacks
```

### Performance Tips

- **Reuse Sessions**: Always reuse `Session` objects instead of creating new ones for each request
- **Connection Pooling**: Sessions automatically handle connection pooling for better performance
- **Context Manager**: Use sessions as context managers to ensure proper cleanup:

```python
with requests.Session() as session:
    # Make requests
    response = session.get('https://example.com')
# Session automatically closed
```

### Environment Integration

The session respects environment variables when `trust_env=True` (default):

- `HTTP_PROXY`, `HTTPS_PROXY`: Proxy settings
- `NO_PROXY`: Hosts to bypass proxy
- `REQUESTS_CA_BUNDLE`, `CURL_CA_BUNDLE`: Custom CA certificate bundles

### Redirect Handling

- **Automatic**: Redirects are followed automatically by default
- **Intelligent**: Authentication headers are stripped when redirecting to different hosts
- **Configurable**: Set `allow_redirects=False` to disable
- **Limited**: Maximum redirects controlled by `max_redirects` attribute

### Error Handling

The module raises several specific exceptions:
- `TooManyRedirects`: When redirect limit is exceeded
- `InvalidSchema`: When no adapter is found for the URL scheme
- `ChunkedEncodingError`, `ContentDecodingError`: During redirect processing

### Deprecation Notice

The standalone `session()` function is deprecated. Use `Session()` class directly:

```python
# Deprecated
s = requests.sessions.session()

# Preferred
s = requests.Session()
```

## Best Practices

1. **Always use context managers** when possible
2. **Set reasonable timeouts** to prevent hanging requests
3. **Configure appropriate retry strategies** for production use
4. **Monitor redirect chains** to avoid infinite loops
5. **Use sessions for multiple requests** to the same host/API
6. **Keep SSL verification enabled** in production environments