<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.utils Documentation

## Overview

The `requests.utils` module provides utility functions that are used internally within the Requests library and are also made available for external consumption. This module contains a comprehensive collection of helper functions for URL manipulation, proxy handling, encoding detection, file operations, header parsing, and various other HTTP-related utilities.

## Purpose

This module serves as the core utility library for the Requests package, providing:
- URL parsing and manipulation utilities
- Proxy configuration and bypass logic
- Encoding detection and content handling
- Header parsing and validation
- File and network operations
- Authentication helpers

## Constants

### File and Network Constants
- `NETRC_FILES`: Tuple containing netrc file names (`".netrc"`, `"_netrc"`)
- `DEFAULT_CA_BUNDLE_PATH`: Path to default CA certificate bundle
- `DEFAULT_PORTS`: Dictionary mapping protocols to default ports (`{"http": 80, "https": 443}`)
- `DEFAULT_ACCEPT_ENCODING`: Default accept-encoding header value
- `UNRESERVED_SET`: Set of unreserved URI characters per RFC 3986

## Key Functions

### URL and URI Utilities

#### `requote_uri(uri)`
Re-quotes a given URI to ensure it is fully and consistently quoted.

```python
# Example usage
clean_uri = requote_uri("https://example.com/path with spaces")
```

#### `unquote_unreserved(uri)`
Un-escapes percent-escape sequences for unreserved characters only.

#### `prepend_scheme_if_needed(url, new_scheme)`
Adds a scheme to a URL if one is not present.

```python
# Example usage
full_url = prepend_scheme_if_needed("example.com", "https")
# Returns: "https://example.com"
```

#### `urldefragauth(url)`
Removes fragment and authentication parts from a URL.

### Proxy Handling

#### `should_bypass_proxies(url, no_proxy)`
Determines whether proxies should be bypassed for a given URL.

**Parameters:**
- `url`: The target URL
- `no_proxy`: Comma-separated list of hosts to bypass

**Returns:** `bool`

#### `get_environ_proxies(url, no_proxy=None)`
Returns a dictionary of environment-based proxy configurations.

#### `select_proxy(url, proxies)`
Selects the appropriate proxy for a given URL from available proxies.

#### `resolve_proxies(request, proxies, trust_env=True)`
Resolves proxy configuration considering environment settings and NO_PROXY rules.

### Authentication

#### `get_netrc_auth(url, raise_errors=False)`
Extracts authentication credentials from `.netrc` files.

**Parameters:**
- `url`: URL to get authentication for
- `raise_errors`: Whether to raise exceptions on parsing errors

**Returns:** Tuple of `(username, password)` or `None`

#### `get_auth_from_url(url)`
Extracts username and password from URL authentication components.

### Content and Encoding

#### `get_encoding_from_headers(headers)`
Determines character encoding from HTTP headers.

**Parameters:**
- `headers`: Dictionary of HTTP headers

**Returns:** Encoding string or `None`

#### `guess_json_utf(data)`
Attempts to detect UTF encoding of JSON data by analyzing byte patterns.

#### `stream_decode_response_unicode(iterator, r)`
Generator that decodes response content incrementally.

### File Operations

#### `super_len(o)`
Attempts to determine the length of various object types (strings, files, etc.).

**Key Features:**
- Handles strings, file objects, and objects with `__len__` method
- Uses `fstat` for file objects when possible
- Warns about text mode files (deprecated)
- Returns remaining length from current position

#### `guess_filename(obj)`
Attempts to guess filename from an object's `name` attribute.

#### `extract_zipped_paths(path)`
Extracts files from ZIP archives when path references archive members.

#### `atomic_open(filename)`
Context manager for atomic file writing operations.

```python
# Example usage
with atomic_open('output.txt') as f:
    f.write(b'content')
# File is atomically moved to final location
```

### Data Structure Utilities

#### `from_key_val_list(value)`
Converts various input types to `OrderedDict`.

**Parameters:**
- `value`: List of tuples, dictionary, or other iterable

**Returns:** `OrderedDict` or `None`

**Raises:** `ValueError` for invalid input types

#### `to_key_val_list(value)`
Converts dictionary-like objects to list of tuples.

#### `dict_to_sequence(d)`
Converts dictionary to items sequence for internal use.

### Header Processing

#### `parse_list_header(value)`
Parses comma-separated lists from headers, handling quoted strings properly.

```python
# Example
result = parse_list_header('token, "quoted value"')
# Returns: ['token', 'quoted value']
```

#### `parse_dict_header(value)`
Parses key-value pairs from headers into a dictionary.

#### `parse_header_links(value)`
Parses HTTP Link headers into list of dictionaries.

#### `check_header_validity(header)`
Validates header names and values for illegal characters.

### Network Utilities

#### `address_in_network(ip, net)`
Checks if an IP address belongs to a network subnet.

**Parameters:**
- `ip`: IP address string
- `net`: Network in CIDR notation (e.g., "192.168.1.0/24")

**Returns:** `bool`

#### `is_ipv4_address(string_ip)`
Validates if a string is a valid IPv4 address.

#### `is_valid_cidr(string_network)`
Validates CIDR notation format.

### Cookie Utilities

#### `dict_from_cookiejar(cj)`
Converts `CookieJar` object to dictionary.

#### `add_dict_to_cookiejar(cj, cookie_dict)`
Adds dictionary of cookies to a `CookieJar`.

### Default Configurations

#### `default_user_agent(name="python-requests")`
Returns default User-Agent string.

#### `default