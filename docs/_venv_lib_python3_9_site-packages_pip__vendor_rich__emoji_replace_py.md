<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Emoji Text Replacement Module

## Overview

This module provides functionality to replace emoji codes in text strings with their actual emoji characters. It processes emoji codes in the format `:emoji_name:` or `:emoji_name-variant:` and converts them to Unicode emoji characters with optional text or emoji presentation variants.

## Purpose

- Convert textual emoji codes (e.g., `:smile:`, `:heart-emoji:`) to actual emoji Unicode characters
- Support emoji presentation variants (text vs emoji style)
- Handle unknown emoji codes gracefully by leaving them unchanged

## Dependencies

- `typing`: For type hints and annotations
- `re`: For regular expression pattern matching
- `._emoji_codes.EMOJI`: Internal module containing emoji name-to-Unicode mappings

## Type Definitions

```python
_ReStringMatch = Match[str]  # regex match object
_ReSubCallable = Callable[[_ReStringMatch], str]  # Callable invoked by re.sub
_EmojiSubMethod = Callable[[_ReSubCallable, str], str]  # Sub method of a compiled re
```

These type aliases improve code readability and provide clear documentation for the function signatures used in regex substitution operations.

## Functions

### `_emoji_replace(text, default_variant=None, _emoji_sub=...)`

**Purpose**: Replaces emoji codes in text with actual emoji characters.

**Parameters**:
- `text` (str): The input text containing emoji codes to replace
- `default_variant` (Optional[str]): Default presentation variant ('text' or 'emoji')
- `_emoji_sub` (_EmojiSubMethod): Compiled regex substitution method (default provided)

**Returns**: 
- `str`: Text with emoji codes replaced by actual emoji characters

**Regex Pattern**: `r"(:(\S*?)(?:(?:\-)(emoji|text))?:)"`
- Matches patterns like `:smile:`, `:heart-emoji:`, `:thumbs_up-text:`
- Captures the full code, emoji name, and optional variant

**Behavior**:
- Converts emoji names to lowercase for lookup
- Applies Unicode variation selectors:
  - `\uFE0E` for text presentation
  - `\uFE0F` for emoji presentation
- Falls back to original code if emoji name is not found

## Internal Implementation Details

### Emoji Variants
```python
variants = {"text": "\uFE0E", "emoji": "\uFE0F"}
```
- **Text variant** (`\uFE0E`): Forces text-style presentation
- **Emoji variant** (`\uFE0F`): Forces colorful emoji presentation

### Error Handling
The function uses a try-catch approach to handle unknown emoji codes:
- **Success**: Returns emoji + variant selector
- **KeyError**: Returns original emoji code unchanged

## Usage Examples

```python
# Basic emoji replacement
result = _emoji_replace("Hello :smile: world!")
# Output: "Hello üòä world!"

# With emoji variant
result = _emoji_replace("I :heart-emoji: Python!")
# Output: "I ‚ù§Ô∏è Python!" (colorful heart)

# With text variant
result = _emoji_replace("Check this :check_mark-text:")
# Output: "Check this ‚úì" (text-style checkmark)

# Unknown emoji (unchanged)
result = _emoji_replace("Unknown :fake_emoji: code")
# Output: "Unknown :fake_emoji: code"
```

## Notes and Suggestions

### Security Considerations
- The function safely handles malformed input by returning original codes for unknown emojis
- No risk of code injection as it only performs character substitution

### Performance Considerations
- Pre-compiled regex pattern for efficient matching
- Direct dictionary lookups using `__getitem__` for better performance
- Consider caching for high-frequency usage

### Potential Improvements
- Add validation for `default_variant` parameter
- Consider case-insensitive matching documentation
- Add logging for debugging unknown emoji codes
- Consider supporting custom emoji dictionaries

### Dependencies
- Requires `EMOJI` dictionary from `._emoji_codes` module
- Ensure emoji database is comprehensive and up-to-date