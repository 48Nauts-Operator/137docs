<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Ratio Distribution Module

## Overview

This module provides utilities for distributing space or resources across multiple elements based on ratios, size constraints, and minimum/maximum requirements. It's particularly useful for layout systems where you need to divide available space (like screen width/height) among multiple components while respecting their size constraints.

## Key Components

### Edge Protocol

```python
class Edge(Protocol):
    """Any object that defines an edge (such as Layout)."""
    
    size: Optional[int] = None
    ratio: int = 1
    minimum_size: int = 1
```

Defines the interface for objects that can be used in ratio distribution:
- `size`: Fixed size (if specified, overrides ratio-based calculation)
- `ratio`: Relative proportion for flexible sizing
- `minimum_size`: Minimum allowed size

## Main Functions

### `ratio_resolve(total: int, edges: Sequence[Edge]) -> List[int]`

**Purpose**: Divides total space among edges while satisfying size, ratio, and minimum size constraints.

**Parameters**:
- `total`: Total available space/characters
- `edges`: Sequence of Edge objects to distribute space among

**Returns**: List of integers representing allocated space for each edge

**Key Features**:
- Handles fixed sizes first
- Distributes remaining space proportionally based on ratios
- Ensures minimum size requirements are met
- Handles rounding errors in distribution
- May return totals exceeding input if constraints cannot be satisfied

**Algorithm**:
1. Process fixed-size edges first
2. Calculate remaining flexible space
3. Distribute space proportionally among flexible edges
4. Adjust for minimum size constraints
5. Handle fractional remainders

### `ratio_reduce(total: int, ratios: List[int], maximums: List[int], values: List[int]) -> List[int]`

**Purpose**: Reduces values proportionally based on ratios while respecting maximum limits.

**Parameters**:
- `total`: Target total to achieve
- `ratios`: Proportional reduction ratios
- `maximums`: Maximum allowed values for each element
- `values`: Current values to be reduced

**Returns**: List of reduced values that sum to the target total

### `ratio_distribute(total: int, ratios: List[int], minimums: Optional[List[int]] = None) -> List[int]`

**Purpose**: Distributes a total amount across elements based on ratios with optional minimums.

**Parameters**:
- `total`: Total amount to distribute
- `ratios`: Distribution ratios for each element
- `minimums`: Optional minimum values for each element

**Returns**: List of distributed values guaranteed to sum to total

## Usage Examples

```python
from dataclasses import dataclass

@dataclass
class Edge:
    size: Optional[int] = None
    ratio: int = 1
    minimum_size: int = 1

# Distribute 100 units among 3 equal-ratio edges
edges = [Edge(None, 1, 1), Edge(None, 1, 1), Edge(None, 1, 1)]
result = ratio_resolve(100, edges)
# Result: [33, 33, 34] (adds up to 100)

# Mix of fixed and flexible sizing
edges = [Edge(size=20), Edge(None, 2, 5), Edge(None, 1, 5)]
result = ratio_resolve(100, edges)
# Result: [20, 53, 27] (20 fixed, remaining 80 split 2:1)
```

## Implementation Notes

### Performance Optimizations
- Uses `Fraction` for precise arithmetic to avoid floating-point errors
- Optimizes list operations with local variable assignments (`append = result.append`)
- Handles edge cases efficiently (zero ratios, impossible constraints)

### Error Handling
- Returns minimum sizes when total space is insufficient
- Gracefully handles zero ratios
- Asserts positive ratio sums where required

## Use Cases

This module is ideal for:
- **Terminal UI layouts**: Distributing console width/height among panels
- **Web layouts**: CSS-like flexible box sizing
- **Resource allocation**: Distributing limited resources proportionally
- **Grid systems**: Dynamic column/row sizing

## Notes and Suggestions

‚ö†Ô∏è **Important Considerations**:
- The returned list may sum to more than `total` if minimum size constraints cannot be satisfied
- Always check if constraints are realistic for the given total
- Consider UI clipping or scrolling when constraints exceed available space

üí° **Best Practices**:
- Use meaningful minimum sizes to prevent unusable layouts
- Test edge cases with very small totals
- Consider caching results for frequently-used ratio combinations

üîß **Potential Improvements**:
- Add maximum size constraints to `Edge` protocol
- Include validation for negative values
- Add comprehensive error messages for constraint violations