<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Windows Console Features Detection Module

## Overview

This Python module provides functionality to detect and report Windows console capabilities, specifically focusing on Virtual Terminal (VT) sequence support and truecolor support. It's designed to work with the Rich library ecosystem and helps determine what terminal features are available on Windows systems.

## Purpose

- **Console Capability Detection**: Determines if the Windows console supports modern terminal features
- **Cross-Platform Compatibility**: Gracefully handles non-Windows platforms with fallback behavior
- **Rich Library Integration**: Works as part of the Rich text formatting library ecosystem

## Classes

### `WindowsConsoleFeatures`

A dataclass that represents the available Windows console features.

```python
@dataclass
class WindowsConsoleFeatures:
    vt: bool = False          # VT sequence support
    truecolor: bool = False   # 24-bit color support
```

**Attributes:**
- `vt`: Boolean indicating if the console supports Virtual Terminal (VT) escape sequences
- `truecolor`: Boolean indicating if the console supports 24-bit (true) color

## Functions

### `get_windows_console_features()`

The main function that detects Windows console capabilities.

```python
def get_windows_console_features() -> WindowsConsoleFeatures
```

**Returns:** `WindowsConsoleFeatures` instance with detected capabilities

**Behavior:**
- **On Windows**: Queries the console mode using Windows API calls
- **On Non-Windows**: Returns default `WindowsConsoleFeatures()` with all features disabled

**Detection Logic:**
1. Gets handle to standard output console
2. Retrieves current console mode flags
3. Checks for `ENABLE_VIRTUAL_TERMINAL_PROCESSING` flag
4. If VT is supported, determines truecolor support based on Windows version:
   - Windows 11+ (major > 10): Truecolor supported
   - Windows 10 build 15063+: Truecolor supported
   - Earlier versions: No truecolor support

## Dependencies

### Required Imports
- `sys`: Platform detection and Windows version information
- `dataclasses`: For the `WindowsConsoleFeatures` dataclass

### Conditional Imports (Windows Only)
- `ctypes`: Windows API access
- `pip._vendor.rich._win32_console`: Windows console API wrappers

## Error Handling

The module uses a try-except pattern to handle import failures gracefully:

- **Success Case**: Full Windows API functionality available
- **Fallback Case**: Returns basic `WindowsConsoleFeatures()` with disabled features

**Handled Exceptions:**
- `AttributeError`: Missing ctypes attributes
- `ImportError`: Missing dependencies or non-Windows platform
- `ValueError`: Invalid library loading
- `LegacyWindowsError`: Console API call failures

## Usage Example

```python
# Get console features
features = get_windows_console_features()

# Check capabilities
if features.vt:
    print("VT sequences supported")
if features.truecolor:
    print("Truecolor supported")
```

## Notes and Suggestions

### Platform Compatibility
- ✅ **Safe for all platforms**: Non-Windows systems get fallback behavior
- ✅ **No crashes**: Graceful error handling for missing dependencies

### Windows Version Requirements
- **VT Support**: Windows 10+ with console updates
- **Truecolor Support**: Windows 10 build 15063+ (Creators Update)

### Integration Notes
- Part of the Rich library's Windows support infrastructure
- Uses vendored Rich components (`pip._vendor.rich`)
- Designed for terminal/console applications that need feature detection

### Potential Improvements
- Consider caching results to avoid repeated API calls
- Add logging for debugging console detection issues
- Extend detection for additional Windows console features

## Command Line Usage

The module can be run directly for testing:

```bash
python windows_console_features.py
```

This will output the current platform and detected console features.