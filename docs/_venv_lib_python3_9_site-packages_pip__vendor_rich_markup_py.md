<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Console Markup Parser

This module provides functionality for parsing and rendering console markup in Rich, a Python library for creating rich text and beautiful formatting in the terminal. The markup system allows users to apply styling (colors, bold, italic, etc.) to text using a bracket-based syntax similar to BBCode.

## Purpose

The module enables:
- Parsing markup strings with style tags (e.g., `[red]Hello[/red]`)
- Converting markup into styled `Text` objects
- Handling nested and overlapping styles
- Supporting emoji rendering within markup
- Escaping markup characters when needed

## Key Components

### Classes

#### `Tag`
A `NamedTuple` representing a markup tag.

```python
class Tag(NamedTuple):
    name: str           # Tag name (e.g., 'bold', 'red')
    parameters: Optional[str]  # Additional parameters
```

**Properties:**
- `markup`: Returns the string representation of the tag in markup format

**Example:**
```python
tag = Tag("red", None)
print(tag.markup)  # "[red]"

tag_with_params = Tag("link", "https://example.com")
print(tag_with_params.markup)  # "[link=https://example.com]"
```

### Functions

#### `escape(markup: str) -> str`
Escapes markup text so it won't be interpreted as tags.

```python
escaped = escape("[red]This will show as literal text[/red]")
# Result: "\\[red]This will show as literal text\\[/red]"
```

**Use case:** When you need to display literal square brackets in your output.

#### `render(markup: str, style: Union[str, Style] = "", emoji: bool = True, emoji_variant: Optional[EmojiVariant] = None) -> Text`
The main function that converts markup strings into styled `Text` objects.

**Parameters:**
- `markup`: String containing console markup
- `style`: Base style to apply
- `emoji`: Whether to render emoji codes (default: True)
- `emoji_variant`: Emoji variant preference

**Returns:** A `Text` instance with applied styling

**Example:**
```python
text = render("[bold red]Warning![/bold red] This is important.")
```

#### `_parse(markup: str) -> Iterable[Tuple[int, Optional[str], Optional[Tag]]]`
Internal parser that breaks markup into components.

**Returns:** Tuples of `(position, text, tag)` where:
- `position`: Character position in the original string
- `text`: Plain text content (if any)
- `tag`: Parsed tag object (if any)

## Regular Expressions

### `RE_TAGS`
```python
RE_TAGS = re.compile(r"""((\\*)\[([a-z#/@][^[]*?)])""", re.VERBOSE)
```
Matches markup tags while handling escaping with backslashes.

### `RE_HANDLER`
```python
RE_HANDLER = re.compile(r"^([\w.]*?)(\(.*?\))?$")
```
Matches handler patterns for special tags (like click handlers).

## Key Features

### Nested and Overlapping Tags
The parser handles complex tag structures:
```python
"[bold]Bold [italic]bold and italic[/bold] just italic[/italic]"
```

### Tag Types

1. **Style tags**: `[red]`, `[bold]`, `[italic]`
2. **Closing tags**: `[/red]`, `[/bold]`, `[/]` (implicit close)
3. **Parameterized tags**: `[link=https://example.com]`
4. **Handler tags**: `[@click.method()]` for interactive elements

### Error Handling
Raises `MarkupError` for:
- Mismatched closing tags
- Syntax errors in tag parameters
- Invalid tag structures

## Usage Notes

### Performance Considerations
- The parser is optimized for common cases (e.g., strings without `[` characters)
- Uses local variable assignments for frequently accessed functions
- Employs efficient span sorting and text building

### Escaping
- Use `\\[` to display literal square brackets
- The `escape()` function automatically handles proper escaping
- Backslashes themselves can be escaped with `\\\\`

### Best Practices
- Always close tags explicitly when possible: `[red]text[/red]` vs `[red]text[/]`
- Use the `escape()` function for user-generated content
- Handle `MarkupError` exceptions when processing untrusted markup

## Example Usage

```python
from rich.markup import render

# Basic styling
text = render("[bold red]ERROR:[/bold red] Something went wrong!")

# With emoji
text = render(":warning: [yellow]Caution![/yellow]", emoji=True)

# Nested styles
text = render("[bold]Bold [italic]and italic[/italic] text[/bold]")

# Links
text = render("Visit [link=https://github.com]GitHub[/link]")
```

The module integrates seamlessly with Rich's console output system, providing a user-friendly way to add styling to terminal applications.