<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Rich Measurement Module

## Overview

The `measure.py` module provides functionality for measuring the width requirements of renderable objects in the Rich library. It calculates the minimum and maximum character widths needed to properly display content in a console, which is essential for layout and formatting decisions.

## Purpose

This module enables Rich to:
- Determine how much horizontal space renderable objects require
- Support responsive layouts by providing width ranges
- Optimize rendering by understanding content dimensions before display
- Handle width constraints and clamping for different display scenarios

## Classes

### `Measurement`

A `NamedTuple` that stores width measurement information for renderable objects.

#### Attributes

- **`minimum`** (`int`): Minimum number of cells required to render the object
- **`maximum`** (`int`): Maximum number of cells required to render the object

#### Properties

- **`span`** (`int`): Returns the difference between maximum and minimum widths

#### Methods

##### `normalize() -> Measurement`
Ensures the measurement values are valid by guaranteeing:
- `minimum <= maximum`
- `minimum >= 0`

```python
measurement = Measurement(10, 5)  # Invalid: min > max
normalized = measurement.normalize()  # Returns valid measurement
```

##### `with_maximum(width: int) -> Measurement`
Creates a new measurement with both minimum and maximum values capped at the specified width.

```python
measurement = Measurement(5, 20)
capped = measurement.with_maximum(15)  # Returns Measurement(5, 15)
```

##### `with_minimum(width: int) -> Measurement`
Creates a new measurement with both minimum and maximum values raised to at least the specified width.

```python
measurement = Measurement(5, 20)
raised = measurement.with_minimum(10)  # Returns Measurement(10, 20)
```

##### `clamp(min_width: Optional[int] = None, max_width: Optional[int] = None) -> Measurement`
Constrains the measurement within the specified range by applying both minimum and maximum constraints.

```python
measurement = Measurement(5, 25)
clamped = measurement.clamp(min_width=8, max_width=20)  # Returns Measurement(8, 20)
```

##### `get(console: Console, options: ConsoleOptions, renderable: RenderableType) -> Measurement`
**Class method** that calculates the measurement for any renderable object.

**Parameters:**
- `console`: Console instance for rendering context
- `options`: Console options including width constraints
- `renderable`: Object to measure

**Behavior:**
- Returns `Measurement(0, 0)` if max width is less than 1
- Handles string objects by converting them through console rendering
- Checks for `__rich_measure__` method on renderable objects
- Falls back to `Measurement(0, max_width)` for basic renderables
- Raises `NotRenderableError` for non-renderable objects

## Functions

### `measure_renderables(console, options, renderables) -> Measurement`

Calculates a measurement that would accommodate multiple renderable objects.

**Parameters:**
- `console`: Console instance
- `options`: Console options
- `renderables`: Sequence of renderable objects to measure

**Returns:**
- `Measurement` with minimum set to the largest minimum among all objects
- Maximum set to the largest maximum among all objects
- `Measurement(0, 0)` if the sequence is empty

**Example Use Case:**
```python
# Measuring multiple objects to find layout requirements
objects = [table, text, panel]
combined = measure_renderables(console, options, objects)
# Use combined.minimum for guaranteed fit, combined.maximum for optimal display
```

## Key Dependencies

- **`operator.itemgetter`**: Used for efficient extraction of minimum/maximum values
- **`typing`**: Provides type hints for better code documentation
- **`.errors`**: Custom error types for rendering failures
- **`.protocol`**: Rendering protocol functions (`is_renderable`, `rich_cast`)

## Usage Notes

### When to Use Measurements
- **Layout Planning**: Before rendering complex layouts with multiple components
- **Responsive Design**: When content needs to adapt to different terminal widths
- **Width Constraints**: When implementing containers with size limits

### Performance Considerations
- Measurements are calculated on-demand and not cached
- For frequently measured objects, consider caching results when appropriate
- The `get()` method may trigger partial rendering for accurate measurements

### Error Handling
- Always handle `NotRenderableError` when measuring unknown object types
- Validate that console options have reasonable width values
- Consider edge cases like zero-width constraints

## Integration with Rich

This module is fundamental to Rich's layout system and is used internally by:
- Table rendering for column width calculation
- Panel and container sizing
- Text wrapping and alignment
- Progress bar and status display sizing