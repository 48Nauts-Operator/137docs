<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Style Module Documentation

## Overview

This module provides a comprehensive system for defining and managing terminal text styles in the Rich library. It handles colors, text attributes (bold, italic, underline, etc.), links, and metadata for terminal output formatting.

## Purpose

- **Terminal Styling**: Create and combine text styles for rich terminal output
- **ANSI Code Generation**: Convert styles to ANSI escape sequences for terminal rendering
- **HTML/CSS Generation**: Convert terminal styles to CSS for web output
- **Style Parsing**: Parse human-readable style definitions into Style objects
- **Performance Optimization**: Efficient style combination and caching mechanisms

## Key Classes

### `Style`

The main class representing a terminal style with colors, background colors, and text attributes.

#### Constructor Parameters

```python
Style(
    color=None,           # Foreground color (Color or str)
    bgcolor=None,         # Background color (Color or str)
    bold=None,           # Bold text (bool or None)
    dim=None,            # Dim text (bool or None)
    italic=None,         # Italic text (bool or None)
    underline=None,      # Underlined text (bool or None)
    blink=None,          # Blinking text (bool or None)
    blink2=None,         # Fast blinking text (bool or None)
    reverse=None,        # Reverse colors (bool or None)
    conceal=None,        # Concealed text (bool or None)
    strike=None,         # Strikethrough text (bool or None)
    underline2=None,     # Double underline (bool or None)
    frame=None,          # Framed text (bool or None)
    encircle=None,       # Encircled text (bool or None)
    overline=None,       # Overlined text (bool or None)
    link=None,           # Link URL (str)
    meta=None            # Metadata dictionary
)
```

#### Key Methods

##### Class Methods

- **`Style.null()`**: Creates a null style (no formatting) - more performant than `Style()`
- **`Style.parse(style_definition)`**: Parses a string style definition into a Style object
- **`Style.normalize(style)`**: Normalizes style definitions for consistent representation
- **`Style.combine(styles)`**: Combines multiple styles into one
- **`Style.chain(*styles)`**: Combines styles from positional arguments

##### Instance Methods

- **`render(text, color_system, legacy_windows)`**: Renders text with ANSI codes
- **`get_html_style(theme)`**: Generates CSS style rules
- **`copy()`**: Creates a copy of the style
- **`test(text)`**: Outputs styled text directly to terminal for testing

##### Properties

- **`color`**: Foreground color
- **`bgcolor`**: Background color
- **`link`**: Link URL if set
- **`meta`**: Metadata dictionary
- **`transparent_background`**: Whether background is transparent
- **`without_color`**: Copy of style with colors removed

#### Usage Examples

```python
# Create a basic style
style = Style(color="red", bold=True)

# Parse from string
style = Style.parse("bold red on blue")

# Combine styles
combined = Style.chain(
    Style(bold=True),
    Style(color="red"),
    Style(bgcolor="blue")
)

# Render with ANSI codes
rendered = style.render("Hello World")

# Generate CSS
css = style.get_html_style()
```

### `StyleStack`

A stack-based container for managing nested styles, useful for hierarchical styling.

#### Methods

- **`current`**: Property returning the current (top) style
- **`push(style)`**: Adds a new style layer
- **`pop()`**: Removes the top style layer

```python
stack = StyleStack(Style.null())
stack.push(Style(bold=True))
stack.push(Style(color="red"))
current_style = stack.current  # Bold + red
stack.pop()  # Remove red, keep bold
```

### `_Bit`

Internal descriptor class for managing style attribute bits efficiently.

## Important Features

### Style Parsing

The module supports parsing human-readable style definitions:

```python
# Supported syntax examples
Style.parse("bold red")
Style.parse("italic blue on yellow")  
Style.parse("underline")
Style.parse("not bold")
Style.parse("link https://example.com")
```

### Attribute Mapping

```python
STYLE_ATTRIBUTES = {
    "bold": "bold", "b": "bold",
    "italic": "italic", "i": "italic", 
    "underline": "underline", "u": "underline",
    "dim": "dim", "d": "dim",
    # ... more mappings
}
```

### Performance Optimizations

- **LRU Caching**: Methods like `parse()`, `normalize()`, and `_add()` use `@lru_cache`
- **Bit Manipulation**: Efficient attribute storage using bitwise operations
- **Lazy Evaluation**: ANSI codes and style definitions generated on demand
- **NULL_STYLE**: Singleton null style instance for better performance

## Type Definitions

```python
StyleType = Union[str, "Style"]  # Styles can be strings or Style instances
```

## Notes and Best Practices

### Performance Considerations

- Use `Style.null()` instead of `Style()` for empty styles
- Style objects are designed to be immutable - operations return new instances
- Extensive caching is used, so repeated operations on the same styles are efficient

### Style Combination

- Styles combine left-to-right: `style1 + style2` applies style2 over style1
- Later styles override earlier ones for conflicting attributes
- Colors and links from the rightmost style take precedence

### Color Systems

The module supports different color systems:
- **TRUECOLOR**: Full 24-bit color support
- **256**: 256-color palette
- **STANDARD**: 16 standard colors
- **LEGACY**: Basic 8 colors

### Error Handling

- Raises `errors.StyleSyntaxError` for invalid style definitions
- Handles color parsing errors gracefully
- Validates style attribute names

### Meta Information

Styles