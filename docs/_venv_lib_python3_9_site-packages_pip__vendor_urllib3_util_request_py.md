<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# HTTP Request Utilities Module

This module provides utility functions and constants for handling HTTP request headers and request body positioning. It's part of a larger HTTP client library (likely urllib3) and focuses on common HTTP request preparation tasks.

## Purpose

The module serves two main purposes:
1. **Header Generation**: Provides convenient shortcuts for creating common HTTP headers
2. **Request Body Management**: Handles file-like object positioning for request retries and redirects

## Constants

### Header Control Constants

```python
SKIP_HEADER = "@@@SKIP_HEADER@@@"
SKIPPABLE_HEADERS = frozenset(["accept-encoding", "host", "user-agent"])
```

- `SKIP_HEADER`: Special marker value to skip automatic emission of certain HTTP headers
- `SKIPPABLE_HEADERS`: Set of headers that can be skipped (Accept-Encoding, Host, User-Agent)

### Default Values

```python
ACCEPT_ENCODING = "gzip,deflate"
```

- Default accept-encoding header value supporting common compression formats

## Functions

### `make_headers(**kwargs)`

**Purpose**: Creates a dictionary of HTTP headers based on provided parameters.

**Parameters**:
- `keep_alive` (bool): Adds 'connection: keep-alive' header
- `accept_encoding` (bool/list/string): Sets accept-encoding header
  - `True` → uses default "gzip,deflate"
  - List → joins with commas
  - String → uses as-is
- `user_agent` (string): Sets user-agent header
- `basic_auth` (string): Username:password for basic authentication
- `proxy_basic_auth` (string): Username:password for proxy authentication
- `disable_cache` (bool): Adds 'cache-control: no-cache' header

**Returns**: Dictionary of HTTP headers

**Example**:
```python
headers = make_headers(
    keep_alive=True, 
    user_agent="MyApp/1.0",
    accept_encoding=True
)
# Returns: {'connection': 'keep-alive', 'user-agent': 'MyApp/1.0', 'accept-encoding': 'gzip,deflate'}
```

### `set_file_position(body, pos)`

**Purpose**: Manages file-like object positioning, either setting a specific position or recording current position.

**Parameters**:
- `body`: File-like object
- `pos`: Target position (integer) or None to record current position

**Returns**: Current or target position

**Behavior**:
- If `pos` provided: Rewinds body to that position
- If `pos` is None: Attempts to record current position via `tell()`

### `rewind_body(body, body_pos)`

**Purpose**: Rewinds a file-like object to a specified position, primarily for handling redirects and retries.

**Parameters**:
- `body`: File-like object with `seek` method
- `body_pos`: Integer position to seek to

**Raises**:
- `UnrewindableBodyError`: When seeking fails or position recording failed
- `ValueError`: When body_pos is not an integer type

## Key Features

### Authentication Support
- Handles Basic HTTP authentication with automatic Base64 encoding
- Supports both direct and proxy authentication
- Uses UTF-8 encoding for credential strings

### Error Handling
- Graceful handling of file positioning errors
- Custom exception types for body rewinding failures
- Validates parameter types before operations

### Compatibility
- Uses `six` library for Python 2/3 compatibility
- Handles various input types for accept_encoding parameter
- Supports both file objects and file-like objects

## Usage Notes

### Important Considerations

- **Authentication Security**: Basic auth credentials are Base64 encoded (not encrypted)
- **File Object Requirements**: Body rewinding requires objects with `seek` and `tell` methods
- **Error Recovery**: Failed `tell()` operations are tracked for better error reporting

### Best Practices

- Use `make_headers()` instead of manually building header dictionaries
- Handle `UnrewindableBodyError` when implementing retry logic
- Consider using `SKIP_HEADER` constant when you need to bypass automatic header addition

### Typical Usage Pattern

```python
# Create headers for a request
headers = make_headers(
    user_agent="MyApp/2.0",
    accept_encoding=["gzip", "br"],
    basic_auth="username:password"
)

# Handle file positioning for retries
pos = set_file_position(request_body, None)  # Record position
# ... attempt request ...
# On failure/redirect:
rewind_body(request_body, pos)  # Reset for retry
```