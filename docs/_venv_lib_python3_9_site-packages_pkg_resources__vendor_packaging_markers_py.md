<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Markers Module Documentation

This module implements PEP 508 environment markers for Python packaging. It provides functionality to parse, evaluate, and format dependency markers that specify conditional installation requirements based on the runtime environment.

## Purpose

Environment markers allow Python packages to specify conditional dependencies that only apply under certain conditions, such as specific Python versions, operating systems, or platforms. For example: `requests[security]; python_version<"2.7"`

## Classes

### Exception Classes

#### `InvalidMarker`
- **Inherits from**: `ValueError`
- **Purpose**: Raised when an invalid marker string is encountered
- **Note**: Users should refer to PEP 508 for proper marker syntax

#### `UndefinedComparison`
- **Inherits from**: `ValueError` 
- **Purpose**: Raised when an invalid operation is attempted on incompatible values

#### `UndefinedEnvironmentName`
- **Inherits from**: `ValueError`
- **Purpose**: Raised when attempting to use an environment variable name that doesn't exist

### Node Classes

#### `Node`
Base class for marker AST nodes.

**Methods:**
- `__init__(value)`: Initialize with a value
- `serialize()`: Abstract method to serialize the node back to string format

#### `Variable`
- **Inherits from**: `Node`
- **Purpose**: Represents environment variable names in markers
- **Method**: `serialize()` returns the variable name as string

#### `Value` 
- **Inherits from**: `Node`
- **Purpose**: Represents literal values in markers
- **Method**: `serialize()` returns the value wrapped in quotes

#### `Op`
- **Inherits from**: `Node` 
- **Purpose**: Represents comparison operators in markers
- **Method**: `serialize()` returns the operator as string

### Main Class

#### `Marker`

The primary class for working with environment markers.

**Constructor:**
```python
Marker(marker: str)
```
- **Parameters**: `marker` - A PEP 508 marker string
- **Raises**: `InvalidMarker` if the marker string is invalid

**Methods:**

##### `evaluate(environment=None)`
```python
def evaluate(self, environment=None):
    # type: (Optional[Dict[str, str]]) -> bool
```
- **Purpose**: Evaluate the marker against the current or specified environment
- **Parameters**: 
  - `environment` (optional) - Dictionary to override environment variables
- **Returns**: `bool` - True if the marker condition is satisfied
- **Note**: If no environment is provided, uses the current Python process environment

##### `__str__()`
Returns the string representation of the marker

##### `__repr__()`
Returns a detailed representation for debugging

## Key Functions

### `default_environment()`
```python
def default_environment():
    # type: () -> Dict[str, str]
```
- **Purpose**: Generate the default environment dictionary from the current Python process
- **Returns**: Dictionary containing all standard environment variables
- **Environment Variables Included**:
  - `implementation_name`, `implementation_version`
  - `os_name`, `platform_machine`, `platform_release`
  - `platform_system`, `platform_version` 
  - `python_full_version`, `python_version`
  - `platform_python_implementation`, `sys_platform`

### Internal Functions

#### `_evaluate_markers(markers, environment)`
- **Purpose**: Core evaluation logic for parsed marker expressions
- **Handles**: Boolean logic (and/or), comparisons, environment variable lookup

#### `_eval_op(lhs, op, rhs)`
- **Purpose**: Evaluate individual comparison operations
- **Supports**: Version specifiers and standard comparison operators
- **Operators**: `in`, `not in`, `<`, `<=`, `==`, `!=`, `>=`, `>`, `===`, `~=`

## Supported Environment Variables

The module recognizes these environment marker variables:

- `implementation_version` - Python implementation version
- `platform_python_implementation` - Python implementation name  
- `implementation_name` - Implementation name
- `python_full_version` - Full Python version string
- `platform_release`, `platform_version`, `platform_machine`, `platform_system` - Platform info
- `python_version` - Major.minor Python version
- `sys_platform` - System platform identifier
- `os_name` - Operating system name
- `extra` - Package extra name (PEP 508)

### Legacy Aliases
The module supports legacy variable names for backwards compatibility:
- `os.name` → `os_name`
- `sys.platform` → `sys_platform` 
- `platform.version` → `platform_version`
- `platform.machine` → `platform_machine`
- `platform.python_implementation` → `platform_python_implementation`
- `python_implementation` → `platform_python_implementation`

## Usage Examples

```python
from packaging.markers import Marker, default_environment

# Create a marker
marker = Marker("python_version >= '3.6'")

# Evaluate against current environment
if marker.evaluate():
    print("Python 3.6+ detected")

# Evaluate with custom environment
custom_env = {"python_version": "2.7"}
if not marker.evaluate(custom_env):
    print("Would not install on Python 2.7")

# Get current environment
env = default_environment()
print(f"Current Python version: {env['python_version']}")
```

## Notes and Suggestions

- **Performance**: Marker parsing happens once during initialization; evaluation is fast
- **Caching**: Consider caching `Marker` instances for frequently used marker strings
- **Error Handling**: Always handle `InvalidMarker` exceptions when parsing user input
- **Testing**: Use custom environment dictionaries to test marker behavior across different platforms
- **Compatibility**: This implementation follows PEP 508 specifications for maximum compatibility