<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Python Package Markers Module

This module implements parsing and evaluation of environment markers for Python packages, as defined in PEP 508. Environment markers allow packages to specify conditional dependencies based on the target environment (Python version, operating system, platform, etc.).

## Purpose

The primary purpose of this module is to:
- Parse marker expressions from strings (e.g., `python_version >= "3.7"`)
- Evaluate these markers against the current or specified environment
- Provide a standardized way to handle conditional package dependencies

## Key Classes

### Exception Classes

#### `InvalidMarker`
```python
class InvalidMarker(ValueError)
```
- Raised when a marker string cannot be parsed
- Users should refer to PEP 508 for proper marker syntax

#### `UndefinedComparison`
```python
class UndefinedComparison(ValueError)
```
- Raised when an invalid operation is attempted on incompatible values

#### `UndefinedEnvironmentName`
```python
class UndefinedEnvironmentName(ValueError)
```
- Raised when referencing a non-existent environment variable in a marker

### Node Classes

#### `Node`
Base class for all marker AST nodes.

#### `Variable`
Represents environment variable names (e.g., `python_version`, `sys_platform`).

#### `Value`
Represents literal values in markers (e.g., quoted strings).

#### `Op`
Represents operators in marker expressions (e.g., `>=`, `==`, `in`).

### Main Class

#### `Marker`
```python
class Marker(object):
    def __init__(self, marker):
        # type: (str) -> None
        
    def evaluate(self, environment=None):
        # type: (Optional[Dict[str, str]]) -> bool
```

The main class for working with markers:
- **Constructor**: Parses a marker string into an internal representation
- **`evaluate()`**: Evaluates the marker against an environment, returning `True`/`False`

**Example Usage:**
```python
marker = Marker('python_version >= "3.7"')
result = marker.evaluate()  # True if running Python 3.7+
```

## Important Functions

### `default_environment()`
```python
def default_environment():
    # type: () -> Dict[str, str]
```
Returns a dictionary containing the current Python environment information:
- `python_version`: Major.minor Python version
- `python_full_version`: Full Python version string
- `os_name`: Operating system name
- `sys_platform`: System platform identifier
- `platform_*`: Various platform-specific information
- `implementation_*`: Python implementation details

### `format_full_version(info)`
```python
def format_full_version(info):
    # type: (sys._version_info) -> str
```
Formats version info tuples into standardized version strings.

## Supported Environment Variables

The module recognizes these environment variables in markers:

| Variable | Description |
|----------|-------------|
| `python_version` | Python major.minor version |
| `python_full_version` | Complete Python version |
| `os_name` | Operating system name |
| `sys_platform` | System platform |
| `platform_machine` | Machine type |
| `platform_system` | Platform system |
| `platform_release` | Platform release |
| `platform_version` | Platform version |
| `implementation_name` | Python implementation name |
| `implementation_version` | Implementation version |
| `extra` | Package extra name (PEP 508) |

## Supported Operators

- **Comparison**: `==`, `!=`, `<`, `<=`, `>`, `>=`, `===`, `~=`
- **Membership**: `in`, `not in`
- **Logical**: `and`, `or`

## Usage Examples

```python
# Basic version check
marker = Marker('python_version >= "3.8"')
print(marker.evaluate())  # True if Python 3.8+

# Platform-specific marker
marker = Marker('sys_platform == "win32"')
print(marker.evaluate())  # True on Windows

# Complex marker with logical operators
marker = Marker('python_version >= "3.7" and sys_platform != "win32"')
print(marker.evaluate())

# Custom environment
custom_env = {"python_version": "3.9"}
marker = Marker('python_version >= "3.8"')
print(marker.evaluate(custom_env))  # True
```

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

1. **PEP 508 Compliance**: This module implements PEP 508 marker syntax. Refer to the PEP for complete specification details.

2. **Legacy Aliases**: The module supports legacy variable names from older PEPs (e.g., `os.name` ‚Üí `os_name`).

3. **Version Comparison**: Version comparisons use the `Specifier` class for proper semantic version handling.

### üí° Best Practices

1. **Error Handling**: Always catch `InvalidMarker` when parsing user-provided marker strings.

2. **Environment Override**: Use the `environment` parameter in `evaluate()` for testing with different environments.

3. **String Representation**: `Marker` objects can be converted back to strings, useful for serialization.

### üîß Implementation Details

- Uses `pyparsing` for robust marker string parsing
- Supports both old-style (PEP 345) and new-style (PEP 508) marker syntax
- Thread-safe for evaluation operations
- Dual-licensed under Apache 2.0 and BSD licenses