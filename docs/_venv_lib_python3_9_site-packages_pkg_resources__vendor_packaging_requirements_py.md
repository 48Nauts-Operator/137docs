<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Python Requirements Parser Documentation

## Overview

This Python module provides functionality for parsing and representing Python package requirements according to **PEP 508** (Dependency specification for Python Software Packages). It handles the complex task of parsing requirement strings like `requests[security]>=2.8.1,!=2.11.0; python_version<"3.6"` into structured components.

## Purpose

The module enables:
- Parsing requirement strings into structured data
- Validating requirement syntax according to PEP 508
- Extracting components like package names, version specifiers, URLs, extras, and environment markers
- Converting parsed requirements back to normalized string format

## Key Components

### Exception Classes

#### `InvalidRequirement`
```python
class InvalidRequirement(ValueError):
    """An invalid requirement was found, users should refer to PEP 508."""
```
- **Purpose**: Raised when a requirement string cannot be parsed
- **Usage**: Indicates malformed requirement strings that don't conform to PEP 508

### Main Classes

#### `Requirement`
The primary class for parsing and representing package requirements.

```python
class Requirement(object):
    """Parse a requirement.
    
    Parse a given requirement string into its parts, such as name, specifier,
    URL, and extras. Raises InvalidRequirement on a badly-formed requirement
    string.
    """
```

##### Constructor
```python
def __init__(self, requirement_string):
    # type: (str) -> None
```
- **Parameters**: `requirement_string` - A PEP 508 compliant requirement string
- **Raises**: `InvalidRequirement` if the string cannot be parsed
- **Example**: 
  ```python
  req = Requirement("requests[security]>=2.8.1; python_version>='3.6'")
  ```

##### Attributes
After parsing, a `Requirement` object provides:
- `name` (str): Package name
- `url` (str or None): Direct URL if specified
- `extras` (set): Set of extra features requested
- `specifier` (SpecifierSet): Version constraints
- `marker` (Marker or None): Environment markers

##### Methods

**`__str__()`**
- Returns the normalized string representation of the requirement
- Reconstructs the requirement string from parsed components

**`__repr__()`**
- Returns a developer-friendly representation showing the requirement string

## Grammar Components

The module defines a comprehensive grammar using `pyparsing` for parsing requirements:

### Basic Elements
- `ALPHANUM`: Letters and digits
- `PUNCTUATION`: Allowed punctuation in identifiers (`-_.`)
- `IDENTIFIER`: Valid Python package names
- Various literals for brackets, parentheses, commas, etc.

### Complex Patterns
- `NAME`: Package name identifier
- `EXTRAS`: Optional features in square brackets
- `VERSION_SPEC`: Version constraints (PEP 440 and legacy formats)
- `URL`: Direct package URLs
- `MARKER_EXPR`: Environment markers for conditional installation

## Usage Examples

### Basic Usage
```python
# Simple requirement
req = Requirement("requests>=2.0.0")
print(req.name)        # "requests"
print(req.specifier)   # >=2.0.0

# Requirement with extras
req = Requirement("requests[security,socks]>=2.0.0")
print(req.extras)      # {'security', 'socks'}

# Requirement with markers
req = Requirement("requests>=2.0.0; python_version>='3.6'")
print(req.marker)      # Marker object

# URL-based requirement
req = Requirement("mypackage @ https://github.com/user/repo/archive/main.zip")
print(req.url)         # URL string
```

### Error Handling
```python
try:
    req = Requirement("invalid requirement string !!!")
except InvalidRequirement as e:
    print(f"Invalid requirement: {e}")
```

## Important Notes

### Thread Safety
- The module includes a workaround for pyparsing thread safety issues during initialization
- A dummy parse operation is performed at module load: `REQUIREMENT.parseString("x[]")`

### URL Validation
The parser performs validation on URLs:
- File URLs must be properly formatted
- HTTP/HTTPS URLs must have both scheme and netloc
- Invalid URLs raise `InvalidRequirement`

### Dependencies
- Relies on `pyparsing` for grammar parsing
- Uses `pkg_resources.extern.pyparsing` (bundled version)
- Imports `markers` and `specifiers` modules for handling those components

## Suggestions for Usage

1. **Always handle `InvalidRequirement` exceptions** when parsing user input
2. **Use the parsed attributes** rather than regex parsing requirement strings manually
3. **Leverage the `__str__()` method** to normalize requirement strings
4. **Consider caching parsed requirements** if parsing the same strings repeatedly

## Related Standards

- **PEP 508**: Dependency specification for Python Software Packages
- **PEP 440**: Version Identification and Dependency Specification
- This module implements the official Python packaging requirement specification