<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Version Specifier Module Documentation

This module provides functionality for parsing, validating, and working with version specifiers according to PEP 440 (Python packaging version identification and dependency specification standard).

## Overview

The module enables users to:
- Parse version specifiers (e.g., `>=1.0`, `~=2.1`, `!=1.5.*`)
- Check if versions match specific criteria
- Filter collections of versions based on specifier rules
- Handle both modern PEP 440 and legacy version formats

## Classes

### `InvalidSpecifier`

**Purpose**: Exception raised when an invalid version specifier is encountered.

```python
class InvalidSpecifier(ValueError):
    """
    An invalid specifier was found, users should refer to PEP 440.
    """
```

### `BaseSpecifier`

**Purpose**: Abstract base class that defines the interface for all specifier objects.

**Key Methods**:
- `contains(item, prereleases=None)` - Check if a version matches the specifier
- `filter(iterable, prereleases=None)` - Filter versions from an iterable
- `prereleases` - Property to control prerelease handling

### `LegacySpecifier`

**Purpose**: Handles legacy (non-PEP 440) version specifiers with basic comparison operators.

**Supported Operators**:
- `==`, `!=`, `<=`, `>=`, `<`, `>`

**Example Usage**:
```python
spec = LegacySpecifier(">=1.0")
print(spec.contains("1.5"))  # True
```

### `Specifier`

**Purpose**: Handles modern PEP 440 compliant version specifiers with advanced features.

**Supported Operators**:
- `~=` (compatible release)
- `==`, `!=` (equality, with wildcard support)
- `<=`, `>=`, `<`, `>` (comparison)
- `===` (arbitrary equality)

**Key Features**:
- **Wildcard matching**: `==1.4.*` matches `1.4.0`, `1.4.1`, etc.
- **Compatible release**: `~=1.4.2` equivalent to `>=1.4.2, ==1.4.*`
- **Prerelease handling**: Smart handling of alpha, beta, rc versions
- **Local version support**: Handles versions with local identifiers

**Example Usage**:
```python
spec = Specifier("~=1.4.2")
print(spec.contains("1.4.5"))  # True
print(spec.contains("1.5.0"))  # False

# Wildcard matching
spec = Specifier("==1.4.*")
print(spec.contains("1.4.2"))  # True
```

### `SpecifierSet`

**Purpose**: Manages collections of multiple specifiers that must all be satisfied (logical AND).

**Key Features**:
- Combines multiple specifiers with comma separation
- Supports set operations (`&` for intersection)
- Handles mixed modern and legacy specifiers

**Example Usage**:
```python
spec_set = SpecifierSet(">=1.0,<2.0,!=1.5")
print(spec_set.contains("1.4"))   # True
print(spec_set.contains("1.5"))   # False
print(spec_set.contains("2.0"))   # False

# Filtering versions
versions = ["0.9", "1.2", "1.5", "2.1"]
filtered = list(spec_set.filter(versions))
# Returns: ["1.2"]
```

## Key Functions

### Helper Functions

- `_version_split(version)` - Splits version strings for comparison
- `_pad_version(left, right)` - Normalizes version segments for comparison
- `_require_version_compare()` - Decorator ensuring proper version types

## Important Features

### Prerelease Handling

The module provides sophisticated prerelease handling:

```python
spec = Specifier(">=1.0")
spec.prereleases = True  # Enable prerelease matching

# By default, prereleases are excluded unless explicitly included
print(spec.contains("1.0a1"))  # False (unless prereleases=True)
```

### Version Filtering

Efficiently filter version collections:

```python
versions = ["1.0", "1.1a1", "1.2", "2.0a1", "2.0"]
spec_set = SpecifierSet(">=1.0,<2.0")
stable_versions = list(spec_set.filter(versions))
# Returns stable versions within range
```

## Usage Examples

### Basic Specifier Usage

```python
# Create a specifier
spec = Specifier(">=1.4.0")

# Check if version matches
if spec.contains("1.5.0"):
    print("Version matches!")

# Filter a list of versions
versions = ["1.2.0", "1.4.0", "1.5.0", "2.0.0"]
matching = list(spec.filter(versions))
```

### Complex Specifier Sets

```python
# Multiple constraints
spec_set = SpecifierSet(">=1.0,<2.0,!=1.3.*")

# Combine specifier sets
combined = spec_set & SpecifierSet(">=1.2")
```

## Notes and Considerations

- **PEP 440 Compliance**: The `Specifier` class follows PEP 440 exactly
- **Legacy Support**: `LegacySpecifier` handles older, non-standard formats
- **Performance**: Uses compiled regex patterns for efficient parsing
- **Error Handling**: Raises `InvalidSpecifier` for malformed input
- **Thread Safety**: Immutable objects are thread-safe once created

## Dependencies

- Requires `version`, `utils`, and `_compat` modules from the same package
- Uses standard library modules: `abc`, `functools`, `itertools`, `re`

This module is essential for Python packaging tools that need to handle version constraints and dependency resolution.