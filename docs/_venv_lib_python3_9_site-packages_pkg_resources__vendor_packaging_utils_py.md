<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Canonicalization Utilities

This Python module provides utilities for canonicalizing (normalizing) package names and version strings according to Python packaging standards. It's part of a packaging library and ensures consistent formatting of package identifiers and versions.

## Purpose

The module implements canonicalization functions that:
- Normalize package names according to PEP 503 standards
- Standardize version strings by removing redundant elements
- Ensure consistent formatting across different package management tools

## Functions

### `canonicalize_name(name)`

Canonicalizes a package name according to PEP 503 specifications.

**Parameters:**
- `name` (str): The package name to canonicalize

**Returns:**
- `NormalizedName`: A normalized version of the package name

**Behavior:**
- Converts the name to lowercase
- Replaces any sequence of hyphens, underscores, or periods with a single hyphen

**Example:**
```python
canonicalize_name("My_Package.Name")  # Returns: "my-package-name"
canonicalize_name("Django-REST-framework")  # Returns: "django-rest-framework"
```

### `canonicalize_version(_version)`

Normalizes a version string by parsing it and reconstructing it in a standardized format.

**Parameters:**
- `_version` (str): The version string to canonicalize

**Returns:**
- `Union[Version, str]`: A normalized version string, or the original string if it's a legacy version that cannot be parsed

**Behavior:**
- Parses the version using the `Version` class
- Reconstructs the version with standardized formatting
- Strips trailing `.0` segments from the release portion
- Handles all version components: epoch, release, pre-release, post-release, development, and local versions

**Example:**
```python
canonicalize_version("1.2.0.0")     # Returns: "1.2"
canonicalize_version("2.0.0a1")     # Returns: "2.0.0a1"  
canonicalize_version("1.0.dev0")    # Returns: "1.0.dev0"
```

## Implementation Details

### Regular Expressions

- `_canonicalize_regex`: Compiled pattern `r"[-_.]+"` used to match sequences of hyphens, underscores, and periods in package names

### Version Components Handled

The `canonicalize_version` function processes these version components in order:

1. **Epoch** - Prefixes like `1!` for versioning epochs
2. **Release** - Main version numbers (e.g., `1.2.3`) with trailing `.0` removal
3. **Pre-release** - Alpha/beta/rc releases (e.g., `a1`, `b2`, `rc1`)
4. **Post-release** - Post releases (e.g., `.post1`)
5. **Development** - Development releases (e.g., `.dev0`)
6. **Local version** - Local version identifiers (e.g., `+local.1`)

## Dependencies

- `re`: Standard library regular expression module
- `.version`: Local module providing `Version` and `InvalidVersion` classes
- `._typing`: Local typing utilities

## Notes and Suggestions

- ‚ö†Ô∏è **Legacy Version Handling**: If a version string cannot be parsed by the `Version` class, the function returns the original string unchanged
- üîÑ **PEP Compliance**: The name canonicalization follows PEP 503, ensuring compatibility with Python package indexes
- üéØ **Use Cases**: These functions are typically used by package managers, dependency resolvers, and package index implementations
- üí° **Performance**: The regex is compiled once at module level for efficient reuse

## Error Handling

The module gracefully handles invalid versions by catching `InvalidVersion` exceptions and returning the original version string, making it backward-compatible with legacy version formats.