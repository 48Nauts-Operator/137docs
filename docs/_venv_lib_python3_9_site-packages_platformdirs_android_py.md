<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Android Platform Directories Module

## Overview

This module provides Android-specific directory path implementations for the `platformdirs` library. It defines where applications should store different types of data on Android devices, following Android filesystem conventions and best practices.

## Purpose

The module implements platform-specific directory resolution for Android devices, handling:
- Application data storage locations
- Configuration file directories  
- Cache directories
- User media directories (documents, downloads, pictures, etc.)
- Runtime and logging directories

## Main Class

### `Android(PlatformDirsABC)`

The primary class that implements Android-specific directory paths. It inherits from `PlatformDirsABC` and provides properties for various directory types.

#### Key Properties

##### Application Data Directories
- **`user_data_dir`**: Returns the user-specific data directory
  - Path: `/data/user/<userid>/<packagename>/files/<AppName>`
- **`site_data_dir`**: Same as `user_data_dir` (no distinction on Android)

##### Configuration Directories  
- **`user_config_dir`**: Returns the user configuration directory
  - Path: `/data/user/<userid>/<packagename>/shared_prefs/<AppName>`
- **`site_config_dir`**: Same as `user_config_dir`

##### Cache Directories
- **`user_cache_dir`**: Returns the user cache directory
  - Path: `/data/user/<userid>/<packagename>/cache/<AppName>`
- **`site_cache_dir`**: Same as `user_cache_dir`

##### Special Directories
- **`user_state_dir`**: Same as `user_data_dir`
- **`user_log_dir`**: Cache directory + `/log` if opinionated mode is enabled
- **`user_runtime_dir`**: Cache directory + `/tmp` if opinionated mode is enabled

##### Media Directories
- **`user_documents_dir`**: `/storage/emulated/0/Documents`
- **`user_downloads_dir`**: `/storage/emulated/0/Downloads` 
- **`user_pictures_dir`**: `/storage/emulated/0/Pictures`
- **`user_videos_dir`**: `/storage/emulated/0/DCIM/Camera`
- **`user_music_dir`**: `/storage/emulated/0/Music`
- **`user_desktop_dir`**: `/storage/emulated/0/Desktop`

## Helper Functions

### `_android_folder()`
- **Purpose**: Determines the base Android application folder
- **Returns**: Base folder path or `None` if not found
- **Caching**: Uses `@lru_cache(maxsize=1)` for performance
- **Detection Methods**:
  1. Uses `python4android` if available
  2. Falls back to `pyjnius` 
  3. Regex pattern matching on `sys.path` for `/data/` paths
  4. Regex pattern matching for adopted storage paths

### Media Folder Functions
Each media type has a dedicated helper function:
- `_android_documents_folder()`
- `_android_downloads_folder()`  
- `_android_pictures_folder()`
- `_android_videos_folder()`
- `_android_music_folder()`

**Common Pattern**:
```python
@lru_cache(maxsize=1)
def _android_<media>_folder() -> str:
    try:
        # Use pyjnius to get Android system directories
        from jnius import autoclass
        context = autoclass("android.content.Context")
        environment = autoclass("android.os.Environment")
        return context.getExternalFilesDir(environment.DIRECTORY_<TYPE>).getAbsolutePath()
    except Exception:
        # Fallback to hardcoded path
        return "/storage/emulated/0/<MediaType>"
```

## Usage Notes

### Dependencies
- **Optional**: `python4android` for native Android integration
- **Optional**: `pyjnius` for Java/Android API access
- **Fallback**: Regex-based path detection when libraries unavailable

### Error Handling
- All Android API calls are wrapped in try-catch blocks
- Graceful fallback to standard Android paths when APIs fail
- No exceptions propagated to calling code

### Performance
- All directory resolution functions use `@lru_cache(maxsize=1)` 
- Results cached after first call to avoid repeated system calls

## Suggestions & Notes

### ‚ö†Ô∏è Important Considerations

1. **Permissions**: Some directories may require specific Android permissions
2. **API Level**: Behavior may vary across different Android versions
3. **Storage Types**: Only handles primary storage, not secondary/external storage
4. **App Context**: Requires proper Android application context for full functionality

### üí° Best Practices

- Always check if directories exist before writing
- Handle permission errors gracefully in your application
- Consider using the `ensure_exists` parameter when initializing
- Test on different Android versions and devices

### üîß Potential Improvements

- Add support for scoped storage (Android 10+)
- Implement secondary storage detection
- Add more granular error handling with specific exception types
- Consider adding support for Android Work Profiles