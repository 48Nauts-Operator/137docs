<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Windows Platform Directories Module

## Overview

This module provides Windows-specific implementations for determining standard application directories on Windows systems. It follows Microsoft's recommended guidelines for where applications should store different types of data (data, config, cache, logs, etc.) based on the Windows Shell Known Folders API.

## Purpose

The module implements platform-specific directory resolution for Windows systems, extending the abstract base class `PlatformDirsABC`. It provides methods to locate standard directories like:

- Application data directories (roaming and local)
- Configuration directories
- Cache directories
- User-specific directories (Documents, Downloads, Pictures, etc.)
- Runtime and temporary directories

## Classes

### `Windows(PlatformDirsABC)`

The main class that implements Windows-specific directory resolution.

**Key Features:**
- Supports both roaming and local application data
- Handles multiple fallback mechanisms for directory resolution
- Supports opinionated directory structures (with additional subdirectories like "Cache", "Logs")
- Can optionally create directories if they don't exist

#### Important Properties

##### Data Directories
- **`user_data_dir`**: User-specific data directory
  - Roaming: `%USERPROFILE%\AppData\Roaming\$appauthor\$appname`
  - Local: `%USERPROFILE%\AppData\Local\$appauthor\$appname`

- **`site_data_dir`**: System-wide data directory
  - `C:\ProgramData\$appauthor\$appname`

##### Configuration Directories
- **`user_config_dir`**: Same as `user_data_dir` on Windows
- **`site_config_dir`**: Same as `site_data_dir` on Windows

##### Cache Directories
- **`user_cache_dir`**: User cache directory with optional "Cache" subfolder
- **`site_cache_dir`**: System-wide cache directory

##### User Directories
- **`user_documents_dir`**: `%USERPROFILE%\Documents`
- **`user_downloads_dir`**: `%USERPROFILE%\Downloads`
- **`user_pictures_dir`**: `%USERPROFILE%\Pictures`
- **`user_videos_dir`**: `%USERPROFILE%\Videos`
- **`user_music_dir`**: `%USERPROFILE%\Music`
- **`user_desktop_dir`**: `%USERPROFILE%\Desktop`

#### Key Methods

##### `_append_parts(path: str, *, opinion_value: str | None = None) -> str`

Internal method that constructs the full path by appending application-specific components:

```python
# Example path construction:
# Base path + appauthor + appname + opinion_value + version
```

**Parameters:**
- `path`: Base directory path
- `opinion_value`: Optional subdirectory (e.g., "Cache", "Logs")

## Functions

### Directory Resolution Functions

The module implements a sophisticated fallback mechanism for obtaining Windows folder paths:

#### `get_win_folder(csidl_name: str) -> str`

Main function that resolves Windows folder paths using the best available method.

#### Fallback Methods (in order of preference):

1. **`get_win_folder_via_ctypes(csidl_name: str)`**
   - Uses Windows Shell API via ctypes
   - Most reliable method
   - Requires ctypes library

2. **`get_win_folder_from_registry(csidl_name: str)`**
   - Reads paths from Windows registry
   - Fallback when ctypes unavailable
   - Requires winreg library

3. **`get_win_folder_from_env_vars(csidl_name: str)`**
   - Uses environment variables
   - Last resort fallback
   - Most portable but least reliable

#### `get_win_folder_if_csidl_name_not_env_var(csidl_name: str) -> str | None`

Handles CSIDL names that don't have corresponding environment variables by constructing paths manually.

## Usage Example

```python
from platformdirs import Windows

# Create instance for your application
dirs = Windows(
    appname="MyApp",
    appauthor="MyCompany",
    version="1.0",
    roaming=False  # Use local AppData instead of roaming
)

# Get various directories
user_data = dirs.user_data_dir
# Result: C:\Users\Username\AppData\Local\MyCompany\MyApp\1.0

user_cache = dirs.user_cache_dir  
# Result: C:\Users\Username\AppData\Local\MyCompany\MyApp\Cache\1.0

documents = dirs.user_documents_dir
# Result: C:\Users\Username\Documents
```

## Notes and Recommendations

### Performance
- The `get_win_folder` function is cached using `@lru_cache` for better performance
- Directory resolution is performed once and cached

### Error Handling
- Functions raise `ValueError` for unknown CSIDL names or missing environment variables
- Graceful fallback between different resolution methods

### Platform Safety
- Code includes platform checks to ensure Windows-specific imports only occur on Windows
- Type checking guards prevent issues in cross-platform environments

### Directory Creation
- Directories can be automatically created if the `ensure_exists` parameter is set
- Uses `_optionally_create_directory()` method from the base class

### CSIDL Constants
The module uses Windows CSIDL (constant special item ID list) values to identify standard folders:
- `CSIDL_APPDATA` (26): Application Data
- `CSIDL_LOCAL_APPDATA` (28): Local Application Data  
- `CSIDL_COMMON_APPDATA` (35): All Users Application Data
- `CSIDL_PERSONAL` (5): Documents
- And others for Pictures, Videos, Music, Desktop, etc.

## Dependencies

- **Required**: `os`, `sys` (standard library)
- **Optional**: `ctypes` (for Shell API access)
- **Optional**: `winreg` (for registry access)
- **Fallback**: Environment variables

The module gracefully handles missing optional dependencies by falling back to less optimal but functional alternatives.