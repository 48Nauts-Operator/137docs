<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Windows Platform Directories Module

## Overview

This module provides Windows-specific implementation for platform directory access. It's part of the `platformdirs` library and handles the retrieval of standard system directories on Windows platforms according to Microsoft's guidelines for application data storage.

## Purpose

The module implements Windows-specific directory paths for:
- Application data storage (user and system-wide)
- Configuration files
- Cache directories
- User directories (Documents, Downloads, Pictures, etc.)
- Runtime/temporary directories

It follows Microsoft's [CSIDL (Constant Special Item ID List)](https://learn.microsoft.com/en-us/windows/win32/shell/knownfolderid) standards for directory locations.

## Main Classes

### `Windows`

The primary class that inherits from `PlatformDirsABC` and provides Windows-specific directory implementations.

#### Key Properties

##### Application Data Directories
- **`user_data_dir`**: Returns user-specific data directory
  - Roaming: `%USERPROFILE%\AppData\Roaming\$appauthor\$appname`
  - Local: `%USERPROFILE%\AppData\Local\$appauthor\$appname`

- **`site_data_dir`**: Returns system-wide data directory
  - `C:\ProgramData\$appauthor\$appname`

##### Configuration Directories
- **`user_config_dir`**: Same as `user_data_dir` on Windows
- **`site_config_dir`**: Same as `site_data_dir` on Windows

##### Cache Directories
- **`user_cache_dir`**: User cache with optional "Cache" subfolder
- **`site_cache_dir`**: System-wide cache directory

##### User Directories
- **`user_documents_dir`**: `%USERPROFILE%\Documents`
- **`user_downloads_dir`**: `%USERPROFILE%\Downloads`
- **`user_pictures_dir`**: `%USERPROFILE%\Pictures`
- **`user_videos_dir`**: `%USERPROFILE%\Videos`
- **`user_music_dir`**: `%USERPROFILE%\Music`
- **`user_desktop_dir`**: `%USERPROFILE%\Desktop`

##### Runtime Directories
- **`user_runtime_dir`**: Temporary runtime directory in Local AppData
- **`site_runtime_dir`**: Same as user runtime directory

#### Key Methods

##### `_append_parts(path, *, opinion_value=None)`

Internal method that constructs directory paths by appending:
- App author name
- App name  
- Opinion value (e.g., "Cache", "Logs")
- Version number

```python
# Example path construction
# Input: "C:\Users\User\AppData\Local"
# Output: "C:\Users\User\AppData\Local\MyCompany\MyApp\Cache\1.0"
```

## Utility Functions

### Directory Resolution Functions

The module provides multiple fallback mechanisms for resolving Windows directories:

#### `get_win_folder_via_ctypes(csidl_name)`
- **Primary method**: Uses Windows API via ctypes
- Most reliable and direct approach
- Handles special cases like Downloads directory

#### `get_win_folder_from_registry(csidl_name)`
- **Fallback method**: Reads from Windows Registry
- Used when ctypes is unavailable
- Less reliable but covers most cases

#### `get_win_folder_from_env_vars(csidl_name)`
- **Last resort**: Uses environment variables
- Most basic fallback option
- Limited to common directories

#### `get_win_folder_if_csidl_name_not_env_var(csidl_name)`
- Helper function for directories not available as environment variables
- Constructs paths using `%USERPROFILE%` + standard folder names

### Smart Resolution

#### `_pick_get_win_folder()`
Automatically selects the best available method:
1. **ctypes** (if available and on Windows)
2. **Registry** (if winreg module available)  
3. **Environment variables** (fallback)

#### `get_win_folder`
- LRU cached function for performance
- Uses the method selected by `_pick_get_win_folder()`

## Usage Example

```python
from platformdirs import Windows

# Initialize with app details
dirs = Windows(
    appname="MyApp",
    appauthor="MyCompany", 
    version="1.0",
    roaming=False
)

# Get directories
data_dir = dirs.user_data_dir
# Returns: C:\Users\Username\AppData\Local\MyCompany\MyApp\1.0

cache_dir = dirs.user_cache_dir  
# Returns: C:\Users\Username\AppData\Local\MyCompany\MyApp\Cache\1.0

docs_dir = dirs.user_documents_dir
# Returns: C:\Users\Username\Documents
```

## Important Notes

- **Automatic Directory Creation**: Directories are created automatically if `ensure_exists=True`
- **CSIDL Constants**: Uses Windows CSIDL constants for standard folder locations
- **Fallback Strategy**: Multiple fallback mechanisms ensure compatibility across different Windows environments
- **Path Normalization**: All paths are normalized using `os.path.normpath()`
- **Caching**: Directory lookups are cached for performance using `@lru_cache`

## Dependencies

- **Required**: `os`, `sys`, `functools`
- **Optional**: `ctypes` (preferred), `winreg` (fallback)
- **Platform**: Windows-specific (though includes safety checks)

## Error Handling

The module handles various error conditions:
- Missing environment variables
- Unknown CSIDL constants  
- Import failures for optional modules
- Invalid directory paths

Errors are raised as `ValueError` with descriptive messages.