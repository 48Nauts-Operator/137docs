<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Bypass Whitespace Normalization Extension

## Overview

The `pymdownx._bypassnorm` module is a Python Markdown extension designed to work around whitespace normalization issues that can interfere with HTML preservation in other extensions. It provides a mechanism to protect HTML content during Markdown's whitespace normalization process.

## Purpose

This extension solves a specific problem in Python Markdown processing:

- **Problem**: Markdown's whitespace normalization can strip out important control characters (`STX` and `ETX`) that other extensions use to preserve HTML content
- **Solution**: Uses alternative control characters (`SOH` and `EOT`) as temporary placeholders that survive whitespace normalization, then converts them to the standard Markdown placeholders afterward

## Control Characters Used

| Character | Unicode | Purpose |
|-----------|---------|---------|
| `SOH` | `\u0001` | Start of Header - temporary start marker |
| `EOT` | `\u0004` | End of Transmission - temporary end marker |
| `STX` | Built-in | Start of Text - Python Markdown standard |
| `ETX` | Built-in | End of Text - Python Markdown standard |

## Classes and Functions

### `PreNormalizePreprocessor`

**Purpose**: Removes any existing `SOH` and `EOT` characters before whitespace normalization.

```python
class PreNormalizePreprocessor(Preprocessor):
    def run(self, lines):
        # Removes SOH and EOT characters completely
        source = source.replace(SOH, '').replace(EOT, '')
```

- **Priority**: 35 (runs early in preprocessing)
- **Function**: Clean slate preparation by removing workaround symbols

### `PostNormalizePreprocessor` 

**Purpose**: Converts `SOH`/`EOT` characters to Python Markdown's standard `STX`/`ETX` characters after whitespace normalization.

```python
class PostNormalizePreprocessor(Preprocessor):
    def run(self, lines):
        # Converts temporary markers to standard Markdown markers
        source = source.replace(SOH, STX).replace(EOT, ETX)
```

- **Priority**: 29.9 (runs after whitespace normalization but before most other processors)
- **Function**: Restores HTML placeholder markers in standard format

### `BypassNormExtension`

**Purpose**: Main extension class that registers the preprocessors.

```python
def extendMarkdown(self, md):
    md.preprocessors.register(PreNormalizePreprocessor(md), "pymdownx-pre-norm-ws", 35)
    md.preprocessors.register(PostNormalizePreprocessor(md), "pymdownx-post-norm-ws", 29.9)
```

## Usage

```python
import markdown
from pymdownx import _bypassnorm

# Create Markdown instance with bypass normalization
md = markdown.Markdown(extensions=[_bypassnorm.makeExtension()])
```

## Processing Flow

1. **Pre-normalization**: Remove any existing `SOH`/`EOT` characters
2. **Whitespace normalization**: Python Markdown's built-in process runs
3. **Post-normalization**: Convert `SOH`/`EOT` to `STX`/`ETX` for other extensions to use

## Important Notes

- **Internal Extension**: This is typically used internally by other PyMdown extensions rather than directly by end users
- **Priority Matters**: The specific priority values (35 and 29.9) ensure proper execution order relative to whitespace normalization
- **Character Safety**: The two-step process ensures HTML content is preserved through the normalization phase

## Dependencies

- `markdown`: Core Python Markdown library
- `markdown.util`: For `STX` and `ETX` constants  
- `markdown.preprocessors`: Base `Preprocessor` class

## Suggestions

- **For Extension Authors**: Use this extension as a dependency when creating extensions that need to preserve HTML through whitespace normalization
- **For End Users**: This extension is rarely used standalone - it's typically included automatically by other PyMdown extensions that require it
- **Debugging**: If HTML is being stripped unexpectedly, check that this extension is loaded with proper priorities