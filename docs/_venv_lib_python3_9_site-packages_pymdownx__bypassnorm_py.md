<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# PyMdown Extensions - Bypass Normalization Module

## Overview

The `pymdownx._bypassnorm` module provides a workaround for Python Markdown's whitespace normalization process. This extension allows other extensions to preserve HTML content that would otherwise be affected by whitespace normalization.

## Purpose

Python Markdown's whitespace normalization can interfere with certain extensions that need to stash HTML content using control characters. This module:

- Provides a mechanism to bypass whitespace normalization for specific content
- Uses alternative control characters (`SOH` and `EOT`) as temporary placeholders
- Converts these placeholders to Python Markdown's standard `STX` and `ETX` characters after normalization

## Control Characters

The module defines and uses the following control characters:

```python
SOH = '\u0001'  # Start of Heading (temporary placeholder)
EOT = '\u0004'  # End of Transmission (temporary placeholder)
STX            # Start of Text (Python Markdown standard)
ETX            # End of Text (Python Markdown standard)
```

## Classes

### `PreNormalizePreprocessor`

**Purpose**: Removes workaround symbols before whitespace normalization occurs.

**Key Method**:
- `run(lines)`: Strips all `SOH` and `EOT` characters from the source text

```python
def run(self, lines):
    """Remove workaround placeholder markers before adding actual workaround placeholders."""
    source = '\n'.join(lines)
    source = source.replace(SOH, '').replace(EOT, '')
    return source.split('\n')
```

### `PostNormalizePreprocessor`

**Purpose**: Converts alternative placeholder symbols to Python Markdown's standard placeholder symbols after normalization.

**Key Method**:
- `run(lines)`: Converts `SOH` → `STX` and `EOT` → `ETX`

```python
def run(self, lines):
    """Convert alternate placeholder symbols to actual placeholder symbols."""
    source = '\n'.join(lines)
    source = source.replace(SOH, STX).replace(EOT, ETX)
    return source.split('\n')
```

### `BypassNormExtension`

**Purpose**: Main extension class that orchestrates the bypass mechanism.

**Key Features**:
- Inherits from `markdown.Extension`
- Registers both preprocessors with specific priorities
- No configuration options required

**Method**:
- `extendMarkdown(md)`: Registers preprocessors with the Markdown instance

```python
def extendMarkdown(self, md):
    """Add extensions that help with bypassing whitespace normalization."""
    md.preprocessors.register(PreNormalizePreprocessor(md), "pymdownx-pre-norm-ws", 35)
    md.preprocessors.register(PostNormalizePreprocessor(md), "pymdownx-post-norm-ws", 29.9)
```

## Usage

### Installation

```python
from pymdownx._bypassnorm import makeExtension

# Create the extension
extension = makeExtension()
```

### Integration with Markdown

```python
import markdown
from pymdownx._bypassnorm import BypassNormExtension

md = markdown.Markdown(extensions=[BypassNormExtension()])
```

## Technical Notes

### Preprocessor Priorities

The extension registers preprocessors with specific priorities:
- **Pre-normalization**: Priority `35` (runs before whitespace normalization)
- **Post-normalization**: Priority `29.9` (runs after whitespace normalization)

### Processing Flow

1. **Pre-normalization**: Remove existing `SOH` and `EOT` characters
2. **Whitespace normalization**: Python Markdown's built-in process
3. **Post-normalization**: Convert `SOH`/`EOT` to `STX`/`ETX`

## Recommendations

- **Internal Use**: This module appears to be designed for internal use by other PyMdown extensions
- **Extension Development**: Useful when developing extensions that need to preserve HTML content through whitespace normalization
- **Testing**: Ensure proper testing when using this extension, as it modifies the core Markdown processing pipeline

## Compatibility

- **Python Markdown**: Compatible with the standard Python Markdown library
- **Dependencies**: Requires `markdown.Extension`, `markdown.util`, and `markdown.preprocessors`

## Copyright

Copyright 2014 - 2018 Isaac Muse <isaacmuse@gmail.com>