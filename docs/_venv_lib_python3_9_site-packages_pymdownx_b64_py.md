<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# B64 Markdown Extension

## Overview

The **B64** extension is a Python Markdown extension that automatically converts local image references to base64-encoded data URIs. When processing Markdown documents, it searches for HTML `<img>` tags with local file paths and embeds the image data directly into the HTML as base64-encoded strings.

## Purpose

- **Inline Image Embedding**: Converts local image files to base64 data URIs, eliminating the need for separate image files
- **Self-contained Documents**: Creates standalone HTML documents with embedded images
- **Portable Output**: Generated HTML can be shared without worrying about missing image dependencies

## Supported Image Formats

The extension supports the following image formats:

- **PNG** (`.png`) → `image/png`
- **JPEG** (`.jpg`, `.jpeg`) → `image/jpeg`
- **GIF** (`.gif`) → `image/gif`
- **SVG** (`.svg`) → `image/svg+xml`

## Key Components

### Classes

#### `B64Extension`
The main extension class that integrates with Python Markdown.

**Configuration:**
- `base_path`: Base directory path for resolving relative image paths (default: `"."`)

**Methods:**
- `extendMarkdown(md)`: Registers the B64 postprocessor with the Markdown instance

#### `B64Postprocessor`
Post-processor that performs the actual image replacement after Markdown processing.

**Methods:**
- `run(text)`: Processes HTML text and replaces local image sources with base64 data

### Key Functions

#### `repl_path(m, base_path)`
Replaces an image path with base64-encoded data.

**Parameters:**
- `m`: Regular expression match object containing the image path
- `base_path`: Base directory for resolving relative paths

**Process:**
1. Parses the image URL/path
2. Resolves absolute file path
3. Checks if file exists and has supported extension
4. Reads file and encodes as base64
5. Returns data URI string

#### `repl(m, base_path)`
Main replacement function that processes entire `<img>` tags.

**Parameters:**
- `m`: Regular expression match object for the entire image tag
- `base_path`: Base directory for resolving relative paths

## Usage

### Basic Usage

```python
import markdown

# Initialize with extension
md = markdown.Markdown(extensions=['b64'])
html = md.convert(markdown_text)
```

### With Custom Base Path

```python
import markdown

md = markdown.Markdown(
    extensions=['b64'],
    extension_configs={
        'b64': {
            'base_path': '/path/to/images'
        }
    }
)
```

### Example Transformation

**Input Markdown:**
```html
<img src="./images/logo.png" alt="Logo">
```

**Output HTML:**
```html
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..." alt="Logo">
```

## Regular Expressions

### `RE_TAG_HTML`
Complex regex that matches HTML `<img>` tags while avoiding `<script>` and `<style>` tags and HTML comments.

### `RE_TAG_LINK_ATTR`
Matches the `src` attribute within image tags to extract the file path.

### `RE_SLASH_WIN_DRIVE`
Handles Windows drive letter paths that start with a forward slash.

## Notes and Considerations

### Performance
- **File Size Impact**: Base64 encoding increases file size by approximately 33%
- **Memory Usage**: Large images will significantly increase HTML document size
- **Processing Time**: File I/O operations may slow down document generation

### Error Handling
- Gracefully handles parsing errors and file access issues
- Non-existent files are left unchanged
- Unsupported file types are ignored

### Security Considerations
- Only processes local files (not URLs)
- File path resolution prevents directory traversal attacks
- Binary file reading is safe for supported image formats

### Limitations
- Only works with `<img>` tags in HTML (not Markdown image syntax)
- Requires absolute base path for reliable operation
- Large images may cause browser performance issues

## Installation

This extension requires:
- Python Markdown library
- Access to local file system for image files
- Utility module (`.util`) for URL parsing

## License

MIT License - Copyright (c) 2014-2017 Isaac Muse