<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# BetterEm Documentation

## Overview

The `betterem` module is a Python-Markdown extension that provides intelligent handling of emphasis (`em`) and strong (`strong`) notations in Markdown. It improves upon the default Markdown emphasis processing by adding "smart" rules that better handle edge cases and nested emphasis patterns.

## Purpose

This extension addresses limitations in standard Markdown emphasis processing by:

- Providing more intelligent parsing of asterisk (`*`) and underscore (`_`) emphasis markers
- Handling complex nested emphasis patterns (e.g., `***bold and italic***`)
- Offering "smart" modes that avoid unwanted emphasis in word boundaries
- Supporting various combinations of strong and emphasis formatting

## Key Components

### Processor Classes

#### `AsteriskProcessor`
- **Purpose**: Handles emphasis processing for asterisk-based patterns (`*italic*`, `**bold**`)
- **Inherits from**: `util.PatternSequenceProcessor`
- **Patterns**: Processes 8 different asterisk-based emphasis patterns in priority order

#### `SmartAsteriskProcessor`
- **Purpose**: Intelligent asterisk processing that avoids emphasis within words
- **Key Feature**: Uses word boundaries to prevent unwanted emphasis triggering
- **Use Case**: Prevents patterns like `snake_case_variable` from being interpreted as emphasis

#### `UnderscoreProcessor`
- **Purpose**: Handles emphasis processing for underscore-based patterns (`_italic_`, `__bold__`)
- **Patterns**: Mirrors asterisk patterns but for underscore syntax

#### `SmartUnderscoreProcessor`
- **Purpose**: Intelligent underscore processing with word boundary awareness
- **Key Feature**: Prevents underscore emphasis within words (useful for code and variable names)

### Main Extension Class

#### `BetterEmExtension`
- **Purpose**: Main extension class that integrates with Python-Markdown
- **Configuration Options**:
  - `smart_enable`: Controls which smart features are enabled
    - `"underscore"` (default): Smart underscore processing only
    - `"asterisk"`: Smart asterisk processing only  
    - `"all"`: Both smart underscore and asterisk processing

## Pattern Types

The extension handles various emphasis combinations:

### Basic Patterns
- `*emphasis*` / `_emphasis_` → `<em>emphasis</em>`
- `**strong**` / `__strong__` → `<strong>strong</strong>`

### Complex Nested Patterns
- `***strong and em***` → `<strong><em>strong and em</em></strong>`
- `**strong *and em***` → `<strong>strong <em>and em</em></strong>`
- `*em **and strong***` → `<em>em <strong>and strong</strong></em>`

## Usage

### Basic Usage
```python
import markdown
from pymdownx import betterem

md = markdown.Markdown(extensions=['pymdownx.betterem'])
```

### Configuration Options
```python
# Enable smart processing for underscores only (default)
md = markdown.Markdown(extensions=['pymdownx.betterem'])

# Enable smart processing for asterisks only
md = markdown.Markdown(
    extensions=['pymdownx.betterem'],
    extension_configs={
        'pymdownx.betterem': {
            'smart_enable': 'asterisk'
        }
    }
)

# Enable smart processing for both
md = markdown.Markdown(
    extensions=['pymdownx.betterem'],
    extension_configs={
        'pymdownx.betterem': {
            'smart_enable': 'all'
        }
    }
)
```

## Important Notes

### Compatibility
- This extension should be used **instead of** the `smart_strong` package
- When using with extra extensions, use `pymdownx.extra` instead of `markdown.extensions.extra`
- The extension deregisters default emphasis patterns and replaces them with improved versions

### Smart Processing Benefits
- **Smart Underscore**: Prevents `variable_name_here` from becoming `variable<em>name</em>here`
- **Smart Asterisk**: Prevents unwanted emphasis in mathematical expressions or code
- **Word Boundary Awareness**: Uses `\w` patterns to detect word boundaries intelligently

### Pattern Priority
The extension processes patterns in a specific order to handle complex nested cases correctly:
1. Triple marker combinations (`***`, `___`)
2. Double marker combinations (`**`, `__`)  
3. Single marker combinations (`*`, `_`)
4. Special nested pattern handling

## Implementation Details

- Uses regex patterns with `re.DOTALL | re.UNICODE` flags for comprehensive matching
- Employs negative lookbehind and lookahead assertions for smart boundary detection
- Registers with Python-Markdown's inline pattern system at specific priorities (70, 50, 40)
- Replaces 8 default emphasis-related inline patterns with improved versions