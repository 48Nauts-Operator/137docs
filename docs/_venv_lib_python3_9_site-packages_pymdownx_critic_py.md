<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# PyMdown Extensions - Critic Documentation

## Overview

The `pymdownx.critic` module is a Python Markdown extension that parses and renders **Critic Markup** - a syntax for tracking changes, additions, deletions, and comments in text documents. This extension converts Critic markup into visual HTML representations, making it easy to display editorial changes in rendered documents.

> **Important Note**: This extension must be loaded as the last extension in your Markdown processor chain.

## Purpose

Critic Markup allows writers and editors to track changes in plain text documents using a simple syntax:
- `{++added text++}` - Insertions
- `{--deleted text--}` - Deletions  
- `{==highlighted text==}` - Highlights/marks
- `{>>comment text<<}` - Comments
- `{~~deleted text~>inserted text~~}` - Substitutions

This extension processes these markup patterns and can operate in three modes:
1. **View mode**: Renders changes visually with HTML tags
2. **Accept mode**: Keeps only the accepted/new content
3. **Reject mode**: Keeps only the original/rejected content

## Key Classes and Components

### CriticExtension

The main extension class that integrates with Python Markdown.

**Configuration Options:**
- `mode`: String - Processing mode (`'view'`, `'accept'`, or `'reject'`) - Default: `'view'`
- `raw_view`: Boolean - Keep raw markup output in view mode - Default: `False`

**Usage:**
```python
import markdown
from pymdownx import critic

md = markdown.Markdown(extensions=['pymdownx.critic'])
# or with configuration
md = markdown.Markdown(extensions=['pymdownx.critic'], 
                      extension_configs={'pymdownx.critic': {'mode': 'accept'}})
```

### CriticStash

A utility class for temporarily storing critic markup during processing.

**Key Methods:**
- `store(code)`: Stores HTML code and returns a placeholder
- `get(key, default=None)`: Retrieves stored content by key
- `clear()`: Clears all stored content

### CriticViewPreprocessor

Handles the initial parsing and conversion of critic markup in the preprocessing stage.

**Key Methods:**
- `run(lines)`: Main processing method that finds and converts critic markup
- `critic_view(m)`: Converts markup to HTML for visual display
- `critic_parse(m)`: Processes markup for accept/reject modes
- `html_escape(txt, strip_nl=False)`: Escapes HTML characters

**Supported Markup Patterns:**
- `{++text++}` → `<ins class="critic">text</ins>`
- `{--text--}` → `<del class="critic">text</del>`
- `{==text==}` → `<mark class="critic">text</mark>`
- `{>>comment<<}` → `<span class="critic comment">comment</span>`
- `{~~old~>new~~}` → `<del class="critic">old</del><ins class="critic">new</ins>`

### CriticsPostprocessor

Handles final cleanup and restoration of placeholders in the post-processing stage.

**Key Methods:**
- `run(text)`: Restores critic placeholders with actual HTML
- `restore(m)`: Replaces placeholders with stored content
- `block_edit(m)`: Handles block-level edits

## Usage Examples

### Basic Usage

```python
import markdown

# View mode (default) - shows all changes visually
md = markdown.Markdown(extensions=['pymdownx.critic'])
result = md.convert("This is {++an addition++} and {--a deletion--}")
```

### Accept Mode

```python
# Accept mode - keeps only new content
md = markdown.Markdown(
    extensions=['pymdownx.critic'],
    extension_configs={'pymdownx.critic': {'mode': 'accept'}}
)
result = md.convert("This is {++an addition++} and {--a deletion--}")
# Output: "This is an addition and "
```

### Reject Mode

```python
# Reject mode - keeps only original content  
md = markdown.Markdown(
    extensions=['pymdownx.critic'],
    extension_configs={'pymdownx.critic': {'mode': 'reject'}}
)
result = md.convert("This is {++an addition++} and {--a deletion--}")
# Output: "This is  and a deletion"
```

## CSS Styling

The extension generates HTML with specific CSS classes that you can style:

```css
.critic.comment {
    color: #999;
    font-style: italic;
}

ins.critic {
    background-color: #d4edda;
    text-decoration: none;
}

del.critic {
    background-color: #f8d7da;
}

mark.critic {
    background-color: #fff3cd;
}

.critic.break {
    display: block;
    height: 1em;
}
```

## Important Notes

- **Load Order**: This extension must be loaded last in your extension chain
- **Block Handling**: The extension properly handles both inline and block-level critic markup
- **HTML Escaping**: Comments are automatically HTML-escaped for security
- **Placeholder System**: Uses a sophisticated placeholder system to preserve markup through Markdown processing

## Regular Expressions

The module uses several compiled regular expressions for efficient parsing:
- `RE_CRITIC`: Main pattern for matching all critic markup types
- `RE_CRITIC_PLACEHOLDER`: Matches placeholder patterns
- `RE_BLOCK_SEP`: Identifies block separators

## License

MIT License - Copyright (c) 2014 - 2017 Isaac Muse