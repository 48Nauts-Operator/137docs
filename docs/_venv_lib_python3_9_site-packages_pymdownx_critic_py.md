<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# CriticExtension Documentation

## Overview

The `pymdownx.critic` module is a Python-Markdown extension that parses and processes **Critic Markup** syntax, converting it into visual HTML output. Critic Markup is a lightweight syntax for tracking changes and comments in text documents, similar to track changes in word processors.

> **Important Note**: This extension must be loaded as the **last extension** in your Markdown processor chain.

## Purpose

This extension allows you to:
- **View** critic markup with visual HTML styling (insertions, deletions, substitutions, highlights, and comments)
- **Accept** all proposed changes (keeps insertions, removes deletions)
- **Reject** all proposed changes (removes insertions, keeps deletions)

## Critic Markup Syntax

The extension recognizes the following Critic Markup patterns:

- **Insertions**: `{++inserted text++}`
- **Deletions**: `{--deleted text--}`
- **Substitutions**: `{~~original text~>replacement text~~}`
- **Highlights/Marks**: `{==highlighted text==}`
- **Comments**: `{>>comment text<<}`

## Key Classes and Functions

### CriticExtension

Main extension class that integrates with Python-Markdown.

**Configuration Options:**
- `mode`: Operating mode (`'view'`, `'accept'`, or `'reject'`) - Default: `'view'`
- `raw_view`: Keep raw markup output in view mode - Default: `False`

```python
# Usage example
import markdown
md = markdown.Markdown(extensions=['pymdownx.critic'], 
                      extension_configs={'pymdownx.critic': {'mode': 'view'}})
```

### CriticStash

Internal storage class for temporarily holding critic markup during processing.

**Key Methods:**
- `store(code)`: Store HTML code and return placeholder
- `get(key, default=None)`: Retrieve stored code by key
- `clear()`: Clear all stored items

### CriticViewPreprocessor

Processes critic markup in the preprocessing stage.

**Key Methods:**
- `run(lines)`: Main processing method that finds and converts critic marks
- `critic_view(m)`: Converts critic marks to HTML for visualization
- `critic_parse(m)`: Processes critic marks for accept/reject modes
- `html_escape(txt, strip_nl=False)`: Escapes HTML characters

**Private Methods:**
- `_ins(text)`: Handles insertion markup
- `_del(text)`: Handles deletion markup  
- `_mark(text)`: Handles highlight markup
- `_comment(text)`: Handles comment markup

### CriticsPostprocessor

Handles cleanup and final processing of critic markup placeholders.

**Key Methods:**
- `run(text)`: Replace critic placeholders with final HTML
- `restore(m)`: Replace placeholders with actual critic tags
- `block_edit(m)`: Handle block-level edits

## Usage Examples

### Basic Usage

```python
import markdown

# View mode (default) - shows all markup visually
md = markdown.Markdown(extensions=['pymdownx.critic'])
html = md.convert("This is {++an insertion++} and {--a deletion--}.")

# Accept mode - keeps insertions, removes deletions
md = markdown.Markdown(extensions=['pymdownx.critic'], 
                      extension_configs={'pymdownx.critic': {'mode': 'accept'}})

# Reject mode - removes insertions, keeps deletions  
md = markdown.Markdown(extensions=['pymdownx.critic'], 
                      extension_configs={'pymdownx.critic': {'mode': 'reject'}})
```

### All Markup Types

```markdown
{++This text has been added++}

{--This text has been deleted--}

{~~This text~>has been changed~~}

{==This text has been highlighted==}

{>>This is a comment<<}
```

## Implementation Notes

### Technical Details

- Uses regex patterns to identify critic markup syntax
- Employs a two-stage processing approach (preprocessor + postprocessor)
- Uses special Unicode characters (SOH `\u0001`, EOT `\u0004`) as internal placeholders
- Handles both inline and block-level critic markup

### CSS Classes Generated

The extension generates the following CSS classes for styling:

- `critic` - Base class for all critic elements
- `critic break` - For block-level breaks
- `critic comment` - For comment spans

**HTML Output Examples:**
```html
<ins class="critic">inserted text</ins>
<del class="critic">deleted text</del>
<mark class="critic">highlighted text</mark>
<span class="critic comment">comment text</span>
```

## Important Considerations

### Loading Order
- **Must be the last extension loaded** to ensure proper processing of other Markdown syntax first

### Block vs Inline Handling
- The extension intelligently handles both inline and block-level critic markup
- Block separations (multiple newlines) receive special `break` class treatment

### Security
- Comment text is HTML-escaped to prevent XSS attacks
- All user input is properly sanitized before HTML output

## License

MIT License - Copyright (c) 2014 - 2017 Isaac Muse