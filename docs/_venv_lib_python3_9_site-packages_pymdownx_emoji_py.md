<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# PyMdown Extensions - Emoji Extension

## Overview

This module provides an emoji extension for Python-Markdown that converts emoji shortcodes (like `:smile:`) into various formats including PNG images, SVG images, HTML sprites, or Unicode characters. The extension supports multiple emoji databases including EmojiOne, GitHub's Gemoji, and Twemoji.

## Purpose

The emoji extension allows users to:
- Convert emoji shortcodes (`:emoji_name:`) in Markdown text to visual representations
- Support multiple emoji providers (EmojiOne, Gemoji, Twemoji)
- Render emojis as PNG images, SVG images, sprites, or Unicode characters
- Provide flexible configuration options for styling and behavior

## Key Components

### Constants

```python
RE_EMOJI = r'(:[+\-\w]+:)'  # Regex pattern to match emoji shortcodes
SUPPORTED_INDEXES = ('emojione', 'gemoji', 'twemoji')
```

- **CDN URLs**: Pre-defined CDN paths for different emoji providers
- **Title Options**: `NO_TITLE`, `LONG_TITLE`, `SHORT_TITLE` for image title attributes
- **Unicode Options**: `UNICODE_ALT`, `UNICODE_ENTITY` for alternative text formats

### Emoji Index Functions

#### `emojione(options, md)`
Returns the EmojiOne emoji database with name, emoji mappings, and aliases.

#### `gemoji(options, md)`
Returns the GitHub Gemoji emoji database with name, emoji mappings, and aliases.

#### `twemoji(options, md)`
Returns the Twitter Twemoji emoji database with name, emoji mappings, and aliases.

### Converter Functions

#### `to_png(index, shortname, alias, uc, alt, title, category, options, md)`
Converts emoji to PNG `<img>` elements with appropriate CDN URLs.

#### `to_svg(index, shortname, alias, uc, alt, title, category, options, md)`
Converts emoji to SVG `<img>` elements.

#### `to_png_sprite(index, shortname, alias, uc, alt, title, category, options, md)`
Creates CSS sprite-based emoji using `<span>` elements with specific classes.

#### `to_svg_sprite(index, shortname, alias, uc, alt, title, category, options, md)`
Creates SVG sprite-based emoji using `<svg>` and `<use>` elements.

#### `to_alt(index, shortname, alias, uc, alt, title, category, options, md)`
Returns HTML entities for emoji representation.

## Main Classes

### `EmojiPattern(InlineProcessor)`

The core pattern processor that handles emoji shortcode detection and conversion.

**Key Methods:**
- `handleMatch(m, data)`: Processes matched emoji patterns and converts them using the configured generator
- `_get_unicode(emoji)`: Extracts Unicode representations with optional variation selector removal
- `_get_alt(shortname, uc_alt)`: Generates appropriate alt text based on configuration

### `EmojiAlertPostprocessor(Postprocessor)`

Post-processor for strict mode that raises exceptions when invalid emoji shortcodes are detected.

### `EmojiExtension(Extension)`

Main extension class that integrates emoji processing into Python-Markdown.

**Configuration Options:**
- `emoji_index`: Function returning the desired emoji database (default: `emojione`)
- `emoji_generator`: Method for rendering emojis (default: `to_png`)
- `title`: Title attribute format (`'short'`, `'long'`, or `'none'`)
- `alt`: Alt text format (`'unicode'`, `'short'`, or `'html_entity'`)
- `remove_variation_selector`: Remove Unicode variation selector 16
- `strict`: Raise exceptions for invalid emoji names
- `options`: Additional configuration options

## Usage Example

```python
import markdown
from pymdownx import emoji

# Basic usage with PNG output
md = markdown.Markdown(extensions=['pymdownx.emoji'])

# Custom configuration
md = markdown.Markdown(
    extensions=['pymdownx.emoji'],
    extension_configs={
        'pymdownx.emoji': {
            'emoji_index': emoji.twemoji,
            'emoji_generator': emoji.to_svg,
            'options': {
                'attributes': {'class': 'custom-emoji'},
                'image_path': 'https://my-cdn.com/emoji/'
            }
        }
    }
)
```

## Important Notes

### Backwards Compatibility
- The `add_attriubtes` function exists for backwards compatibility (note the typo in the name)
- Legacy emoji index functions without arguments are deprecated

### Strict Mode
When `strict=True`, the extension will raise a `RuntimeError` if any invalid emoji shortcodes are detected, listing all problematic emojis.

### Unicode Handling
The extension handles Unicode variation selectors and provides options to remove them when needed. It distinguishes between Unicode for identification (`uc`) and Unicode for display (`uc_alt`).

## Suggestions

1. **Performance**: For sites with many emojis, consider using sprite-based rendering to reduce HTTP requests
2. **Accessibility**: Always ensure proper alt text is configured for screen readers
3. **CDN**: Consider hosting emoji assets on your own CDN for better performance and reliability
4. **Strict Mode**: Enable strict mode during development to catch typos in emoji shortcodes
5. **Caching**: The extension creates deep copies of emoji databases, so consider the memory implications for large applications