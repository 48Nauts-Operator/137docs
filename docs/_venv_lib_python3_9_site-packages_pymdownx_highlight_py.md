<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Highlight Extension Documentation

## Overview

The **Highlight** extension is a comprehensive code highlighting library for Python-Markdown that provides syntax highlighting capabilities for code blocks. It's based on the original CodeHilite extension but includes numerous enhancements and features.

## Purpose

This extension serves to:
- Add syntax highlighting to Markdown code blocks
- Support both Pygments-based highlighting and JavaScript highlighter preparation
- Provide extensive customization options for code presentation
- Handle both inline and block code highlighting

## Key Components

### 1. Core Classes

#### `Highlight`
The main highlighting class that handles code formatting and syntax highlighting.

**Key Parameters:**
- `use_pygments`: Enable/disable Pygments highlighting
- `guess_lang`: Automatic language detection
- `pygments_style`: Color scheme for highlighting
- `linenums`: Line number display options
- `language_prefix`: Prefix for language classes

**Important Methods:**
```python
def highlight(self, src, language, css_class='highlight', ...):
    """Main method to highlight code with various options"""
    
def get_lexer(self, src, language, inline, stripnl):
    """Get appropriate Pygments lexer for the code"""
```

#### `HighlightExtension`
The Markdown extension class that integrates the highlighter into the Markdown processing pipeline.

```python
def extendMarkdown(self, md):
    """Registers the tree processor with Markdown"""
```

#### `HighlightTreeprocessor`
Processes the Markdown tree to find and highlight code blocks.

### 2. Specialized Formatters

#### `InlineHtmlFormatter`
Custom Pygments formatter for inline code highlighting that removes wrapping div elements.

#### `BlockHtmlFormatter`
Enhanced formatter for block code with improved line number handling and custom features.

## Configuration Options

The extension supports extensive configuration through `DEFAULT_CONFIG`:

### Essential Options
- **`use_pygments`** (bool): Enable Pygments highlighting (default: True)
- **`css_class`** (str): CSS class for wrapper element (default: 'highlight')
- **`guess_lang`** (bool/str): Automatic language detection (default: False)
- **`pygments_style`** (str): Pygments color scheme (default: 'default')

### Line Number Options
- **`linenums`**: Display line numbers (default: None)
- **`linenums_style`**: Line number style - 'table' or 'inline' (default: 'table')
- **`linenums_special`**: Highlight every nth line (default: -1)

### Advanced Features
- **`auto_title`**: Inject lexer name as title (default: False)
- **`line_spans`**: Wrap lines in spans with IDs (default: '')
- **`anchor_linenums`**: Make line numbers clickable anchors (default: False)
- **`extend_pygments_lang`**: Custom language definitions (default: [])

## Usage Examples

### Basic Extension Registration
```python
import markdown
from your_module import HighlightExtension

md = markdown.Markdown(extensions=[HighlightExtension()])
```

### With Custom Configuration
```python
md = markdown.Markdown(extensions=[
    HighlightExtension(
        use_pygments=True,
        pygments_style='monokai',
        linenums=True,
        css_class='codehilite'
    )
])
```

### Direct Highlighting
```python
highlighter = Highlight(
    use_pygments=True,
    pygments_style='github',
    linenums=True
)

highlighted_code = highlighter.highlight(
    src="print('Hello, World!')",
    language='python',
    css_class='highlight'
)
```

## Features

### Multi-Mode Support
- **Pygments Mode**: Full syntax highlighting with Pygments
- **JavaScript Mode**: Prepares code for client-side highlighting libraries
- **Fallback Mode**: Basic HTML escaping when Pygments unavailable

### Language Handling
```python
def get_extended_language(self, language):
    """Support for custom language definitions"""
```

### HTML Generation
- Generates clean, semantic HTML
- Supports custom attributes and CSS classes
- Handles both `<pre><code>` and div-wrapped output

## Dependencies

### Required
- `markdown`: Python-Markdown library
- `xml.etree.ElementTree`: XML processing

### Optional
- `pygments`: Syntax highlighting engine (recommended)

### Compatibility Check
```python
if pygments and p_ver < (2, 12):
    raise RuntimeError('Requires Pygments 2.12+ if enabling Pygments')
```

## Notes and Recommendations

### Performance Considerations
- Pygments highlighting is more resource-intensive than JavaScript alternatives
- Consider using `guess_lang` sparingly as it adds processing overhead
- Cache highlighted content when possible

### Browser Compatibility
- Generated HTML is compatible with modern browsers
- CSS classes follow standard conventions for easy styling

### Security
- All user input is properly escaped to prevent XSS attacks
- HTML output is sanitized through proper escaping methods

### Styling
The extension generates structured HTML that can be styled with CSS:
```css
.highlight { /* wrapper styles */ }
.highlight pre { /* code block styles */ }
.highlight .linenos { /* line number styles */ }
```

### Extension Points
- Custom formatters can be created by subclassing `HtmlFormatter`
- Language extensions supported through `extend_pygments_lang`
- Title mapping available through `auto_title_map`

## Error Handling

The extension includes robust error handling:
- Graceful fallback when Pygments is unavailable
- Language detection failures fall back to text/plain
- Invalid configuration options use sensible defaults

This extension provides a powerful and flexible solution for code highlighting in Markdown documents with extensive customization options and robust error handling.