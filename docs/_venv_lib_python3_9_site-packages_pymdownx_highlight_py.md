<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Highlight Extension Documentation

## Overview

The **Highlight** extension is a comprehensive code highlighting library for Python-Markdown that provides syntax highlighting capabilities for both inline and block code. It extends the standard Python-Markdown functionality by adding advanced code highlighting features using Pygments or preparing code for JavaScript-based syntax highlighters.

## Purpose

This extension serves to:
- Add syntax highlighting to standard Python-Markdown code blocks
- Support both Pygments-based highlighting and JavaScript highlighter preparation
- Provide extensive customization options for code presentation
- Handle line numbering, language detection, and styling

## Key Components

### 1. Main Classes

#### `Highlight`
The core highlighting class that handles the actual code highlighting process.

**Key Parameters:**
- `use_pygments`: Enable/disable Pygments highlighting
- `guess_lang`: Automatic language detection
- `pygments_style`: Color scheme for Pygments
- `linenums`: Enable line numbering
- `language_prefix`: Prefix for language classes
- `auto_title`: Inject lexer name as title

**Main Methods:**
```python
def highlight(self, src, language, css_class='highlight', hl_lines=None, 
              linestart=-1, linestep=-1, linespecial=-1, inline=False, 
              classes=None, id_value='', attrs=None, title=None, code_block_count=0):
    """Highlight code with specified parameters."""
```

#### `HighlightExtension`
The main extension class that integrates with Python-Markdown.

```python
def extendMarkdown(self, md):
    """Add support for code highlighting to Markdown processor."""
```

#### `HighlightTreeprocessor`
Processes the Markdown tree to find and highlight code blocks.

```python
def run(self, root):
    """Find code blocks and store in htmlStash."""
```

### 2. Formatter Classes

#### `InlineHtmlFormatter`
Custom Pygments formatter for inline code highlighting.

#### `BlockHtmlFormatter`
Enhanced Pygments formatter for block code with improved line numbering support.

## Configuration Options

The extension supports extensive configuration through the `DEFAULT_CONFIG` dictionary:

### Core Settings
- **`use_pygments`** (bool): Enable Pygments highlighting (default: `True`)
- **`guess_lang`** (int/bool): Automatic language detection (default: `False`)
- **`css_class`** (str): CSS class for wrapper element (default: `'highlight'`)
- **`pygments_style`** (str): Pygments color scheme (default: `'default'`)

### Line Number Settings
- **`linenums`** (bool): Display line numbers (default: `None`)
- **`linenums_style`** (str): Line number style (default: `'table'`)
- **`linenums_special`** (int): Make nth line special (default: `-1`)
- **`linenums_class`** (str): CSS class for line numbers (default: `'linenums'`)

### Language and Styling
- **`language_prefix`** (str): Prefix for language classes (default: `'language-'`)
- **`extend_pygments_lang`** (list): Extend Pygments with custom languages
- **`auto_title`** (bool): Auto-inject lexer name as title (default: `False`)
- **`default_lang`** (str): Default language when none specified

## Usage Examples

### Basic Usage
```python
from markdown import Markdown
from highlight import HighlightExtension

md = Markdown(extensions=[HighlightExtension(use_pygments=True)])
result = md.convert("""
```python
def hello_world():
    print("Hello, World!")
```
""")
```

### With Custom Configuration
```python
config = {
    'use_pygments': True,
    'linenums': True,
    'pygments_style': 'github',
    'css_class': 'codehilite'
}
ext = HighlightExtension(**config)
```

## Important Notes

### Requirements
- **Pygments 2.12+** is required if Pygments highlighting is enabled
- Falls back gracefully when Pygments is not available

### Language Detection
The extension supports three modes for language detection:
1. **Explicit**: Language specified in code fence
2. **Automatic**: Uses Pygments' `guess_lexer` functionality  
3. **Default**: Falls back to specified default language or 'text'

### Line Numbering
Multiple line numbering styles are supported:
- `table`: Uses HTML table format
- `inline`: Inline span elements
- `pymdownx-inline`: Custom inline format with data attributes

## Suggestions

### Performance Considerations
- **Disable Pygments** if using client-side JavaScript highlighters for better performance
- **Cache highlighted content** when possible for frequently accessed pages
- **Limit language guessing** to specific contexts to avoid performance overhead

### Best Practices
1. **Specify languages explicitly** when possible for better performance and accuracy
2. **Use consistent CSS classes** across your site for easier styling
3. **Test with your target languages** to ensure proper highlighting
4. **Consider accessibility** when choosing color schemes and contrast ratios

### Integration Tips
- The extension integrates seamlessly with other Python-Markdown extensions
- Custom language definitions can be added via `extend_pygments_lang`
- CSS styling can be fully customized through the various class and style options

## Error Handling

The extension includes robust error handling:
- Graceful fallback when Pygments is unavailable
- Safe handling of unknown languages
- Automatic fallback to text highlighting when language detection fails