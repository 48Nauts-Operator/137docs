<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Sane Headers Extension

## Overview

The Sane Headers extension is a Python-Markdown extension that enforces stricter syntax rules for hash-style headers (ATX headers). Unlike the default Markdown processor, this extension **requires** a space after the `#` symbols in headers.

## Purpose

This extension solves compatibility issues by preventing conflicts between:
- Header syntax (`#`, `##`, etc.)
- Other Markdown extensions like Magiclink issues (e.g., `#123` for issue references)
- Tag extensions and similar features

By requiring a space after the hash symbols, it creates clear disambiguation between actual headers and other uses of the `#` character.

## Key Components

### `SaneHeadersProcessor` Class

```python
class SaneHeadersProcessor(HashHeaderProcessor):
    """Process hash headers syntax."""
    
    RE = re.compile(r'(?:^|\n)(?P<level>#{1,6})(?=[ ])(?P<header>(?:\\.|[^\\])*?)#*(?:\n|$)')
```

- **Inherits from**: `HashHeaderProcessor` (Python-Markdown's default header processor)
- **Purpose**: Processes hash-style headers with enforced space requirement
- **Key Feature**: Uses a custom regular expression that includes `(?=[ ])` - a positive lookahead that requires a space after the hash symbols

#### Regular Expression Breakdown

- `(?:^|\n)` - Matches start of string or newline
- `(?P<level>#{1,6})` - Captures 1-6 hash symbols as the header level
- `(?=[ ])` - **Critical**: Positive lookahead requiring a space
- `(?P<header>(?:\\.|[^\\])*?)` - Captures the header text (handling escaped characters)
- `#*` - Matches optional trailing hashes
- `(?:\n|$)` - Matches newline or end of string

### `SaneHeadersExtension` Class

```python
class SaneHeadersExtension(Extension):
    """Adds the sane headers extension."""
    
    def extendMarkdown(self, md):
        """Extend the inline and block processor objects."""
        
        md.parser.blockprocessors.register(SaneHeadersProcessor(md.parser), 'hashheader', 70)
        md.registerExtension(self)
```

- **Inherits from**: `Extension` (Python-Markdown base extension class)
- **Purpose**: Registers the custom header processor with the Markdown parser
- **Priority**: `70` (replaces the default hash header processor)

### `makeExtension` Function

```python
def makeExtension(*args, **kwargs):
    """Return extension."""
    
    return SaneHeadersExtension(*args, **kwargs)
```

- **Purpose**: Factory function for creating extension instances
- **Usage**: Standard Python-Markdown extension instantiation pattern

## Usage Examples

### Valid Headers (with space)
```markdown
# Header 1
## Header 2
### Header 3
```

### Invalid Headers (no space - won't be processed as headers)
```markdown
#NoSpace
##AlsoInvalid
#123 (issue reference - won't conflict)
```

## Installation and Setup

```python
import markdown

# Method 1: Using the factory function
md = markdown.Markdown(extensions=['path.to.sane_headers'])

# Method 2: Direct instantiation
from sane_headers import SaneHeadersExtension
md = markdown.Markdown(extensions=[SaneHeadersExtension()])
```

## Notes and Considerations

- **Breaking Change**: This extension changes standard Markdown behavior by requiring spaces after hash symbols
- **Compatibility**: Designed to work alongside extensions like Magiclink that use `#` for other purposes
- **Priority**: Registered with priority 70 to replace the default header processor
- **Validation**: Only processes headers with 1-6 hash symbols (standard Markdown limit)

## Recommendations

- Use this extension when you need to combine header syntax with other extensions that use `#` characters
- Ensure your Markdown content follows the space requirement for headers
- Test thoroughly if migrating from standard Markdown header processing
- Consider documenting the space requirement for content authors