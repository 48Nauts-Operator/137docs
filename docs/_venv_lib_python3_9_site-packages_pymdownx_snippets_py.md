<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# PyMdown Extensions - Snippet Module

## Overview

The `pymdownx.snippet` module is a Markdown extension that allows you to inject code snippets and content from external files or URLs directly into your Markdown documents. It uses a special syntax with "snippet markers" (`---8<---`) to indicate where content should be inserted.

## Purpose

This extension enables:
- **Code reuse**: Include the same snippet in multiple documents
- **Live documentation**: Reference actual source code files that stay up-to-date
- **Modular content**: Break large documents into smaller, manageable pieces
- **Remote content**: Download and include content from URLs
- **Selective inclusion**: Include specific lines or sections from files

## Snippet Syntax

The extension recognizes two types of snippet markers:

### Block Snippets
```markdown
--8<--
path/to/file.py
--8<--
```

### Inline Snippets
```markdown
--8<-- "path/to/file.py"
```

## Key Classes and Functions

### `SnippetExtension`

The main extension class that integrates with Python Markdown.

**Configuration Options:**
- `base_path`: Base directories for snippet paths (default: `["."]`)
- `restrict_base_path`: Restrict paths to be under base paths (default: `True`)
- `encoding`: File encoding for snippets (default: `"utf-8"`)
- `check_paths`: Fail build if snippet not found (default: `False`)
- `auto_append`: List of snippets to automatically append (default: `[]`)
- `url_download`: Enable downloading from URLs (default: `False`)
- `url_max_size`: Maximum size for URL downloads (default: 32 MiB)
- `url_timeout`: Timeout for URL requests (default: 10 seconds)
- `url_request_headers`: Custom headers for URL requests (default: `{}`)
- `dedent_subsections`: Auto-dedent extracted sections (default: `False`)

### `SnippetPreprocessor`

The core processor that handles snippet parsing and insertion.

**Key Methods:**

#### `parse_snippets(lines, file_name=None, is_url=False, is_section=False)`
Recursively processes lines looking for snippet markers and replaces them with content.

#### `extract_section(section, lines)`
Extracts named sections from files using special section markers:
```python
# --8<-- [start: section_name]
code here
# --8<-- [end: section_name]
```

#### `get_snippet_path(path)`
Resolves snippet file paths against the configured base paths.

#### `download(url)`
Downloads content from URLs with caching using `@functools.lru_cache`.

## Advanced Features

### Line Selection
Include specific lines from files:
```markdown
--8<-- "file.py:10:20"     # Lines 10-20
--8<-- "file.py:10:"       # From line 10 to end
--8<-- "file.py::20"       # From start to line 20
--8<-- "file.py:1:10,15:25" # Multiple ranges
```

### Named Sections
Include specific sections marked in source files:
```markdown
--8<-- "file.py:section_name"
```

### Escaping
Escape snippet markers with semicolons:
```markdown
;--8<-- "this won't be processed"
```

### URL Support
When `url_download` is enabled:
```markdown
--8<-- "https://example.com/snippet.py"
```

## Error Handling

### `SnippetMissingError`
Custom exception raised when:
- A snippet file cannot be found
- A named section doesn't exist
- URL download fails
- Path restrictions are violated

## Security Considerations

- **Path Restriction**: By default, `restrict_base_path=True` prevents directory traversal attacks
- **URL Size Limits**: Downloads are limited to prevent resource exhaustion
- **Timeout Protection**: URL requests have configurable timeouts
- **Infinite Loop Prevention**: Tracks seen files to prevent circular references

## Usage Example

```python
import markdown

md = markdown.Markdown(extensions=[
    'pymdownx.snippet'
], extension_configs={
    'pymdownx.snippet': {
        'base_path': ['./snippets', './examples'],
        'check_paths': True,
        'url_download': True
    }
})

result = md.convert(markdown_content)
```

## Notes and Suggestions

- **Performance**: The `download()` method uses LRU caching to avoid repeated URL fetches
- **Memory**: Large files are limited by `url_max_size` to prevent memory issues  
- **Security**: Always use `restrict_base_path=True` in production environments
- **Debugging**: Enable `check_paths=True` during development to catch missing snippets
- **Organization**: Use `base_path` to organize snippets in dedicated directories

## Dependencies

- `markdown`: Core Markdown processing
- `urllib`: URL handling and downloads
- `codecs`: File encoding support
- `functools`: LRU cache for downloads
- `textwrap`: Text indentation handling