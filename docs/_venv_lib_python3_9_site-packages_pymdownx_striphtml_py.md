<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# PyMdown Extensions - StripHTML

## Overview

The `striphtml` module is a Python Markdown extension that sanitizes HTML output by removing unwanted attributes and comments from HTML tags. It was previously named "Plain HTML" and is part of the PyMdown Extensions collection.

## Purpose

This extension serves as a post-processing filter to:
- Remove potentially unsafe or unwanted HTML attributes (like `class`, `id`, `style`)
- Strip JavaScript event handlers (attributes starting with `on*`)
- Remove HTML comments
- Create cleaner, more secure HTML output

## Key Components

### Classes

#### `StripHtmlPostprocessor`

The main post-processor class that performs the HTML stripping operations.

**Constructor Parameters:**
- `strip_comments` (bool): Whether to remove HTML comments
- `strip_js_on_attributes` (bool): Whether to remove JavaScript event attributes
- `strip_attributes` (list): List of specific attributes to remove
- `md`: The Markdown instance

**Key Methods:**

##### `repl(self, m)`
Replacement function for regex matches that:
- Removes comments if `strip_comments` is enabled
- Processes script/style tags while preserving functionality
- Strips unwanted attributes from regular HTML tags

##### `run(self, text)`
Main processing method that applies the regex substitution to strip unwanted content.

#### `StripHtmlExtension`

The main extension class that integrates with Python Markdown.

**Configuration Options:**
- `strip_comments`: Remove HTML comments (default: `True`)
- `strip_attributes`: List of attributes to remove (default: empty list)
- `strip_js_on_attributes`: Remove JavaScript event handlers (default: `True`)

## Regular Expressions

### `RE_TAG_HTML`
Complex regex pattern that matches:
- HTML comments
- Script and style tags (with special handling)
- Regular HTML opening tags with attributes
- HTML closing tags

### `TAG_BAD_ATTR`
Template for matching unwanted attributes within HTML tags.

## Usage Example

```python
import markdown
from pymdownx import striphtml

# Basic usage
md = markdown.Markdown(extensions=['pymdownx.striphtml'])
result = md.convert('<p class="highlight" id="main">Hello World</p>')
# Output: <p>Hello World</p>

# Custom configuration
md = markdown.Markdown(
    extensions=['pymdownx.striphtml'],
    extension_configs={
        'pymdownx.striphtml': {
            'strip_comments': True,
            'strip_attributes': ['class', 'id', 'style'],
            'strip_js_on_attributes': True
        }
    }
)
```

## Important Notes

### Security Considerations
- ⚠️ **This extension removes attributes but does not validate HTML structure**
- ⚠️ **It's not a complete XSS protection solution**
- ⚠️ **Use in conjunction with other security measures for user-generated content**

### Processing Order
- Runs as a post-processor with priority `1`
- Applied after all other Markdown processing is complete
- Only processes the final HTML output

### Attribute Handling
- JavaScript event handlers (`onclick`, `onload`, etc.) are automatically detected using the pattern `on[\w]+`
- Custom attributes can be specified in the `strip_attributes` list
- Script and style tag content is preserved while their attributes can still be stripped

## Performance Notes
- Uses compiled regex patterns for efficient processing
- Only applies regex substitution when stripping is actually configured
- Minimal overhead when no stripping options are enabled

## Integration
This extension integrates seamlessly with other PyMdown Extensions and standard Python Markdown extensions. It's commonly used in documentation systems, blogs, and content management systems where HTML sanitization is needed.