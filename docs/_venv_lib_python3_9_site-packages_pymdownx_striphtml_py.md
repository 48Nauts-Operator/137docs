<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# StripHTML Extension Documentation

## Overview

The `pymdownx.striphtml` module is a Python Markdown extension that cleans up HTML output by removing unwanted attributes and content. It was previously named "Plain HTML" and serves as a post-processor to strip classes, styles, IDs, and other specified attributes from HTML elements.

## Purpose

This extension is useful when you need to:
- Generate clean, simplified HTML output
- Remove styling attributes for consistent presentation
- Strip potentially harmful JavaScript event handlers
- Remove HTML comments from the final output
- Create sanitized HTML content

## Key Components

### StripHtmlPostprocessor Class

The main processing logic is handled by the `StripHtmlPostprocessor` class, which inherits from Markdown's `Postprocessor`.

#### Constructor Parameters
- `strip_comments`: Boolean flag to remove HTML comments
- `strip_js_on_attributes`: Boolean flag to remove JavaScript event handlers (on* attributes)
- `strip_attributes`: List of specific attributes to remove
- `md`: Markdown instance reference

#### Key Methods

**`repl(self, m)`**
- Processes regex matches to rebuild HTML tags without unwanted attributes
- Handles different types of content: comments, script/style tags, regular tags, and closing tags
- Returns cleaned HTML content

**`run(self, text)`**
- Main processing method that applies the cleaning logic to the entire text
- Uses regex pattern matching to identify and process HTML elements
- Returns the processed text with unwanted attributes removed

### StripHtmlExtension Class

The extension class that integrates with Python Markdown.

#### Configuration Options

| Option | Default | Description |
|--------|---------|-------------|
| `strip_comments` | `True` | Remove HTML comments from output |
| `strip_attributes` | `[]` | List of attribute names to strip (commonly: id, class, style) |
| `strip_js_on_attributes` | `True` | Remove JavaScript event handlers (onclick, onload, etc.) |

#### Methods

**`extendMarkdown(self, md)`**
- Registers the extension with the Markdown processor
- Creates and configures the StripHtmlPostprocessor
- Adds the processor to the postprocessor registry with priority 1

## Regular Expression Pattern

The module uses a complex regex pattern (`RE_TAG_HTML`) that matches:
- HTML comments
- Script and style tags with their attributes
- Regular HTML tags with attributes
- Closing tags

```python
RE_TAG_HTML = re.compile(r'''(?x)...''', re.DOTALL | re.UNICODE)
```

## Usage Example

```python
import markdown
from pymdownx import striphtml

# Basic usage
md = markdown.Markdown(extensions=['pymdownx.striphtml'])

# With custom configuration
md = markdown.Markdown(
    extensions=['pymdownx.striphtml'],
    extension_configs={
        'pymdownx.striphtml': {
            'strip_comments': True,
            'strip_attributes': ['id', 'class', 'style'],
            'strip_js_on_attributes': True
        }
    }
)

# Process markdown with HTML
html_output = md.convert(your_markdown_text)
```

## Notes and Suggestions

### Performance Considerations
- The extension uses complex regex patterns that may impact performance on large documents
- Consider the trade-off between cleaning and processing speed for your use case

### Security Benefits
- Automatically removes JavaScript event handlers, improving security
- Helps prevent XSS attacks when processing user-generated content
- Useful for sanitizing HTML in content management systems

### Customization Tips
- Configure `strip_attributes` based on your specific needs
- Consider keeping `strip_js_on_attributes=True` for security
- Test thoroughly with your specific HTML content patterns

### Limitations
- May not handle all edge cases in malformed HTML
- Complex nested structures might require additional validation
- Self-closing tags and XML namespaces are supported but should be tested

### Best Practices
- Use this extension as part of a broader HTML sanitization strategy
- Combine with other security measures for user-generated content
- Validate the output matches your expected clean HTML format