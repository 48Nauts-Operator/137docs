<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# General Utilities Module

This Python module provides a collection of general utility functions and classes for working with URLs, paths, Unicode, and Markdown processing. It's designed to be cross-platform compatible and includes specialized functionality for handling complex nested patterns in Markdown.

## Overview

The module serves as a foundational utility library with the following key purposes:

- **Cross-platform compatibility**: Handles differences between Windows, macOS, and Linux systems
- **URL and path manipulation**: Converts between URLs and file paths with proper handling of platform-specific formats
- **Unicode utilities**: Provides functions for working with Unicode characters and code points
- **Markdown processing**: Includes advanced pattern matching for complex nested Markdown elements
- **Deprecation support**: Utilities for marking functions as deprecated

## Platform Detection

The module automatically detects the current platform and provides helper functions:

```python
# Platform detection functions
is_win()    # Returns True on Windows
is_mac()    # Returns True on macOS  
is_linux()  # Returns True on Linux
```

## Key Functions

### Math Utilities

#### `clamp(value, mn, mx)`
Constrains a value between minimum and maximum bounds.

```python
clamp(5, 0, 10)   # Returns 5
clamp(-5, 0, 10)  # Returns 0
clamp(15, 0, 10)  # Returns 10
```

### URL and Path Utilities

#### `path2url(url)` and `url2path(path)`
Convert between file paths and URLs with proper platform handling.

```python
# Convert file path to URL format
path2url('/home/user/file.txt')

# Convert URL to file path
url2path('file:///home/user/file.txt')
```

#### `parse_url(url)`
Comprehensive URL parsing that handles various formats including:
- Standard URLs (`http://`, `https://`, `ftp://`)
- File paths (absolute and relative)
- Windows drive letters (`C:/path`)
- UNC paths (`//server/path`)

**Returns**: Tuple containing `(scheme, netloc, path, params, query, fragment, is_url, is_absolute)`

### Unicode Utilities

#### `get_code_points(s)`, `get_ord(c)`, `get_char(value)`
Utility functions for Unicode character manipulation:

```python
get_code_points("hello")  # Returns ['h', 'e', 'l', 'l', 'o']
get_ord('A')             # Returns 65
get_char(65)             # Returns 'A'
```

### Markdown Utilities

#### `escape_chars(md, echrs)`
Safely adds characters to Markdown's escape list without modifying the global list.

```python
escape_chars(markdown_instance, ['@', '#'])
```

## Key Classes

### `PatSeqItem`
A named tuple for defining pattern sequence items used in complex Markdown processing.

**Fields**:
- `pattern`: Compiled regex pattern
- `builder`: Builder method name ('single', 'double', 'double2')
- `tags`: HTML tags to generate
- `full_recursion`: Whether to allow full recursive pattern matching

### `PatternSequenceProcessor`
An advanced Markdown inline processor for handling complex nested patterns like emphasis and strong text.

**Key Features**:
- Handles nested pattern matching (e.g., `***bold italic***`)
- Supports multiple builder types for different HTML structures
- Recursive pattern evaluation with configurable depth
- Proper handling of text nodes and element tails

**Builder Types**:
- `single`: Creates single HTML element
- `double`: Creates nested elements like `<strong><em>text</em></strong>`
- `double2`: Creates elements with mixed content like `<strong>text <em>text</em></strong>`

## Deprecation Utilities

### `@deprecated(message)` Decorator
Mark functions as deprecated with custom messages:

```python
@deprecated("Use new_function() instead")
def old_function():
    pass
```

### `warn_deprecated(message)`
Issue deprecation warnings programmatically:

```python
warn_deprecated("This feature will be removed in v2.0")
```

## Constants and Configuration

- `PY39`: Boolean indicating if Python version is 3.9 or higher
- `RE_WIN_DRIVE_LETTER`: Regex for Windows drive letters
- `RE_WIN_DRIVE_PATH`: Regex for Windows drive paths
- `RE_URL`: Regex for URL schemes
- `RE_WIN_DEFAULT_PROTOCOL`: Regex for Windows default protocol format

## Notes and Suggestions

### Best Practices
- Use the platform detection functions instead of checking `sys.platform` directly
- The URL parsing function is robust and handles edge cases, prefer it over manual parsing
- When extending `PatternSequenceProcessor`, carefully consider the pattern order and recursion settings

### Performance Considerations
- The `clamp()` function handles `None` values gracefully but has multiple conditional checks
- Pattern sequence processing can be computationally intensive for deeply nested structures

### Cross-Platform Compatibility
- The module handles Windows-specific path formats (drive letters, UNC paths)
- URL conversion properly handles platform-specific path separators
- File path handling accounts for different operating system conventions

This module provides a solid foundation for applications that need robust URL/path handling and advanced Markdown processing capabilities while maintaining cross-platform compatibility.