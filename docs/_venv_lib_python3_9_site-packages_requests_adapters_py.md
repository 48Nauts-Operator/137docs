<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# requests.adapters

This module contains the transport adapters that Requests uses to define and maintain connections. It provides the core HTTP transport layer implementation for the Requests library.

## Overview

The `requests.adapters` module implements the adapter pattern to handle HTTP and HTTPS connections using urllib3 as the underlying transport mechanism. It provides abstraction layers for connection pooling, SSL/TLS handling, proxy support, and request/response processing.

## Key Components

### Constants

```python
DEFAULT_POOLBLOCK = False
DEFAULT_POOLSIZE = 10
DEFAULT_RETRIES = 0
DEFAULT_POOL_TIMEOUT = None
```

These constants define default values for connection pool configuration.

### Helper Functions

#### `_urllib3_request_context()`

```python
def _urllib3_request_context(
    request: "PreparedRequest",
    verify: "bool | str | None",
    client_cert: "typing.Tuple[str, str] | str | None",
    poolmanager: "PoolManager",
) -> "(typing.Dict[str, typing.Any], typing.Dict[str, typing.Any])"
```

Builds the context parameters needed for urllib3 connections, including SSL configuration and host parameters.

**Parameters:**
- `request`: The prepared request object
- `verify`: SSL verification settings (boolean or CA bundle path)
- `client_cert`: Client certificate for mutual TLS
- `poolmanager`: The urllib3 PoolManager instance

**Returns:** Tuple of (host_params, pool_kwargs) dictionaries

## Classes

### BaseAdapter

```python
class BaseAdapter:
    """The Base Transport Adapter"""
```

Abstract base class that defines the interface for transport adapters.

**Key Methods:**
- `send()`: Sends PreparedRequest object and returns Response object (must be implemented by subclasses)
- `close()`: Cleans up adapter-specific resources (must be implemented by subclasses)

### HTTPAdapter

```python
class HTTPAdapter(BaseAdapter):
    """The built-in HTTP Adapter for urllib3."""
```

The main HTTP transport adapter that handles HTTP and HTTPS requests using urllib3.

#### Constructor Parameters

- `pool_connections`: Number of urllib3 connection pools to cache (default: 10)
- `pool_maxsize`: Maximum connections per pool (default: 10)
- `max_retries`: Maximum retry attempts for failed connections (default: 0)
- `pool_block`: Whether connection pool should block when no connections available (default: False)

#### Key Methods

##### Connection Management

- **`init_poolmanager()`**: Initializes the urllib3 PoolManager
- **`proxy_manager_for()`**: Returns urllib3 ProxyManager for given proxy
- **`get_connection_with_tls_context()`**: Gets connection with proper TLS configuration
- **`get_connection()`**: ⚠️ **DEPRECATED** - Use `get_connection_with_tls_context()` instead

##### SSL/TLS Handling

- **`cert_verify()`**: Configures SSL certificate verification
- **`build_connection_pool_key_attributes()`**: Builds PoolKey attributes for connection selection

##### Request Processing

- **`send()`**: Main method that sends requests and returns responses
- **`request_url()`**: Determines the URL to use for the final request
- **`add_headers()`**: Adds headers needed by the connection
- **`proxy_headers()`**: Returns headers for proxy requests

##### Response Processing

- **`build_response()`**: Converts urllib3 response to Requests Response object

##### Cleanup

- **`close()`**: Closes all connection pools and proxy managers

## Usage Example

```python
import requests
from requests.adapters import HTTPAdapter

# Create a session with custom adapter settings
session = requests.Session()
adapter = HTTPAdapter(
    pool_connections=20,
    pool_maxsize=20,
    max_retries=3
)

# Mount the adapter for HTTP and HTTPS
session.mount('http://', adapter)
session.mount('https://', adapter)

# Use the session
response = session.get('https://api.example.com/data')
```

## Features

### Connection Pooling
- Maintains pools of reusable connections
- Configurable pool size and connection limits
- Automatic cleanup of idle connections

### SSL/TLS Support
- Certificate verification with custom CA bundles
- Client certificate authentication (mutual TLS)
- Preloaded SSL context for performance optimization

### Proxy Support
- HTTP and HTTPS proxy support
- SOCKS proxy support (when dependencies available)
- Automatic proxy authentication

### Error Handling
The adapter translates urllib3 exceptions to Requests exceptions:
- `MaxRetryError` → `RetryError`, `ConnectTimeout`, `ProxyError`, `SSLError`
- `ProtocolError` → `ConnectionError`
- `ReadTimeoutError` → `ReadTimeout`

## Notes and Recommendations

### Migration Notice
- The `get_connection()` method is deprecated as of Requests 2.32.2
- Custom HTTPAdapter subclasses should migrate to `get_connection_with_tls_context()`

### Performance Considerations
- Uses preloaded SSL context for better performance on standard requests
- Connection pooling reduces overhead for multiple requests to same hosts
- Configurable pool sizes allow optimization for specific use cases

### Security
- SSL verification is enabled by default
- Supports custom CA bundles and client certificates
- Proper handling of proxy authentication

### Extensibility
- Designed for subclassing to customize behavior
- Many methods are exposed specifically for subclass overriding
- Clear separation of concerns for different aspects of HTTP transport