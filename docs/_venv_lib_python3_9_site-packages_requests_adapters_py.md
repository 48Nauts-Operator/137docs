<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.adapters Module Documentation

## Overview

The `requests.adapters` module contains transport adapters that define and maintain connections for the Requests library. It serves as the bridge between Requests and the underlying HTTP transport layer (urllib3), handling connection pooling, SSL/TLS verification, proxy management, and error handling.

## Purpose

This module provides:
- Connection management and pooling for HTTP/HTTPS requests
- SSL/TLS certificate verification and client authentication
- Proxy support (HTTP, HTTPS, and SOCKS)
- Retry logic and error handling
- Response building from urllib3 responses

## Key Constants

```python
DEFAULT_POOLBLOCK = False
DEFAULT_POOLSIZE = 10
DEFAULT_RETRIES = 0
DEFAULT_POOL_TIMEOUT = None
```

## Important Functions

### `_urllib3_request_context(request, verify, client_cert, poolmanager)`

Internal function that builds the SSL/TLS context parameters for urllib3 connections.

**Parameters:**
- `request`: PreparedRequest object
- `verify`: SSL verification setting (bool or path to CA bundle)
- `client_cert`: Client certificate for mTLS authentication
- `poolmanager`: urllib3 PoolManager instance

**Returns:** Tuple of (host_params, pool_kwargs) dictionaries

## Core Classes

### `BaseAdapter`

Abstract base class for all transport adapters.

**Key Methods:**
- `send()`: Abstract method for sending requests (must be implemented by subclasses)
- `close()`: Abstract method for cleanup (must be implemented by subclasses)

### `HTTPAdapter`

The main HTTP/HTTPS transport adapter that implements the BaseAdapter interface.

#### Constructor Parameters

```python
HTTPAdapter(
    pool_connections=DEFAULT_POOLSIZE,
    pool_maxsize=DEFAULT_POOLSIZE, 
    max_retries=DEFAULT_RETRIES,
    pool_block=DEFAULT_POOLBLOCK
)
```

- **`pool_connections`**: Number of urllib3 connection pools to cache
- **`pool_maxsize`**: Maximum connections per pool
- **`max_retries`**: Retry attempts for failed connections
- **`pool_block`**: Whether to block when no connections are available

#### Key Methods

##### `init_poolmanager(connections, maxsize, block=False, **pool_kwargs)`

Initializes the urllib3 PoolManager for connection pooling.

```python
adapter.init_poolmanager(10, 10, block=False)
```

##### `proxy_manager_for(proxy, **proxy_kwargs)`

Returns a urllib3 ProxyManager for the given proxy URL. Supports HTTP, HTTPS, and SOCKS proxies.

##### `get_connection_with_tls_context(request, verify, proxies=None, cert=None)`

**Recommended method** for obtaining connections with proper TLS context handling.

**Parameters:**
- `request`: PreparedRequest object
- `verify`: SSL verification (bool or CA bundle path)
- `proxies`: Proxy configuration dictionary
- `cert`: Client certificate for mTLS

##### `get_connection(url, proxies=None)` ⚠️ DEPRECATED

Legacy method for obtaining connections. Use `get_connection_with_tls_context` instead.

##### `cert_verify(conn, url, verify, cert)`

Configures SSL certificate verification on the connection.

##### `build_response(req, resp)`

Converts a urllib3 response into a Requests Response object.

##### `send(request, stream=False, timeout=None, verify=True, cert=None, proxies=None)`

Main method that sends HTTP requests and returns responses.

**Parameters:**
- `request`: PreparedRequest to send
- `stream`: Whether to stream the response
- `timeout`: Connection/read timeout (float or tuple)
- `verify`: SSL verification setting
- `cert`: Client certificate
- `proxies`: Proxy configuration

**Returns:** `requests.Response` object

## Usage Examples

### Basic Usage

```python
import requests
from requests.adapters import HTTPAdapter

# Create session with custom adapter
session = requests.Session()
adapter = HTTPAdapter(
    pool_connections=20,
    pool_maxsize=20,
    max_retries=3
)

# Mount adapter for HTTP and HTTPS
session.mount('http://', adapter)
session.mount('https://', adapter)

# Make requests
response = session.get('https://httpbin.org/get')
```

### Custom SSL Configuration

```python
# Disable SSL verification
adapter = HTTPAdapter()
session = requests.Session()
session.mount('https://', adapter)
response = session.get('https://example.com', verify=False)

# Use custom CA bundle
response = session.get('https://example.com', verify='/path/to/ca-bundle.crt')
```

### Proxy Configuration

```python
# HTTP proxy
proxies = {
    'http': 'http://proxy.example.com:8080',
    'https': 'http://proxy.example.com:8080'
}

# SOCKS proxy
proxies = {
    'http': 'socks5://proxy.example.com:1080',
    'https': 'socks5://proxy.example.com:1080'
}

response = session.get('https://httpbin.org/ip', proxies=proxies)
```

## Error Handling

The adapter converts urllib3 exceptions to Requests exceptions:

- `urllib3.exceptions.ConnectTimeoutError` → `requests.exceptions.ConnectTimeout`
- `urllib3.exceptions.ReadTimeoutError` → `requests.exceptions.ReadTimeout`
- `urllib3.exceptions.SSLError` → `requests.exceptions.SSLError`
- `urllib3.exceptions.ProxyError` → `requests.exceptions.ProxyError`
- `urllib3.exceptions.MaxRetryError` → `requests.exceptions.RetryError`

## Notes and Recommendations

### ⚠️ Important Notes

1. **Deprecated Method**: `get_connection()` is deprecated. Use `get_connection_with_tls_context()` for new implementations.

2. **SSL Context**: The module creates a preloaded SSL context for performance optimization on standard requests.

3. **SOCKS Support**: SOCKS proxy support requires additional dependencies. Install with `pip install requests[socks]