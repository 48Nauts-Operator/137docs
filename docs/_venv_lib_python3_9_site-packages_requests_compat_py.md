<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.compat Module Documentation

## Overview

The `requests.compat` module handles compatibility and import resolution for the Python `requests` library. While it was originally designed to manage compatibility between Python 2 and Python 3, it now primarily serves as a backwards compatibility layer and import resolver for various dependencies.

## Purpose

- **Legacy Support**: Maintains backwards compatibility for existing code that imports from this module
- **Import Resolution**: Automatically detects and imports the best available implementations of certain libraries
- **Type Definitions**: Provides consistent type definitions across different Python versions
- **Centralized Imports**: Consolidates imports from various standard library modules

## Key Components

### Character Detection

#### `_resolve_char_detection()`

```python
def _resolve_char_detection():
    """Find supported character detection libraries."""
```

- **Purpose**: Automatically detects and imports available character encoding detection libraries
- **Priority Order**: 
  1. `chardet` (original library)
  2. `charset_normalizer` (modern alternative)
- **Returns**: The first available character detection module, or `None` if neither is found
- **Usage**: Used internally to set the global `chardet` variable

### Python Version Detection

The module provides boolean flags for Python version checking:

- **`is_py2`**: `True` if running Python 2.x (legacy support)
- **`is_py3`**: `True` if running Python 3.x

### JSON Module Resolution

The module intelligently selects the best JSON implementation:

```python
has_simplejson = False
try:
    import simplejson as json
    has_simplejson = True
except ImportError:
    import json
```

- **Priority**: Uses `simplejson` if available, falls back to standard `json`
- **Exception Handling**: Imports `JSONDecodeError` from the selected JSON module

### Type Definitions

Provides consistent type definitions for cross-version compatibility:

- **`builtin_str`**: Reference to the built-in string type
- **`str`**: String type alias
- **`bytes`**: Bytes type alias  
- **`basestring`**: Tuple containing both string and bytes types `(str, bytes)`
- **`numeric_types`**: Tuple of numeric types `(int, float)`
- **`integer_types`**: Tuple containing integer types `(int,)`

### Standard Library Imports

The module centralizes imports from various standard library modules:

#### Collections
- `OrderedDict` from `collections`
- `Callable`, `Mapping`, `MutableMapping` from `collections.abc`

#### HTTP Related
- `cookielib` (aliased from `http.cookiejar`)
- `Morsel` from `http.cookies`

#### URL Processing
From `urllib.parse`:
- `quote`, `quote_plus`, `unquote`, `unquote_plus`
- `urldefrag`, `urlencode`, `urljoin`
- `urlparse`, `urlsplit`, `urlunparse`

#### Network Utilities
From `urllib.request`:
- `getproxies`, `getproxies_environment`
- `parse_http_list`
- `proxy_bypass`, `proxy_bypass_environment`

#### I/O
- `StringIO` from `io`

## Usage Notes

### ⚠️ Deprecation Warning
This module is maintained for backwards compatibility and may be removed in future major versions of the requests library.

### Best Practices
- **Avoid Direct Usage**: New code should import directly from standard library modules instead of using this compatibility layer
- **Character Detection**: The module automatically handles character detection library selection, so you can use `requests.compat.chardet` without worrying about which implementation is available

### Migration Suggestions
If you're currently importing from `requests.compat`, consider updating your imports:

```python
# Instead of:
from requests.compat import urlparse, urljoin

# Use:
from urllib.parse import urlparse, urljoin
```

## Dependencies

### Required
- Python standard library modules

### Optional
- `chardet` or `charset_normalizer` (for character encoding detection)
- `simplejson` (preferred over standard `json` if available)