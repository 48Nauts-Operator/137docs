<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# requests.compat Module Documentation

## Overview

The `requests.compat` module is a compatibility layer that was originally designed to handle import differences between Python 2 and Python 3. While Python 2 support has been dropped, this module is maintained for backwards compatibility until the next major version of the requests library.

## Purpose

- **Legacy Support**: Maintains backwards compatibility for code that imports from `requests.compat`
- **Unified Imports**: Provides a single location for commonly used modules and functions
- **Character Detection**: Handles dynamic loading of character detection libraries
- **JSON Handling**: Manages JSON library preferences (simplejson vs standard json)

## Key Components

### Character Detection

#### `_resolve_char_detection()`

```python
def _resolve_char_detection():
    """Find supported character detection libraries."""
```

- **Purpose**: Dynamically discovers and loads available character detection libraries
- **Priority Order**: 
  1. `chardet`
  2. `charset_normalizer`
- **Returns**: The first available character detection module, or `None` if neither is found
- **Usage**: Called once at module import to set the global `chardet` variable

### Python Version Detection

The module provides boolean flags for Python version detection:

```python
#: Python 2.x?
is_py2 = _ver[0] == 2

#: Python 3.x?
is_py3 = _ver[0] == 3
```

- **Note**: `is_py2` will always be `False` in current versions since Python 2 support was dropped
- **Maintained for**: Backwards compatibility with existing code

### JSON Library Management

```python
has_simplejson = False
try:
    import simplejson as json
    has_simplejson = True
except ImportError:
    import json
```

- **Purpose**: Prefers `simplejson` over standard library `json` when available
- **Fallback**: Uses standard library `json` if `simplejson` is not installed
- **Error Handling**: Imports appropriate `JSONDecodeError` class based on the chosen JSON library

### Type Definitions

The module defines several type aliases for compatibility:

```python
builtin_str = str
str = str
bytes = bytes
basestring = (str, bytes)
numeric_types = (int, float)
integer_types = (int,)
```

## Imported Modules and Functions

### Collections
- `OrderedDict` from `collections`
- `Callable`, `Mapping`, `MutableMapping` from `collections.abc`

### HTTP and Cookies
- `cookielib` (aliased from `http.cookiejar`)
- `Morsel` from `http.cookies`

### I/O
- `StringIO` from `io`

### URL Processing
From `urllib.parse`:
- `quote`, `quote_plus`
- `unquote`, `unquote_plus`
- `urldefrag`, `urlencode`, `urljoin`
- `urlparse`, `urlsplit`, `urlunparse`

### Network Utilities
From `urllib.request`:
- `getproxies`, `getproxies_environment`
- `parse_http_list`
- `proxy_bypass`, `proxy_bypass_environment`

## Usage Notes

### ⚠️ Deprecation Warning

This module is maintained for backwards compatibility only. New code should import these functions and classes directly from their respective standard library modules.

### Migration Suggestions

Instead of:
```python
from requests.compat import urlparse, urljoin
```

Use:
```python
from urllib.parse import urlparse, urljoin
```

### Character Detection

The `chardet` variable will be `None` if no character detection library is available. Always check for `None` before using:

```python
if chardet is not None:
    detected = chardet.detect(data)
```

## Dependencies

- **Optional**: `chardet` or `charset_normalizer` for character detection
- **Optional**: `simplejson` for enhanced JSON processing
- **Required**: Standard library modules (urllib, json, collections, etc.)