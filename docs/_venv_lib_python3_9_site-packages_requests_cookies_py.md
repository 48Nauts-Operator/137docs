<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.cookies

## Overview

This module provides compatibility code to use Python's `http.cookiejar.CookieJar` with the requests library. It bridges the gap between the standard library's cookie handling and requests' HTTP client functionality by providing wrapper classes and utility functions.

## Purpose

- Enable seamless cookie management between requests and Python's standard cookie jar
- Provide a dictionary-like interface for cookie operations while maintaining CookieJar compatibility
- Handle cookie extraction from HTTP responses and injection into HTTP requests
- Support various cookie formats and conversion between them

## Important Classes

### MockRequest

Wraps a `requests.Request` object to mimic a `urllib2.Request` interface that `http.cookiejar.CookieJar` expects.

**Key Methods:**
- `get_type()` - Returns URL scheme
- `get_host()` - Returns URL netloc 
- `get_full_url()` - Returns full URL, handling Host header edge cases
- `add_unredirected_header(name, value)` - Adds headers that won't be redirected
- `get_new_headers()` - Returns newly added headers

### MockResponse

Wraps HTTP headers to mimic a `urllib.addinfourl` interface for cookie jar compatibility.

**Key Methods:**
- `info()` - Returns the headers object
- `getheaders(name)` - Gets headers by name

### RequestsCookieJar

The main cookie jar class that extends `http.cookiejar.CookieJar` with dictionary-like operations.

**Key Features:**
- Dictionary interface (`__getitem__`, `__setitem__`, `__delitem__`)
- Standard dict methods (`keys()`, `values()`, `items()`, `get()`, `set()`)
- Domain and path specific operations
- Pickleable (unlike standard CookieJar)
- Thread-safe with RLock

**Important Methods:**
```python
def get(self, name, default=None, domain=None, path=None)
def set(self, name, value, **kwargs)  
def get_dict(self, domain=None, path=None)
def list_domains(self)
def list_paths(self)
def multiple_domains(self)
```

### CookieConflictError

Exception raised when multiple cookies match the same criteria.

## Important Functions

### Cookie Extraction and Management

```python
def extract_cookies_to_jar(jar, request, response)
```
Extracts cookies from HTTP response into a CookieJar.

```python
def get_cookie_header(jar, request)
```
Generates appropriate Cookie header string for a request.

```python
def remove_cookie_by_name(cookiejar, name, domain=None, path=None)
```
Removes cookies by name, with optional domain/path filtering.

### Cookie Creation and Conversion

```python
def create_cookie(name, value, **kwargs)
```
Creates a Cookie object from basic parameters with sensible defaults.

```python
def morsel_to_cookie(morsel)
```
Converts a `http.cookies.Morsel` object to a `Cookie` object.

### Utility Functions

```python
def cookiejar_from_dict(cookie_dict, cookiejar=None, overwrite=True)
```
Creates a CookieJar from a dictionary of key-value pairs.

```python
def merge_cookies(cookiejar, cookies)
```
Merges cookies from various sources into an existing CookieJar.

```python
def _copy_cookie_jar(jar)
```
Creates a deep copy of a CookieJar, handling both RequestsCookieJar and generic CookieJar instances.

## Usage Notes

### Performance Considerations
- ⚠️ **Warning**: Dictionary operations that are normally O(1) may be O(n) due to the underlying CookieJar implementation
- Cookie lookups iterate through all cookies to find matches

### Threading
- Uses `threading.RLock` for thread safety
- Falls back to `dummy_threading` if threading is unavailable

### Import Considerations
- `requests.utils` imports from this module, so be careful with circular imports
- Uses compatibility imports from `requests.compat`

### Cookie Conflicts
- Use `_find()` for internal operations (chooses arbitrarily among conflicts)
- Use `_find_no_duplicates()` when you want exceptions on conflicts
- Specify `domain` and `path` parameters to resolve naming collisions

## Example Usage

```python
# Create a cookie jar
jar = RequestsCookieJar()

# Set cookies with dictionary interface
jar['session_id'] = 'abc123'
jar.set('user_pref', 'dark_mode', domain='example.com', path='/settings')

# Get cookies
session_id = jar.get('session_id')
user_pref = jar.get('user_pref', domain='example.com', path='/settings')

# Convert to plain dict
cookie_dict = jar.get_dict()

# Merge from another source
jar = merge_cookies(jar, {'new_cookie': 'value'})
```

## Compatibility

This module maintains compatibility with:
- Python's standard `http.cookiejar.CookieJar`
- `LWPCookieJar` and `FileCookieJar`  
- Dictionary-like interfaces expected by client code
- Pickling/unpickling operations