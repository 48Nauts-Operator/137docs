<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# requests.sessions Module Documentation

## Overview

The `requests.sessions` module provides session management functionality for the Python requests library. It enables persistent settings across multiple HTTP requests, including cookies, authentication, proxies, and connection pooling.

## Purpose

- **Session Management**: Maintain consistent settings across multiple requests
- **Cookie Persistence**: Automatically handle cookies between requests
- **Connection Pooling**: Reuse connections for improved performance
- **Configuration Management**: Centralize authentication, headers, and proxy settings
- **Redirect Handling**: Intelligently manage HTTP redirects with proper security considerations

## Key Classes

### Session

The main class that provides session functionality with persistent settings.

```python
import requests

# Basic usage
s = requests.Session()
response = s.get('https://httpbin.org/get')

# Context manager usage
with requests.Session() as s:
    response = s.get('https://httpbin.org/get')
```

#### Key Attributes

- **`headers`**: Default headers sent with each request
- **`cookies`**: Cookie jar for automatic cookie management
- **`auth`**: Default authentication credentials
- **`proxies`**: Proxy configuration dictionary
- **`verify`**: SSL certificate verification setting (default: `True`)
- **`cert`**: SSL client certificate configuration
- **`max_redirects`**: Maximum number of redirects allowed (default: 30)
- **`trust_env`**: Whether to trust environment variables for configuration

#### HTTP Methods

The Session class provides convenience methods for all standard HTTP verbs:

```python
session.get(url, **kwargs)
session.post(url, data=None, json=None, **kwargs)
session.put(url, data=None, **kwargs)
session.patch(url, data=None, **kwargs)
session.delete(url, **kwargs)
session.head(url, **kwargs)
session.options(url, **kwargs)
```

### SessionRedirectMixin

A mixin class that handles HTTP redirect logic with security considerations.

#### Key Methods

- **`resolve_redirects()`**: Generator that handles the redirect chain
- **`should_strip_auth()`**: Determines when to remove authentication headers during redirects
- **`rebuild_auth()`**: Reconstructs authentication for redirected requests
- **`rebuild_proxies()`**: Updates proxy configuration for redirected requests

## Important Functions

### merge_setting()

```python
def merge_setting(request_setting, session_setting, dict_class=OrderedDict)
```

Intelligently merges request-specific settings with session defaults. Request settings take precedence over session settings.

### merge_hooks()

```python
def merge_hooks(request_hooks, session_hooks, dict_class=OrderedDict)
```

Properly merges event hooks from both request and session levels.

### session()

```python
def session()
```

**⚠️ Deprecated**: Factory function that returns a Session instance. Use `Session()` directly instead.

## Usage Examples

### Basic Session Usage

```python
import requests

# Create a session with default settings
s = requests.Session()
s.headers.update({'User-Agent': 'MyApp/1.0'})
s.auth = ('username', 'password')

# All requests will use these settings
response1 = s.get('https://api.example.com/data')
response2 = s.post('https://api.example.com/submit', json={'key': 'value'})
```

### Cookie Persistence

```python
s = requests.Session()

# Login request - cookies are automatically stored
s.post('https://example.com/login', data={'user': 'me', 'pass': 'secret'})

# Subsequent requests automatically include login cookies
protected_data = s.get('https://example.com/protected')
```

### Proxy Configuration

```python
s = requests.Session()
s.proxies = {
    'http': 'http://proxy.example.com:8080',
    'https': 'https://proxy.example.com:8080'
}

response = s.get('https://httpbin.org/ip')  # Uses proxy
```

## Security Considerations

### SSL Verification

- **Default**: `verify=True` (recommended for production)
- **Testing Only**: Set `verify=False` only for development/testing
- **Custom CA Bundle**: Provide path to custom certificate bundle

```python
# Secure (default)
s = requests.Session()
s.verify = True  # or path to CA bundle

# ⚠️ Insecure - only for testing
s.verify = False
```

### Authentication Stripping

The session automatically removes authentication headers when redirecting to different hosts to prevent credential leakage:

```python
# Auth header removed when redirecting to different domain
s.auth = ('user', 'pass')
response = s.get('https://site1.com/redirect-to-site2')
```

## Notes and Best Practices

### Performance

- **Connection Pooling**: Sessions automatically reuse connections for better performance
- **Context Manager**: Use `with` statement to ensure proper cleanup:

```python
with requests.Session() as s:
    # Session automatically closed when exiting context
    response = s.get('https://example.com')
```

### Environment Integration

- **Trust Environment**: `trust_env=True` (default) respects environment variables:
  - `HTTP_PROXY`, `HTTPS_PROXY` for proxy settings
  - `REQUESTS_CA_BUNDLE`, `CURL_CA_BUNDLE` for CA certificates
  - `.netrc` file for authentication

### Error Handling

The module handles various error conditions:

- **`TooManyRedirects`**: Raised when redirect limit exceeded
- **`InvalidSchema`**: Raised when no adapter found for URL scheme
- **Connection errors**: Properly cleaned up through connection pooling

### Adapter System

Sessions use an adapter pattern for different protocols:

```python
from requests.adapters import HTTPAdapter

s = requests.Session()
# Mount custom adapter
s.mount('https://', HTTPAdapter(max_retries=3))
```

## Migration Notes

- The `session()` factory function is deprecated since v1.0.0
- Use `Session()` constructor directly for new code
- Existing code using `session()` will continue to work but should be updated