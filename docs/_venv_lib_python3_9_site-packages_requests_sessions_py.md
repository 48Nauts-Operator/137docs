<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# requests.sessions Module Documentation

## Overview

The `requests.sessions` module provides session management functionality for the Python `requests` library. It enables persistent settings across multiple HTTP requests, including cookies, authentication, proxies, and connection pooling.

## Purpose

This module's primary purpose is to:
- Maintain persistent settings across multiple HTTP requests
- Handle cookie management automatically
- Manage connection pooling for improved performance
- Provide a consistent interface for HTTP operations
- Handle redirects intelligently while preserving security

## Key Classes

### Session

The main class that provides persistent HTTP session functionality.

```python
import requests

# Basic usage
s = requests.Session()
response = s.get('https://httpbin.org/get')

# Context manager usage (recommended)
with requests.Session() as s:
    response = s.get('https://httpbin.org/get')
```

#### Key Attributes

- **`headers`**: Default headers sent with each request
- **`cookies`**: Cookie jar for automatic cookie handling
- **`auth`**: Default authentication configuration
- **`proxies`**: Proxy configuration dictionary
- **`verify`**: SSL certificate verification setting (default: `True`)
- **`cert`**: SSL client certificate configuration
- **`max_redirects`**: Maximum number of redirects to follow (default: 30)
- **`trust_env`**: Whether to trust environment variables for configuration

#### HTTP Methods

The Session class provides convenience methods for common HTTP operations:

- **`get(url, **kwargs)`**: Sends GET request
- **`post(url, data=None, json=None, **kwargs)`**: Sends POST request
- **`put(url, data=None, **kwargs)`**: Sends PUT request
- **`patch(url, data=None, **kwargs)`**: Sends PATCH request
- **`delete(url, **kwargs)`**: Sends DELETE request
- **`head(url, **kwargs)`**: Sends HEAD request
- **`options(url, **kwargs)`**: Sends OPTIONS request

### SessionRedirectMixin

A mixin class that handles HTTP redirect logic and provides methods for:
- Determining redirect targets
- Rebuilding authentication during redirects
- Managing proxy settings across redirects
- Handling different redirect status codes appropriately

## Important Functions

### merge_setting()

```python
def merge_setting(request_setting, session_setting, dict_class=OrderedDict):
```

Merges request-specific settings with session defaults. Request settings take precedence over session settings.

**Parameters:**
- `request_setting`: Setting from individual request
- `session_setting`: Default setting from session
- `dict_class`: Class to use for dictionary merging

### merge_hooks()

```python
def merge_hooks(request_hooks, session_hooks, dict_class=OrderedDict):
```

Properly merges request and session event hooks, handling edge cases where hooks might be empty.

## Usage Examples

### Basic Session Usage

```python
import requests

with requests.Session() as s:
    # Set default headers
    s.headers.update({'User-Agent': 'MyApp/1.0'})
    
    # Set authentication
    s.auth = ('username', 'password')
    
    # Make requests - settings persist
    r1 = s.get('https://api.example.com/data')
    r2 = s.post('https://api.example.com/submit', json={'key': 'value'})
```

### Cookie Persistence

```python
with requests.Session() as s:
    # Login request sets cookies
    s.post('https://example.com/login', data={'user': 'me', 'pass': 'secret'})
    
    # Subsequent requests automatically include cookies
    profile = s.get('https://example.com/profile')
```

### Proxy Configuration

```python
with requests.Session() as s:
    s.proxies = {
        'http': 'http://proxy.example.com:8080',
        'https': 'https://proxy.example.com:8080'
    }
    
    response = s.get('https://httpbin.org/ip')
```

## Security Considerations

### SSL Verification

- **Default**: SSL verification is enabled (`verify=True`)
- **Warning**: Setting `verify=False` makes your application vulnerable to MitM attacks
- **Recommendation**: Only disable SSL verification for testing purposes

```python
# Secure (default)
with requests.Session() as s:
    s.verify = True  # or path to CA bundle
    response = s.get('https://secure-site.com')

# Insecure - only for testing!
with requests.Session() as s:
    s.verify = False
    response = s.get('https://site-with-self-signed-cert.com')
```

### Authentication Handling

The session intelligently handles authentication during redirects:
- Strips authentication headers when redirecting to different hosts
- Preserves authentication for same-host redirects
- Supports automatic authentication from `.netrc` files

## Performance Notes

### Connection Pooling

Sessions automatically handle connection pooling through adapters:
- HTTP and HTTPS adapters are mounted by default
- Connections are reused when possible
- Call `session.close()` or use context manager to properly cleanup

### Adapter Management

```python
from requests.adapters import HTTPAdapter

with requests.Session() as s:
    # Mount custom adapter with specific configuration
    adapter = HTTPAdapter(max_retries=3)
    s.mount('https://', adapter)
    s.mount('http://', adapter)
```

## Best Practices

1. **Use Context Managers**: Always use `with` statements or manually call `close()`
2. **Reuse Sessions**: Create one session per logical grouping of requests
3. **Configure Once**: Set common headers, auth, and proxies at session level
4. **Handle Exceptions**: Be prepared for network-related exceptions
5. **Verify SSL**: Keep SSL verification enabled in production

## Notes and Limitations

- The deprecated `session()` function is kept for backwards compatibility
- Redirect limits prevent infinite redirect loops
- Cookie handling follows HTTP standards but may need customization for specific use cases
- Environment variables (like `REQUESTS_CA_BUNDLE`) are respected when `trust_env=True`

## Environment Variables

The session respects these environment variables when `trust_env=True`:
- `REQUESTS_CA