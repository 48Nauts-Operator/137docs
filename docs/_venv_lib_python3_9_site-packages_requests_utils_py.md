<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# requests.utils

## Overview

The `requests.utils` module provides a collection of utility functions that are used internally by the Requests library and are also available for external consumption. This module contains helper functions for handling URLs, headers, authentication, proxies, encodings, file operations, and various data transformations commonly needed when working with HTTP requests.

## Purpose

This module serves as a toolkit for:
- URL manipulation and validation
- HTTP header parsing and validation
- Authentication handling (netrc, URL-based)
- Proxy configuration and detection
- File and encoding operations
- Data structure conversions
- Network utilities

## Important Constants

- `NETRC_FILES`: Tuple containing netrc file names (`".netrc"`, `"_netrc"`)
- `DEFAULT_CA_BUNDLE_PATH`: Path to default CA certificate bundle
- `DEFAULT_PORTS`: Dictionary mapping protocols to default ports (`{"http": 80, "https": 443}`)
- `DEFAULT_ACCEPT_ENCODING`: Default accept-encoding header value
- `UNRESERVED_SET`: Set of unreserved URI characters per RFC 3986

## Key Functions

### Authentication Functions

#### `get_netrc_auth(url, raise_errors=False)`
Extracts authentication credentials from netrc files for a given URL.

```python
auth = get_netrc_auth("https://example.com")
# Returns tuple: (username, password) or None
```

#### `get_auth_from_url(url)`
Extracts username and password from URLs containing authentication components.

```python
username, password = get_auth_from_url("https://user:pass@example.com")
```

### URL Utilities

#### `requote_uri(uri)`
Re-quotes a URI to ensure it's fully and consistently quoted.

```python
clean_uri = requote_uri("https://example.com/path with spaces")
```

#### `unquote_unreserved(uri)`
Un-escapes percent-encoded sequences for unreserved characters only.

#### `prepend_scheme_if_needed(url, new_scheme)`
Adds a scheme to a URL if one isn't present.

```python
full_url = prepend_scheme_if_needed("example.com", "https")
# Returns: "https://example.com"
```

#### `urldefragauth(url)`
Removes fragment and authentication parts from a URL.

### Header Utilities

#### `parse_list_header(value)`
Parses comma-separated lists from HTTP headers, handling quoted strings properly.

```python
items = parse_list_header('token, "quoted value"')
# Returns: ['token', 'quoted value']
```

#### `parse_dict_header(value)`
Parses key-value pairs from HTTP headers into a dictionary.

```python
params = parse_dict_header('foo="bar", baz="qux"')
# Returns: {'foo': 'bar', 'baz': 'qux'}
```

#### `check_header_validity(header)`
Validates that header names and values don't contain invalid characters.

#### `get_encoding_from_headers(headers)`
Extracts character encoding from HTTP Content-Type headers.

### Data Structure Utilities

#### `from_key_val_list(value)`
Converts various input types to an OrderedDict.

```python
result = from_key_val_list([('key', 'val')])
# Returns: OrderedDict([('key', 'val')])
```

#### `to_key_val_list(value)`
Converts dictionaries and mappings to lists of key-value tuples.

#### `dict_to_sequence(d)`
Converts dictionary-like objects to sequences for internal use.

### File and Content Utilities  

#### `super_len(o)`
Determines the length of various object types (strings, files, streams).

```python
length = super_len(file_object)
```

#### `guess_filename(obj)`
Attempts to guess the filename from file-like objects.

#### `extract_zipped_paths(path)`
Extracts files from zip archives when referenced in paths.

#### `atomic_open(filename)`
Context manager for atomic file writing operations.

```python
with atomic_open('file.txt') as f:
    f.write(data)  # File is written atomically
```

### Proxy Utilities

#### `should_bypass_proxies(url, no_proxy)`
Determines whether proxies should be bypassed for a given URL.

#### `get_environ_proxies(url, no_proxy=None)`
Returns proxy configuration from environment variables.

#### `select_proxy(url, proxies)`
Selects appropriate proxy for a URL from available proxy configurations.

#### `resolve_proxies(request, proxies, trust_env=True)`
Resolves final proxy configuration considering environment and explicit settings.

### Network Utilities

#### `address_in_network(ip, net)`
Checks if an IP address belongs to a network subnet.

```python
is_in_network = address_in_network("192.168.1.1", "192.168.1.0/24")
# Returns: True
```

#### `is_ipv4_address(string_ip)`
Validates if a string represents a valid IPv4 address.

#### `is_valid_cidr(string_network)`
Validates CIDR notation for network addresses.

### Cookie Utilities

#### `dict_from_cookiejar(cj)`
Converts a CookieJar to a dictionary.

#### `add_dict_to_cookiejar(cj, cookie_dict)`
Adds dictionary cookies to a CookieJar.

### Encoding and Content Utilities

#### `stream_decode_response_unicode(iterator, r)`
Streams and decodes response content with proper encoding handling.

#### `guess_json_utf(data)`
Attempts to detect UTF encoding of JSON data by analyzing byte patterns.

### Miscellaneous Utilities

#### `default_user_agent(name="python-requests")`
Returns the default User-Agent string.

#### `default_headers()`
Returns default HTTP headers as a CaseInsensitiveDict.

#### `iter_slices(string, slice_length)`
Iterates over slices of a string with specified length.

## Platform-Specific Features

### Windows Proxy Support
On Windows systems, the module provides `proxy_bypass_registry