<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# RequestMethods Module Documentation

## Overview

The `RequestMethods` module provides a convenience mixin class for implementing HTTP request functionality. It serves as a high-level interface for making various types of HTTP requests with automatic encoding based on the request method type.

## Purpose

This module acts as a bridge between raw HTTP connection handling and user-friendly request methods. It automatically determines the appropriate encoding strategy (URL encoding vs. body encoding) based on the HTTP method being used.

## Key Features

- **Automatic encoding selection**: Chooses between URL and body encoding based on HTTP method
- **JSON support**: Built-in JSON serialization with proper content-type headers
- **Multipart form data**: Support for file uploads and complex form data
- **Header management**: Flexible header handling with sensible defaults

## Classes

### `RequestMethods`

A mixin class that provides HTTP request method implementations.

#### Class Attributes

- `_encode_url_methods`: Set of HTTP methods that use URL encoding (`{"DELETE", "GET", "HEAD", "OPTIONS"}`)

#### Constructor

```python
def __init__(self, headers: typing.Mapping[str, str] | None = None) -> None:
```

**Parameters:**
- `headers`: Default headers to include with all requests

## Methods

### `urlopen()` (Abstract)

```python
def urlopen(
    self,
    method: str,
    url: str,
    body: _TYPE_BODY | None = None,
    headers: typing.Mapping[str, str] | None = None,
    encode_multipart: bool = True,
    multipart_boundary: str | None = None,
    **kw: typing.Any,
) -> BaseHTTPResponse:
```

**Abstract method** that must be implemented by subclasses. Performs the actual HTTP request.

### `request()` - Main Request Method

```python
def request(
    self,
    method: str,
    url: str,
    body: _TYPE_BODY | None = None,
    fields: _TYPE_FIELDS | None = None,
    headers: typing.Mapping[str, str] | None = None,
    json: typing.Any | None = None,
    **urlopen_kw: typing.Any,
) -> BaseHTTPResponse:
```

**Primary method** for making HTTP requests with automatic encoding selection.

**Parameters:**
- `method`: HTTP method (GET, POST, PUT, etc.)
- `url`: Target URL
- `body`: Raw request body data
- `fields`: Form data to encode
- `headers`: Custom headers
- `json`: Data to serialize as JSON

**Key Features:**
- Automatically selects encoding method based on HTTP verb
- Handles JSON serialization with UTF-8 encoding
- Sets appropriate `Content-Type` headers
- Validates mutually exclusive parameters (`body` and `json`)

### `request_encode_url()`

```python
def request_encode_url(
    self,
    method: str,
    url: str,
    fields: _TYPE_ENCODE_URL_FIELDS | None = None,
    headers: typing.Mapping[str, str] | None = None,
    **urlopen_kw: str,
) -> BaseHTTPResponse:
```

**Specialized method** for requests that encode data in the URL query string.

**Use Cases:**
- GET requests with parameters
- HEAD requests
- DELETE requests with identifiers

### `request_encode_body()`

```python
def request_encode_body(
    self,
    method: str,
    url: str,
    fields: _TYPE_FIELDS | None = None,
    headers: typing.Mapping[str, str] | None = None,
    encode_multipart: bool = True,
    multipart_boundary: str | None = None,
    **urlopen_kw: str,
) -> BaseHTTPResponse:
```

**Specialized method** for requests that encode data in the request body.

**Parameters:**
- `encode_multipart`: Use multipart/form-data encoding (default: True)
- `multipart_boundary`: Custom boundary string for multipart encoding

**Use Cases:**
- POST requests with form data
- File uploads
- PUT/PATCH requests with payload

#### Example Field Formats

```python
fields = {
    'foo': 'bar',                                    # Simple key-value
    'fakefile': ('foofile.txt', 'contents'),        # File tuple
    'realfile': ('barfile.txt', file_content),      # Real file content
    'typedfile': ('bazfile.bin', content, 'image/jpeg'),  # With MIME type
    'nonamefile': 'contents of field',              # Content only
}
```

## Type Definitions

```python
_TYPE_ENCODE_URL_FIELDS = typing.Union[
    typing.Sequence[tuple[str, typing.Union[str, bytes]]],
    typing.Mapping[str, typing.Union[str, bytes]],
]
```

## Usage Notes

### Important Considerations

- **Mixin Design**: This class is designed to be mixed with classes that implement `urlopen()`
- **Method Selection**: URL encoding is automatically used for GET, HEAD, DELETE, OPTIONS
- **JSON Handling**: JSON serialization uses compact format with UTF-8 encoding
- **Content-Type Management**: Automatically sets appropriate content-type headers

### Error Handling

- Raises `TypeError` when both `body` and `json` parameters are provided
- Raises `TypeError` when both `fields` and `body` are provided in body-encoded requests
- Raises `NotImplementedError` if `urlopen()` is not implemented by subclass

### Best Practices

1. **Use `request()` method** for most cases - it handles encoding automatically
2. **Prefer multipart encoding** for file uploads
3. **Set default headers** in constructor for common headers like User-Agent
4. **Use JSON parameter** instead of manually encoding JSON in body

## Dependencies

- `json`: JSON serialization
- `urllib.parse.urlencode`: URL encoding
- `._collections.HTTPHeaderDict`: Header management
- `.filepost.encode_multipart_formdata`: Multipart encoding
- `.response.BaseHTTPResponse`: Response handling