<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# RequestMethods Module Documentation

## Overview

The `RequestMethods` module provides a convenient mixin class for making HTTP requests with automatic encoding of request fields. It serves as a high-level interface that simplifies the process of sending different types of HTTP requests by automatically determining the appropriate encoding method based on the HTTP method used.

## Purpose

This module is designed to be mixed into classes that implement a `urlopen` method (such as `urllib3.HTTPConnectionPool` and `urllib3.PoolManager`) to provide convenient methods for making common HTTP requests with proper field encoding.

## Key Features

- **Automatic encoding selection**: Chooses between URL encoding and body encoding based on HTTP method
- **JSON support**: Built-in JSON serialization and content-type handling
- **Multipart form data**: Support for file uploads and multipart encoding
- **Header management**: Flexible header handling with defaults and overrides

## Classes

### RequestMethods

A mixin class that provides high-level HTTP request methods with automatic field encoding.

#### Class Attributes

- `_encode_url_methods`: A set of HTTP methods that encode fields in the URL
  ```python
  {"DELETE", "GET", "HEAD", "OPTIONS"}
  ```

#### Constructor

```python
def __init__(self, headers: typing.Mapping[str, str] | None = None) -> None
```

**Parameters:**
- `headers`: Default headers to include with all requests

## Key Methods

### `request()`

The primary method for making HTTP requests with automatic encoding selection.

```python
def request(
    self,
    method: str,
    url: str,
    body: _TYPE_BODY | None = None,
    fields: _TYPE_FIELDS | None = None,
    headers: typing.Mapping[str, str] | None = None,
    json: typing.Any | None = None,
    **urlopen_kw: typing.Any,
) -> BaseHTTPResponse
```

**Parameters:**
- `method`: HTTP method (GET, POST, PUT, etc.)
- `url`: Target URL
- `body`: Raw request body data
- `fields`: Data to encode (URL or body depending on method)
- `headers`: Custom headers
- `json`: Data to encode as JSON
- `**urlopen_kw`: Additional arguments passed to `urlopen`

**Key Features:**
- Automatically selects encoding method based on HTTP method
- Handles JSON serialization with proper Content-Type header
- Prevents conflicting `body` and `json` parameters

### `request_encode_url()`

Makes requests with fields encoded in the URL query string.

```python
def request_encode_url(
    self,
    method: str,
    url: str,
    fields: _TYPE_ENCODE_URL_FIELDS | None = None,
    headers: typing.Mapping[str, str] | None = None,
    **urlopen_kw: str,
) -> BaseHTTPResponse
```

**Best for:** GET, HEAD, DELETE, OPTIONS requests

### `request_encode_body()`

Makes requests with fields encoded in the request body.

```python
def request_encode_body(
    self,
    method: str,
    url: str,
    fields: _TYPE_FIELDS | None = None,
    headers: typing.Mapping[str, str] | None = None,
    encode_multipart: bool = True,
    multipart_boundary: str | None = None,
    **urlopen_kw: str,
) -> BaseHTTPResponse
```

**Parameters:**
- `encode_multipart`: Whether to use multipart/form-data encoding
- `multipart_boundary`: Custom boundary string for multipart encoding

**Best for:** POST, PUT, PATCH requests

**Encoding Options:**
- **Multipart encoding** (default): For file uploads and complex forms
- **URL encoding**: For simple form data (`application/x-www-form-urlencoded`)

## Usage Examples

### Basic Request
```python
# GET request with URL parameters
response = client.request('GET', '/api/users', fields={'page': 1, 'limit': 10})

# POST request with JSON data
response = client.request('POST', '/api/users', json={'name': 'John', 'email': 'john@example.com'})
```

### File Upload
```python
fields = {
    'username': 'john',
    'file': ('document.pdf', file_data, 'application/pdf')
}
response = client.request('POST', '/upload', fields=fields)
```

### Custom Headers
```python
headers = {'Authorization': 'Bearer token123'}
response = client.request('GET', '/protected', headers=headers)
```

## Type Definitions

- `_TYPE_ENCODE_URL_FIELDS`: Union of sequences and mappings for URL field encoding
- `_TYPE_FIELDS`: Defined in `filepost` module for multipart form data
- `_TYPE_BODY`: Defined in `_base_connection` for request body types

## Important Notes

### ‚ö†Ô∏è Key Considerations

1. **Mutually Exclusive Parameters**: Cannot specify both `body` and `json` parameters simultaneously
2. **Content-Type Override**: When using `request_encode_body()`, the Content-Type header may be overwritten for proper encoding
3. **File Upload Requirements**: Multipart encoding is required for file uploads
4. **OAuth Compatibility**: Multipart encoding may break request signing for OAuth

### üîß Implementation Requirements

Classes using this mixin must implement the abstract `urlopen()` method:

```python
def urlopen(
    self,
    method: str,
    url: str,
    body: _TYPE_BODY | None = None,
    headers: typing.Mapping[str, str] | None = None,
    encode_multipart: bool = True,
    multipart_boundary: str | None = None,
    **kw: typing.Any,
) -> BaseHTTPResponse:
    # Implementation required
    raise NotImplementedError("Classes extending RequestMethods must implement their own urlopen method.")
```

### üìù Best Practices

- Use the high-level `request()` method for most use cases
- Use specific `request_encode_*()` methods when you need precise control over encoding
- Set default headers in the constructor for common headers like User-Agent
- Use `json` parameter for JSON APIs