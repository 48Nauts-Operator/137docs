<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# HTTP Connection Module Documentation

This module provides HTTP and HTTPS connection classes for the urllib3 library, extending Python's built-in `http.client` functionality with additional features like proxy support, SSL/TLS configuration, and connection pooling capabilities.

## Overview

The module implements custom HTTP connection classes that serve as the foundation for urllib3's connection handling. It provides enhanced error handling, proxy support, SSL/TLS configuration, and HTTP/2 probing capabilities.

## Key Classes

### `HTTPConnection`

A custom HTTP connection class that extends `http.client.HTTPConnection` with additional functionality.

**Key Features:**
- Custom socket options configuration
- Proxy support (forwarding and tunneling)
- Enhanced timeout handling
- Connection state tracking
- Chunked transfer encoding support

**Constructor Parameters:**
- `host`: Target hostname
- `port`: Target port (defaults to 80 for HTTP)
- `timeout`: Connection timeout
- `source_address`: Source address for the connection
- `blocksize`: Block size for data transfer (default: 16384)
- `socket_options`: Custom socket options
- `proxy`: Proxy URL configuration
- `proxy_config`: Proxy configuration object

**Important Properties:**
- `is_verified`: Whether the connection is verified (always `False` for HTTP)
- `is_closed`: Whether the connection is closed
- `is_connected`: Whether the connection is active
- `proxy_is_forwarding`: Whether using a forwarding proxy
- `proxy_is_tunneling`: Whether using a tunneling proxy

### `HTTPSConnection`

Extends `HTTPConnection` to provide HTTPS/SSL functionality.

**Key Features:**
- SSL/TLS configuration and certificate verification
- Support for client certificates
- Certificate fingerprint verification
- SSL context customization
- TLS-in-TLS for HTTPS proxies
- HTTP/2 protocol probing

**Additional Constructor Parameters:**
- `cert_reqs`: Certificate requirements level
- `ca_certs`: CA certificate file path
- `ca_cert_dir`: CA certificate directory
- `ssl_context`: Custom SSL context
- `cert_file`: Client certificate file
- `key_file`: Client private key file
- `assert_hostname`: Hostname to verify against certificate
- `assert_fingerprint`: Expected certificate fingerprint

## Important Functions

### `_ssl_wrap_socket_and_match_hostname()`

Core function that handles SSL socket wrapping and certificate verification.

```python
def _ssl_wrap_socket_and_match_hostname(
    sock: socket.socket,
    *,
    cert_reqs: None | str | int,
    ssl_version: None | str | int,
    # ... other SSL parameters
) -> _WrappedAndVerifiedSocket:
```

**Purpose:** Wraps a socket with SSL/TLS encryption and performs certificate verification.

### `_match_hostname()`

Performs hostname verification against SSL certificates.

```python
def _match_hostname(
    cert: _TYPE_PEER_CERT_RET_DICT | None,
    asserted_hostname: str,
    hostname_checks_common_name: bool = False,
) -> None:
```

## Key Constants

- `port_by_scheme`: Default ports for HTTP (80) and HTTPS (443)
- `RECENT_DATE`: Reference date for system time validation
- `_CONTAINS_CONTROL_CHAR_RE`: Regex for detecting invalid characters in HTTP methods

## Usage Examples

### Basic HTTP Connection

```python
conn = HTTPConnection('example.com')
conn.request('GET', '/')
response = conn.getresponse()
```

### HTTPS Connection with Custom SSL

```python
conn = HTTPSConnection(
    'secure.example.com',
    cert_reqs='CERT_REQUIRED',
    ca_certs='/path/to/ca-bundle.crt'
)
conn.request('GET', '/api/data')
response = conn.getresponse()
```

### Connection with Proxy

```python
from .util.url import Url

proxy_url = Url.from_str('http://proxy.example.com:8080')
conn = HTTPConnection(
    'target.example.com',
    proxy=proxy_url
)
```

## Important Notes

### Security Considerations

- **Certificate Verification**: Always use `cert_reqs='CERT_REQUIRED'` for production HTTPS connections
- **Hostname Verification**: The module performs automatic hostname verification unless explicitly disabled
- **System Time**: The module warns about system time issues that could affect SSL verification

### Proxy Support

- **Forwarding Proxies**: HTTP requests sent through proxy without tunneling
- **Tunneling Proxies**: HTTPS requests using CONNECT method for end-to-end encryption
- **TLS-in-TLS**: Support for HTTPS connections through HTTPS proxies

### Deprecation Warnings

- `request_chunked()` method is deprecated in favor of `request(..., chunked=True)`
- `set_cert()` method is deprecated in favor of constructor parameters

### Error Handling

The module provides comprehensive error handling for:
- Connection timeouts (`ConnectTimeoutError`)
- DNS resolution failures (`NameResolutionError`)
- SSL/TLS errors with helpful diagnostics
- Proxy connection issues with HTTP/HTTPS detection

### Performance Features

- **HTTP/2 Probing**: Automatic detection of HTTP/2 support
- **Connection Reuse**: Proper connection state management for pooling
- **Chunked Encoding**: Efficient handling of large request bodies

## Dependencies

- Standard library: `socket`, `ssl`, `http.client`, `threading`
- Internal urllib3 modules for utilities, SSL helpers, and response handling
- Optional HTTP/2 support through ALPN protocol negotiation

This module serves as the foundation for urllib3's robust HTTP client functionality, providing enterprise-grade features while maintaining compatibility with Python's standard HTTP client interface.