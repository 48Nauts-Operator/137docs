<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Connection Pool Documentation

## Overview

This module implements HTTP and HTTPS connection pools for urllib3, providing efficient connection reuse, thread-safe operations, and comprehensive error handling. The connection pools manage multiple connections to the same host, enabling better performance through connection reuse in multithreaded environments.

## Purpose

- **Connection Management**: Efficiently manage multiple HTTP/HTTPS connections to the same host
- **Thread Safety**: Provide thread-safe connection pooling for concurrent requests
- **Resource Optimization**: Reuse connections to reduce overhead and improve performance
- **Error Handling**: Comprehensive exception handling and retry mechanisms
- **Proxy Support**: Built-in support for HTTP and HTTPS proxies

## Key Classes

### `ConnectionPool`

Base class for all connection pools.

```python
class ConnectionPool:
    def __init__(self, host: str, port: int | None = None) -> None:
```

**Features:**
- Basic host/port validation and normalization
- Context manager support (`__enter__`/`__exit__`)
- Abstract interface for connection pool implementations

**Key Methods:**
- `close()`: Close all pooled connections and disable the pool

### `HTTPConnectionPool`

Thread-safe connection pool for HTTP connections.

```python
class HTTPConnectionPool(ConnectionPool, RequestMethods):
    def __init__(
        self,
        host: str,
        port: int | None = None,
        timeout: _TYPE_TIMEOUT | None = _DEFAULT_TIMEOUT,
        maxsize: int = 1,
        block: bool = False,
        headers: typing.Mapping[str, str] | None = None,
        retries: Retry | bool | int | None = None,
        _proxy: Url | None = None,
        _proxy_headers: typing.Mapping[str, str] | None = None,
        _proxy_config: ProxyConfig | None = None,
        **conn_kw: typing.Any,
    ):
```

**Parameters:**
- `host`: Target hostname
- `port`: Target port (defaults to 80 for HTTP)
- `timeout`: Socket timeout configuration
- `maxsize`: Maximum number of connections to pool
- `block`: Whether to block when pool is full
- `headers`: Default headers for all requests
- `retries`: Retry configuration
- `_proxy`: Proxy configuration (internal use)

**Key Methods:**

#### `urlopen()`
Main method for making HTTP requests through the pool.

```python
def urlopen(
    self,
    method: str,
    url: str,
    body: _TYPE_BODY | None = None,
    headers: typing.Mapping[str, str] | None = None,
    retries: Retry | bool | int | None = None,
    redirect: bool = True,
    assert_same_host: bool = True,
    timeout: _TYPE_TIMEOUT = _DEFAULT_TIMEOUT,
    pool_timeout: int | None = None,
    release_conn: bool | None = None,
    chunked: bool = False,
    body_pos: _TYPE_BODY_POSITION | None = None,
    preload_content: bool = True,
    decode_content: bool = True,
    **response_kw: typing.Any,
) -> BaseHTTPResponse:
```

#### Internal Connection Management:
- `_get_conn()`: Retrieve a connection from the pool
- `_put_conn()`: Return a connection to the pool
- `_new_conn()`: Create a new connection
- `_make_request()`: Execute HTTP request on a connection

### `HTTPSConnectionPool`

HTTPS-specific connection pool with SSL/TLS support.

```python
class HTTPSConnectionPool(HTTPConnectionPool):
    def __init__(
        self,
        host: str,
        port: int | None = None,
        # ... base parameters ...
        key_file: str | None = None,
        cert_file: str | None = None,
        cert_reqs: int | str | None = None,
        key_password: str | None = None,
        ca_certs: str | None = None,
        ssl_version: int | str | None = None,
        ssl_minimum_version: ssl.TLSVersion | None = None,
        ssl_maximum_version: ssl.TLSVersion | None = None,
        assert_hostname: str | typing.Literal[False] | None = None,
        assert_fingerprint: str | None = None,
        ca_cert_dir: str | None = None,
        **conn_kw: typing.Any,
    ) -> None:
```

**Additional SSL Parameters:**
- `key_file`/`cert_file`: Client certificate files
- `cert_reqs`: Certificate verification requirements
- `ca_certs`/`ca_cert_dir`: Certificate authority configuration
- `ssl_version`: SSL/TLS version constraints
- `assert_hostname`/`assert_fingerprint`: Certificate validation options

## Utility Functions

### `connection_from_url()`

Convenience function to create connection pools from URLs.

```python
def connection_from_url(url: str, **kw: typing.Any) -> HTTPConnectionPool:
```

**Example:**
```python
pool = connection_from_url('https://api.example.com')
response = pool.request('GET', '/data')
```

### Internal Utilities

- `_normalize_host()`: Host normalization for IPv6 compatibility
- `_close_pool_connections()`: Clean shutdown of pooled connections
- `_url_from_pool()`: URL reconstruction for logging/testing

## Features

### Connection Reuse
- Maintains a pool of persistent connections
- Automatically detects and replaces dropped connections
- Configurable pool size with `maxsize` parameter

### Thread Safety
- Uses `queue.LifoQueue` for thread-safe connection management
- Proper locking and synchronization for concurrent access

### Error Handling
- Comprehensive exception wrapping and translation
- Automatic retry logic with configurable policies
- Timeout handling at multiple levels (connect, read, pool)

### Proxy Support
- HTTP and HTTPS proxy support
- Automatic HTTP CONNECT tunneling for HTTPS through proxies
- Proxy authentication header management

### SSL/TLS Features
- Flexible certificate validation options
- Support for client certificates
- Configurable SSL/TLS versions and c