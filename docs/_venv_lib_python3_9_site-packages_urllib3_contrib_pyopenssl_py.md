<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# PyOpenSSL TLS Backend Module

## Overview

This module provides a PyOpenSSL-based TLS backend for urllib3. **However, this module is now deprecated and no longer recommended** since modern Python versions (3.7+) have built-in SNI support in the standard library `ssl` module.

## Purpose

Originally created to provide SNI (Server Name Indication) support before the standard library supported it. The module allows urllib3 to use PyOpenSSL as the underlying TLS implementation instead of the standard library's `ssl` module.

## Dependencies

The module requires the following packages:
- `pyOpenSSL` (tested with 16.0.0)
- `cryptography` (minimum 1.3.4)
- `idna` (minimum 2.0)

Install with:
```bash
python -m pip install pyopenssl cryptography idna
```

## Usage

To activate PyOpenSSL as the TLS backend:

```python
try:
    import urllib3.contrib.pyopenssl
    urllib3.contrib.pyopenssl.inject_into_urllib3()
except ImportError:
    pass
```

## Key Functions

### `inject_into_urllib3()`
Monkey-patches urllib3 to use PyOpenSSL-backed SSL support.
- Replaces `util.SSLContext` with `PyOpenSSLContext`
- Sets `util.IS_PYOPENSSL = True`

### `extract_from_urllib3()`
Reverses the monkey-patching done by `inject_into_urllib3()`.
- Restores original SSL context
- Sets `util.IS_PYOPENSSL = False`

### `get_subj_alt_name(peer_cert)`
Extracts Subject Alternative Names (SANs) from a PyOpenSSL certificate.
- **Parameters**: `peer_cert` - PyOpenSSL X509 certificate
- **Returns**: List of tuples containing SAN types and values
- Handles DNS names and IP addresses
- Includes error handling for malformed certificates

## Key Classes

### `WrappedSocket`
API-compatibility wrapper for PyOpenSSL's Connection class that mimics Python's standard socket interface.

**Key Methods**:
- `recv()` / `recv_into()` - Receive data with SSL error handling
- `sendall()` - Send all data in chunks (respects `SSL_WRITE_BLOCKSIZE`)
- `getpeercert()` - Get peer certificate information
- `version()` - Get TLS protocol version
- `selected_alpn_protocol()` - Get negotiated ALPN protocol

**Error Handling**:
- Converts PyOpenSSL exceptions to standard library equivalents
- Handles timeout scenarios
- Manages TLS 1.3 post-handshake authentication errors

### `PyOpenSSLContext`
Wrapper for PyOpenSSL's Context object that provides an interface compatible with the standard library's `SSLContext`.

**Key Properties**:
- `verify_mode` - Certificate verification mode
- `verify_flags` - Certificate verification flags  
- `options` - SSL/TLS options
- `minimum_version` / `maximum_version` - TLS version constraints

**Key Methods**:
- `set_ciphers()` - Configure cipher suites
- `load_verify_locations()` - Load CA certificates
- `load_cert_chain()` - Load client certificates
- `set_alpn_protocols()` - Configure ALPN protocols
- `wrap_socket()` - Wrap a socket with SSL/TLS

## Internal Mappings

The module maintains several mapping dictionaries:
- `_openssl_versions` - Maps stdlib protocol constants to PyOpenSSL methods
- `_stdlib_to_openssl_verify` - Maps verification modes between libraries
- `_openssl_to_ssl_minimum_version` / `_openssl_to_ssl_maximum_version` - TLS version constraints

## Important Notes

⚠️ **Deprecation Warning**: This module is no longer recommended for new projects since Python 3.7+ has full SNI support built-in.

⚠️ **Compatibility**: The module includes extensive error handling and compatibility code to bridge differences between PyOpenSSL and the standard library.

⚠️ **Performance**: PyOpenSSL operations may have different performance characteristics compared to the standard library implementation.

## Validation

The `_validate_dependencies_met()` function ensures:
- Cryptography library has required functionality (v1.3.4+)
- PyOpenSSL has required functionality (v0.14+)

Raises `ImportError` if dependencies don't meet requirements.