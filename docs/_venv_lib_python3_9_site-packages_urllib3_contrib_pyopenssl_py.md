<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# PyOpenSSL TLS Backend Module

## Overview

This module provides PyOpenSSL as a TLS backend for urllib3. **This module is deprecated and no longer recommended** since Python's standard library `ssl` module now supports SNI (Server Name Indication) natively.

## Purpose

- Provides PyOpenSSL-based SSL/TLS functionality as an alternative to Python's standard library SSL
- Offers certificate verification and SSL context management using PyOpenSSL
- Allows monkey-patching urllib3 to use PyOpenSSL instead of the standard SSL library

## Dependencies

The module requires the following packages:

- `pyOpenSSL` (tested with 16.0.0)
- `cryptography` (minimum 1.3.4)
- `idna` (minimum 2.0)

Install with:
```bash
python -m pip install pyopenssl cryptography idna
```

## Main Functions

### `inject_into_urllib3()`

Monkey-patches urllib3 to use PyOpenSSL-backed SSL support.

```python
import urllib3.contrib.pyopenssl
urllib3.contrib.pyopenssl.inject_into_urllib3()
```

### `extract_from_urllib3()`

Reverts the monkey-patching done by `inject_into_urllib3()`, restoring the original SSL context.

## Key Classes

### `PyOpenSSLContext`

A wrapper class that translates the standard library `SSLContext` interface to PyOpenSSL calls.

**Key Features:**
- Protocol version management (TLS 1.0, 1.1, 1.2, 1.3)
- Certificate verification modes
- Cipher suite configuration
- Certificate chain loading
- ALPN protocol support

**Important Properties:**
- `verify_mode`: Certificate verification mode (CERT_NONE, CERT_OPTIONAL, CERT_REQUIRED)
- `options`: SSL context options
- `minimum_version`/`maximum_version`: TLS version constraints
- `check_hostname`: Whether to verify hostname

**Key Methods:**
- `wrap_socket()`: Creates a wrapped SSL socket
- `load_cert_chain()`: Loads certificate and private key
- `load_verify_locations()`: Loads CA certificates
- `set_ciphers()`: Configures cipher suites
- `set_alpn_protocols()`: Sets ALPN protocols

### `WrappedSocket`

API-compatibility wrapper for PyOpenSSL's Connection class that mimics Python's SSL socket interface.

**Key Features:**
- Standard socket methods (`recv`, `send`, `close`, etc.)
- SSL-specific methods (`getpeercert`, `version`, `selected_alpn_protocol`)
- Proper error handling and timeout management
- Certificate information extraction

## Utility Functions

### `get_subj_alt_name(peer_cert)`

Extracts Subject Alternative Names (SAN) from a PyOpenSSL certificate.

**Returns:** List of tuples containing DNS names and IP addresses from the certificate's SAN extension.

### `_validate_dependencies_met()`

Validates that required PyOpenSSL and cryptography versions are installed with necessary functionality.

## Configuration Constants

The module defines several mapping dictionaries for protocol version translation:

- `_openssl_versions`: Maps Python SSL protocols to PyOpenSSL methods
- `_stdlib_to_openssl_verify`: Maps verification modes between libraries
- `_openssl_to_ssl_minimum_version`/`_openssl_to_ssl_maximum_version`: TLS version constraint mappings

## Important Notes

⚠️ **Deprecation Warning**: This module is no longer recommended since Python 2.7 support was dropped. Modern Python versions have full SNI support in the standard library.

### Error Handling

The module handles various OpenSSL-specific exceptions and translates them to standard Python SSL exceptions:

- `OpenSSL.SSL.SysCallError` → `OSError`
- `OpenSSL.SSL.Error` → `ssl.SSLError`
- `OpenSSL.SSL.WantReadError` → Timeout handling

### Performance Considerations

- SSL writes are limited to 16KB blocks (`SSL_WRITE_BLOCKSIZE = 16384`)
- Proper timeout handling for non-blocking operations
- Certificate parsing includes fallback for unsupported extensions

### Security Features

- Support for modern TLS versions (1.0-1.3)
- Proper certificate validation
- Subject Alternative Name (SAN) processing
- ALPN protocol negotiation
- Hostname verification support

## Migration Advice

Consider migrating to Python's standard library SSL implementation unless you specifically need PyOpenSSL features not available in the standard library. The standard library SSL module is actively maintained and provides excellent security features.