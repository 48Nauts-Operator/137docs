<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# SOCKS Proxy Support Module

This module provides provisional SOCKS proxy support for urllib3, enabling HTTP and HTTPS connections through SOCKS4, SOCKS4A, and SOCKS5 proxies.

## Purpose

The module extends urllib3's functionality to route connections through SOCKS proxies while maintaining compatibility with the full range of urllib3 features. It supports various SOCKS proxy configurations including authentication and DNS resolution options.

## Dependencies

- **Required**: PySocks library
- **Optional**: ssl module (for HTTPS support)

> **Note**: Install with `pip install urllib3[socks]` or install PySocks separately.

## Supported SOCKS Features

- **SOCKS4**: Basic proxy support with IPv4
- **SOCKS4A**: Extension supporting domain names
- **SOCKS5**: Full support for IPv4, IPv6, and domain names
- **Authentication**: Username/password for SOCKS5, userid for SOCKS4
- **DNS Resolution**: Local or remote DNS resolution options

### Proxy URL Schemes

| Scheme | SOCKS Version | DNS Resolution |
|--------|---------------|----------------|
| `socks4://` | SOCKS4 | Local |
| `socks4a://` | SOCKS4A | Remote |
| `socks5://` | SOCKS5 | Local |
| `socks5h://` | SOCKS5 | Remote |

> **Recommendation**: Use `socks5h://` or `socks4a://` schemes for remote DNS resolution when connecting to domain names.

## Key Classes

### SOCKSConnection

A plain-text HTTP connection class that establishes connections through SOCKS proxies.

```python
class SOCKSConnection(HTTPConnection):
    def __init__(self, _socks_options: _TYPE_SOCKS_OPTIONS, *args, **kwargs)
    def _new_conn(self) -> socks.socksocket
```

**Key Features:**
- Extends `HTTPConnection` with SOCKS proxy support
- Handles connection establishment through the proxy
- Manages timeouts and error handling for proxy connections

### SOCKSHTTPSConnection

HTTPS connection support through SOCKS proxies.

```python
class SOCKSHTTPSConnection(SOCKSConnection, HTTPSConnection)
```

**Features:**
- Combines SOCKS proxy functionality with HTTPS support
- Automatically inherits verification settings from HTTPSConnection

### SOCKSProxyManager

Main interface for managing SOCKS proxy connections.

```python
class SOCKSProxyManager(PoolManager):
    def __init__(self, proxy_url: str, username: str | None = None, 
                 password: str | None = None, num_pools: int = 10, 
                 headers: typing.Mapping[str, str] | None = None, 
                 **connection_pool_kw: typing.Any)
```

**Parameters:**
- `proxy_url`: SOCKS proxy URL (e.g., `socks5h://proxy.example.com:1080`)
- `username`/`password`: Authentication credentials (optional)
- `num_pools`: Maximum number of connection pools
- `headers`: Default headers for requests

## Usage Examples

### Basic SOCKS5 Proxy

```python
from urllib3.contrib.socks import SOCKSProxyManager

# SOCKS5 with remote DNS resolution
proxy = SOCKSProxyManager('socks5h://proxy.example.com:1080')
resp = proxy.request('GET', 'http://httpbin.org/ip')
```

### SOCKS5 with Authentication

```python
# Method 1: Credentials in URL
proxy = SOCKSProxyManager('socks5h://username:password@proxy.example.com:1080')

# Method 2: Separate parameters
proxy = SOCKSProxyManager(
    'socks5h://proxy.example.com:1080',
    username='username',
    password='password'
)
```

### SOCKS4A with User ID

```python
# SOCKS4A with userid
proxy = SOCKSProxyManager('socks4a://userid@proxy.example.com:1080')
```

## Connection Pool Classes

- **SOCKSHTTPConnectionPool**: HTTP connection pool using SOCKSConnection
- **SOCKSHTTPSConnectionPool**: HTTPS connection pool using SOCKSHTTPSConnection

## Error Handling

The module handles various connection errors:

- **ConnectTimeoutError**: Raised when proxy connection times out
- **NewConnectionError**: Raised for general connection failures
- **DependencyWarning**: Issued when PySocks is not installed

## Type Definitions

```python
class _TYPE_SOCKS_OPTIONS(typing.TypedDict):
    socks_version: int
    proxy_host: str | None
    proxy_port: str | None
    username: str | None
    password: str | None
    rdns: bool
```

## Notes and Considerations

- This is **provisional** support and may change in future versions
- Remote DNS resolution (`socks5h://`, `socks4a://`) is recommended for better privacy
- SOCKS4 only supports IPv4 addresses and domain names (with 4A extension)
- SOCKS5 supports IPv4, IPv6, and domain names
- Authentication is only supported for SOCKS5 proxies
- The module gracefully handles missing dependencies with appropriate warnings