<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# SOCKS Proxy Support for urllib3

## Overview

This module provides provisional support for SOCKS proxies within urllib3, enabling HTTP and HTTPS connections through SOCKS4, SOCKS4A, and SOCKS5 proxy servers. The implementation maintains full compatibility with urllib3 features while adding comprehensive SOCKS proxy functionality.

## Purpose

- Enable HTTP/HTTPS requests through SOCKS proxy servers
- Support multiple SOCKS protocol versions (4, 4A, 5)
- Provide both local and remote DNS resolution options
- Handle authentication with SOCKS proxies
- Maintain compatibility with existing urllib3 features

## Dependencies

**Required:**
- `PySocks` library (install with `pip install urllib3[socks]`)

**Optional:**
- `ssl` module (for HTTPS connections)

> **Note:** If PySocks is not installed, the module will raise a `DependencyWarning` and fail to import.

## Supported SOCKS Features

- **SOCKS4**: IPv4 connections (`socks4://`)
- **SOCKS4A**: IPv4 and domain names (`socks4a://`)
- **SOCKS5 with local DNS**: IPv4, IPv6, domain names (`socks5://`)
- **SOCKS5 with remote DNS**: IPv4, IPv6, domain names (`socks5h://`)
- **Authentication**: Username/password for SOCKS5, userid for SOCKS4

## Key Classes

### `SOCKSConnection`

A plain-text HTTP connection class that routes traffic through a SOCKS proxy.

**Key Features:**
- Inherits from `HTTPConnection`
- Establishes connections via SOCKS proxy
- Handles connection timeouts and errors
- Supports socket options and source address binding

**Important Methods:**

#### `_new_conn()`
```python
def _new_conn(self) -> socks.socksocket:
```
- Establishes a new connection through the SOCKS proxy
- Handles various connection errors and timeouts
- Returns a `socksocket` object for communication

### `SOCKSHTTPSConnection`

Extends `SOCKSConnection` to support HTTPS connections through SOCKS proxies.

```python
class SOCKSHTTPSConnection(SOCKSConnection, HTTPSConnection):
    pass
```

### `SOCKSProxyManager`

The main class for managing SOCKS proxy connections, extending urllib3's `PoolManager`.

**Constructor:**
```python
def __init__(
    self,
    proxy_url: str,
    username: str | None = None,
    password: str | None = None,
    num_pools: int = 10,
    headers: typing.Mapping[str, str] | None = None,
    **connection_pool_kw: typing.Any,
):
```

**Parameters:**
- `proxy_url`: SOCKS proxy URL (e.g., `socks5h://proxy.example.com:1080`)
- `username`: Authentication username (optional)
- `password`: Authentication password (optional)
- `num_pools`: Maximum number of connection pools
- `headers`: Default headers for requests

## Connection Pool Classes

### `SOCKSHTTPConnectionPool`
- Manages HTTP connections through SOCKS proxy
- Uses `SOCKSConnection` as the connection class

### `SOCKSHTTPSConnectionPool`
- Manages HTTPS connections through SOCKS proxy  
- Uses `SOCKSHTTPSConnection` as the connection class

## Usage Examples

### Basic SOCKS5 Proxy
```python
from urllib3.contrib.socks import SOCKSProxyManager

# SOCKS5 with remote DNS resolution (recommended)
proxy = SOCKSProxyManager('socks5h://proxy.example.com:1080')
resp = proxy.request('GET', 'https://httpbin.org/ip')
```

### SOCKS5 with Authentication
```python
proxy = SOCKSProxyManager(
    'socks5h://username:password@proxy.example.com:1080'
)
```

### SOCKS4A Proxy
```python
proxy = SOCKSProxyManager('socks4a://userid@proxy.example.com:1080')
```

## Error Handling

The module handles several types of connection errors:

- **`ConnectTimeoutError`**: Raised when connection times out
- **`NewConnectionError`**: Raised when connection establishment fails
- **`DependencyWarning`**: Issued when PySocks is not installed

## Type Definitions

### `_TYPE_SOCKS_OPTIONS`
```python
class _TYPE_SOCKS_OPTIONS(typing.TypedDict):
    socks_version: int
    proxy_host: str | None
    proxy_port: str | None
    username: str | None
    password: str | None
    rdns: bool
```

Configuration dictionary for SOCKS connection parameters.

## Best Practices

1. **Use remote DNS resolution** (`socks5h://` or `socks4a://`) to ensure DNS queries go through the proxy
2. **Handle authentication properly** by including credentials in the proxy URL or constructor parameters
3. **Install PySocks** as a dependency for your project
4. **Choose appropriate SOCKS version** based on your proxy server capabilities

## Limitations

- Requires PySocks library installation
- SOCKS4 only supports IPv4 addresses
- Error handling relies on PySocks exception types
- Some coverage issues exist due to exception chaining complexity