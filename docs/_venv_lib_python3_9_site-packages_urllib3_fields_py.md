<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# RequestField Module Documentation

## Overview

This module provides utilities for handling HTTP request fields, particularly for multipart form data. It's part of the urllib3 library and focuses on proper formatting of headers and field parameters according to web standards.

## Purpose

The module serves several key purposes:
- **Field Parameter Formatting**: Formats header parameters for multipart form data
- **Content Type Detection**: Automatically guesses MIME types for files
- **Request Field Management**: Provides a container class for organizing request body parameters
- **Standards Compliance**: Follows WHATWG HTML Standard for multipart form data formatting

## Type Definitions

```python
_TYPE_FIELD_VALUE = typing.Union[str, bytes]
_TYPE_FIELD_VALUE_TUPLE = typing.Union[
    _TYPE_FIELD_VALUE,
    tuple[str, _TYPE_FIELD_VALUE],
    tuple[str, _TYPE_FIELD_VALUE, str],
]
```

These type aliases define the acceptable formats for field values and tuples used throughout the module.

## Key Functions

### `guess_content_type(filename, default="application/octet-stream")`

Automatically determines the MIME type of a file based on its filename.

**Parameters:**
- `filename`: The filename to analyze
- `default`: Fallback MIME type if detection fails

**Returns:** String representing the guessed content type

**Example:**
```python
content_type = guess_content_type("image.jpg")  # Returns "image/jpeg"
```

### `format_multipart_header_param(name, value)`

The primary function for formatting multipart form data header parameters according to the WHATWG HTML Standard.

**Key Features:**
- Handles UTF-8 encoded values
- Percent-encodes special characters (`\n`, `\r`, `"`)
- Returns properly quoted parameter strings

**Parameters:**
- `name`: ASCII-only parameter name
- `value`: Parameter value (string or UTF-8 bytes)

**Returns:** Formatted string in the format `name="value"`

## Deprecated Functions

⚠️ **Warning**: The following functions are deprecated and will be removed in urllib3 v2.1.0:

- `format_header_param_rfc2231()` - Use `format_multipart_header_param()` instead
- `format_header_param_html5()` - Renamed to `format_multipart_header_param()`
- `format_header_param()` - Renamed to `format_multipart_header_param()`

## RequestField Class

The main class for representing request body parameters in multipart forms.

### Constructor

```python
RequestField(name, data, filename=None, headers=None, header_formatter=None)
```

**Parameters:**
- `name`: Field name (must be unicode)
- `data`: Field data/value
- `filename`: Optional filename for file uploads
- `headers`: Optional initial headers dictionary
- `header_formatter`: **Deprecated** - Custom header formatting function

### Class Methods

#### `from_tuples(fieldname, value, header_formatter=None)`

Factory method for creating RequestField instances from various tuple formats.

**Supported formats:**
```python
# Simple key-value
'foo': 'bar'

# File with name and data
'file': ('filename.txt', 'file contents')

# File with name, data, and MIME type
'file': ('filename.txt', 'file contents', 'text/plain')
```

### Instance Methods

#### `make_multipart(content_disposition=None, content_type=None, content_location=None)`

Configures the field for multipart form submission by setting appropriate headers.

**Parameters:**
- `content_disposition`: Defaults to "form-data"
- `content_type`: MIME type of the content
- `content_location`: Content location header

#### `render_headers()`

Generates the complete header string for the request field.

**Returns:** Formatted header string with proper line endings

#### `_render_part(name, value)` and `_render_parts(header_parts)`

Internal methods for formatting individual header parts and combining multiple parts.

## Usage Examples

### Basic Field Creation

```python
# Simple text field
field = RequestField("username", "john_doe")

# File upload field
field = RequestField("avatar", file_data, filename="avatar.jpg")
field.make_multipart(content_type="image/jpeg")
```

### Using Factory Method

```python
# Create from tuple
field = RequestField.from_tuples("upload", ("file.txt", "content", "text/plain"))
```

## Notes and Suggestions

### Migration Notes
- **Update deprecated functions**: Replace any usage of deprecated formatting functions with `format_multipart_header_param()`
- **Remove header_formatter**: The `header_formatter` parameter is deprecated

### Best Practices
- Always use unicode strings for field names and filenames
- Let the module handle content-type guessing when possible
- Use the `from_tuples()` factory method for backward compatibility with older tuple-based APIs

### Standards Compliance
- The module follows the WHATWG HTML Standard for multipart form data
- RFC 2231 formatting is deprecated for multipart forms
- Proper UTF-8 handling is built-in for international content