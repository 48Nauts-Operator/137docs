<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# urllib3 Fields Module Documentation

## Overview

This module provides utilities for handling HTTP request field formatting, particularly for multipart form data. It contains functions for content type detection, header parameter formatting, and a class for managing request field data containers.

## Purpose

The primary purpose of this module is to:
- Format HTTP header parameters according to web standards
- Handle multipart form data fields
- Provide content type guessing for file uploads
- Manage request field data with proper header formatting

## Type Definitions

```python
_TYPE_FIELD_VALUE = typing.Union[str, bytes]
_TYPE_FIELD_VALUE_TUPLE = typing.Union[
    _TYPE_FIELD_VALUE,
    tuple[str, _TYPE_FIELD_VALUE],
    tuple[str, _TYPE_FIELD_VALUE, str],
]
```

These type aliases define the acceptable formats for field values and tuples used throughout the module.

## Functions

### `guess_content_type(filename, default="application/octet-stream")`

Determines the MIME content type of a file based on its filename.

**Parameters:**
- `filename` (str | None): The filename to analyze
- `default` (str): Fallback content type if detection fails

**Returns:** String representing the content type

**Usage:**
```python
content_type = guess_content_type("document.pdf")
# Returns: "application/pdf"
```

### `format_multipart_header_param(name, value)`

Formats a single multipart header parameter according to the WHATWG HTML Standard.

**Parameters:**
- `name` (str): ASCII-only parameter name
- `value` (str | bytes): Parameter value (UTF-8 encoded if bytes)

**Returns:** Formatted string in the format `name="value"`

**Key Features:**
- Percent encodes `\n`, `\r`, and `"` characters
- Handles UTF-8 encoding automatically
- Follows current browser behavior

### Deprecated Functions

⚠️ **The following functions are deprecated and will be removed in urllib3 v2.1.0:**

- `format_header_param_rfc2231()` - Not valid for multipart/form-data
- `format_header_param_html5()` - Renamed to `format_multipart_header_param`
- `format_header_param()` - Renamed to `format_multipart_header_param`

## Classes

### `RequestField`

A data container for HTTP request body parameters, particularly useful for multipart form data.

#### Constructor

```python
RequestField(name, data, filename=None, headers=None, header_formatter=None)
```

**Parameters:**
- `name` (str): Field name (must be unicode)
- `data` (str | bytes): Field data/value
- `filename` (str | None): Optional filename for file uploads
- `headers` (dict | None): Optional initial headers
- `header_formatter` (callable | None): **Deprecated** - Custom header formatter

#### Key Methods

##### `from_tuples(fieldname, value, header_formatter=None)` (classmethod)

Factory method for creating RequestField instances from tuple parameters.

**Supported formats:**
```python
# Simple key-value
'field_name': 'field_value'

# File tuple (filename, data)
'file_field': ('filename.txt', 'file contents')

# File tuple with MIME type (filename, data, content_type)
'typed_file': ('image.jpg', binary_data, 'image/jpeg')
```

##### `make_multipart(content_disposition=None, content_type=None, content_location=None)`

Configures the field for multipart form data by setting appropriate headers.

**Parameters:**
- `content_disposition` (str | None): Defaults to "form-data"
- `content_type` (str | None): MIME type of the field
- `content_location` (str | None): Content location header

##### `render_headers()`

Generates the complete header string for the request field.

**Returns:** Formatted headers as a string with proper line endings

## Usage Examples

### Basic Field Creation

```python
# Simple text field
field = RequestField("username", "john_doe")

# File upload field
with open("document.pdf", "rb") as f:
    file_field = RequestField("document", f.read(), filename="document.pdf")
    file_field.make_multipart(content_type="application/pdf")
```

### Using Factory Method

```python
# From tuple with filename and data
field = RequestField.from_tuples("upload", ("file.txt", "content"))

# From tuple with MIME type
field = RequestField.from_tuples("image", ("photo.jpg", image_data, "image/jpeg"))
```

## Important Notes

- **Deprecation Warning**: Several functions are deprecated and will be removed in v2.1.0
- **Unicode Support**: Field names and filenames must be unicode strings
- **Standards Compliance**: The module follows WHATWG HTML Standard for multipart formatting
- **UTF-8 Encoding**: All text values are handled as UTF-8
- **Header Ordering**: Headers are rendered in a specific order for consistency

## Migration Guide

If you're using deprecated functions:

```python
# Old (deprecated)
format_header_param("name", "value")
format_header_param_html5("name", "value")

# New
format_multipart_header_param("name", "value")
```

The `header_formatter` parameter in `RequestField` constructor should be avoided as it will be removed in future versions.