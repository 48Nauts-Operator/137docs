<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# PoolManager Module Documentation

## Overview

This module provides the core pool management functionality for urllib3, enabling efficient connection pooling and reuse for HTTP/HTTPS requests. It includes classes for managing multiple connection pools and handling proxy connections.

## Purpose

The module serves to:
- **Manage connection pools**: Automatically create, cache, and reuse HTTP/HTTPS connection pools
- **Handle proxy connections**: Provide specialized proxy management with CONNECT method support
- **Optimize performance**: Reduce connection overhead by pooling and reusing connections
- **Abstract complexity**: Simplify making HTTP requests across multiple hosts

## Key Classes

### PoolKey

```python
class PoolKey(typing.NamedTuple):
```

A named tuple that uniquely identifies connection pools based on their configuration parameters.

**Key Fields:**
- `key_scheme`: Protocol scheme (http/https)
- `key_host`: Target hostname
- `key_port`: Target port number
- `key_timeout`: Connection timeout settings
- SSL-related fields for HTTPS connections
- Proxy configuration fields

### PoolManager

```python
class PoolManager(RequestMethods):
```

The main class for managing multiple connection pools transparently.

**Key Features:**
- Automatically creates and caches connection pools
- Supports both HTTP and HTTPS connections
- Handles connection pool lifecycle management
- Provides context manager support

**Constructor Parameters:**
- `num_pools`: Maximum number of pools to cache (default: 10)
- `headers`: Default headers for all requests
- `**connection_pool_kw`: Additional parameters passed to connection pools

**Important Methods:**

#### `connection_from_host(host, port, scheme, pool_kwargs)`
Gets or creates a connection pool for the specified host.

#### `connection_from_url(url, pool_kwargs)`
Creates a connection pool based on a URL.

#### `urlopen(method, url, redirect=True, **kw)`
Makes HTTP requests with automatic connection pool management and redirect handling.

#### `clear()`
Closes all connection pools and clears the cache.

**Example Usage:**
```python
import urllib3

http = urllib3.PoolManager(num_pools=2)
resp1 = http.request("GET", "https://google.com/")
resp2 = http.request("GET", "https://yahoo.com/")
```

### ProxyManager

```python
class ProxyManager(PoolManager):
```

Specialized pool manager that routes all requests through a proxy server.

**Key Features:**
- Supports HTTP and HTTPS proxies
- Handles CONNECT method for HTTPS tunneling
- Optional forwarding mode for HTTPS requests
- Proxy authentication support

**Constructor Parameters:**
- `proxy_url`: URL of the proxy server
- `proxy_headers`: Headers sent to the proxy
- `proxy_ssl_context`: SSL context for HTTPS proxies
- `use_forwarding_for_https`: Enable forwarding instead of tunneling
- `proxy_assert_hostname`: Certificate hostname verification
- `proxy_assert_fingerprint`: Certificate fingerprint verification

**Example Usage:**
```python
import urllib3

proxy = urllib3.ProxyManager("https://localhost:3128/")
resp = proxy.request("GET", "https://google.com/")
```

## Key Functions

### `proxy_from_url(url, **kw)`
Convenience function to create a ProxyManager from a URL string.

### `_default_key_normalizer(key_class, request_context)`
Creates normalized pool keys from request contexts, ensuring case-insensitive scheme/host handling.

## Important Constants

- **`SSL_KEYWORDS`**: Tuple of SSL-related parameter names
- **`_DEFAULT_BLOCKSIZE`**: Default block size for HTTP connections (16384 bytes)
- **`key_fn_by_scheme`**: Dictionary mapping schemes to key normalization functions
- **`pool_classes_by_scheme`**: Dictionary mapping schemes to connection pool classes

## Notes and Suggestions

### ‚ö†Ô∏è Important Considerations

1. **Connection Limits**: The `num_pools` parameter limits cached pools, not total connections
2. **SSL Context**: Always use proper SSL contexts for HTTPS connections in production
3. **Proxy Security**: Be cautious with `use_forwarding_for_https` as it exposes request/response data to proxies

### üí° Best Practices

1. **Context Manager**: Use PoolManager as a context manager to ensure proper cleanup:
   ```python
   with urllib3.PoolManager() as http:
       response = http.request('GET', 'https://example.com')
   ```

2. **Connection Pool Tuning**: Adjust `num_pools` based on the number of different hosts you regularly connect to

3. **Proxy Authentication**: Use `proxy_headers` for authentication:
   ```python
   proxy = urllib3.ProxyManager(
       "https://proxy.example.com:8080",
       proxy_headers={'Proxy-Authorization': 'Basic ...'}
   )
   ```

4. **Error Handling**: Always handle `MaxRetryError`, `URLSchemeUnknown`, and `ProxySchemeUnknown` exceptions

### üîß Customization

- Override `key_fn_by_scheme` to customize pool key generation
- Override `pool_classes_by_scheme` to use custom connection pool classes
- Extend `_new_pool()` method for custom pool creation logic

## Dependencies

This module relies on several internal urllib3 modules:
- `._collections`: For `RecentlyUsedContainer`
- `.connectionpool`: For HTTP/HTTPS connection pools
- `.util.retry`: For retry logic
- `.util.timeout`: For timeout handling
- `.util.url`: For URL parsing