<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Timeout Module Documentation

## Overview

This module provides timeout configuration functionality for urllib3 HTTP connections. It defines a comprehensive `Timeout` class that manages connection and read timeouts for HTTP requests, allowing fine-grained control over network operation timeouts.

## Purpose

The module serves to:
- Provide a unified interface for managing different types of timeouts (connect, read, and total)
- Handle timeout validation and state management
- Support both per-pool default timeouts and per-request timeout overrides
- Ensure thread-safe timeout operations with proper state tracking

## Key Components

### Constants and Types

```python
_DEFAULT_TIMEOUT: Final[_TYPE_DEFAULT] = _TYPE_DEFAULT.token
_TYPE_TIMEOUT = typing.Optional[typing.Union[float, _TYPE_DEFAULT]]
```

- **`_DEFAULT_TIMEOUT`**: A sentinel value representing the system default timeout
- **`_TYPE_TIMEOUT`**: Type alias for timeout values (float, None, or default sentinel)

### Main Classes

#### `Timeout`

The primary class for timeout configuration and management.

##### Constructor Parameters

- **`total`** (`float | None`): Combined timeout for the entire request operation
- **`connect`** (`float | None`): Maximum time to wait for connection establishment  
- **`read`** (`float | None`): Maximum time to wait between consecutive read operations

##### Key Methods

**Configuration Methods:**

```python
@classmethod
def from_float(cls, timeout: _TYPE_TIMEOUT) -> Timeout
```
- Creates a `Timeout` object from a single timeout value
- Sets both connect and read timeouts to the same value
- Useful for migrating from legacy timeout configurations

```python
def clone(self) -> Timeout
```
- Creates a copy of the timeout object
- Essential for per-request timeout handling
- Preserves original timeout values while resetting state

**State Management Methods:**

```python
def start_connect(self) -> float
```
- Starts the timeout timer for connection attempts
- Returns the start time using `time.monotonic()`
- **Raises**: `TimeoutStateError` if timer already started

```python
def get_connect_duration(self) -> float  
```
- Returns elapsed time since `start_connect()` was called
- **Raises**: `TimeoutStateError` if timer not started

**Timeout Resolution Properties:**

```python
@property
def connect_timeout(self) -> _TYPE_TIMEOUT
```
- Returns the effective connection timeout value
- Considers total timeout constraints
- Returns the minimum of connect and total timeouts when both are set

```python  
@property
def read_timeout(self) -> float | None
```
- Returns the effective read timeout value
- Dynamically calculated based on remaining total timeout
- Accounts for time already consumed during connection

**Utility Methods:**

```python
@staticmethod
def resolve_default_timeout(timeout: _TYPE_TIMEOUT) -> float | None
```
- Resolves default timeout sentinel to actual system timeout value

```python
@classmethod  
def _validate_timeout(cls, value: _TYPE_TIMEOUT, name: str) -> _TYPE_TIMEOUT
```
- Validates timeout values for correctness
- Ensures values are positive numbers, None, or default sentinel
- **Raises**: `ValueError` for invalid timeout values

## Usage Examples

### Basic Pool-Level Timeout Configuration

```python
import urllib3

# Configure different timeouts for different operations
timeout = urllib3.util.Timeout(connect=2.0, read=7.0)
http = urllib3.PoolManager(timeout=timeout)
resp = http.request("GET", "https://example.com/")
```

### Per-Request Timeout Override

```python
# Override pool timeout for specific request
response = http.request(
    "GET", 
    "https://example.com/", 
    timeout=Timeout(total=10.0)
)
```

### Disabling Timeouts

```python
# Disable all timeouts
no_timeout = Timeout(connect=None, read=None, total=None)
response = http.request("GET", "https://example.com/", timeout=no_timeout)
```

## Important Notes

### ‚ö†Ô∏è Timeout Behavior Considerations

- **DNS Resolution**: Python's DNS resolver doesn't respect socket timeouts
- **System Factors**: CPU load, swap usage, and process priority can affect actual timeout behavior  
- **Streaming Responses**: Read timeouts measure time between socket read operations, not total response time
- **First Byte**: Timeouts typically trigger when the server hasn't sent the first byte within the specified time

### üîß Implementation Details

- Uses `time.monotonic()` for reliable timeout measurements
- Thread-safe state management with proper error handling
- Supports both absolute and relative timeout calculations
- Maintains backward compatibility with legacy timeout formats

### üí° Best Practices

1. **Always clone timeouts** when using the same timeout configuration across multiple requests
2. **Set reasonable total timeouts** to prevent indefinitely long requests
3. **Consider your application's needs** when setting connect vs read timeouts
4. **Handle TimeoutStateError** appropriately in your error handling code
5. **Test timeout behavior** under various network conditions

## Dependencies

- `time`: For monotonic time measurements
- `socket.getdefaulttimeout()`: For system default timeout resolution
- `..exceptions.TimeoutStateError`: Custom exception for timeout state errors