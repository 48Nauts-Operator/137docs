<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Linux Inotify API Wrapper

This Python module provides a wrapper around the Linux inotify API for monitoring filesystem events. It's part of the Watchdog library and enables real-time monitoring of file and directory changes on Linux systems.

## Overview

The module interfaces with the Linux kernel's inotify subsystem using ctypes to call C library functions directly. It provides a high-level Python interface for watching filesystem events like file creation, modification, deletion, and movement.

## Key Classes and Functions

### `InotifyConstants`

A class containing all the inotify event constants and flags used by the Linux inotify API.

#### Important Event Constants:
- `IN_ACCESS` - File was accessed
- `IN_MODIFY` - File was modified  
- `IN_CREATE` - File/directory was created
- `IN_DELETE` - File/directory was deleted
- `IN_MOVED_FROM` / `IN_MOVED_TO` - File was moved
- `IN_CLOSE_WRITE` - Writable file was closed
- `IN_DELETE_SELF` - Watched file/directory was deleted
- `IN_ISDIR` - Event occurred on a directory

#### Special Flags:
- `IN_ONLYDIR` - Only watch if path is a directory
- `IN_DONT_FOLLOW` - Don't follow symbolic links
- `IN_ONESHOT` - Send event only once

### `Inotify`

The main class that wraps the inotify functionality.

#### Constructor Parameters:
- `path` (bytes): Directory path to monitor
- `recursive` (bool): Whether to monitor subdirectories recursively
- `event_mask` (int): Bitmask of events to monitor

#### Key Methods:

```python
def add_watch(self, path: bytes) -> None:
    """Adds a watch for the given path."""
    
def remove_watch(self, path: bytes) -> None:  
    """Removes a watch for the given path."""
    
def read_events(self, *, event_buffer_size: int = DEFAULT_EVENT_BUFFER_SIZE) -> list[InotifyEvent]:
    """Reads events from inotify and returns them as a list."""
    
def close(self) -> None:
    """Closes the inotify instance and removes all watches."""
```

#### Properties:
- `fd`: File descriptor for the inotify instance
- `path`: The monitored path
- `is_recursive`: Whether monitoring recursively
- `event_mask`: Current event mask

### `InotifyEvent`

Represents a single inotify event with convenient property accessors.

#### Properties:
- `src_path`: Full path where event occurred
- `name`: Base name of the file/directory
- `mask`: Event type bitmask
- `cookie`: Used to pair related events (like moves)
- `wd`: Watch descriptor

#### Event Type Properties:
- `is_create`, `is_delete`, `is_modify`
- `is_moved_from`, `is_moved_to`, `is_move`
- `is_directory`, `is_access`, `is_attrib`
- And more...

## Usage Example

```python
# Monitor a directory recursively
inotify = Inotify(b'/path/to/watch', recursive=True)

try:
    while True:
        events = inotify.read_events()
        for event in events:
            if event.is_create:
                print(f"Created: {event.src_path}")
            elif event.is_delete:
                print(f"Deleted: {event.src_path}")
            elif event.is_modify:
                print(f"Modified: {event.src_path}")
finally:
    inotify.close()
```

## Important Notes

### Thread Safety
- The `Inotify` class uses threading locks for thread-safe operations
- The `read_events()` method will block until events are available

### Resource Management
- Always call `close()` to clean up file descriptors and watches
- The class manages internal file descriptors that need proper cleanup
- Uses a pipe mechanism (`_kill_r`, `_kill_w`) for safe shutdown

### Move Event Handling
- Move operations generate two events: `IN_MOVED_FROM` and `IN_MOVED_TO`
- The class tracks these events using cookies to pair them correctly
- Provides `source_for_move()` to get the source path for move operations

### Recursive Monitoring
- When `recursive=True`, automatically adds watches for new subdirectories
- Simulates events for existing directory structures when they're moved in
- Handles complex scenarios like `mkdir -p` creating nested directories

## Error Handling

The module handles several Linux-specific errors:
- `ENOSPC`: inotify watch limit reached
- `EMFILE`: inotify instance limit reached  
- `EBADF`: Bad file descriptor (usually means inotify was closed)

## Dependencies

- Requires a compatible libc with inotify support
- Uses `select.poll()` when available, falls back to `select.select()`
- Only works on Linux systems with inotify support

## Limitations

- **Linux-only**: This module only works on Linux systems
- **Bytes paths**: All paths must be provided as bytes, not strings
- **Kernel limitations**: Subject to kernel inotify limits (watches per instance, etc.)
- **Symbolic links**: Limited support for symbolic links depending on flags used