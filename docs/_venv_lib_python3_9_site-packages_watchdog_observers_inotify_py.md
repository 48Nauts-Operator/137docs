<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Watchdog Inotify Observer Documentation

## Overview

This module provides an `inotify(7)`-based file system event monitoring implementation for the Python Watchdog library. It's specifically designed for Linux systems and leverages the Linux kernel's inotify subsystem to efficiently monitor file system changes.

## Purpose

The module implements file system event monitoring using Linux's inotify mechanism, providing real-time notifications for:
- File and directory creation, deletion, and modification
- File moves and renames
- File open/close operations
- Attribute changes

## System Requirements

- **Platform**: Linux 2.6.13+
- **Recommended**: Linux kernel 2.6.25+
- **Library**: glibc 2.4+ (glibc 2.5+ for advanced features)

> **Note**: The inotify system has specific behaviors regarding event coalescing and ordering. Events are delivered in order, and identical consecutive events may be coalesced into a single event.

## Key Classes

### InotifyEmitter

The core event emitter class that interfaces with the inotify system.

```python
class InotifyEmitter(EventEmitter):
    def __init__(
        self,
        event_queue: EventQueue,
        watch: ObservedWatch,
        *,
        timeout: float = DEFAULT_EMITTER_TIMEOUT,
        event_filter: list[type[FileSystemEvent]] | None = None,
    ) -> None:
```

**Parameters:**
- `event_queue`: Queue to store detected file system events
- `watch`: Directory or file to monitor
- `timeout`: Blocking timeout for reading events (seconds)
- `event_filter`: Optional filter to limit which event types are emitted

**Key Methods:**

#### `queue_events(timeout: float, *, full_events: bool = False)`
Main event processing method that:
- Reads events from the inotify buffer
- Converts low-level inotify events to high-level FileSystemEvent objects
- Handles move event pairing and recursive directory monitoring
- Queues events for dispatch to handlers

#### `get_event_mask_from_filter()`
Optimization method that:
- Converts event filter into inotify event mask
- Reduces system overhead by only monitoring relevant event types
- Returns appropriate inotify constants for the filtered events

### InotifyFullEmitter

Extended emitter that provides complete move event information.

```python
class InotifyFullEmitter(InotifyEmitter):
    def queue_events(self, timeout: float, *, events: bool = True) -> None:
```

**Features:**
- Reports unmatched move events as separate events
- Provides `None` values for unmatched parts of move operations
- Useful when you need complete move event tracking

### InotifyObserver

High-level observer class that manages the monitoring process.

```python
class InotifyObserver(BaseObserver):
    def __init__(
        self, 
        *, 
        timeout: float = DEFAULT_OBSERVER_TIMEOUT, 
        generate_full_events: bool = False
    ) -> None:
```

**Parameters:**
- `timeout`: Observer timeout for thread operations
- `generate_full_events`: Whether to use InotifyFullEmitter for complete move events

## Event Types Supported

The emitter handles various file system events:

- **File Events**: `FileCreatedEvent`, `FileDeletedEvent`, `FileModifiedEvent`, `FileMovedEvent`
- **Directory Events**: `DirCreatedEvent`, `DirDeletedEvent`, `DirModifiedEvent`, `DirMovedEvent`
- **File Operation Events**: `FileOpenedEvent`, `FileClosedEvent`, `FileClosedNoWriteEvent`

## Important Features

### Recursive Monitoring
- inotify doesn't natively support recursive directory monitoring
- This implementation automatically adds watches for subdirectories when recursive mode is enabled
- Generates sub-events for directory operations in recursive mode

### Thread Safety
- Uses threading locks to ensure safe concurrent access
- Proper thread lifecycle management with `on_thread_start()` and `on_thread_stop()`

### Event Filtering Optimization
- Converts high-level event filters to low-level inotify masks
- Reduces system overhead by only monitoring required event types
- Automatically includes essential events like `IN_DELETE_SELF`

## Usage Notes

### Best Practices
- Use event filtering when you only need specific event types
- Consider using `InotifyFullEmitter` if you need complete move event tracking
- Be aware that inotify has system limits on the number of watches

### Limitations
- Linux-specific implementation
- Subject to inotify system limits (number of watches, event queue size)
- Event coalescing may combine identical consecutive events
- Requires proper cleanup to avoid resource leaks

### Error Handling
- Gracefully handles thread lifecycle issues
- Logs errors when methods are called on inactive threads
- Automatically stops monitoring when watched directory is deleted

## Dependencies

```python
from watchdog.observers.inotify_buffer import InotifyBuffer
from watchdog.observers.inotify_c import InotifyConstants
from watchdog.observers.api import BaseObserver, EventEmitter
```

The module relies on companion modules for low-level inotify operations and event definitions.