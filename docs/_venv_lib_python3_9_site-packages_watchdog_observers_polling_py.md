<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Watchdog Polling Observer Module

## Overview

The `watchdog.observers.polling` module provides platform-independent file system monitoring capabilities through polling mechanisms. Unlike native file system watchers that rely on OS-specific APIs, this module periodically checks directory contents to detect changes, making it highly portable across different operating systems and file systems.

## Purpose

This module serves as a fallback or alternative implementation for file system monitoring when:
- Native OS file system events are not available
- Working with virtual file systems (VFS)
- Cross-platform compatibility is critical
- Native watchers are unreliable for specific use cases

## Classes

### PollingEmitter

A platform-independent event emitter that uses polling to detect file system changes.

**Key Features:**
- Inherits from `EventEmitter`
- Takes periodic snapshots of directory structure
- Compares snapshots to identify changes
- Thread-safe operations with locking mechanism

**Constructor Parameters:**
- `event_queue`: Queue for storing detected events
- `watch`: Watch configuration object
- `timeout`: Polling interval (defaults to `DEFAULT_EMITTER_TIMEOUT`)
- `event_filter`: Optional list to filter specific event types
- `stat`: Custom stat function (defaults to `os.stat`)
- `listdir`: Custom directory listing function (defaults to `os.scandir`)

**Important Methods:**

#### `on_thread_start()`
```python
def on_thread_start(self) -> None:
    self._snapshot = self._take_snapshot()
```
Initializes the baseline directory snapshot when the monitoring thread starts.

#### `queue_events(timeout: float)`
Core polling logic that:
- Waits for the specified timeout interval
- Takes a new directory snapshot
- Compares with previous snapshot using `DirectorySnapshotDiff`
- Queues appropriate events for detected changes
- Handles OSError by stopping the emitter

**Event Types Generated:**
- File events: `FileCreatedEvent`, `FileDeletedEvent`, `FileModifiedEvent`, `FileMovedEvent`
- Directory events: `DirCreatedEvent`, `DirDeletedEvent`, `DirModifiedEvent`, `DirMovedEvent`

### PollingObserver

A simple platform-independent observer using the default polling emitter.

```python
class PollingObserver(BaseObserver):
    def __init__(self, *, timeout: float = DEFAULT_OBSERVER_TIMEOUT) -> None:
        super().__init__(PollingEmitter, timeout=timeout)
```

**Usage:**
- Drop-in replacement for platform-specific observers
- Uses standard `os.stat` and `os.scandir` functions
- Suitable for most general-purpose polling scenarios

### PollingObserverVFS

A specialized observer designed for virtual file systems or custom file system implementations.

**Constructor Parameters:**
- `stat`: Custom stat function implementation
- `listdir`: Custom directory listing function implementation  
- `polling_interval`: Time interval between polls (default: 1 second)

**Use Cases:**
- Monitoring virtual file systems
- Custom file system implementations
- Remote file systems with custom access methods
- Testing scenarios with mocked file system operations

## Usage Examples

### Basic Polling Observer
```python
from watchdog.observers.polling import PollingObserver
from watchdog.events import FileSystemEventHandler

class MyHandler(FileSystemEventHandler):
    def on_modified(self, event):
        print(f"File {event.src_path} was modified")

observer = PollingObserver()
observer.schedule(MyHandler(), path='/path/to/watch', recursive=True)
observer.start()
```

### Custom VFS Observer
```python
from watchdog.observers.polling import PollingObserverVFS

def custom_stat(path):
    # Custom stat implementation
    pass

def custom_listdir(path):
    # Custom directory listing implementation
    pass

observer = PollingObserverVFS(
    stat=custom_stat,
    listdir=custom_listdir,
    polling_interval=2  # Poll every 2 seconds
)
```

## Notes and Considerations

### Performance
- **Higher CPU usage**: Polling requires periodic disk access
- **Configurable intervals**: Balance between responsiveness and resource usage
- **I/O intensive**: Consider the impact on system performance

### Reliability
- **Eventually consistent**: Changes are detected after the next poll cycle
- **Handles errors gracefully**: OSError triggers cleanup and observer shutdown
- **Thread-safe**: Uses locking to prevent race conditions

### Recommendations
- Use native observers when available for better performance
- Adjust polling intervals based on your specific requirements
- Consider using `PollingObserverVFS` for specialized file system scenarios
- Monitor resource usage in production environments

### Limitations
- **Delayed detection**: Changes are only detected at polling intervals
- **Resource intensive**: More CPU and I/O usage compared to native watchers
- **No sub-second precision**: Minimum practical polling interval is around 1 second

## Dependencies

- `watchdog.events`: Event type definitions
- `watchdog.observers.api`: Base observer and emitter classes
- `watchdog.utils.dirsnapshot`: Directory snapshot and diff utilities
- Standard library: `os`, `threading`, `functools`, `typing`