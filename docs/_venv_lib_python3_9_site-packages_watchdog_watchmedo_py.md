<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# watchmedo - Watchdog Shell Script Utility

## Overview

This module provides the `watchmedo` command-line utility for the Watchdog library. It allows users to monitor file system events and respond to them through various commands without writing custom Python code.

## Purpose

The `watchmedo` utility serves as a shell interface to the Watchdog file monitoring library, providing several subcommands for:
- Executing predefined "tricks" from YAML configuration files
- Logging file system events to the console
- Running shell commands in response to file changes
- Auto-restarting long-running processes when files change
- Generating YAML configuration templates

## Key Components

### Main CLI Parser

The module uses `ArgumentParser` with a custom `HelpFormatter` class for better command-line help formatting:

```python
cli = ArgumentParser(epilog=epilog, formatter_class=HelpFormatter)
cli.add_argument("--version", action="version", version=VERSION_STRING)
subparsers = cli.add_subparsers(dest="top_command")
```

### Command Decorator System

The module implements a decorator-based system for defining subcommands:

```python
@command([arguments...])
def command_name(args: Namespace) -> None:
    """Command description"""
    # Command implementation
```

## Available Commands

### 1. `tricks-from` (alias: `tricks`)

Executes tricks from YAML configuration files.

**Key Features:**
- Loads configuration from YAML files
- Supports multiple observer backends (polling, kqueue, inotify, etc.)
- Configurable Python path handling
- Recursive directory monitoring

**Usage Example:**
```bash
watchmedo tricks-from config.yaml --recursive
```

### 2. `tricks-generate-yaml` (alias: `generate-tricks-yaml`)

Generates YAML configuration templates for specified trick classes.

**Key Features:**
- Generates configuration for specified trick classes
- Can append to existing files or output to stdout
- Supports custom Python paths

**Usage Example:**
```bash
watchmedo tricks-generate-yaml my.custom.Trick --append-to-file config.yaml
```

### 3. `log`

Logs file system events to the console.

**Key Features:**
- Pattern-based event filtering
- Support for ignore patterns
- Multiple observer backend options
- Configurable recursion and polling intervals

**Usage Example:**
```bash
watchmedo log --patterns="*.py;*.txt" --recursive /path/to/watch
```

### 4. `shell-command`

Executes shell commands in response to file system events.

**Key Features:**
- Variable interpolation in commands (`${watch_src_path}`, `${watch_dest_path}`, etc.)
- Process synchronization options (wait/drop)
- Pattern-based filtering

**Usage Example:**
```bash
watchmedo shell-command --command='echo "File changed: ${watch_src_path}"' --patterns="*.py"
```

### 5. `auto-restart`

Automatically restarts long-running processes when files change.

**Key Features:**
- Configurable signals for process termination
- Debounce intervals to prevent rapid restarts
- Graceful shutdown handling
- Optional restart on command exit

**Usage Example:**
```bash
watchmedo auto-restart --directory=src --patterns="*.py" -- python app.py
```

## Utility Functions

### File System Utilities

- **`path_split()`**: Splits OS-dependent path specifications
- **`add_to_sys_path()`**: Adds paths to Python's module search path
- **`parse_patterns()`**: Parses pattern specifications for filtering

### Observer Management

- **`observe_with()`**: Sets up and runs a single observer with event handler
- **`schedule_tricks()`**: Schedules multiple tricks with an observer

### Configuration

- **`load_config()`**: Loads YAML configuration files

## Debug Options

All commands support various debug flags to force specific observer backends:
- `--debug-force-polling`: Force polling observer (cross-platform)
- `--debug-force-kqueue`: Force BSD kqueue observer
- `--debug-force-inotify`: Force Linux inotify observer  
- `--debug-force-fsevents`: Force macOS FSEvents observer
- `--debug-force-winapi`: Force Windows API observer

## Error Handling

The module includes comprehensive error handling:
- **`LogLevelError`**: Custom exception for verbosity argument validation
- **`WatchdogShutdownError`**: Graceful shutdown handling
- Signal handling for clean termination (SIGTERM, SIGINT, SIGHUP)

## Configuration Constants

```python
CONFIG_KEY_TRICKS = "tricks"
CONFIG_KEY_PYTHON_PATH = "python-path"
```

## Usage Notes

- Use `--` before command arguments in `auto-restart` to prevent argument interpretation conflicts
- Avoid double quotes in shell commands to prevent premature interpolation
- The utility automatically selects the most appropriate observer for the current platform
- Verbosity can be controlled with `-q`/`--quiet` and `-v`/`--verbose` flags
- All commands support recursive monitoring with the `-R`/`--recursive` flag

## Entry Point

The module can be executed directly or through the `watchmedo` console script:

```python
if __name__ == "__main__":
    sys.exit(main())
```

The `main()` function handles argument parsing, logging setup, and command execution with proper exit codes.