<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Environment Variable YAML Tag

This Python module provides a custom YAML tag `!ENV` that allows referencing environment variables directly within YAML files. It extends PyYAML's functionality to seamlessly integrate environment variable values into YAML configuration.

## Purpose

The module enables YAML files to dynamically reference environment variables at parse time, making configuration files more flexible and environment-aware. This is particularly useful for:

- Configuration files that need different values across environments (development, staging, production)
- Avoiding hardcoded sensitive values like API keys or database credentials
- Creating portable configuration files that adapt to their runtime environment

## Key Functions

### `construct_env_tag(loader, node)`

The core constructor function that processes `!ENV` tags in YAML files.

**Parameters:**
- `loader` (yaml.Loader): The YAML loader instance
- `node` (yaml.Node): The YAML node containing the environment variable reference

**Returns:**
- The value of the referenced environment variable, or a default value if specified

**Behavior:**
- **Scalar Node**: `!ENV VARIABLE_NAME` - Returns the value of `VARIABLE_NAME`
- **Sequence Node**: `!ENV [VAR1, VAR2, default_value]` - Returns the first available variable or the default
- **Type Resolution**: Automatically converts string values to appropriate Python types (int, bool, etc.)

**Example Usage in YAML:**
```yaml
database:
  host: !ENV DATABASE_HOST
  port: !ENV [DATABASE_PORT, 5432]
  ssl_enabled: !ENV [USE_SSL, true]
```

### `add_env_tag(loader)`

Registers the `!ENV` tag constructor with a YAML loader.

**Parameters:**
- `loader` (yaml.Loader): The YAML loader to modify

**Returns:**
- The modified loader with `!ENV` tag support

**Usage:**
```python
import yaml
from your_module import add_env_tag

# Method 1: Modify existing loader
loader = yaml.SafeLoader(yaml_content)
add_env_tag(loader)

# Method 2: Create custom loader class
class EnvLoader(yaml.SafeLoader):
    pass

add_env_tag(EnvLoader)
```

## Implementation Details

### Supported Node Types

- **ScalarNode**: Single environment variable reference
- **SequenceNode**: Multiple variables with optional default value (last item)

### Type Resolution

The module leverages PyYAML's implicit type resolution to automatically convert environment variable string values to appropriate Python types:

- `"true"/"false"` ‚Üí `bool`
- `"123"` ‚Üí `int`
- `"3.14"` ‚Üí `float`
- Other values remain as strings

### Error Handling

Raises `yaml.constructor.ConstructorError` for unsupported node types with descriptive error messages including line numbers.

## Usage Notes

### ‚ö†Ô∏è Important Considerations

- **Environment variables are always strings**: The module handles type conversion automatically
- **Fallback behavior**: If no specified environment variables exist, returns the default value (or `None` if no default provided)
- **Security**: Be cautious when using with `yaml.UnsafeLoader` in production environments

### üîß Integration Examples

```python
import yaml
import os
from your_module import add_env_tag

# Set environment variables
os.environ['DB_HOST'] = 'localhost'
os.environ['DB_PORT'] = '5432'

# YAML content
yaml_content = """
database:
  host: !ENV DB_HOST
  port: !ENV DB_PORT
  timeout: !ENV [DB_TIMEOUT, 30]
"""

# Load with environment variable support
loader = add_env_tag(yaml.SafeLoader)
config = yaml.load(yaml_content, Loader=loader)
```

### üìù Best Practices

1. **Always provide defaults** for optional configuration values
2. **Use descriptive environment variable names** with consistent naming conventions
3. **Document required environment variables** in your application's README
4. **Validate critical environment variables** exist before loading YAML files

## Version

Current version: **1.1**