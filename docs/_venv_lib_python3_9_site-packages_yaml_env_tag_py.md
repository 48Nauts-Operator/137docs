<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# YAML Environment Variable Tag Documentation

This Python module provides a custom YAML tag (`!ENV`) that allows referencing environment variables directly within YAML files, with support for default values and automatic type resolution.

## Purpose

The module extends YAML's functionality to:
- Reference environment variables in YAML configuration files
- Provide fallback default values when environment variables are not set
- Automatically resolve environment variable values to appropriate Python types (string, int, bool, etc.)

## Key Functions

### `construct_env_tag(loader, node)`

The core constructor function that processes the `!ENV` tag and retrieves environment variable values.

**Parameters:**
- `loader` (yaml.Loader): The YAML loader instance
- `node` (yaml.Node): The YAML node containing the environment variable reference

**Returns:**
- `Any`: The environment variable value (with automatic type resolution) or the default value

**Behavior:**
- **Scalar node**: Single environment variable name
  ```yaml
  database_url: !ENV DATABASE_URL
  ```
- **Sequence node**: Multiple environment variables with optional default value
  ```yaml
  port: !ENV [PORT, FALLBACK_PORT, 8080]  # Tries PORT, then FALLBACK_PORT, defaults to 8080
  ```

**Error Handling:**
- Raises `yaml.constructor.ConstructorError` for unsupported node types

### `add_env_tag(loader)`

Registers the `!ENV` tag constructor with a YAML loader.

**Parameters:**
- `loader` (yaml.Loader): The YAML loader to modify

**Returns:**
- `yaml.Loader`: The modified loader with `!ENV` tag support

## Usage Examples

### Basic Usage

```python
import yaml
from your_module import add_env_tag

# Set up loader with ENV tag support
loader = add_env_tag(yaml.SafeLoader)

# Load YAML with environment variable references
yaml_content = """
database:
  host: !ENV DB_HOST
  port: !ENV [DB_PORT, 5432]
  debug: !ENV [DEBUG, false]
"""

config = yaml.load(yaml_content, Loader=loader)
```

### YAML File Examples

```yaml
# Single environment variable
api_key: !ENV API_KEY

# Environment variable with default value
port: !ENV [PORT, 8080]

# Multiple fallback environment variables
database_url: !ENV [DATABASE_URL, DB_URL, "sqlite:///default.db"]

# Boolean environment variable with default
debug_mode: !ENV [DEBUG, false]
```

## Features

### Type Resolution
Environment variables are automatically converted to appropriate Python types:
- `"true"` → `True` (boolean)
- `"123"` → `123` (integer)  
- `"3.14"` → `3.14` (float)
- `"hello"` → `"hello"` (string)

### Fallback Chain
When using sequence notation, the function tries environment variables in order and falls back to the default value if none are found.

## Notes and Recommendations

### Security Considerations
- Be cautious when using this with untrusted YAML files
- Consider using `yaml.SafeLoader` instead of `yaml.Loader` for better security
- Sensitive environment variables will be processed as plain text

### Best Practices
- Always provide sensible default values for optional configuration
- Use descriptive environment variable names
- Document required environment variables in your application

### Limitations
- Environment variables are always read as strings initially (type conversion happens afterward)
- Default values must be valid YAML literals
- Complex nested structures as defaults may require careful YAML formatting

## Version

Current version: **1.1**