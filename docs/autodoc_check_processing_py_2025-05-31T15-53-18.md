<!--
This documentation was auto-generated by Claude on 2025-05-31T15-53-18.
Source file: ./check_processing.py
-->

# Document Processing Status Checker

## Overview

This utility script provides a diagnostic tool for monitoring document processing status in the application database. It queries the database to display documents currently being processed and shows the most recently created documents with their status information.

## Requirements

- Python 3.7+
- SQLAlchemy with async support
- Access to the application database
- Application models and database configuration

## Dependencies

```python
import asyncio
import sys
import os
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select, text
from app.database import engine
from app.models import Document
```

## Functions

### `check_processing()`

**Description:** Asynchronously queries the database to retrieve and display document processing information.

**Parameters:** None

**Returns:** None (prints output to console)

**Functionality:**

1. **Processing Documents Query**
   - Retrieves all documents with status 'processing'
   - Displays count and details of processing documents
   - Shows document ID and title for each processing document

2. **Recent Documents Query**
   - Fetches the 5 most recently created documents
   - Orders results by creation date (descending)
   - Displays ID, title, status, and creation timestamp

**Database Operations:**
- Uses SQLAlchemy ORM for processing status query
- Uses raw SQL for recent documents query
- Operates within an async database session

## Usage

### Command Line Execution

```bash
python check_processing.py
```

### Programmatic Usage

```python
import asyncio
from check_processing import check_processing

# Run the check
await check_processing()

# Or from synchronous context
asyncio.run(check_processing())
```

## Output Format

### Processing Documents Section
```
Documents with processing status: 2
  - Document Title 1 (ID: 123)
  - Document Title 2 (ID: 456)
```

### Recent Documents Section
```
Recent documents:
  - Latest Document (ID: 789, Status: completed, Created: 2023-10-15 14:30:25)
  - Previous Document (ID: 456, Status: processing, Created: 2023-10-15 13:45:10)
  - ...
```

## Database Schema Requirements

The script expects a `documents` table with the following columns:
- `id`: Primary key
- `title`: Document title
- `status`: Processing status (e.g., 'processing', 'completed')
- `created_at`: Timestamp of document creation

## Error Handling

- Database connection errors will propagate and terminate the script
- Assumes proper database configuration in `app.database.engine`
- Requires valid Document model in `app.models`

## Configuration

The script adds `/app` to the Python path to ensure proper module imports:

```python
sys.path.append('/app')
```

Modify this path if your application structure differs.

## Use Cases

- **Development**: Quick status check during development
- **Debugging**: Identify stuck processing jobs
- **Monitoring**: Regular health checks of document processing pipeline
- **Operations**: Troubleshooting document processing issues

## Notes

- Script runs asynchronously and requires an event loop
- Uses both ORM and raw SQL queries for demonstration purposes
- Database session is properly managed with async context manager
- Suitable for containerized environments (Docker)