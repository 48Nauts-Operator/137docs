<!--
This documentation was auto-generated by Claude on 2025-06-01T06-13-39.
Source file: ./check_processing.py
-->

# Document Processing Status Checker

## Overview

A diagnostic utility script for monitoring document processing status in an asynchronous database environment. This tool provides real-time insights into document processing workflows by querying and displaying current processing states and recent document activity.

## Purpose

This script serves as a monitoring and debugging tool for document management systems, allowing administrators to:
- Track documents currently in processing state
- Review recent document activity
- Diagnose potential processing bottlenecks or stuck documents

## Dependencies

### Required Modules
- `asyncio` - Asynchronous I/O support
- `sys` - System-specific parameters and functions
- `os` - Operating system interface utilities
- `sqlalchemy.ext.asyncio.AsyncSession` - Async database session management
- `sqlalchemy.select` - SQL SELECT query construction
- `sqlalchemy.text` - Raw SQL text queries

### Application Dependencies
- `app.database.engine` - Database engine instance
- `app.models.Document` - Document model class

## Functions

### `check_processing()`

**Type:** `async function`

**Purpose:** Executes comprehensive document status analysis by querying the database for processing documents and recent activity.

**Parameters:** None

**Returns:** None (outputs results to console)

**Behavior:**

1. **Processing Documents Query**
   - Retrieves all documents with `status = 'processing'`
   - Displays count and details of processing documents
   - Shows document ID and title for each processing item

2. **Recent Documents Query**
   - Executes raw SQL query to fetch 5 most recent documents
   - Orders results by creation timestamp (descending)
   - Displays comprehensive details: ID, title, status, and creation time

**Database Operations:**
- Uses async database sessions for non-blocking operations
- Implements proper session management with context managers
- Combines ORM queries and raw SQL for flexibility

## Usage

### Command Line Execution
```bash
python check_processing.py
```

### Programmatic Usage
```python
import asyncio
from check_processing import check_processing

# Run the status check
await check_processing()

# Or run from synchronous context
asyncio.run(check_processing())
```

## Output Format

### Processing Documents Section
```
Documents with processing status: 3
  - Document Title 1 (ID: 123)
  - Document Title 2 (ID: 124)
  - Document Title 3 (ID: 125)
```

### Recent Documents Section
```
Recent documents:
  - Latest Document (ID: 130, Status: completed, Created: 2023-12-07 14:30:25)
  - Previous Document (ID: 129, Status: processing, Created: 2023-12-07 14:28:10)
  - Another Document (ID: 128, Status: failed, Created: 2023-12-07 14:25:33)
```

## Configuration Requirements

### Environment Setup
- Application must be accessible at `/app` path
- Database engine must be properly configured in `app.database`
- Document model must be available in `app.models`

### Database Requirements
- `documents` table with required columns:
  - `id` (Primary key)
  - `title` (String)
  - `status` (String)
  - `created_at` (Timestamp)

## Error Handling

The script relies on SQLAlchemy's built-in error handling and async session management. Common issues may include:
- Database connection failures
- Missing table or column structures
- Import path resolution problems

## Performance Considerations

- **Async Operations:** All database operations are asynchronous to prevent blocking
- **Limited Queries:** Recent documents query is limited to 5 records for performance
- **Session Management:** Proper async session cleanup prevents connection leaks

## Use Cases

- **System Monitoring:** Regular checks of document processing pipeline health
- **Debugging:** Identifying stuck or failed document processing jobs
- **Auditing:** Reviewing recent system activity and document flow
- **Maintenance:** Pre/post-deployment verification of document processing status