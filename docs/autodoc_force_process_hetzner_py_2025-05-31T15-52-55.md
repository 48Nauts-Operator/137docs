<!--
This documentation was auto-generated by Claude on 2025-05-31T15-52-55.
Source file: ./force_process_hetzner.py
-->

# Hetzner Invoice Force Processing Script

## Overview

This script provides a manual processing mechanism for Hetzner invoices, bypassing normal duplicate detection and directly adding documents to the processing queue. It is designed to run within a containerized environment and processes PDF invoice files from a designated inbox directory.

## Purpose

- **Manual Override**: Bypasses automated duplicate detection mechanisms
- **Batch Processing**: Processes multiple Hetzner invoice files in sequence
- **Direct Queue Addition**: Adds invoices directly to the processing pipeline
- **Error Handling**: Provides detailed feedback on processing success/failure

## Requirements

- Python 3.7+
- Access to `/app` directory (backend modules)
- Access to `/hostfs/Inbox` directory (invoice files)
- Required dependencies from the main application

## Usage

### Command Line Execution

```bash
python3 force_process_hetzner_invoices.py
```

### Container Execution

```bash
# Execute within the application container
./force_process_hetzner_invoices.py
```

## Configuration

### File Paths

| Path | Description | Configurable |
|------|-------------|--------------|
| `/app` | Backend application directory | No |
| `/hostfs/Inbox` | Invoice file inbox directory | No |

### File Pattern Matching

The script searches for files matching the pattern: `*Hetzner*.pdf`

## Functions

### `force_process_hetzner_invoices()`

**Type**: `async function`

**Description**: Main processing function that discovers and processes all Hetzner invoice files in the inbox directory.

**Parameters**: None

**Returns**: None

**Behavior**:
1. Scans the inbox directory for Hetzner invoice files
2. Lists all discovered files
3. Processes each file sequentially
4. Provides progress feedback and error reporting

**Error Handling**: Catches and reports processing errors for individual files while continuing with remaining files.

## Output Format

### Discovery Phase
```
Found 3 Hetzner invoice files:
  - Hetzner_Invoice_2023_001.pdf
  - Hetzner_Invoice_2023_002.pdf
  - Hetzner_Invoice_2023_003.pdf
```

### Processing Phase
```
Starting manual processing of Hetzner invoices...

Processing 1/3: Hetzner_Invoice_2023_001.pdf
✅ Successfully processed: Hetzner_Invoice_2023_001.pdf

Processing 2/3: Hetzner_Invoice_2023_002.pdf
❌ Error processing Hetzner_Invoice_2023_002.pdf: [Error message]
```

### Completion Summary
```
Completed processing 3 Hetzner invoices.
```

## Error Handling

- **File Not Found**: Reports when no Hetzner invoice files are found
- **Processing Errors**: Catches and displays individual file processing errors
- **Path Errors**: Handles issues with directory access or file permissions

## Dependencies

### Internal Modules
```python
from app.main import process_new_document
```

### Standard Library
- `asyncio` - Asynchronous execution
- `sys` - System-specific parameters and functions
- `os` - Operating system interface
- `glob` - Unix-style pathname pattern expansion

## Security Considerations

- Script requires file system access to inbox directory
- Bypasses normal duplicate detection safeguards
- Should be used with caution in production environments
- Requires appropriate container permissions

## Limitations

- Only processes PDF files
- Fixed file pattern matching (`*Hetzner*.pdf`)
- Sequential processing (no parallel execution)
- Container-specific file paths

## Troubleshooting

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| No files found | Incorrect file naming or location | Verify files match `*Hetzner*.pdf` pattern in `/hostfs/Inbox` |
| Import errors | Missing backend modules | Ensure `/app` directory is accessible and contains required modules |
| Processing failures | Invalid PDF or processing logic errors | Check individual file integrity and processing logs |

### Exit Codes

- **0**: Successful execution (may include individual file processing errors)
- **Non-zero**: Script-level failure (import errors, critical exceptions)

## Maintenance

- Monitor processing logs for recurring errors
- Verify file path accessibility in container environment
- Update file pattern matching if invoice naming conventions change