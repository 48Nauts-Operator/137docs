<!--
This documentation was auto-generated by Claude on 2025-06-01T06-13-16.
Source file: ./force_process_hetzner.py
-->

# Hetzner Invoice Force Processing Script

## Overview

This script provides a manual method to force process Hetzner invoices by bypassing duplicate detection mechanisms and directly adding them to the processing queue. It's designed to run within a containerized environment and processes PDF invoice files from a designated inbox folder.

## Purpose

- **Manual Processing**: Forces processing of Hetzner invoices without normal validation checks
- **Duplicate Bypass**: Circumvents duplicate detection to reprocess previously handled invoices
- **Batch Operation**: Processes all matching Hetzner invoice files in a single execution

## Usage

### Basic Execution

```bash
python3 force_process_hetzner.py
```

### Container Environment

This script is designed to run inside a Docker container with the following assumptions:
- Application code mounted at `/app`
- Host filesystem accessible at `/hostfs`
- Inbox folder located at `/hostfs/Inbox`

## Configuration

### File Paths

| Path | Description |
|------|-------------|
| `/app` | Application backend directory |
| `/hostfs/Inbox` | Inbox folder containing invoice files |

### File Pattern Matching

The script searches for files matching the pattern: `*Hetzner*.pdf`

## Functions

### `force_process_hetzner_invoices()`

**Type**: Async Function  
**Returns**: None

Orchestrates the complete processing workflow for Hetzner invoices.

#### Workflow

1. **Discovery**: Scans inbox folder for Hetzner invoice files
2. **Reporting**: Lists all found files with count
3. **Processing**: Iterates through each file and processes individually
4. **Error Handling**: Continues processing remaining files if individual files fail
5. **Summary**: Reports completion status

#### Error Handling

- Individual file processing errors are caught and logged
- Processing continues for remaining files even if some fail
- Success/failure status indicated with emoji indicators (✅/❌)

## Dependencies

### Standard Library
- `asyncio`: Asynchronous execution support
- `sys`: System path manipulation
- `os`: Operating system interface
- `glob`: File pattern matching

### Application Modules
- `app.main.process_new_document`: Core document processing function

## Output Format

### Discovery Phase
```
Found 3 Hetzner invoice files:
  - Hetzner_Invoice_2023_001.pdf
  - Hetzner_Invoice_2023_002.pdf
  - Hetzner_Invoice_2023_003.pdf
```

### Processing Phase
```
Processing 1/3: Hetzner_Invoice_2023_001.pdf
✅ Successfully processed: Hetzner_Invoice_2023_001.pdf

Processing 2/3: Hetzner_Invoice_2023_002.pdf
❌ Error processing Hetzner_Invoice_2023_002.pdf: Connection timeout
```

### Completion Summary
```
Completed processing 3 Hetzner invoices.
```

## Requirements

- Python 3.7+ (for asyncio support)
- Access to application backend modules
- Read access to inbox directory
- Write access to processing queue

## Limitations

- **Container Specific**: Hardcoded paths assume specific container structure
- **PDF Only**: Only processes PDF format files
- **Pattern Dependent**: Relies on filename containing "Hetzner"
- **No Rollback**: No mechanism to undo processing operations

## Security Considerations

- Script bypasses normal duplicate detection safeguards
- Requires filesystem access to host directories
- Should be used only by authorized personnel
- Consider logging all forced processing operations for audit purposes

## Troubleshooting

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| No files found | Incorrect inbox path or missing files | Verify `/hostfs/Inbox` exists and contains Hetzner PDFs |
| Import errors | Backend path not accessible | Ensure `/app` contains required application modules |
| Permission errors | Insufficient file system permissions | Check container has read access to inbox directory |
| Processing failures | Individual document issues | Review error messages for specific file problems |