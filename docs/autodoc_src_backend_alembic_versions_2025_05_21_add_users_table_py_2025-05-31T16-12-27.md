<!--
This documentation was auto-generated by Claude on 2025-05-31T16-12-27.
Source file: ./src/backend/alembic/versions/2025_05_21_add_users_table.py
-->

# Database Migration: Add Users Table

## Overview

This Alembic migration creates a `users` table to support user authentication and management functionality in the application.

## Migration Details

- **Revision ID**: `2025_05_21_add_users_table`
- **Previous Revision**: `0001_baseline`
- **Created**: 2025-05-21 00:00:00.000000

## Table Schema

### `users`

The users table stores user account information with the following structure:

| Column | Type | Constraints | Default | Description |
|--------|------|-------------|---------|-------------|
| `id` | SERIAL | PRIMARY KEY | Auto-increment | Unique identifier for each user |
| `username` | VARCHAR(50) | UNIQUE, NOT NULL | - | Unique username for login |
| `email` | VARCHAR(100) | UNIQUE, NOT NULL | - | User's email address |
| `full_name` | VARCHAR(100) | - | - | User's display name |
| `role` | VARCHAR(20) | NOT NULL | 'viewer' | User role/permission level |
| `hashed_password` | VARCHAR(255) | NOT NULL | - | Encrypted password hash |
| `disabled` | BOOLEAN | - | FALSE | Account status flag |
| `created_at` | TIMESTAMP | - | NOW() | Account creation timestamp |

## Migration Functions

### `upgrade()`

Creates the `users` table with the schema defined above.

**Implementation Notes:**
- Uses raw SQL with `IF NOT EXISTS` clause for idempotency
- Safe to run multiple times without errors
- Creates all necessary constraints and indexes

### `downgrade()`

Removes the `users` table from the database.

**Implementation Notes:**
- Uses `DROP TABLE IF EXISTS` for safe removal
- Will not error if table doesn't exist

## Usage

### Apply Migration
```bash
alembic upgrade head
```

### Rollback Migration
```bash
alembic downgrade 0001_baseline
```

## Security Considerations

- The `hashed_password` field stores encrypted passwords only
- Email and username fields have unique constraints to prevent duplicates
- Default role is set to 'viewer' for security (least privilege principle)
- Accounts can be disabled without deletion via the `disabled` flag

## Dependencies

- **Alembic**: Database migration framework
- **SQLAlchemy**: Database toolkit and ORM
- **PostgreSQL**: Target database (uses SERIAL type and PostgreSQL-specific syntax)

## Related Migrations

- **Previous**: `0001_baseline` - Initial baseline migration
- **Next**: TBD - Future migrations will reference this revision ID