<!--
This documentation was auto-generated by Claude on 2025-05-31T16-12-41.
Source file: ./src/backend/alembic/versions/2025_05_22_add_settings_table.py
-->

# Database Migration: Add Settings Table

## Overview

This Alembic migration creates a `settings` table to store application configuration data. The migration is identified by revision `2025_05_22_add_settings_table` and builds upon the `2025_05_22_expand_address_book` migration.

## Migration Details

| Property | Value |
|----------|-------|
| **Revision ID** | `2025_05_22_add_settings_table` |
| **Down Revision** | `2025_05_22_expand_address_book` |
| **Create Date** | 2025-05-22 00:00:00.000000 |
| **Branch Labels** | None |
| **Dependencies** | None |

## Schema Changes

### Table: `settings`

This migration creates a new `settings` table with the following structure:

| Column | Type | Constraints | Default | Description |
|--------|------|-------------|---------|-------------|
| `id` | `SERIAL` | `PRIMARY KEY` | Auto-increment | Unique identifier for settings record |
| `inbox_path` | `VARCHAR(255)` | `NOT NULL` | - | File system path to inbox directory |
| `storage_root` | `VARCHAR(255)` | `NOT NULL` | - | Root directory for application storage |
| `locked` | `BOOLEAN` | - | `FALSE` | Flag indicating if settings are locked for editing |
| `created_at` | `TIMESTAMP WITHOUT TIME ZONE` | - | `NOW()` | Timestamp when record was created |
| `updated_at` | `TIMESTAMP WITHOUT TIME ZONE` | - | `NOW()` | Timestamp when record was last updated |

## Functions

### `upgrade()`

Executes the forward migration by creating the `settings` table.

**Behavior:**
- Creates the `settings` table using `CREATE TABLE IF NOT EXISTS` statement
- Defines all columns with appropriate data types and constraints
- Sets default values for `locked`, `created_at`, and `updated_at` columns

### `downgrade()`

Executes the reverse migration by removing the `settings` table.

**Behavior:**
- Drops the `settings` table using `DROP TABLE IF EXISTS` statement
- Uses conditional drop to prevent errors if table doesn't exist

## Usage Notes

- The `IF NOT EXISTS` and `IF EXISTS` clauses make the migration idempotent
- The `locked` field can be used to prevent modification of critical settings
- Timestamps are stored without timezone information
- The `SERIAL` type provides auto-incrementing integer primary keys

## Migration Dependencies

> **Note:** There appears to be a discrepancy in the revision comments. The code comments reference depending on `2025_05_24_add_vectors_table` (May 24), but the actual `down_revision` is set to `2025_05_22_expand_address_book` (May 22). Ensure the dependency chain is correct before applying this migration.

## Example Usage

```bash
# Apply migration
alembic upgrade head

# Rollback migration
alembic downgrade 2025_05_22_expand_address_book
```