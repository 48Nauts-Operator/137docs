<!--
This documentation was auto-generated by Claude on 2025-05-31T16-11-38.
Source file: ./src/backend/alembic/versions/2025_05_24_add_disabled_col.py
-->

# Database Migration: Add Disabled Column to Users

## Overview

This Alembic migration adds a `disabled` column to the `users` table to support user account status management.

## Migration Details

- **Revision ID**: `20250524_user_disabled`
- **Parent Revision**: `20250523_user_cols`
- **Created**: 2025-05-24 00:00:00.000000
- **Description**: Add disabled column to users table

## Changes

### Schema Modifications

The migration adds the following column to the `users` table:

| Column | Type | Default | Nullable | Description |
|--------|------|---------|----------|-------------|
| `disabled` | `BOOLEAN` | `FALSE` | Yes | Indicates whether the user account is disabled |

## Functions

### `upgrade()`

Applies the migration by adding the `disabled` column to the `users` table.

**Behavior:**
- Executes `ALTER TABLE users ADD COLUMN disabled BOOLEAN DEFAULT FALSE;`
- Uses exception handling to gracefully handle cases where the column already exists
- Sets default value to `FALSE` for all existing users

**Error Handling:**
- Catches and ignores exceptions (typically when column already exists)
- Does not raise errors for duplicate column scenarios

### `downgrade()`

Reverts the migration changes.

**Behavior:**
- **No-op implementation** - does not remove the column
- Includes comment explaining SQLite limitations

**Important Notes:**
- SQLite does not support `DROP COLUMN` operations
- Column will remain in the database schema after downgrade
- Consider manual cleanup if complete rollback is required

## Usage Example

```bash
# Apply migration
alembic upgrade 20250524_user_disabled

# Rollback migration (limited functionality)
alembic downgrade 20250523_user_cols
```

## Database Compatibility

- **Primary Support**: SQLite
- **Limitations**: Downgrade functionality limited by SQLite's lack of `DROP COLUMN` support
- **Other Databases**: Should work with PostgreSQL, MySQL, etc. (downgrade will still be no-op)

## Post-Migration Considerations

1. **Application Code**: Update user models and queries to handle the new `disabled` column
2. **Default Behavior**: All existing users will have `disabled = FALSE` after migration
3. **Cleanup**: Manual intervention required if complete column removal is needed after downgrade

## Related Migrations

- **Previous**: `20250523_user_cols` - User columns modification
- **Next**: (To be determined)