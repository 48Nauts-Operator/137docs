<!--
This documentation was auto-generated by Claude on 2025-06-01T06-32-01.
Source file: ./src/backend/alembic/versions/2025_05_24_add_disabled_col.py
-->

# Database Migration Documentation

## Migration: Add Disabled Column to Users Table

### Overview

This Alembic migration adds a `disabled` column to the `users` table to support user account status management.

### Migration Details

| Property | Value |
|----------|-------|
| **Revision ID** | `20250524_user_disabled` |
| **Parent Revision** | `20250523_user_cols` |
| **Created** | 2025-05-24 00:00:00.000000 |
| **Branch Labels** | None |
| **Dependencies** | None |

### Changes

#### Upgrade Operations

The migration performs the following changes when upgrading:

- **Adds `disabled` column** to the `users` table
  - **Data Type**: `BOOLEAN`
  - **Default Value**: `FALSE`
  - **Nullable**: Yes (implicit)

#### SQL Executed

```sql
ALTER TABLE users ADD COLUMN disabled BOOLEAN DEFAULT FALSE;
```

### Error Handling

The upgrade operation includes error handling to gracefully manage scenarios where the column may already exist:

- If the column addition fails (typically due to the column already existing), the exception is caught and ignored
- This allows the migration to be run safely multiple times without failing

### Rollback Limitations

⚠️ **Important**: This migration has limited rollback capabilities due to SQLite constraints.

#### Downgrade Behavior

- **No operations performed** during downgrade
- The `disabled` column will **remain in the table** after rollback
- This is due to SQLite's lack of support for the `DROP COLUMN` operation

#### Considerations

- If using a different database system (PostgreSQL, MySQL, etc.), consider implementing proper rollback functionality
- For production environments, ensure you have appropriate backup procedures before applying this migration

### Usage Impact

After applying this migration:

1. All existing users will have `disabled = FALSE` by default
2. New users will automatically receive `disabled = FALSE` unless explicitly set otherwise
3. Application code can now check the `disabled` status to control user access

### Prerequisites

- Requires the previous migration `20250523_user_cols` to be applied
- Ensure the `users` table exists before running this migration

### Testing Recommendations

1. **Pre-migration**: Verify the `users` table structure
2. **Post-migration**: Confirm the `disabled` column exists with correct default values
3. **Rollback testing**: Understand that the column will persist after downgrade

---

*This migration is part of the user management system enhancement to support account status controls.*