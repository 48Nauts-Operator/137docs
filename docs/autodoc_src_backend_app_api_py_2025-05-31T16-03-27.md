<!--
This documentation was auto-generated by Claude on 2025-05-31T16-03-27.
Source file: ./src/backend/app/api.py
-->

# Document Management System API Routes

## Overview

This module provides the RESTful API routes for the Document Management System using FastAPI. It handles document CRUD operations, file uploads, OCR processing, and document metadata management including tags and tasks.

## Dependencies

- **FastAPI**: Web framework for building APIs
- **SQLAlchemy**: Database ORM for data persistence
- **Pydantic**: Data validation and serialization
- **Python Standard Library**: File operations and logging

## Data Models

### Request/Response Models

#### DocumentBase
Base model for document operations.

| Field | Type | Description | Optional |
|-------|------|-------------|----------|
| `title` | `str` | Document title | Yes |
| `sender` | `str` | Document sender | Yes |
| `document_date` | `date` | Date of the document | Yes |
| `due_date` | `date` | Due date for document action | Yes |
| `amount` | `float` | Monetary amount (if applicable) | Yes |
| `document_type` | `str` | Type/category of document | Yes |
| `status` | `str` | Processing status | Yes |

#### DocumentResponse
Response model extending DocumentBase with additional fields.

| Field | Type | Description |
|-------|------|-------------|
| `id` | `int` | Unique document identifier |
| `filename` | `str` | Original filename |
| `content_text` | `str` | Extracted text content |
| `created_at` | `date` | Creation timestamp |
| `updated_at` | `date` | Last update timestamp |

#### TagCreate/TagResponse
Models for document tagging functionality.

| Field | Type | Description | Default |
|-------|------|-------------|---------|
| `name` | `str` | Tag name | Required |
| `color` | `str` | Hex color code | `#cccccc` |
| `id` | `int` | Tag identifier (response only) | - |

#### TaskCreate/TaskResponse
Models for document task management.

| Field | Type | Description | Default |
|-------|------|-------------|---------|
| `description` | `str` | Task description | Required |
| `due_date` | `date` | Task deadline | `None` |
| `id` | `int` | Task identifier (response only) | - |
| `status` | `str` | Task status (response only) | - |

## API Endpoints

### Document Management

#### GET `/documents`
Retrieve a paginated list of documents with optional filtering.

**Query Parameters:**
- `limit` (int): Number of documents to return (1-1000, default: 100)
- `offset` (int): Number of documents to skip (default: 0)
- `document_type` (str, optional): Filter by document type
- `status` (str, optional): Filter by document status
- `tag_id` (int, optional): Filter by tag ID

**Response:** List of `DocumentResponse` objects

**Example:**
```http
GET /documents?limit=50&offset=0&document_type=invoice&status=pending
```

#### GET `/documents/{document_id}`
Retrieve a specific document by its ID.

**Path Parameters:**
- `document_id` (int): Unique document identifier

**Response:** `DocumentResponse` object

**Error Responses:**
- `404`: Document not found

#### POST `/documents`
Create a new document manually (without file upload).

**Request Body:** `DocumentCreate` object

**Response:** `DocumentResponse` object

#### PUT `/documents/{document_id}`
Update an existing document's metadata.

**Path Parameters:**
- `document_id` (int): Unique document identifier

**Request Body:** `DocumentUpdate` object (partial updates supported)

**Response:** `DocumentResponse` object

**Error Responses:**
- `404`: Document not found

#### DELETE `/documents/{document_id}`
Delete a document from the system.

**Path Parameters:**
- `document_id` (int): Unique document identifier

**Response:** Success message

**Error Responses:**
- `404`: Document not found

### File Upload and Processing

#### POST `/upload`
Upload and automatically process a document file.

**Request Body:** Multipart form data with file

**Supported File Types:** Configured in `settings.ALLOWED_FILE_TYPES`

**Process Flow:**
1. Validates file extension
2. Saves file to inbox folder
3. Processes document with OCR
4. Extracts metadata using LLM
5. Stores document in database

**Response:** 
```json
{
  "message": "Document uploaded and processed successfully",
  "document_id": 123
}
```

**Error Responses:**
- `400`: Unsupported file type

### Tag Management

#### POST `/documents/{document_id}/tags`
Add a tag to a specific document.

**Path Parameters:**
- `document_id` (int): Target document identifier

**Request Body:** `TagCreate` object

**Response:** `TagResponse` object

**Error Responses:**
- `404`: Document not found

#### DELETE `/documents/{document_id}/tags/{tag_id}`
Remove a tag from a document.

**Path Parameters:**
- `document_id` (int): Target document identifier
- `tag_id` (int): Tag to remove

**Response:** Success message

**Error Responses:**
- `404`: Document or tag not found

### Task Management

#### POST `/documents/{document_id}/tasks`
Create a task associated with a document.

**Path Parameters:**
- `document_id` (int): Target document identifier

**Request Body:** `TaskCreate` object

**Response:** `TaskResponse` object

**Error Responses:**
- `404`: Document not found

## Configuration

The module relies on the following configuration settings:

- `settings.ALLOWED_FILE_TYPES`: List of supported file extensions
- `settings.INBOX_FOLDER`: Directory for uploaded files

## Logging

The module implements structured logging with INFO level, including:
- Timestamp
- Module name
- Log level
- Message content

## Error Handling

The API uses standard HTTP status codes:
- `200`: Success
- `400`: Bad Request (invalid file type, validation errors)
- `404`: Resource Not Found
- `500`: Internal Server Error

All error responses follow FastAPI's standard error format with detailed error messages.

## Dependencies Injection