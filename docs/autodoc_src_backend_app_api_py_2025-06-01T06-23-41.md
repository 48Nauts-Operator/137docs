<!--
This documentation was auto-generated by Claude on 2025-06-01T06-23-41.
Source file: ./src/backend/app/api.py
-->

# Document Management System API Documentation

## Overview

This module provides REST API endpoints for the Document Management System built with FastAPI. It handles document operations including upload, processing, CRUD operations, tagging, and task management.

## Dependencies

- **FastAPI**: Web framework for building APIs
- **SQLAlchemy**: Database ORM
- **Pydantic**: Data validation and serialization
- **Python Standard Library**: logging, os, shutil, datetime

## Configuration

The module uses structured logging with INFO level and includes timestamp, logger name, level, and message formatting.

```python
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
)
```

## Data Models

### Base Models

#### `DocumentBase`
Base model for document data with optional fields.

| Field | Type | Description |
|-------|------|-------------|
| `title` | `Optional[str]` | Document title |
| `sender` | `Optional[str]` | Document sender |
| `document_date` | `Optional[date]` | Date of the document |
| `due_date` | `Optional[date]` | Document due date |
| `amount` | `Optional[float]` | Associated monetary amount |
| `document_type` | `Optional[str]` | Type/category of document |
| `status` | `Optional[str]` | Processing status |

#### `DocumentCreate`
Inherits from `DocumentBase`. Used for creating new documents.

#### `DocumentUpdate`
Inherits from `DocumentBase`. Used for updating existing documents.

#### `DocumentResponse`
Response model extending `DocumentBase` with additional system fields.

| Field | Type | Description |
|-------|------|-------------|
| `id` | `int` | Unique document identifier |
| `filename` | `str` | Original filename |
| `content_text` | `Optional[str]` | Extracted text content |
| `created_at` | `date` | Creation timestamp |
| `updated_at` | `date` | Last update timestamp |

### Tag Models

#### `TagCreate`
Model for creating new tags.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `name` | `str` | - | Tag name |
| `color` | `Optional[str]` | `"#cccccc"` | Hex color code |

#### `TagResponse`
Response model for tag data.

| Field | Type | Description |
|-------|------|-------------|
| `id` | `int` | Unique tag identifier |
| `name` | `str` | Tag name |
| `color` | `Optional[str]` | Hex color code |

### Task Models

#### `TaskCreate`
Model for creating new tasks.

| Field | Type | Description |
|-------|------|-------------|
| `description` | `str` | Task description |
| `due_date` | `Optional[date]` | Task due date |

#### `TaskResponse`
Response model for task data.

| Field | Type | Description |
|-------|------|-------------|
| `id` | `int` | Unique task identifier |
| `description` | `str` | Task description |
| `due_date` | `Optional[date]` | Task due date |
| `status` | `str` | Task status |

## API Endpoints

### Document Operations

#### `GET /documents`
Retrieve a paginated list of documents with optional filtering.

**Query Parameters:**
- `limit` (int): Maximum number of documents to return (1-1000, default: 100)
- `offset` (int): Number of documents to skip (â‰¥0, default: 0)
- `document_type` (str, optional): Filter by document type
- `status` (str, optional): Filter by status
- `tag_id` (int, optional): Filter by tag ID

**Response:** `List[DocumentResponse]`

**Example:**
```http
GET /documents?limit=50&offset=0&document_type=invoice&status=pending
```

#### `GET /documents/{document_id}`
Retrieve a specific document by ID.

**Path Parameters:**
- `document_id` (int): Document identifier

**Response:** `DocumentResponse`

**Errors:**
- `404`: Document not found

#### `POST /documents`
Create a new document manually.

**Request Body:** `DocumentCreate`

**Response:** `DocumentResponse`

**Example:**
```json
{
  "title": "Monthly Invoice",
  "sender": "ACME Corp",
  "document_type": "invoice",
  "amount": 1500.00,
  "due_date": "2024-01-31"
}
```

#### `PUT /documents/{document_id}`
Update an existing document.

**Path Parameters:**
- `document_id` (int): Document identifier

**Request Body:** `DocumentUpdate`

**Response:** `DocumentResponse`

**Errors:**
- `404`: Document not found

#### `DELETE /documents/{document_id}`
Delete a document.

**Path Parameters:**
- `document_id` (int): Document identifier

**Response:**
```json
{
  "message": "Document deleted successfully"
}
```

**Errors:**
- `404`: Document not found

### File Upload

#### `POST /upload`
Upload and process a document file.

**Request:**
- Content-Type: `multipart/form-data`
- File field: `file` (required)

**Process Flow:**
1. Validates file extension against allowed types
2. Saves file to inbox folder
3. Processes document with OCR
4. Stores extracted data in database

**Response:**
```json
{
  "message": "Document uploaded and processed successfully",
  "document_id": 123
}
```

**Errors:**
- `400`: Unsupported file type

### Tag Management

#### `POST /documents/{document_id}/tags`
Add a tag to a document.

**Path Parameters:**
- `document_id` (int): Document identifier

**Request Body:** `TagCreate`

**Response:** `TagResponse`

**Errors:**
- `404`: Document not found

#### `DELETE /documents/{document_id}/tags/{tag_id}`
Remove a tag from a document.

**Path