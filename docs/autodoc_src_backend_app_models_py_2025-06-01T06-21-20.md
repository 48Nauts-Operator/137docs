<!--
This documentation was auto-generated by Claude on 2025-06-01T06-21-20.
Source file: ./src/backend/app/models.py
-->

# Document Management System Database Models

This document describes the database models for the Document Management System, implemented using SQLAlchemy ORM.

## Overview

The database schema supports document processing, multi-tenant architecture, AI-powered enrichment, and comprehensive document management features.

## Database Models

### Core Models

#### Document
**Table:** `documents`

Represents a processed document in the system with extracted metadata and content.

| Column | Type | Description |
|--------|------|-------------|
| `id` | Integer | Primary key |
| `title` | String(255) | Document title |
| `file_path` | String(255) | Path to the stored file |
| `content` | Text | Extracted text content |
| `document_type` | String(50) | Type of document (invoice, receipt, etc.) |
| `sender` | String(255) | Document sender |
| `recipient` | String(255) | Document recipient |
| `document_date` | String(50) | Date from document |
| `due_date` | String(50) | Payment due date |
| `amount` | Float | Total amount |
| `subtotal` | Float | Subtotal before tax |
| `tax_rate` | Float | Applied tax rate |
| `tax_amount` | Float | Tax amount |
| `payment_date` | String(50) | Payment date |
| `category` | String(100) | Document category |
| `recurring` | Boolean | Whether document is recurring |
| `frequency` | String(20) | Recurrence frequency |
| `parent_id` | Integer | Reference to parent document |
| `original_file_name` | String(255) | Original filename |
| `summary` | Text | AI-generated summary |
| `confidence_score` | Float | Processing confidence score |
| `currency` | String(10) | Currency code |
| `status` | String(50) | Processing status (default: "pending") |
| `embedding` | Vector(1536) | Document embedding for similarity search |
| `hash` | String(64) | SHA-256 hash for deduplication |
| `entity_id` | Integer | Associated entity/tenant ID |
| `created_at` | DateTime | Creation timestamp |
| `updated_at` | DateTime | Last update timestamp |

**Relationships:**
- Many-to-many with `Tag` through `document_tag` table
- One-to-many with `Notification`
- Many-to-one with `Entity`

#### Tag
**Table:** `tags`

Represents tags for document categorization.

| Column | Type | Description |
|--------|------|-------------|
| `id` | Integer | Primary key |
| `name` | String(50) | Unique tag name |
| `created_at` | DateTime | Creation timestamp |

**Relationships:**
- Many-to-many with `Document` through `document_tag` table

#### User
**Table:** `users`

Represents system users with authentication information.

| Column | Type | Description |
|--------|------|-------------|
| `id` | Integer | Primary key |
| `username` | String(50) | Unique username |
| `email` | String(100) | Unique email address |
| `full_name` | String(100) | User's full name |
| `role` | String(20) | User role (default: "viewer") |
| `hashed_password` | String(255) | Encrypted password |
| `disabled` | Boolean | Account status |
| `created_at` | DateTime | Creation timestamp |

### Notification System

#### Notification
**Table:** `notifications`

Stores user notifications and alerts.

| Column | Type | Description |
|--------|------|-------------|
| `id` | Integer | Primary key |
| `title` | String(255) | Notification title |
| `message` | Text | Notification message |
| `type` | String(50) | Notification type |
| `is_read` | Boolean | Read status |
| `document_id` | Integer | Associated document ID |
| `created_at` | DateTime | Creation timestamp |

### Address Book

#### AddressEntry
**Table:** `address_book`

Stores contact information for persons and organizations.

| Column | Type | Description |
|--------|------|-------------|
| `id` | Integer | Primary key |
| `name` | String(255) | Contact name |
| `entity_type` | String(20) | Type: company/person/government |
| `email` | String(255) | Email address |
| `phone` | String(50) | Phone number |
| `street` | String(255) | Street address |
| `address2` | String(255) | Additional address info |
| `town` | String(255) | City/town |
| `zip` | String(20) | Postal code |
| `county` | String(100) | County/state |
| `country` | String(100) | Country |
| `group_name` | String(100) | Contact group |
| `last_transaction` | String(50) | Last transaction date |
| `address` | Text | Legacy address field |
| `vat_id` | String(50) | VAT identification |
| `bank_details` | Text | Banking information |
| `tags` | String(255) | Comma-separated tags |
| `created_from` | String(255) | Source document |
| `last_seen_in` | String(50) | Last seen date |
| `created_at` | DateTime | Creation timestamp |
| `updated_at` | DateTime | Last update timestamp |

### Vector Search

#### VectorEntry
**Table:** `vectors`

Maps document pages to vector search IDs for ColPali embeddings.

| Column | Type | Description |
|--------|------|-------------|
| `id` | Integer | Primary key |
| `doc_id` | Integer | Associated document ID |
| `page` | Integer | Page number |
| `vector_ids` | Text | JSON array of vector UUIDs |

### Configuration

#### AppSettings
**Table:** `settings`

Stores application-wide configuration settings.

| Column | Type | Description |
|--------|------|-------------|
| `id` | Integer | Primary key |
| `inbox_path` | String(255) | Inbox directory path