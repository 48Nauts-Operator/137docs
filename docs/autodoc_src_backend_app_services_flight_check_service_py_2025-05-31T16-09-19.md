<!--
This documentation was auto-generated by Claude on 2025-05-31T16-09-19.
Source file: ./src/backend/app/services/flight_check_service.py
-->

# FlightCheckService Documentation

## Overview

The `FlightCheckService` is a comprehensive platform diagnostics service that provides three levels of system health monitoring for the application platform. It implements diagnostic tests specified in the flight-check documentation and offers quick health checks, comprehensive system analysis, and deep diagnostic capabilities.

## Class Definition

```python
class FlightCheckService:
    """Comprehensive platform diagnostics service."""
```

### Constructor

```python
def __init__(self, db_session: AsyncSession)
```

**Parameters:**
- `db_session` (AsyncSession): Database session for executing queries and checks

**Attributes:**
- `db_session`: The database session instance
- `start_time`: Timestamp when the service was initialized (used for duration calculations)

## Public Methods

### quick_health_check()

```python
async def quick_health_check() -> Dict[str, Any]
```

Performs a quick health check (30 seconds) focusing on essential systems only.

**Returns:**
- `Dict[str, Any]`: Health check results containing:
  - `status`: Overall system status ("healthy", "degraded", or "unhealthy")
  - `timestamp`: ISO format timestamp of the check
  - `duration_seconds`: Time taken to complete the check
  - `tests_passed`: Number of successful tests
  - `tests_failed`: Number of failed tests
  - `tests_total`: Total number of tests (4)
  - `checks`: Dictionary of individual check results

**Checks Performed:**
1. Database connectivity
2. Frontend accessibility
3. Authentication system
4. Basic API health

### comprehensive_check()

```python
async def comprehensive_check() -> Dict[str, Any]
```

Performs a comprehensive check (5 minutes) covering all major systems.

**Returns:**
- `Dict[str, Any]`: Comprehensive results with categorized checks:
  - `status`: Overall system status
  - `timestamp`: ISO format timestamp
  - `duration_seconds`: Execution time
  - `tests_passed/failed/total`: Test statistics
  - `categories`: Dictionary of check categories

**Categories Checked:**
- Critical Systems
- AI & LLM Services
- File System & Processing
- Multi-Tenant System
- Analytics & Reporting

### deep_diagnostic()

```python
async def deep_diagnostic() -> Dict[str, Any]
```

Performs a deep diagnostic (15 minutes) with complete system analysis including performance and security checks.

**Returns:**
- `Dict[str, Any]`: Extended comprehensive results including:
  - All comprehensive check categories
  - Performance metrics
  - Security configurations
  - Integration status

## Critical System Checks

### Database Connectivity

#### _check_database_connection()
Basic database connectivity verification using a simple `SELECT 1` query.

#### _check_database_comprehensive()
Comprehensive database health check including:
- Connection verification
- Required table existence validation
- Data integrity checks (user and entity counts)
- Schema validation

**Required Tables Checked:**
- `documents`, `users`, `entities`, `user_entities`
- `tags`, `document_tags`, `llm_configs`, `processing_rules`
- `vectors`, `addresses`, `notifications`, `settings`, `user_sessions`

### Authentication System

#### _check_authentication()
Basic authentication system verification checking for admin user existence.

#### _check_authentication_comprehensive()
Extended authentication checks including:
- Admin user verification
- Total user count
- Active session tracking
- JWT configuration status

### Frontend and API Health

#### _check_frontend_health()
Verifies frontend service accessibility (basic implementation for port 3303).

#### _check_api_health()
Validates API endpoint responsiveness and FastAPI status.

### Document Processing

#### _check_document_processing()
Monitors the document processing pipeline:
- Recent document activity (24-hour window)
- Documents currently being processed
- Failed document count
- Pipeline operational status

## AI & LLM Services

### LLM Configuration

#### _check_llm_configuration()
Validates LLM service configuration:
- Service enablement status
- Provider configuration (local/remote)
- Model configuration for tagger and enricher
- Connection testing

### Vector Database

#### _check_vector_database()
Checks Qdrant vector database connectivity:
- Vector storage count
- Qdrant availability
- Embeddings functionality

### Tenant Extraction

#### _check_tenant_extraction()
Validates tenant extraction system:
- Available tenants count
- Extraction agent availability
- System operational status

## File System & Processing

### Folder Configuration

#### _check_folder_configuration()
Validates file system setup:
- Environment variable configuration
- Path accessibility verification
- Required directory existence

**Paths Checked:**
- `HOSTFS_ROOT` (default: `/hostfs`)
- `WATCH_FOLDER` (default: `/hostfs/Inbox`)
- `ARCHIVE_FOLDER` (default: `/hostfs/Archive`)

### Processing Rules

#### _check_processing_rules()
Monitors the rules engine:
- Total processing rules count
- Active rules count
- Engine availability status

## Multi-Tenant System

### Tenant Management

#### _check_tenant_management()
Validates multi-tenancy features:
- Total entity count
- Default tenant configuration
- User-entity associations
- Multi-tenant system status

### Entity System

#### _check_entity_system()
Checks entity system integrity:
- Company entity count
- Individual entity count
- System data integrity

## Analytics & Reporting

### Analytics Service

#### _check_analytics_service()
Validates analytics functionality:
- Document count for analysis
- Invoice-specific analytics
- Chart and reporting availability

## Performance & Security (Deep Diagnostic)

### Performance Monitoring

#### _check_performance()
System resource monitoring:
- CPU usage percentage
- Memory utilization
- Disk space usage
- Database query performance timing

**Performance Thresholds:**
- CPU > 80%: Degraded
- Memory > 85%: Degraded  
- Disk > 90%: Degraded

### Security Validation

#### _check_security()
Security configuration verification:
- Admin user security settings
- JWT configuration status
- Password hashing validation (bcrypt)

### Integration Status

#### _check_integrations()
External integration monitoring:
- Calendar integration (ICS export)
- Notification system status
- Email and in-app notification capabilities

## Usage Example

```python
from sqlalchemy.ext.async