<!--
This documentation was auto-generated by Claude on 2025-06-01T06-29-46.
Source file: ./src/backend/app/services/flight_check_service.py
-->

# FlightCheckService Documentation

## Overview

The `FlightCheckService` is a comprehensive platform diagnostics service that implements multi-tiered health checks to monitor system integrity, performance, and functionality across all platform components.

## Features

- **Multi-tiered Diagnostics**: Quick health checks (30s), comprehensive checks (5min), and deep diagnostics (15min)
- **Comprehensive Coverage**: Tests critical systems, AI services, file processing, multi-tenant functionality, and more
- **Detailed Reporting**: Structured JSON responses with pass/fail counts and detailed error information
- **Async Operations**: Built for modern async/await patterns with SQLAlchemy async sessions

## Class Definition

```python
class FlightCheckService:
    """Comprehensive platform diagnostics service."""
```

## Constructor

### `__init__(self, db_session: AsyncSession)`

Initializes the flight check service with a database session.

**Parameters:**
- `db_session` (AsyncSession): SQLAlchemy async database session for running diagnostics

**Attributes:**
- `db_session`: Database session for executing queries
- `start_time`: Timestamp for calculating diagnostic duration

## Core Diagnostic Methods

### `async quick_health_check() -> Dict[str, Any]`

Performs essential system checks in under 30 seconds.

**Returns:**
- Dictionary containing health check results with the following structure:
  ```python
  {
    "status": "healthy|degraded",
    "timestamp": "ISO timestamp",
    "duration_seconds": float,
    "tests_passed": int,
    "tests_failed": int,
    "tests_total": 4,
    "checks": {
      "database": {...},
      "frontend": {...},
      "authentication": {...},
      "api": {...}
    }
  }
  ```

**Checks Performed:**
1. Database connectivity
2. Frontend accessibility
3. Authentication system
4. Basic API health

### `async comprehensive_check() -> Dict[str, Any]`

Performs comprehensive system analysis in approximately 5 minutes.

**Returns:**
- Dictionary with categorized health check results:
  ```python
  {
    "status": "healthy|degraded",
    "timestamp": "ISO timestamp", 
    "duration_seconds": float,
    "tests_passed": int,
    "tests_failed": int,
    "tests_total": 15,
    "categories": {
      "critical": {...},
      "ai_services": {...},
      "file_system": {...},
      "multi_tenant": {...},
      "analytics": {...}
    }
  }
  ```

**Categories Checked:**
- Critical System Checks
- AI & LLM Services
- File System & Processing
- Multi-Tenant System
- Analytics & Reporting

### `async deep_diagnostic() -> Dict[str, Any]`

Performs complete system analysis in approximately 15 minutes.

**Returns:**
- Extended comprehensive check results with additional categories:
  - Performance monitoring
  - Security configurations
  - External integrations

## Critical System Checks

### `async _check_database_connection() -> Dict[str, Any]`

Tests basic database connectivity with a simple SELECT query.

**Returns:**
- Health status with connection details and error information if applicable

### `async _check_database_comprehensive() -> Dict[str, Any]`

Performs thorough database validation including:
- Schema validation
- Required table verification
- Data integrity checks
- User and entity counts

### `async _check_authentication() -> Dict[str, Any]`

Validates authentication system by checking for admin user existence.

### `async _check_authentication_comprehensive() -> Dict[str, Any]`

Extended authentication validation including:
- Admin user verification
- User count statistics
- Active session monitoring
- JWT configuration status

### `async _check_document_processing() -> Dict[str, Any]`

Monitors document processing pipeline health:
- Recent document activity (24h)
- Processing queue status
- Failed document counts

## AI & LLM Services

### `async _check_llm_configuration() -> Dict[str, Any]`

Validates LLM service configuration and connectivity:
- Provider configuration (local/remote)
- Model availability
- Service enablement status

### `async _check_vector_database() -> Dict[str, Any]`

Tests Qdrant vector database connectivity and data availability.

### `async _check_tenant_extraction() -> Dict[str, Any]`

Verifies tenant extraction functionality and agent availability.

## File System & Processing

### `async _check_folder_configuration() -> Dict[str, Any]`

Validates file system paths and accessibility:
- Host filesystem mount points
- Inbox and archive folder access
- Environment variable configuration

### `async _check_processing_rules() -> Dict[str, Any]`

Checks processing rules engine:
- Rule count and status
- Active rule verification

## Multi-Tenant System

### `async _check_tenant_management() -> Dict[str, Any]`

Validates multi-tenant system integrity:
- Entity (tenant) counts
- Default tenant configuration
- User-entity associations

### `async _check_entity_system() -> Dict[str, Any]`

Checks entity system categorization:
- Company vs individual entities
- System integrity validation

## Analytics & Reporting

### `async _check_analytics_service() -> Dict[str, Any]`

Validates analytics functionality:
- Document analytics availability
- Invoice processing statistics
- Chart and reporting capabilities

## Performance & Security (Deep Diagnostic)

### `async _check_performance() -> Dict[str, Any]`

Monitors system performance metrics:
- CPU usage percentage
- Memory utilization
- Disk space usage
- Database query performance

### `async _check_security() -> Dict[str, Any]`

Validates security configurations:
- Admin user security settings
- JWT configuration
- Password hashing verification

### `async _check_integrations() -> Dict[str, Any]`

Tests external integrations:
- Calendar integration (ICS export)
- Notification system functionality

## Usage Examples

### Basic Health Check

```python
from app.services.flight_check import FlightCheckService

async def check_system_health(db_session):
    flight_check = FlightCheckService(db_session)
    results = await flight_check.quick_health_check()
    
    if results["status"] == "healthy":
        print("âœ…