<!--
This documentation was auto-generated by Claude on 2025-05-31T15-53-58.
Source file: ./src/backend/check_documents.py
-->

# Document Recipient Assignment Checker

## Overview

A diagnostic script that analyzes document recipient assignments in the database and identifies potential issues with document processing and tenant assignment.

## Purpose

This script helps administrators:
- Identify documents with missing or invalid recipient assignments
- Analyze document assignment statistics
- Review available tenant entities
- Check LLM configuration status
- Validate the document processing pipeline

## Requirements

### Dependencies
- Python 3.7+
- SQLAlchemy (async support)
- aiosqlite
- Custom application models (`Document`, `Entity`, `LLMConfig`)

### Environment
- Database file: `src/backend/documents.db`
- Application path: `/app`

## Usage

```bash
python3 document_checker.py
```

The script runs asynchronously and provides a comprehensive report of document recipient assignments.

## Output Sections

### 1. Problematic Documents
Lists up to 15 documents with recipient assignment issues:
- `None` or empty recipients
- Generic placeholders ("Your Company", "Unknown")

**Format:**
```
ID: 123 | Document Title                        | Recipient: 'Unknown'    | Sender: Company ABC
```

### 2. Document Statistics
Provides numerical analysis:
- Total document count
- Number of problematic assignments
- Properly assigned documents
- Assignment success rate percentage

### 3. Available Tenants
Lists all entities that could serve as document recipients:
- Entity ID, alias, type, and full name
- Helps identify valid assignment targets

### 4. LLM Configuration
Shows current AI processing settings:
- Enable/disable status
- Provider information
- Auto-tagging and auto-enrichment flags

### 5. Properly Assigned Examples
Displays up to 5 documents with correct recipient assignments as positive examples.

## Database Schema Dependencies

### Document Model
```sql
- id: Primary key
- title: Document title
- recipient: Target entity (focus of analysis)
- sender: Source entity
```

### Entity Model
```sql
- id: Primary key
- name: Full entity name
- alias: Short identifier
- type: Entity classification
```

### LLMConfig Model
```sql
- enabled: Boolean flag
- provider: AI service provider
- auto_tagging: Automatic tag assignment
- auto_enrichment: Automatic data enhancement
```

## Error Handling

- **Database Connection**: Uses async SQLAlchemy with automatic session management
- **Missing LLM Config**: Gracefully handles absent configuration records
- **Empty Result Sets**: Provides appropriate success messages for clean data

## Configuration

### Database URL
```python
DATABASE_URL = "sqlite+aiosqlite:///src/backend/documents.db"
```

### Query Limits
- Problematic documents: 15 records
- Good examples: 5 records
- No limit on statistics or entity queries

## Troubleshooting

### Common Issues

1. **Database Not Found**
   - Verify `src/backend/documents.db` exists
   - Check file permissions

2. **Import Errors**
   - Ensure `/app` path contains required models
   - Verify SQLAlchemy async dependencies installed

3. **No Output**
   - Check database contains document records
   - Verify async event loop compatibility

### Exit Codes
- `0`: Successful execution
- Non-zero: Runtime errors (database connection, import failures)

## Performance Notes

- Uses async database operations for efficiency
- Limits result sets to prevent memory issues with large datasets
- Single session context for all operations
- Echo disabled for cleaner output