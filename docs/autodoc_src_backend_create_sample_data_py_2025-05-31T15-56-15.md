<!--
This documentation was auto-generated by Claude on 2025-05-31T15-56-15.
Source file: ./src/backend/create_sample_data.py
-->

# Sample Data Generator for Tenant Automation Testing

## Overview

This script creates sample data for testing tenant automation functionality in a document management system. It generates test users, entities (tenants), LLM configurations, and documents with various recipient assignment scenarios to validate automatic tenant assignment capabilities.

## Purpose

The script is designed to:
- Create a controlled testing environment for tenant automation features
- Generate documents with problematic recipient data that require automatic assignment
- Set up proper database relationships between entities and documents
- Provide baseline data for testing LLM-based document processing

## Requirements

### Dependencies

```python
asyncio
sys
os
hashlib
datetime
sqlalchemy.ext.asyncio
passlib.context
```

### Database Models

The script requires the following database models:
- `User` - User account management
- `Entity` - Tenant/organization entities
- `Document` - Document storage and metadata
- `LLMConfig` - Language model configuration

### Database Configuration

- **Database**: SQLite with async support (`aiosqlite`)
- **File**: `./documents.db`
- **Engine**: Async SQLAlchemy engine

## Usage

### Command Line Execution

```bash
python3 create_sample_data.py
```

### Programmatic Usage

```python
import asyncio
from create_sample_data import create_sample_data

# Run the sample data creation
asyncio.run(create_sample_data())
```

## Generated Data Structure

### 1. Users

| Field | Value | Description |
|-------|--------|-------------|
| Username | `admin` | Administrator account |
| Email | `admin@example.com` | Contact email |
| Password | `admin123` (hashed) | Login credentials |
| Role | `admin` | Administrative privileges |

### 2. Entities (Tenants)

#### Personal Entity
- **Name**: Personal Entity
- **Type**: Individual
- **Location**: Zurich, Switzerland
- **Aliases**: Andr√© Wolke, A. Wolke, Personal

#### Test Company Ltd.
- **Name**: Test Company Ltd.
- **Type**: Company
- **Location**: Zurich, Switzerland
- **VAT ID**: CHE-123.456.789
- **IBAN**: CH93 0076 2011 6238 5295 7

#### Google LLC
- **Name**: Google LLC
- **Type**: Company
- **Location**: Mountain View, United States
- **Aliases**: Google, Google Cloud, Alphabet Inc

### 3. LLM Configuration

```yaml
Provider: local
API URL: http://localhost:11434
Tagger Model: phi3
Enricher Model: llama3
Auto-tagging: enabled
Auto-enrichment: enabled
Confidence Thresholds:
  - Tagging: 0.7
  - Entity: 0.8
```

### 4. Sample Documents

#### Problematic Recipients (For Testing Auto-Assignment)

1. **Google Cloud Invoice**
   - Recipient: "Your Company" ‚Üê *Problematic*
   - Expected Assignment: Google LLC entity

2. **Medical Insurance Bill**
   - Recipient: "" ‚Üê *Empty*
   - Expected Assignment: Personal Entity

3. **Office Rent Invoice**
   - Recipient: `null` ‚Üê *NULL value*
   - Expected Assignment: Test Company Ltd.

4. **Google Workspace Subscription**
   - Recipient: "Unknown" ‚Üê *Generic*
   - Expected Assignment: Auto-determined

#### Properly Assigned Document

5. **Control Document**
   - Recipient: "Test Company Ltd." ‚Üê *Correct*
   - Assignment: Already linked to Test Corp entity

## Testing Scenarios

### Recipient Assignment Patterns

The script creates documents with various problematic recipient patterns commonly found in real-world scenarios:

| Pattern | Example | Test Case |
|---------|---------|-----------|
| Generic placeholder | "Your Company" | Should be auto-assigned based on content analysis |
| Empty string | `""` | Should trigger entity matching algorithm |
| NULL value | `null` | Should use sender/content context for assignment |
| Vague identifier | "Unknown" | Should use LLM analysis for proper assignment |

### Expected Automation Behavior

1. **Content Analysis**: Documents should be analyzed for entity references
2. **Sender Matching**: Known senders should help determine recipient entity
3. **Alias Resolution**: Entity aliases should be matched against document content
4. **Confidence Scoring**: Assignments should meet minimum confidence thresholds

## Error Handling

The script includes comprehensive error handling:

```python
try:
    # Data creation logic
    await session.commit()
    print("‚úÖ Sample data created successfully!")
except Exception as e:
    print(f"‚ùå Error creating sample data: {e}")
    await session.rollback()
finally:
    await session.close()
```

## Output

Upon successful execution, the script provides a summary:

```
üìù Creating Sample Data for Tenant Automation Testing
============================================================
‚úÖ Sample data created successfully!
üìä Created:
  - 1 admin user
  - 3 entities (tenants)
  - 1 LLM configuration (enabled)
  - 5 sample documents
    ‚Ä¢ 4 with problematic recipients
    ‚Ä¢ 1 properly assigned
```

## Security Considerations

- **Password Hashing**: Uses bcrypt for secure password storage
- **Database Isolation**: Uses separate test database
- **Input Validation**: Includes proper data validation for all entities

## Customization

### Adding New Entities

```python
new_entity = Entity(
    name="Custom Entity",
    alias="Custom",
    type="company",
    # ... additional fields
)
entities.append(new_entity)
```

### Modifying LLM Configuration

```python
llm_config.model_tagger = "custom-model"
llm_config.min_confidence_tagging = 0.8
```

### Adding Document Scenarios

```python
new_document = Document(
    title="Custom Test Document",
    recipient="Problematic Recipient Pattern",
    # ... additional fields
)
documents.append(new_document)
```

## Validation

After running the script, verify the data creation by checking:

1. Database table row counts
2. Entity relationship integrity
3. Document hash uniqueness
4. LLM configuration activation status