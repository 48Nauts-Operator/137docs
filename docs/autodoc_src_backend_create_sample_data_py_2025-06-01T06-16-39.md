<!--
This documentation was auto-generated by Claude on 2025-06-01T06-16-39.
Source file: ./src/backend/create_sample_data.py
-->

# Sample Data Generator Documentation

## Overview

This module creates sample data for testing tenant automation functionality in a document management system. It generates test users, entities (tenants), LLM configurations, and documents with various recipient assignment scenarios to validate automated tenant assignment capabilities.

## Module Information

- **File**: `create_sample_data.py`
- **Type**: Standalone utility script
- **Purpose**: Generate test data for tenant automation testing
- **Database**: SQLite with async support

## Dependencies

```python
import asyncio
import sys
import os
import hashlib
from datetime import datetime, timedelta
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine
from app.models import Document, Entity, LLMConfig, User
from passlib.context import CryptContext
```

## Configuration

### Database Configuration
- **Engine**: SQLite with aiosqlite driver
- **Database File**: `./documents.db`
- **Echo Mode**: Disabled for cleaner output

### Password Hashing
- **Algorithm**: bcrypt
- **Configuration**: Uses passlib CryptContext with deprecated algorithm handling

## Functions

### `create_sample_data()`

**Purpose**: Creates comprehensive sample data for testing tenant automation functionality.

**Signature**: 
```python
async def create_sample_data() -> None
```

**Returns**: None

**Functionality**:

#### 1. User Creation
Creates an administrative user with the following properties:
- **Username**: `admin`
- **Email**: `admin@example.com`
- **Role**: `admin`
- **Password**: `admin123` (bcrypt hashed)
- **Status**: Active

#### 2. Entity (Tenant) Creation
Generates three distinct entities representing different tenant types:

##### Personal Entity
- **Type**: Individual
- **Name**: Personal Entity
- **Location**: Zurich, Switzerland
- **Aliases**: Multiple name variations for testing alias matching

##### Test Company Ltd.
- **Type**: Company
- **Name**: Test Company Ltd.
- **Location**: Zurich, Switzerland
- **Financial Info**: VAT ID and IBAN included
- **Aliases**: Various company name formats

##### Google LLC
- **Type**: Company
- **Name**: Google LLC
- **Location**: Mountain View, United States
- **Aliases**: Google, Google Cloud, Alphabet Inc variations

#### 3. LLM Configuration
Sets up local LLM configuration with the following parameters:

| Parameter | Value | Description |
|-----------|-------|-------------|
| `provider` | `local` | Local LLM deployment |
| `api_url` | `http://localhost:11434` | Ollama default endpoint |
| `model_tagger` | `phi3` | Document tagging model |
| `model_enricher` | `llama3` | Content enrichment model |
| `auto_tagging` | `true` | Enable automatic tagging |
| `auto_enrichment` | `true` | Enable content enrichment |
| `min_confidence_tagging` | `0.7` | Minimum confidence for tagging |
| `min_confidence_entity` | `0.8` | Minimum confidence for entity assignment |
| `max_retries` | `3` | Maximum retry attempts |
| `batch_size` | `5` | Processing batch size |
| `concurrent_tasks` | `2` | Concurrent processing limit |

#### 4. Document Creation
Creates five test documents with different recipient assignment scenarios:

##### Problematic Recipients (Auto-Assignment Candidates)
1. **Google Cloud Invoice**
   - Recipient: `"Your Company"` (generic placeholder)
   - Expected Assignment: Google LLC entity

2. **Medical Insurance Bill**
   - Recipient: `""` (empty string)
   - Expected Assignment: Personal Entity

3. **Office Rent Invoice**
   - Recipient: `None` (null value)
   - Expected Assignment: Test Company Ltd.

4. **Google Workspace Subscription**
   - Recipient: `"Unknown"` (placeholder value)
   - Expected Assignment: Based on sender (Google LLC)

##### Properly Assigned Document
5. **Control Document**
   - Recipient: `"Test Company Ltd."` (properly assigned)
   - Entity ID: Pre-assigned to Test Company

## Usage

### Command Line Execution
```bash
python3 create_sample_data.py
```

### Programmatic Usage
```python
import asyncio
from create_sample_data import create_sample_data

# Run the data creation
asyncio.run(create_sample_data())
```

## Output Format

The script provides detailed console output showing the creation progress:

```
üìù Creating Sample Data for Tenant Automation Testing
============================================================
‚úÖ Sample data created successfully!
üìä Created:
  - 1 admin user
  - 3 entities (tenants)
  - 1 LLM configuration (enabled)
  - 5 sample documents
    ‚Ä¢ 4 with problematic recipients
    ‚Ä¢ 1 properly assigned
```

## Error Handling

- **Transaction Management**: Uses database transactions with automatic rollback on errors
- **Exception Handling**: Catches and reports database errors
- **Resource Cleanup**: Ensures proper session closure in finally block

## Testing Scenarios

This sample data enables testing of the following automation scenarios:

1. **Empty Recipient Detection**: Documents with null, empty, or placeholder recipients
2. **Alias Matching**: Entity recognition through various name aliases
3. **Sender-Based Assignment**: Assignment based on document sender when recipient is unclear
4. **Multi-Tenant Scenarios**: Documents for different entity types (personal vs. corporate)
5. **Confidence Thresholds**: Testing minimum confidence requirements for auto-assignment

## Database Schema Requirements

The script expects the following database models:
- `User`: User management with role-based access
- `Entity`: Tenant/entity information with aliases
- `Document`: Document storage with sender/recipient tracking
- `LLMConfig`: LLM service configuration

## Security Considerations

- **Password Hashing**: Uses bcrypt for secure password storage
- **Test Data**: Contains only sample/dummy data suitable for testing environments
- **Database Path**: Uses relative path suitable for development environments

## Maintenance Notes

- Update entity information to reflect current testing requirements
- Modify LLM configuration parameters based on model capabilities
- Adjust document scenarios to cover new automation features
- Review and update sample data volumes for performance testing