<!--
This documentation was auto-generated by Claude on 2025-06-01T06-15-16.
Source file: ./src/backend/force_process_hetzner.py
-->

# Hetzner Invoice Force Processing Script

## Overview

This script provides a manual mechanism to force process Hetzner invoices by bypassing duplicate detection and adding them directly to the processing queue. It's designed to run within a containerized environment and processes PDF invoice files from a specified inbox directory.

## Usage

```bash
python3 force_process_hetzner.py
```

## Requirements

- Python 3.6+
- Access to `/app` directory containing the main application
- Access to `/hostfs/Inbox` directory containing invoice files
- Required dependencies from the main application (`app.main`)

## Configuration

### File Paths

| Path | Description |
|------|-------------|
| `/app` | Application backend directory (added to Python path) |
| `/hostfs/Inbox` | Container inbox directory containing PDF files |

### File Pattern

The script searches for files matching the pattern: `*Hetzner*.pdf`

## Functions

### `force_process_hetzner_invoices()`

**Type:** `async function`

**Purpose:** Main processing function that locates and processes all Hetzner invoice files.

**Behavior:**
1. Scans the inbox directory for Hetzner invoice PDF files
2. Lists all found files for confirmation
3. Processes each file sequentially using the main application's processing function
4. Provides detailed progress reporting and error handling

**Returns:** `None`

**Exceptions:** Individual file processing errors are caught and reported without stopping the batch process.

## Process Flow

```mermaid
graph TD
    A[Start Script] --> B[Scan /hostfs/Inbox for *Hetzner*.pdf]
    B --> C{Files Found?}
    C -->|No| D[Print "No files found" and exit]
    C -->|Yes| E[Display file list]
    E --> F[Process each file sequentially]
    F --> G[Call process_new_document()]
    G --> H{Processing Successful?}
    H -->|Yes| I[Print success message]
    H -->|No| J[Print error message]
    I --> K{More files?}
    J --> K
    K -->|Yes| F
    K -->|No| L[Print completion summary]
```

## Output Examples

### Successful Processing
```
Found 3 Hetzner invoice files:
  - Hetzner_Invoice_2024001.pdf
  - Hetzner_Invoice_2024002.pdf
  - Hetzner_Invoice_2024003.pdf

Starting manual processing of Hetzner invoices...

Processing 1/3: Hetzner_Invoice_2024001.pdf
✅ Successfully processed: Hetzner_Invoice_2024001.pdf

Processing 2/3: Hetzner_Invoice_2024002.pdf
✅ Successfully processed: Hetzner_Invoice_2024002.pdf

Processing 3/3: Hetzner_Invoice_2024003.pdf
✅ Successfully processed: Hetzner_Invoice_2024003.pdf

Completed processing 3 Hetzner invoices.
```

### No Files Found
```
Found 0 Hetzner invoice files:
No Hetzner invoice files found in the inbox.
```

### Processing with Errors
```
Found 2 Hetzner invoice files:
  - Hetzner_Invoice_2024001.pdf
  - Hetzner_Invoice_corrupted.pdf

Starting manual processing of Hetzner invoices...

Processing 1/2: Hetzner_Invoice_2024001.pdf
✅ Successfully processed: Hetzner_Invoice_2024001.pdf

Processing 2/2: Hetzner_Invoice_corrupted.pdf
❌ Error processing Hetzner_Invoice_corrupted.pdf: File format not supported

Completed processing 2 Hetzner invoices.
```

## Error Handling

- **File Not Found:** Script reports when no matching files are found
- **Processing Errors:** Individual file processing errors are caught and logged without stopping the batch
- **Path Errors:** Relies on the underlying `glob` and `os.path` modules for path validation

## Notes

- This script bypasses normal duplicate detection mechanisms
- Processing is performed sequentially, not in parallel
- The script is designed for containerized environments with specific mount points
- All file operations are read-only; the script does not modify or move files

## Dependencies

```python
import asyncio
import sys
import os
import glob
from app.main import process_new_document
```

## Security Considerations

- Script requires access to host filesystem through `/hostfs/Inbox`
- Executes with the same privileges as the main application
- No input validation on file contents (delegated to `process_new_document`)