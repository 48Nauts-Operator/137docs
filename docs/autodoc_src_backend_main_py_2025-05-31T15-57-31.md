<!--
This documentation was auto-generated by Claude on 2025-05-31T15-57-31.
Source file: ./src/backend/main.py
-->

# Document Processing API Documentation

## Overview

This Python module implements a FastAPI-based document processing service with AI-powered analysis capabilities. The service provides document management, user authentication, multi-tenancy support, and automated document processing with configurable rules.

## Dependencies

### Core Framework
- **FastAPI**: Modern web framework for building APIs
- **Uvicorn**: ASGI server for running the FastAPI application
- **SQLAlchemy**: SQL toolkit and Object-Relational Mapping (ORM)
- **Pydantic**: Data validation using Python type annotations

### Authentication & Security
- **HTTPBearer**: HTTP Bearer token authentication scheme
- **Custom Auth Module**: Handles token creation, verification, and password management

### File & System Operations
- **pathlib.Path**: Object-oriented filesystem paths
- **os**: Operating system interface
- **shutil**: High-level file operations
- **logging**: Logging facility for Python

### AI & Processing
- **VisionAnalyzer**: AI-powered document vision analysis
- **LLMNotConfiguredError**: Exception for unconfigured language models
- **TenantExtractor**: Automated tenant identification from documents
- **TenantAutoAssigner**: Automatic tenant assignment logic
- **DocumentRuleProcessor**: Rule-based document processing engine

## Core Components

### Web Framework Setup
```python
from fastapi import FastAPI, HTTPException, Depends, File, UploadFile, Form, BackgroundTasks, Query
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import FileResponse, StreamingResponse
from fastapi.staticfiles import StaticFiles
```

**Purpose**: Establishes the web API framework with support for:
- File uploads and downloads
- Cross-Origin Resource Sharing (CORS)
- Static file serving
- Background task processing
- Query parameter handling

### Database Integration
```python
from database import get_db, init_database
from models import Document, User, Tenant, ProcessingRule
```

**Components**:
- `get_db()`: Database session dependency injection
- `init_database()`: Database initialization function
- **Models**: SQLAlchemy ORM models for core entities

### Data Schemas
```python
from schemas import (
    DocumentCreate, DocumentUpdate, DocumentResponse,
    UserCreate, UserResponse,
    TenantCreate, TenantUpdate, TenantResponse,
    ProcessingRuleCreate, ProcessingRuleUpdate, ProcessingRuleResponse
)
```

**Purpose**: Pydantic schemas for request/response validation and serialization:
- **Document Schemas**: Handle document CRUD operations
- **User Schemas**: Manage user registration and profiles
- **Tenant Schemas**: Multi-tenant organization management
- **Processing Rule Schemas**: Configurable document processing rules

### Authentication System
```python
from auth import create_access_token, verify_token, hash_password, verify_password, get_current_user
```

**Features**:
- JWT token creation and verification
- Password hashing and validation
- Current user identification from requests
- Secure authentication flow

### Service Layer
```python
from document_service import DocumentService
from utils import save_uploaded_file, cleanup_temp_files
from rule_repository import RuleRepository
```

**Components**:
- **DocumentService**: Business logic for document operations
- **Utility Functions**: File handling and cleanup operations
- **RuleRepository**: Data access layer for processing rules

### AI Processing Pipeline
```python
from vision_ai import VisionAnalyzer, LLMNotConfiguredError
from tenant_extractor import TenantExtractor
from tenant_auto_assigner import TenantAutoAssigner
from document_rule_processor import DocumentRuleProcessor
```

**Capabilities**:
- **Vision Analysis**: Extract text and insights from document images
- **Tenant Extraction**: Automatically identify document ownership
- **Auto-Assignment**: Intelligent tenant assignment based on content
- **Rule Processing**: Apply custom processing rules to documents
- **Error Handling**: Graceful handling of AI service configuration issues

### Version Management
```python
from version import get_version, get_release_info, get_version_history
```

**Functions**:
- `get_version()`: Current application version
- `get_release_info()`: Detailed release information
- `get_version_history()`: Version change history

## Architecture Pattern

This module follows a **layered architecture** pattern:

1. **Presentation Layer**: FastAPI routes and middleware
2. **Authentication Layer**: Security and user management
3. **Service Layer**: Business logic and orchestration
4. **Data Access Layer**: Database models and repositories
5. **AI Processing Layer**: Document analysis and automation
6. **Utilities Layer**: File operations and system utilities

## Key Features

- üîê **Secure Authentication**: JWT-based authentication with password hashing
- üìÑ **Document Management**: Upload, process, and retrieve documents
- üè¢ **Multi-Tenancy**: Organization-based data isolation
- ü§ñ **AI-Powered Analysis**: Automated document processing with vision AI
- ‚öôÔ∏è **Configurable Rules**: Custom processing rules per tenant
- üìä **Background Processing**: Asynchronous document processing
- üåê **CORS Support**: Cross-origin request handling
- üìÅ **File Management**: Secure file upload and storage
- üìà **Version Tracking**: Application version management

## Error Handling

The system includes comprehensive error handling:
- `HTTPException`: Standard HTTP error responses
- `LLMNotConfiguredError`: AI service configuration errors
- Database connection and transaction error handling
- File operation error management

## Usage Context

This module serves as the main entry point for a document processing API that can be used for:
- Enterprise document management systems
- Automated invoice processing
- Multi-tenant SaaS applications
- AI-powered document analysis services
- Compliance and audit document processing