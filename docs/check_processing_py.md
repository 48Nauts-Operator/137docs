<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# Document Processing Checker

## Overview

This Python script is a diagnostic utility designed to monitor and inspect document processing status in a database. It provides insights into documents that are currently being processed and displays recent document activity.

## Purpose

The script serves as a monitoring tool for:
- **Debugging document processing workflows** - Identifies documents stuck in "processing" status
- **System health checks** - Provides a quick overview of recent document activity
- **Administrative monitoring** - Helps track document processing pipeline status

## Dependencies

- `asyncio` - For asynchronous execution
- `sqlalchemy` - Database ORM with async support
- Custom application modules:
  - `app.database` - Database engine configuration
  - `app.models` - Document model definitions

## Main Components

### Core Function: `check_processing()`

```python
async def check_processing():
```

An asynchronous function that performs two main database queries:

#### 1. Processing Status Check
- **Query**: Retrieves all documents with `status = 'processing'`
- **Output**: Count and details of documents currently being processed
- **Use case**: Identify potential bottlenecks or stuck processes

#### 2. Recent Documents Overview
- **Query**: Fetches the 5 most recently created documents
- **Output**: Document ID, title, status, and creation timestamp
- **Use case**: Monitor recent system activity and document flow

### Database Operations

The script uses SQLAlchemy's async session management:

```python
async with AsyncSession(engine) as session:
```

**Query Methods Used:**
- **ORM Query**: `select(Document).filter(Document.status == 'processing')`
- **Raw SQL**: `text('SELECT id, title, status, created_at FROM documents...')`

## Usage

### Running the Script

```bash
python check_processing.py
```

### Expected Output

```
Documents with processing status: 3
  - Annual Report 2023 (ID: 145)
  - Marketing Proposal (ID: 167)
  - Budget Analysis (ID: 203)

Recent documents:
  - Project Timeline (ID: 205, Status: completed, Created: 2024-01-15 14:30:22)
  - Budget Analysis (ID: 203, Status: processing, Created: 2024-01-15 14:25:10)
  - Marketing Proposal (ID: 167, Status: processing, Created: 2024-01-15 14:20:05)
  - Annual Report 2023 (ID: 145, Status: processing, Created: 2024-01-15 14:15:30)
  - Client Contract (ID: 134, Status: completed, Created: 2024-01-15 14:10:15)
```

## Configuration Notes

### Path Configuration
```python
sys.path.append('/app')
```
- Assumes application is located in `/app` directory
- **Suggestion**: Consider using relative paths or environment variables for better portability

### Database Model Requirements

The script expects a `Document` model with the following attributes:
- `id` - Primary key
- `title` - Document title
- `status` - Processing status (particularly 'processing')
- `created_at` - Timestamp field

## Recommendations

### Error Handling
Consider adding try-catch blocks for database connection issues:

```python
try:
    async with AsyncSession(engine) as session:
        # existing code
except Exception as e:
    print(f"Database error: {e}")
```

### Configuration Management
- Move hardcoded values to configuration files
- Add command-line argument support for different query limits

### Logging
Replace `print` statements with proper logging:

```python
import logging
logging.info(f'Documents with processing status: {len(docs)}')
```

### Enhanced Monitoring
Consider adding:
- Document age analysis for stuck processes
- Status distribution statistics
- Processing time metrics

## Use Cases

1. **Development**: Debug document processing workflows
2. **Operations**: Monitor system health and performance
3. **Troubleshooting**: Identify documents stuck in processing state
4. **Reporting**: Generate quick status reports for administrators