<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Document Processing Status Checker

## Overview

This Python script is a diagnostic utility designed to monitor and report on document processing status within a database-driven application. It provides insights into documents that are currently being processed and displays information about recently created documents.

## Purpose

The script serves as a **monitoring and debugging tool** for applications that handle document processing workflows. It helps administrators and developers:

- Track documents stuck in processing state
- Monitor recent document creation activity
- Debug document processing pipeline issues

## Dependencies

The script relies on the following components:

- **SQLAlchemy**: Async ORM for database operations
- **asyncio**: Asynchronous programming support
- **Custom application modules**:
  - `app.database`: Database engine configuration
  - `app.models`: Document model definitions

## Key Functions

### `check_processing()`

**Purpose**: Main asynchronous function that queries the database and displays document status information.

**Functionality**:
- Creates an async database session
- Executes two separate queries to gather document information
- Prints formatted results to the console

**Query Operations**:

1. **Processing Documents Query**:
   ```python
   select(Document).filter(Document.status == 'processing')
   ```
   - Finds all documents with status = 'processing'
   - Displays count and details (title, ID)

2. **Recent Documents Query**:
   ```python
   text('SELECT id, title, status, created_at FROM documents ORDER BY created_at DESC LIMIT 5')
   ```
   - Retrieves 5 most recently created documents
   - Shows ID, title, status, and creation timestamp

## Usage

Run the script directly from the command line:

```bash
python check_processing.py
```

**Expected Output**:
```
Documents with processing status: 2
  - Document Title 1 (ID: 123)
  - Document Title 2 (ID: 124)

Recent documents:
  - Latest Doc (ID: 125, Status: completed, Created: 2023-12-01 10:30:00)
  - Another Doc (ID: 124, Status: processing, Created: 2023-12-01 09:15:00)
  ...
```

## Technical Notes

### Path Configuration
```python
sys.path.append('/app')
```
- Adds `/app` directory to Python path for module imports
- Suggests this script runs in a containerized environment (Docker)

### Database Session Management
- Uses async context manager for proper session cleanup
- Ensures database connections are properly closed

## Suggestions and Improvements

### üîß **Recommended Enhancements**

1. **Add Command Line Arguments**:
   ```python
   import argparse
   # Add options for status filter, limit, date ranges
   ```

2. **Error Handling**:
   ```python
   try:
       async with AsyncSession(engine) as session:
           # existing code
   except Exception as e:
       print(f"Database error: {e}")
   ```

3. **Configuration Options**:
   - Make document limit configurable
   - Add filtering by date ranges
   - Support multiple status filters

4. **Output Formatting**:
   - Consider using tabular output (e.g., `tabulate` library)
   - Add JSON output option for programmatic use

### ‚ö†Ô∏è **Potential Issues**

- **Hard-coded path**: `/app` path assumption may not work in all environments
- **No error handling**: Database connection failures will crash the script
- **Limited filtering**: Only shows processing status, might need other statuses

### üìã **Maintenance Notes**

- Ensure the `Document` model includes required fields: `id`, `title`, `status`, `created_at`
- Verify database engine configuration in `app.database` module
- Consider adding logging instead of print statements for production use