<!-- Auto-generated by Claude on 2025-06-08 06:13 -->

# Hetzner Invoice Force Processing Script

## Overview

This Python script is designed to manually force the processing of Hetzner invoices by bypassing the normal duplicate detection mechanisms. It directly adds Hetzner invoice files to the processing queue, making it useful for handling invoices that may have been previously skipped or failed to process automatically.

## Purpose

- **Manual Invoice Processing**: Processes Hetzner invoices that may have been missed by automated systems
- **Duplicate Detection Bypass**: Circumvents normal duplicate detection to ensure processing occurs
- **Batch Processing**: Handles multiple Hetzner invoice files in a single execution
- **Container Environment**: Designed to run within a containerized application environment

## Key Components

### Main Function

#### `force_process_hetzner_invoices()`

```python
async def force_process_hetzner_invoices():
```

**Purpose**: Asynchronously processes all Hetzner invoice PDF files found in the inbox directory.

**Functionality**:
- Scans the inbox directory for Hetzner invoice files
- Provides progress feedback during processing
- Handles errors gracefully for individual files
- Reports processing results for each file

**Key Features**:
- **File Discovery**: Uses glob pattern matching to find files containing "Hetzner" in the filename
- **Progress Tracking**: Shows current file being processed (e.g., "Processing 2/5")
- **Error Handling**: Continues processing remaining files even if one fails
- **Status Reporting**: Provides visual feedback with ‚úÖ and ‚ùå symbols

## File Structure and Paths

### Important Directories

- **Inbox Path**: `/hostfs/Inbox` - Source directory for invoice files
- **Backend Path**: `/app` - Application backend directory added to Python path

### File Pattern Matching

```python
hetzner_files = glob.glob(os.path.join(inbox_path, "*Hetzner*.pdf"))
```

- Searches for PDF files containing "Hetzner" in the filename
- Case-sensitive matching
- Only processes PDF format files

## Dependencies

### External Modules
- `asyncio` - Asynchronous programming support
- `sys` - System-specific parameters and functions
- `os` - Operating system interface
- `glob` - Unix-style pathname pattern expansion

### Internal Dependencies
- `app.main.process_new_document` - Core document processing function

## Usage

### Execution

Run the script directly:

```bash
python3 force_process_hetzner.py
```

The script will:
1. Search for Hetzner invoice files in the inbox
2. Display found files
3. Process each file individually
4. Report success/failure for each file
5. Provide a summary of total files processed

### Sample Output

```
Found 3 Hetzner invoice files:
  - Invoice_Hetzner_2024_01.pdf
  - Invoice_Hetzner_2024_02.pdf
  - Invoice_Hetzner_2024_03.pdf

Starting manual processing of Hetzner invoices...

Processing 1/3: Invoice_Hetzner_2024_01.pdf
‚úÖ Successfully processed: Invoice_Hetzner_2024_01.pdf

Processing 2/3: Invoice_Hetzner_2024_02.pdf
‚ùå Error processing Invoice_Hetzner_2024_02.pdf: Database connection failed

Completed processing 3 Hetzner invoices.
```

## Important Notes

### ‚ö†Ô∏è Warnings and Considerations

- **Duplicate Processing**: This script bypasses duplicate detection, potentially causing the same invoice to be processed multiple times
- **Container Environment**: Designed specifically for containerized deployment with mounted host filesystem
- **Error Resilience**: Individual file failures don't stop the entire batch process
- **Manual Intervention**: This is a manual override tool and should be used with caution

### üîß Technical Requirements

- **Python Version**: Requires Python 3.7+ (for asyncio support)
- **File System Access**: Needs read access to `/hostfs/Inbox` directory
- **Application Dependencies**: Requires the main application backend to be available

### üí° Suggestions for Improvement

1. **Add Configuration**: Make inbox path configurable via environment variables
2. **Logging**: Implement proper logging instead of print statements
3. **Dry Run Mode**: Add option to preview files without processing
4. **File Validation**: Add PDF file validation before processing
5. **Backup Mechanism**: Create backups of processed files
6. **Progress Persistence**: Save processing state to resume interrupted batches

### üöÄ Best Practices

- Run during low-traffic periods to avoid system load
- Monitor system resources during batch processing
- Keep backups of original invoice files
- Review processing logs after execution
- Test with a small batch first before processing large volumes