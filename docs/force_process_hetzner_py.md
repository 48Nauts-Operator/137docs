<!-- Auto-generated by Claude on 2025-06-02 06:15 -->

# Hetzner Invoice Force Processing Script

## Overview

This Python script is designed to manually force the processing of Hetzner invoices, bypassing normal duplicate detection mechanisms. It's a utility script that directly processes PDF invoice files from Hetzner found in a designated inbox folder.

## Purpose

- **Manual Processing**: Bypasses automated duplicate detection systems
- **Batch Processing**: Processes all Hetzner invoice files in one operation
- **Direct Queue Addition**: Adds invoices directly to the processing pipeline
- **Container Integration**: Designed to work within a containerized environment

## Key Components

### Main Function

#### `force_process_hetzner_invoices()`

```python
async def force_process_hetzner_invoices():
```

**Purpose**: Orchestrates the entire force processing workflow

**Functionality**:
- Scans the inbox directory for Hetzner invoice files
- Displays found files to the user
- Processes each file individually
- Provides progress feedback and error handling

**Key Steps**:
1. **File Discovery**: Uses glob pattern matching to find `*Hetzner*.pdf` files
2. **Validation**: Checks if any files were found before proceeding
3. **Batch Processing**: Iterates through all found files
4. **Error Handling**: Catches and reports processing errors for individual files
5. **Progress Reporting**: Shows current progress (x/total) and results

## Configuration

### File Paths

- **Inbox Path**: `/hostfs/Inbox`
  - Container-mounted path to the host filesystem
  - Contains incoming invoice files
- **Backend Path**: `/app`
  - Application root directory within container

### File Pattern Matching

```python
hetzner_files = glob.glob(os.path.join(inbox_path, "*Hetzner*.pdf"))
```

- Searches for PDF files containing "Hetzner" in the filename
- Case-sensitive matching

## Dependencies

### External Modules
- `asyncio`: Async/await support for concurrent processing
- `sys`: System path manipulation
- `os`: Operating system interface
- `glob`: Unix-style pathname pattern expansion

### Internal Dependencies
- `app.main.process_new_document`: Core document processing function

## Usage

### Command Line Execution

```bash
python3 force_process_hetzner.py
```

### Docker Container Context

This script is designed to run within a Docker container with:
- Host filesystem mounted at `/hostfs`
- Application code at `/app`

## Output Examples

### Successful Processing
```
Found 3 Hetzner invoice files:
  - Invoice-Hetzner-2024-01.pdf
  - Invoice-Hetzner-2024-02.pdf
  - Invoice-Hetzner-2024-03.pdf

Starting manual processing of Hetzner invoices...

Processing 1/3: Invoice-Hetzner-2024-01.pdf
‚úÖ Successfully processed: Invoice-Hetzner-2024-01.pdf

Processing 2/3: Invoice-Hetzner-2024-02.pdf
‚úÖ Successfully processed: Invoice-Hetzner-2024-02.pdf
```

### No Files Found
```
Found 0 Hetzner invoice files:
No Hetzner invoice files found in the inbox.
```

## Important Notes

### ‚ö†Ô∏è Cautions

- **Bypasses Duplicate Detection**: This script intentionally skips duplicate checking
- **Manual Intervention**: Should only be used when automated processing fails
- **File System Dependencies**: Requires specific container mount configuration

### üîß Technical Considerations

- **Async Processing**: Uses asyncio for potentially concurrent operations
- **Error Isolation**: Individual file processing errors don't stop the entire batch
- **Container-Specific**: Hardcoded paths assume specific container setup

### üí° Suggestions for Improvement

1. **Configuration File**: Move hardcoded paths to a configuration file
2. **Logging**: Implement proper logging instead of print statements
3. **Dry Run Mode**: Add option to preview files without processing
4. **Pattern Flexibility**: Make file pattern configurable via command line arguments
5. **Backup Strategy**: Consider backing up files before processing

## Error Handling

The script includes robust error handling:
- Continues processing remaining files if one fails
- Displays clear error messages with file names
- Provides visual indicators (‚úÖ/‚ùå) for processing status