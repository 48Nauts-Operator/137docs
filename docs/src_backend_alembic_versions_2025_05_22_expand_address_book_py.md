<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# Database Migration: Expand Address Book Columns

## Overview

This file is an **Alembic database migration script** that expands the `address_book` table by adding new columns for more detailed contact information storage. Alembic is a database migration tool for SQLAlchemy that allows you to version and manage database schema changes over time.

## Migration Details

- **Revision ID**: `2025_05_22_expand_address_book`
- **Previous Revision**: `2025_05_21_add_users_table`
- **Created**: 2025-05-22
- **Purpose**: Add additional address and contact fields to the existing address book table

## Functions

### `upgrade()`

Applies the migration by adding seven new columns to the `address_book` table:

```python
def upgrade():
    with op.batch_alter_table('address_book') as batch:
        batch.add_column(sa.Column('street', sa.String(length=255), nullable=True))
        batch.add_column(sa.Column('address2', sa.String(length=255), nullable=True))
        batch.add_column(sa.Column('town', sa.String(length=255), nullable=True))
        batch.add_column(sa.Column('zip', sa.String(length=20), nullable=True))
        batch.add_column(sa.Column('county', sa.String(length=100), nullable=True))
        batch.add_column(sa.Column('group_name', sa.String(length=100), nullable=True))
        batch.add_column(sa.Column('last_transaction', sa.String(length=50), nullable=True))
```

**New Columns Added:**
- `street` (String, 255 chars) - Street address
- `address2` (String, 255 chars) - Secondary address line (apartment, suite, etc.)
- `town` (String, 255 chars) - City/town name
- `zip` (String, 20 chars) - Postal/ZIP code
- `county` (String, 100 chars) - County information
- `group_name` (String, 100 chars) - Contact grouping/categorization
- `last_transaction` (String, 50 chars) - Last transaction reference

### `downgrade()`

Reverses the migration by removing all the columns that were added:

```python
def downgrade():
    with op.batch_alter_table('address_book') as batch:
        batch.drop_column('last_transaction')
        batch.drop_column('group_name')
        batch.drop_column('county')
        batch.drop_column('zip')
        batch.drop_column('town')
        batch.drop_column('address2')
        batch.drop_column('street')
```

## Usage

### Running the Migration

**To apply the migration:**
```bash
alembic upgrade head
```

**To rollback this specific migration:**
```bash
alembic downgrade 2025_05_21_add_users_table
```

## Important Notes

- ‚ö†Ô∏è **All new columns are nullable** (`nullable=True`), which means existing records won't break when this migration is applied
- üîÑ **Batch operations** are used, which is recommended for SQLite compatibility and better performance
- üìù **Column order in downgrade** is reversed to avoid potential dependency issues during rollback
- üóÇÔ∏è The migration follows a logical progression from the previous migration that added the users table

## Considerations

### Data Types
- **ZIP codes are stored as strings** (not integers) to handle international postal codes and leading zeros
- **Transaction references** have a relatively short length (50 chars) - ensure this meets your application's needs

### Recommendations
- Consider adding indexes on frequently queried columns like `zip`, `county`, or `group_name` in a future migration
- Validate the string lengths match your application's requirements before deploying
- Consider if `last_transaction` should reference a transactions table with a foreign key instead of storing it as a string