<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# Document Management System API Routes

This file contains the FastAPI routes for a Document Management System. It provides RESTful API endpoints for managing documents, tags, and tasks with automatic document processing capabilities including OCR (Optical Character Recognition).

## Purpose

The API routes handle:
- Document CRUD operations (Create, Read, Update, Delete)
- File upload and automatic processing
- Document tagging system
- Task management for documents
- Document filtering and pagination

## Dependencies

- **FastAPI**: Web framework for building APIs
- **SQLAlchemy**: Database ORM
- **Pydantic**: Data validation and serialization
- **Custom modules**: Database, repository, OCR, and LLM processors

## Data Models

### Document Models

```python
class DocumentBase(BaseModel):
    title: Optional[str] = None
    sender: Optional[str] = None
    document_date: Optional[date] = None
    due_date: Optional[date] = None
    amount: Optional[float] = None
    document_type: Optional[str] = None
    status: Optional[str] = None
```

- **DocumentCreate**: For creating new documents
- **DocumentUpdate**: For updating existing documents  
- **DocumentResponse**: For API responses with additional fields (id, filename, content_text, timestamps)

### Tag Models

- **TagCreate**: Create tags with name and optional color
- **TagResponse**: Tag response including ID

### Task Models

- **TaskCreate**: Create tasks with description and optional due date
- **TaskResponse**: Task response including ID and status

## API Endpoints

### Document Management

#### `GET /documents`
- **Purpose**: Retrieve a paginated list of documents with optional filtering
- **Parameters**:
  - `limit`: Number of documents to return (1-1000, default: 100)
  - `offset`: Number of documents to skip (default: 0)
  - `document_type`: Filter by document type
  - `status`: Filter by document status
  - `tag_id`: Filter by tag ID
- **Returns**: List of documents

#### `GET /documents/{document_id}`
- **Purpose**: Retrieve a specific document by ID
- **Returns**: Single document or 404 error

#### `POST /documents`
- **Purpose**: Create a new document manually
- **Body**: DocumentCreate model
- **Returns**: Created document

#### `PUT /documents/{document_id}`
- **Purpose**: Update an existing document
- **Body**: DocumentUpdate model (partial updates supported)
- **Returns**: Updated document or 404 error

#### `DELETE /documents/{document_id}`
- **Purpose**: Delete a document
- **Returns**: Success message or 404 error

### File Upload

#### `POST /upload`
- **Purpose**: Upload and automatically process documents
- **Process**:
  1. Validates file type against allowed extensions
  2. Saves file to inbox folder
  3. Processes document using OCR
  4. Saves extracted data to database
- **Returns**: Success message with document ID

### Tag Management

#### `POST /documents/{document_id}/tags`
- **Purpose**: Add a tag to a document
- **Body**: TagCreate model
- **Returns**: Created tag

#### `DELETE /documents/{document_id}/tags/{tag_id}`
- **Purpose**: Remove a tag from a document
- **Returns**: Success message

### Task Management

#### `POST /documents/{document_id}/tasks`
- **Purpose**: Create a task associated with a document
- **Body**: TaskCreate model
- **Returns**: Created task

## Key Features

### Automatic Document Processing
The upload endpoint integrates with OCR processing to automatically extract text and metadata from uploaded documents.

### Flexible Filtering
The document listing endpoint supports multiple filter parameters for efficient document retrieval.

### Error Handling
Comprehensive HTTP exception handling with appropriate status codes and error messages.

### Logging
Configured logging system for monitoring and debugging.

## Configuration Dependencies

The system relies on several configuration settings:
- `ALLOWED_FILE_TYPES`: Supported file extensions
- `INBOX_FOLDER`: Directory for uploaded files

## Notes and Suggestions

### Security Considerations
- ⚠️ **File Upload Security**: Consider adding file size limits and virus scanning
- ⚠️ **Authentication**: No authentication middleware is visible - ensure proper security is implemented
- ⚠️ **Input Validation**: Add more robust file validation beyond extension checking

### Performance Improvements
- Consider implementing async database operations
- Add caching for frequently accessed documents
- Implement file cleanup mechanisms for processed documents

### Error Handling
- The current error handling is basic - consider implementing custom exception classes
- Add more specific error messages for different failure scenarios

### Documentation
- Consider adding OpenAPI tags to group related endpoints
- Add more detailed parameter descriptions for auto-generated documentation

### Code Organization
- The file is well-structured but could benefit from separating models into a dedicated schema file
- Consider extracting file processing logic into a separate service layer