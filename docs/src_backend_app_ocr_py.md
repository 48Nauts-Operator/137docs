<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# OCR and Document Processing Module

## Overview

This module provides OCR (Optical Character Recognition) and document processing capabilities for a Document Management System. It's designed to extract text from various document formats including PDFs, images, and plain text files using a hybrid approach that prioritizes performance and reliability.

## Key Features

- **Multi-format support**: Handles PDFs, images (JPG, PNG, TIFF), and text files
- **Hybrid PDF processing**: Combines fast text extraction with OCR fallback
- **Asynchronous processing**: Non-blocking operations using asyncio
- **Lazy loading**: Heavy libraries are imported only when needed
- **Crash-resistant**: Avoids problematic external dependencies that cause segmentation faults

## Classes

### `OCRProcessor`

The main class that handles document processing and text extraction.

#### Methods

##### `process_document(file_path: str) -> str`

**Purpose**: Main entry point for document processing. Routes files to appropriate processors based on file extension.

**Parameters**:
- `file_path`: Path to the document file to process

**Returns**: Extracted text content as a string

**Supported file types**:
- `.pdf` - PDF documents
- `.jpg`, `.jpeg`, `.png`, `.tiff`, `.tif` - Image files
- `.txt` - Plain text files

##### `_process_pdf(file_path: str) -> str` (Private)

**Purpose**: Processes PDF files using a two-pass approach for optimal performance and reliability.

**Process**:
1. **Pass 1**: Uses `pdfplumber` to extract embedded text (fast, pure Python)
2. **Pass 2**: For pages with no extractable text, uses PyMuPDF to render pages and applies Tesseract OCR

**Benefits**:
- Avoids heavy OCR processing for digital PDFs
- Eliminates crashes from external poppler dependencies
- Only processes individual pages that need OCR

##### `_process_image(file_path: str) -> str` (Private)

**Purpose**: Processes image files using Tesseract OCR.

**Process**:
- Opens image using PIL
- Applies Tesseract OCR with English language model
- Returns extracted text

##### `_process_text(file_path: str) -> str` (Private)

**Purpose**: Reads and returns content from plain text files.

## Utility Functions

### `_lazy_import(module_name: str)`

**Purpose**: Imports modules only when first needed and caches them at module level.

**Benefits**:
- Reduces startup time
- Minimizes memory overhead
- Improves application performance

## Dependencies

### Core Libraries
- `pytesseract` - OCR engine interface
- `PIL (Pillow)` - Image processing
- `asyncio` - Asynchronous processing

### Lazy-loaded Libraries
- `pdfplumber` - PDF text extraction (pure Python)
- `fitz (PyMuPDF)` - PDF rendering and manipulation

## Usage Example

```python
import asyncio
from ocr_processor import OCRProcessor

async def main():
    processor = OCRProcessor()
    
    # Process a PDF
    pdf_text = await processor.process_document("document.pdf")
    
    # Process an image
    image_text = await processor.process_document("scan.png")
    
    # Process a text file
    text_content = await processor.process_document("notes.txt")

asyncio.run(main())
```

## Configuration Notes

### Tesseract Setup
Ensure Tesseract is installed on your system:
- **Windows**: Download from GitHub releases
- **macOS**: `brew install tesseract`
- **Linux**: `sudo apt-get install tesseract-ocr`

### Performance Considerations

- **PDF Processing**: The hybrid approach significantly reduces processing time for digital PDFs
- **OCR Quality**: 300 DPI rendering provides good balance between quality and performance
- **Memory Usage**: Lazy imports help keep memory footprint low

## Error Handling

The module includes comprehensive error handling:
- Logs warnings for unsupported file types
- Catches and logs processing errors
- Returns error messages instead of crashing
- Graceful fallback between processing methods

## Logging

Uses Python's standard logging module with logger name `__name__`. Configure logging in your application to capture processing information and errors.

## Recommendations

1. **Monitor memory usage** when processing large PDFs or high-resolution images
2. **Consider adding file size limits** to prevent resource exhaustion  
3. **Implement caching** for frequently processed documents
4. **Add progress tracking** for long-running OCR operations
5. **Consider adding support for additional languages** in Tesseract configuration