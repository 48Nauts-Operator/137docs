<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# Document Recipient Assignment Checker

## Overview

This script is a diagnostic tool designed to analyze and identify issues with document recipient assignments in a document management system. It connects to a SQLite database to examine document records, evaluate recipient assignment quality, and provide insights into the system's configuration and data integrity.

## Purpose

The script serves as a **data quality audit tool** that helps administrators:
- Identify documents with missing or invalid recipient assignments
- Analyze overall document assignment statistics
- Review available entities (tenants) in the system
- Check LLM configuration status
- Display examples of properly assigned documents

## Key Components

### Database Configuration

```python
os.environ["DATABASE_URL"] = f"sqlite+aiosqlite:///src/backend/documents.db"
engine = create_async_engine(f"sqlite+aiosqlite:///src/backend/documents.db", echo=False)
```

- Uses **SQLAlchemy** with async support for database operations
- Connects to a SQLite database located at `src/backend/documents.db`
- Configures the database URL through environment variables

### Main Function: `check_documents()`

This async function performs five main diagnostic checks:

#### 1. Problematic Recipients Detection
- Identifies documents with missing, empty, or placeholder recipient values
- Problematic values include:
  - `None` (null values)
  - Empty strings `''`
  - Generic placeholders: `'Your Company'`, `'Unknown'`
- Displays up to 15 problematic documents with formatted output

#### 2. Statistical Analysis
- Counts total documents in the system
- Calculates the number of problematic assignments
- Computes assignment success rate as a percentage
- Provides a comprehensive overview of data quality

#### 3. Entity (Tenant) Inventory
- Lists all available entities/tenants in the system
- Shows entity ID, alias, type, and full name
- Helps verify that proper recipient options exist

#### 4. LLM Configuration Check
- Examines the Large Language Model configuration
- Reports on auto-tagging and auto-enrichment settings
- Includes error handling for missing or corrupted configuration

#### 5. Success Examples
- Displays up to 5 examples of properly assigned documents
- Demonstrates what correct recipient assignments look like
- Helps validate the detection logic

## Output Format

The script produces a well-formatted console report with:
- **Emoji indicators** for visual clarity (üîç, ‚ùå, ‚úÖ, üìä, üë•, üß†)
- **Tabular formatting** with consistent column widths
- **Statistical summaries** with percentages
- **Color-coded sections** using separators and headers

## Usage

```bash
python3 document_checker.py
```

## Dependencies

- `asyncio` - For asynchronous operations
- `sqlalchemy` - Database ORM with async support
- `app.models` - Custom models (Document, Entity, LLMConfig)

## Notes and Suggestions

### ‚ö†Ô∏è **Path Configuration**
The script modifies `sys.path` to include application directories. Consider using proper package installation or virtual environments instead.

### üîß **Configuration Management**
The database URL is hardcoded. Consider:
- Using environment variables exclusively
- Adding configuration file support
- Implementing database URL validation

### üìà **Enhancement Opportunities**
- Add command-line arguments for filtering options
- Implement export functionality (CSV, JSON)
- Add fix suggestions or auto-correction capabilities
- Include historical trend analysis

### üõ°Ô∏è **Error Handling**
- Add database connection error handling
- Implement retry logic for transient failures
- Add validation for database schema compatibility

### üéØ **Use Cases**
This script is particularly useful for:
- **Data migration validation**
- **Regular data quality audits**
- **Troubleshooting recipient assignment issues**
- **System health monitoring**
- **Pre-deployment verification**

## Example Output

```
üîç Checking Document Recipient Assignments
============================================================
‚ùå Documents with problematic recipients:
  ID:   1 | Invoice_2024_001.pdf                  | Recipient: None           | Sender: Vendor Corp
  ID:   5 | Contract_Draft.docx                   | Recipient: 'Unknown'      | Sender: Legal Dept

üìä Document Statistics:
  Total documents: 150
  Problematic recipients: 23
  Properly assigned: 127
  Assignment rate: 84.7%
```