<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# Processing Check Script

## Overview

This is a diagnostic utility script that monitors and reports on document processing status within a database. The script is designed to help administrators and developers track document processing workflows by providing insights into currently processing documents and recent document activity.

## Purpose

- **Monitor Processing Status**: Identifies documents that are currently in a "processing" state
- **Track Recent Activity**: Displays the 5 most recently created documents with their status
- **Database Health Check**: Provides a quick snapshot of document processing pipeline status

## Dependencies

The script requires the following components:
- `asyncio` - For asynchronous database operations
- `sqlalchemy` - For database ORM and raw SQL queries
- Custom application modules:
  - `app.database.engine` - Database connection engine
  - `app.models.Document` - Document model definition

## Functions

### `check_processing()`

**Type**: Async function  
**Parameters**: None  
**Returns**: None (prints output to console)

This is the main function that performs two key database queries:

#### Processing Documents Query
```python
result = await session.execute(select(Document).filter(Document.status == 'processing'))
```
- Retrieves all documents with status = 'processing'
- Displays count and details (title, ID) of each processing document

#### Recent Documents Query
```python
result = await session.execute(text('SELECT id, title, status, created_at FROM documents ORDER BY created_at DESC LIMIT 5'))
```
- Fetches the 5 most recently created documents
- Shows ID, title, status, and creation timestamp for each

## Usage

Run the script directly from the command line:

```bash
python check_processing.py
```

### Sample Output
```
Documents with processing status: 2
  - Annual Report 2023 (ID: 123)
  - Marketing Proposal (ID: 156)

Recent documents:
  - Budget Analysis (ID: 200, Status: completed, Created: 2023-12-01 10:30:00)
  - Project Timeline (ID: 199, Status: processing, Created: 2023-12-01 09:15:00)
  - Meeting Notes (ID: 198, Status: failed, Created: 2023-11-30 16:45:00)
  - Contract Draft (ID: 197, Status: completed, Created: 2023-11-30 14:20:00)
  - Research Document (ID: 196, Status: completed, Created: 2023-11-30 11:10:00)
```

## Technical Notes

### Database Session Management
- Uses `AsyncSession` with proper context management (`async with`)
- Automatically handles session cleanup and connection pooling

### Query Approaches
- **ORM Query**: Uses SQLAlchemy ORM for filtering processing documents
- **Raw SQL**: Uses raw SQL for the recent documents query with custom field selection

## Recommendations

### Error Handling
Consider adding try-catch blocks for better error handling:

```python
async def check_processing():
    try:
        async with AsyncSession(engine) as session:
            # existing code
    except Exception as e:
        print(f"Error checking processing status: {e}")
```

### Configuration
- Consider making the limit (5) configurable via command-line arguments or environment variables
- Add filtering options for different time ranges or status types

### Logging
Replace `print` statements with proper logging for production use:

```python
import logging
logging.info(f'Documents with processing status: {len(docs)}')
```

### Documentation Status
Ensure the Document model includes clear documentation of all possible status values (e.g., 'processing', 'completed', 'failed', 'pending').