<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# Hetzner Invoice Force Processing Script

## Purpose

This script is a standalone utility designed to manually force the processing of Hetzner invoices from an inbox folder. It bypasses the normal duplicate detection mechanisms and directly adds the invoices to the processing queue. This is particularly useful for handling edge cases where invoices may have been skipped or need reprocessing.

## Overview

The script operates as a containerized application that:
- Scans a mounted inbox directory for Hetzner invoice PDF files
- Processes each found invoice using the main application's document processing function
- Provides detailed console output showing processing progress and results
- Handles errors gracefully while continuing to process remaining files

## Key Components

### Main Function

#### `force_process_hetzner_invoices()`

```python
async def force_process_hetzner_invoices():
```

**Purpose**: Orchestrates the entire force processing workflow for Hetzner invoices.

**Key Operations**:
- Searches for PDF files matching the pattern `*Hetzner*.pdf` in the inbox
- Lists all discovered files for user confirmation
- Iterates through each file and processes it individually
- Provides progress feedback and error handling for each file

**File Discovery**:
- **Inbox Path**: `/hostfs/Inbox` (mounted host filesystem path)
- **File Pattern**: `*Hetzner*.pdf` (case-sensitive)
- Uses `glob.glob()` for pattern matching

## Configuration

### File System Paths

| Path | Purpose | Notes |
|------|---------|-------|
| `/app` | Application backend path | Added to `sys.path` for module imports |
| `/hostfs/Inbox` | Inbox directory (mounted) | Container mount point for host filesystem |

### Dependencies

- **Internal**: `app.main.process_new_document` - Core document processing function
- **External**: 
  - `asyncio` - Asynchronous execution
  - `glob` - File pattern matching
  - `os` - File system operations

## Usage

### Running the Script

```bash
# Execute directly (if in container)
python3 force_process_hetzner.py

# Or if executable
./force_process_hetzner.py
```

### Expected Output

```
Found 3 Hetzner invoice files:
  - Invoice_Hetzner_2024_01.pdf
  - Invoice_Hetzner_2024_02.pdf
  - Invoice_Hetzner_2024_03.pdf

Starting manual processing of Hetzner invoices...

Processing 1/3: Invoice_Hetzner_2024_01.pdf
‚úÖ Successfully processed: Invoice_Hetzner_2024_01.pdf

Processing 2/3: Invoice_Hetzner_2024_02.pdf
‚ùå Error processing Invoice_Hetzner_2024_02.pdf: Invalid PDF format

Processing 3/3: Invoice_Hetzner_2024_03.pdf
‚úÖ Successfully processed: Invoice_Hetzner_2024_03.pdf

Completed processing 3 Hetzner invoices.
```

## Error Handling

- **File Not Found**: Script gracefully handles cases where no Hetzner files are found
- **Processing Errors**: Individual file processing errors are caught and reported without stopping the entire process
- **Import Errors**: Will fail fast if required modules cannot be imported

## Notes and Considerations

### ‚ö†Ô∏è Important Warnings

- **Bypass Duplicate Detection**: This script intentionally bypasses duplicate detection mechanisms
- **Direct Queue Addition**: Files are added directly to the processing queue without normal validation
- **Container Dependency**: Requires running within the application container environment

### üîß Suggestions for Improvement

1. **Add Confirmation Prompt**: Consider adding a user confirmation before processing begins
   ```python
   response = input(f"Process {len(hetzner_files)} files? (y/N): ")
   if response.lower() != 'y':
       return
   ```

2. **Logging Integration**: Replace print statements with proper logging
   ```python
   import logging
   logger = logging.getLogger(__name__)
   ```

3. **Configuration File**: Move hardcoded paths to a configuration file
4. **Dry Run Mode**: Add option to preview files without processing
5. **Filter by Date**: Add date range filtering for selective processing

### üêõ Potential Issues

- **Path Dependencies**: Hardcoded paths may not work in different deployment environments
- **Memory Usage**: Processing large numbers of files simultaneously may cause memory issues
- **No Rollback**: No mechanism to undo processing if errors occur

### üìã Prerequisites

- Application must be running in container environment
- `/hostfs/Inbox` directory must be properly mounted
- Required permissions to read PDF files and write to processing queues
- Main application modules must be available and functional