<!-- Auto-generated by Claude on 2025-06-01 10:12 -->

# FastAPI Document Processing Application

## Overview

This Python file appears to be the main application module for a FastAPI-based document processing system. The application provides a comprehensive solution for document management, user authentication, tenant management, and automated document processing using AI/ML capabilities.

## Purpose

The application serves as a multi-tenant document processing platform that can:
- Handle document uploads and management
- Process documents using Vision AI and LLM technologies
- Manage users and tenants with authentication
- Apply processing rules to documents automatically
- Extract tenant information from documents
- Provide version information and history

## Key Components

### Core Framework
- **FastAPI**: Main web framework for building the REST API
- **SQLAlchemy**: Database ORM for data persistence
- **Pydantic**: Data validation and serialization
- **Uvicorn**: ASGI server for running the application

### Authentication & Security
- **HTTPBearer**: Token-based authentication system
- Custom authentication modules for:
  - Token creation and verification
  - Password hashing and verification
  - User management

### Document Processing Pipeline
The application includes several specialized services:

- **DocumentService**: Core document management operations
- **VisionAnalyzer**: AI-powered document analysis using computer vision
- **TenantExtractor**: Extracts tenant information from documents
- **TenantAutoAssigner**: Automatically assigns documents to appropriate tenants
- **DocumentRuleProcessor**: Applies business rules to documents
- **RuleRepository**: Manages processing rules

### Data Models

The application uses the following main entities:
- **Document**: Core document entity
- **User**: User management
- **Tenant**: Multi-tenant support
- **ProcessingRule**: Configurable document processing rules

## Important Features

### File Handling
```python
from fastapi import File, UploadFile
from utils import save_uploaded_file, cleanup_temp_files
```
- Supports file uploads with temporary file management
- Automatic cleanup of temporary files
- File serving capabilities with `FileResponse` and `StreamingResponse`

### Background Processing
```python
from fastapi import BackgroundTasks
```
- Supports asynchronous background task processing
- Likely used for document processing workflows

### CORS Support
```python
from fastapi.middleware.cors import CORSMiddleware
```
- Cross-Origin Resource Sharing enabled for web client integration

### Static File Serving
```python
from fastapi.staticfiles import StaticFiles
```
- Serves static files (likely for frontend assets)

## Database Integration

The application uses SQLAlchemy with:
- Database initialization (`init_database`)
- Session management (`get_db`)
- Proper dependency injection for database sessions

## Error Handling

- Custom exception handling for LLM configuration issues
- HTTP exception handling for API errors
- Proper logging system integration

## Version Management

```python
from version import get_version, get_release_info, get_version_history
```
The application includes comprehensive version tracking capabilities.

## Suggestions and Notes

### Best Practices Observed
- ✅ Proper separation of concerns with dedicated service modules
- ✅ Type hints throughout the application
- ✅ Pydantic schemas for request/response validation
- ✅ Context managers for resource management
- ✅ Background task support for long-running operations

### Recommendations
- **Environment Configuration**: Consider using environment-specific configuration files
- **Error Monitoring**: Implement structured error monitoring and alerting
- **API Documentation**: FastAPI automatically generates OpenAPI docs - ensure proper docstrings
- **Testing**: Implement comprehensive unit and integration tests
- **Rate Limiting**: Consider adding rate limiting for API endpoints
- **Caching**: Implement caching for frequently accessed data

### Security Considerations
- Ensure proper input validation for file uploads
- Implement file type restrictions and size limits
- Regular security audits for authentication mechanisms
- Proper tenant isolation in multi-tenant scenarios

## Usage

This appears to be the main application module that would typically be run with:

```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```

The application provides a complete document processing platform with REST API endpoints for all major operations including document management, user authentication, tenant management, and automated document processing workflows.