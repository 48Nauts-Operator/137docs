
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>autodoc src backend app llm py 2025 05 31T16 00 26 - 137docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#llm-integration-module-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="137docs" class="md-header__button md-logo" aria-label="137docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            137docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              autodoc src backend app llm py 2025 05 31T16 00 26
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../placeholder/" class="md-tabs__link">
          
  
  
  AI Docs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="137docs" class="md-nav__button md-logo" aria-label="137docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    137docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AI Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            AI Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../placeholder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Placeholder
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llmservice" class="md-nav__link">
    <span class="md-ellipsis">
      LLMService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLMService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#constructor" class="md-nav__link">
    <span class="md-ellipsis">
      Constructor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Core Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_config-dictstr-any" class="md-nav__link">
    <span class="md-ellipsis">
      get_config() -&gt; Dict[str, Any]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_enabled-bool" class="md-nav__link">
    <span class="md-ellipsis">
      is_enabled() -&gt; bool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#is_configured-bool" class="md-nav__link">
    <span class="md-ellipsis">
      is_configured() -&gt; bool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-processing-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Document Processing Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Document Processing Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract_metadatatext-str-max_attempts-optionalint-none-target_score-float-06-task_type-str-enricher-dictstr-any" class="md-nav__link">
    <span class="md-ellipsis">
      extract_metadata(text: str, *, max_attempts: Optional[int] = None, target_score: float = 0.6, task_type: str = 'enricher') -&gt; Dict[str, Any]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze_documenttext-str-dictstr-any" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_document(text: str) -&gt; Dict[str, Any]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggest_tagstext-str-liststr" class="md-nav__link">
    <span class="md-ellipsis">
      suggest_tags(text: str) -&gt; List[str]
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-and-diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      Testing and Diagnostics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing and Diagnostics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test_connectionprovider-str-api_url-optionalstr-none-api_key-optionalstr-none-dictstr-any" class="md-nav__link">
    <span class="md-ellipsis">
      test_connection(provider: str, api_url: Optional[str] = None, api_key: Optional[str] = None) -&gt; Dict[str, Any]
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-methods" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Methods
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Internal Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llm-communication" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Communication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLM Communication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_query_llmprompt-str-task_type-str-enricher-str" class="md-nav__link">
    <span class="md-ellipsis">
      _query_llm(prompt: str, task_type: str = 'enricher') -&gt; str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_query_ollama_directprompt-str-api_url-str-model-str-str" class="md-nav__link">
    <span class="md-ellipsis">
      _query_ollama_direct(prompt: str, api_url: str, model: str) -&gt; str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_query_generic_llm_directprompt-str-api_url-str-api_key-optionalstr-model-str-str" class="md-nav__link">
    <span class="md-ellipsis">
      `_query_generic_llm_direct(prompt: str, api_url: str, api_key: Optional[str], model: str) -&gt; str
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<!--
This documentation was auto-generated by Claude on 2025-05-31T16-00-26.
Source file: ./src/backend/app/llm.py
-->

<h1 id="llm-integration-module-documentation">LLM Integration Module Documentation<a class="headerlink" href="#llm-integration-module-documentation" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The LLM Integration module provides a comprehensive service for interacting with Large Language Models (LLMs) for document metadata extraction, content analysis, and automated tagging. It supports multiple LLM providers including local Ollama instances, OpenAI, Anthropic, LiteLLM, and custom endpoints.</p>
<h2 id="key-features">Key Features<a class="headerlink" href="#key-features" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Multi-provider Support</strong>: Compatible with Ollama, OpenAI, Anthropic, LiteLLM, and custom API endpoints</li>
<li><strong>Intelligent Metadata Extraction</strong>: Iterative extraction with heuristic enrichment for improved accuracy</li>
<li><strong>Document Analysis</strong>: Automated content analysis including sentiment, entities, and key points</li>
<li><strong>Auto-tagging</strong>: Intelligent document categorization and tag suggestion</li>
<li><strong>Configuration Management</strong>: Database-backed configuration with environment variable fallbacks</li>
<li><strong>Connection Testing</strong>: Built-in testing capabilities with detailed debugging</li>
<li><strong>Caching</strong>: Configuration caching and response caching for improved performance</li>
</ul>
<h2 id="classes">Classes<a class="headerlink" href="#classes" title="Permanent link">&para;</a></h2>
<h3 id="llmservice">LLMService<a class="headerlink" href="#llmservice" title="Permanent link">&para;</a></h3>
<p>The main service class for LLM interactions with comprehensive configuration support.</p>
<h4 id="constructor">Constructor<a class="headerlink" href="#constructor" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">LLMService</span><span class="p">(</span><span class="n">db_session</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AsyncSession</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Parameters:</strong>
- <code>db_session</code>: Optional database session for configuration management</p>
<h4 id="core-methods">Core Methods<a class="headerlink" href="#core-methods" title="Permanent link">&para;</a></h4>
<h5 id="configuration-methods">Configuration Methods<a class="headerlink" href="#configuration-methods" title="Permanent link">&para;</a></h5>
<h6 id="get_config-dictstr-any"><code>get_config() -&gt; Dict[str, Any]</code><a class="headerlink" href="#get_config-dictstr-any" title="Permanent link">&para;</a></h6>
<p>Retrieves LLM configuration from database with 5-minute caching fallback to environment variables.</p>
<p><strong>Returns:</strong>
- Dictionary containing complete LLM configuration</p>
<p><strong>Configuration Keys:</strong>
- <code>provider</code>: LLM provider type ('local', 'openai', 'anthropic', 'litellm', 'custom')
- <code>api_url</code>: API endpoint URL
- <code>api_key</code>: API authentication key
- <code>model_*</code>: Model names for different tasks (tagger, enricher, analytics, responder)
- <code>enabled</code>: Whether LLM features are enabled
- <code>auto_tagging</code>: Enable automatic tag suggestion
- <code>auto_enrichment</code>: Enable automatic content enrichment
- <code>max_retries</code>: Maximum retry attempts for failed requests
- <code>retry_delay</code>: Delay between retry attempts (seconds)
- <code>batch_size</code>: Batch processing size
- <code>concurrent_tasks</code>: Maximum concurrent processing tasks
- <code>min_confidence_*</code>: Minimum confidence thresholds</p>
<h6 id="is_enabled-bool"><code>is_enabled() -&gt; bool</code><a class="headerlink" href="#is_enabled-bool" title="Permanent link">&para;</a></h6>
<p>Checks if LLM features are globally enabled.</p>
<p><strong>Returns:</strong>
- Boolean indicating if LLM features are active</p>
<h6 id="is_configured-bool"><code>is_configured() -&gt; bool</code><a class="headerlink" href="#is_configured-bool" title="Permanent link">&para;</a></h6>
<p>Validates if LLM service has proper configuration for the selected provider.</p>
<p><strong>Returns:</strong>
- Boolean indicating if configuration is valid and complete</p>
<h5 id="document-processing-methods">Document Processing Methods<a class="headerlink" href="#document-processing-methods" title="Permanent link">&para;</a></h5>
<h6 id="extract_metadatatext-str-max_attempts-optionalint-none-target_score-float-06-task_type-str-enricher-dictstr-any"><code>extract_metadata(text: str, *, max_attempts: Optional[int] = None, target_score: float = 0.6, task_type: str = 'enricher') -&gt; Dict[str, Any]</code><a class="headerlink" href="#extract_metadatatext-str-max_attempts-optionalint-none-target_score-float-06-task_type-str-enricher-dictstr-any" title="Permanent link">&para;</a></h6>
<p>Extracts structured metadata from document text using iterative LLM calls with heuristic enrichment.</p>
<p><strong>Parameters:</strong>
- <code>text</code>: Document text content to analyze
- <code>max_attempts</code>: Maximum number of extraction attempts (defaults to config value)
- <code>target_score</code>: Target completeness score (0.0-1.0) to achieve
- <code>task_type</code>: Type of processing task for model selection</p>
<p><strong>Returns:</strong>
- Dictionary containing extracted metadata fields</p>
<p><strong>Extracted Fields:</strong>
- <code>title</code>: Document title
- <code>document_type</code>: Type classification (invoice, contract, letter, etc.)
- <code>sender</code>: Document sender/issuer
- <code>recipient</code>: Document recipient
- <code>document_date</code>: Document date (ISO format: YYYY-MM-DD)
- <code>due_date</code>: Due date if applicable (ISO format)
- <code>amount</code>: Total amount including VAT
- <code>subtotal</code>: Amount excluding VAT
- <code>tax_rate</code>: VAT rate percentage
- <code>tax_amount</code>: VAT amount
- <code>currency</code>: ISO currency code (CHF, EUR, USD)
- <code>status</code>: Document status (paid, unpaid, pending)
- Address fields: <code>street</code>, <code>address2</code>, <code>zip</code>, <code>town</code>, <code>county</code>, <code>country</code>
- Contact fields: <code>sender_email</code>, <code>phone</code>
- <code>tags</code>: Relevant document tags</p>
<p><strong>Process:</strong>
1. Sends extraction prompt to LLM
2. Parses JSON response
3. Applies heuristic enrichment using regex patterns
4. Scores completeness against target
5. Retries with focused prompts for missing fields if needed</p>
<h6 id="analyze_documenttext-str-dictstr-any"><code>analyze_document(text: str) -&gt; Dict[str, Any]</code><a class="headerlink" href="#analyze_documenttext-str-dictstr-any" title="Permanent link">&para;</a></h6>
<p>Performs comprehensive document content analysis.</p>
<p><strong>Parameters:</strong>
- <code>text</code>: Document text content</p>
<p><strong>Returns:</strong>
- Dictionary containing analysis results:
  - <code>summary</code>: Brief document summary (max 100 words)
  - <code>key_points</code>: List of important information
  - <code>entities</code>: Named entities (people, organizations, locations)
  - <code>sentiment</code>: Overall sentiment (positive, negative, neutral)
  - <code>action_items</code>: Required actions or tasks</p>
<h6 id="suggest_tagstext-str-liststr"><code>suggest_tags(text: str) -&gt; List[str]</code><a class="headerlink" href="#suggest_tagstext-str-liststr" title="Permanent link">&para;</a></h6>
<p>Generates relevant tags for document categorization.</p>
<p><strong>Parameters:</strong>
- <code>text</code>: Document text content</p>
<p><strong>Returns:</strong>
- List of 3-5 suggested tags for the document</p>
<h5 id="testing-and-diagnostics">Testing and Diagnostics<a class="headerlink" href="#testing-and-diagnostics" title="Permanent link">&para;</a></h5>
<h6 id="test_connectionprovider-str-api_url-optionalstr-none-api_key-optionalstr-none-dictstr-any"><code>test_connection(provider: str, api_url: Optional[str] = None, api_key: Optional[str] = None) -&gt; Dict[str, Any]</code><a class="headerlink" href="#test_connectionprovider-str-api_url-optionalstr-none-api_key-optionalstr-none-dictstr-any" title="Permanent link">&para;</a></h6>
<p>Tests connectivity to LLM provider with detailed debugging information.</p>
<p><strong>Parameters:</strong>
- <code>provider</code>: Provider type to test
- <code>api_url</code>: Optional API URL override
- <code>api_key</code>: Optional API key override</p>
<p><strong>Returns:</strong>
- Dictionary with test results:
  - <code>status</code>: 'success' or 'error'
  - <code>message</code>: Human-readable result message
  - <code>available_models</code>: List of discoverable models
  - <code>debug_info</code>: Detailed debugging information</p>
<h4 id="internal-methods">Internal Methods<a class="headerlink" href="#internal-methods" title="Permanent link">&para;</a></h4>
<h5 id="llm-communication">LLM Communication<a class="headerlink" href="#llm-communication" title="Permanent link">&para;</a></h5>
<h6 id="_query_llmprompt-str-task_type-str-enricher-str"><code>_query_llm(prompt: str, task_type: str = 'enricher') -&gt; str</code><a class="headerlink" href="#_query_llmprompt-str-task_type-str-enricher-str" title="Permanent link">&para;</a></h6>
<p>Routes LLM queries to appropriate provider endpoint based on configuration.</p>
<h6 id="_query_ollama_directprompt-str-api_url-str-model-str-str"><code>_query_ollama_direct(prompt: str, api_url: str, model: str) -&gt; str</code><a class="headerlink" href="#_query_ollama_directprompt-str-api_url-str-model-str-str" title="Permanent link">&para;</a></h6>
<p>Direct communication with Ollama API using native format.</p>
<h6 id="_query_generic_llm_directprompt-str-api_url-str-api_key-optionalstr-model-str-str">`_query_generic_llm_direct(prompt: str, api_url: str, api_key: Optional[str], model: str) -&gt; str<a class="headerlink" href="#_query_generic_llm_directprompt-str-api_url-str-api_key-optionalstr-model-str-str" title="Permanent link">&para;</a></h6>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.top", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>