
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>autodoc src backend fix tenant automation py 2025 05 31T15 57 05 - 137docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tenant-automation-fix-script" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="137docs" class="md-header__button md-logo" aria-label="137docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            137docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              autodoc src backend fix tenant automation py 2025 05 31T15 57 05
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../placeholder/" class="md-tabs__link">
          
  
  
  AI Docs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="137docs" class="md-nav__button md-logo" aria-label="137docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    137docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AI Docs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            AI Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../placeholder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Placeholder
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    <span class="md-ellipsis">
      Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Script Functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Script Functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-components" class="md-nav__link">
    <span class="md-ellipsis">
      Main Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Main Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-connection" class="md-nav__link">
    <span class="md-ellipsis">
      Database Connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity-management" class="md-nav__link">
    <span class="md-ellipsis">
      Entity Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Document Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assignment-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Assignment Rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Processing Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fix_tenant_automation" class="md-nav__link">
    <span class="md-ellipsis">
      fix_tenant_automation()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-format" class="md-nav__link">
    <span class="md-ellipsis">
      Output Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema Requirements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema Requirements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#document-table" class="md-nav__link">
    <span class="md-ellipsis">
      Document Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity-table" class="md-nav__link">
    <span class="md-ellipsis">
      Entity Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    <span class="md-ellipsis">
      Customization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Security Notes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<!--
This documentation was auto-generated by Claude on 2025-05-31T15-57-05.
Source file: ./src/backend/fix_tenant_automation.py
-->

<h1 id="tenant-automation-fix-script">Tenant Automation Fix Script<a class="headerlink" href="#tenant-automation-fix-script" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>This script fixes tenant automation by automatically assigning documents to matching tenants based on content analysis and predefined rules. It identifies problematic documents that lack proper tenant assignment and applies intelligent matching logic to associate them with the appropriate entities.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Python 3.7+</li>
<li>SQLAlchemy with async support</li>
<li>aiosqlite for SQLite async operations</li>
<li>Access to the application models (<code>Document</code> and <code>Entity</code>)</li>
</ul>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>Ensure the following dependencies are installed:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>pip<span class="w"> </span>install<span class="w"> </span>sqlalchemy<span class="o">[</span>asyncio<span class="o">]</span><span class="w"> </span>aiosqlite
</code></pre></div></td></tr></table></div>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Run the script directly from the command line:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>python3<span class="w"> </span>fix_tenant_automation.py
</code></pre></div></td></tr></table></div>
<h2 id="script-functionality">Script Functionality<a class="headerlink" href="#script-functionality" title="Permanent link">&para;</a></h2>
<h3 id="main-components">Main Components<a class="headerlink" href="#main-components" title="Permanent link">&para;</a></h3>
<h4 id="database-connection">Database Connection<a class="headerlink" href="#database-connection" title="Permanent link">&para;</a></h4>
<ul>
<li>Creates an async SQLite engine using <code>aiosqlite</code></li>
<li>Connects to <code>./documents.db</code></li>
<li>Uses SQLAlchemy's async session management</li>
</ul>
<h4 id="entity-management">Entity Management<a class="headerlink" href="#entity-management" title="Permanent link">&para;</a></h4>
<ul>
<li>Retrieves all available entities from the database</li>
<li>Creates a lookup dictionary for efficient entity matching</li>
<li>Displays available entities with their IDs, aliases, and names</li>
</ul>
<h4 id="document-processing">Document Processing<a class="headerlink" href="#document-processing" title="Permanent link">&para;</a></h4>
<ul>
<li>Identifies problematic documents with missing or invalid recipient information</li>
<li>Targets documents where <code>recipient</code> is:</li>
<li><code>NULL</code></li>
<li>Empty string</li>
<li>"Your Company"</li>
<li>"Unknown"</li>
</ul>
<h3 id="assignment-rules">Assignment Rules<a class="headerlink" href="#assignment-rules" title="Permanent link">&para;</a></h3>
<p>The script applies intelligent assignment logic based on content analysis:</p>
<table>
<thead>
<tr>
<th>Rule</th>
<th>Trigger Conditions</th>
<th>Target Entity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Rule 1</strong></td>
<td>"google" in sender, title, or content</td>
<td>Google entity</td>
<td>Google service documents</td>
</tr>
<tr>
<td><strong>Rule 2</strong></td>
<td>"andr√©", "personal", "medical", or "insurance" keywords</td>
<td>Personal entity</td>
<td>Personal/medical documents</td>
</tr>
<tr>
<td><strong>Rule 3</strong></td>
<td>"test company", "office", "rent", or "test corp" keywords</td>
<td>Test Corp entity</td>
<td>Company/business documents</td>
</tr>
</tbody>
</table>
<h3 id="processing-workflow">Processing Workflow<a class="headerlink" href="#processing-workflow" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>graph TD
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    A[Start] --&gt; B[Load Entities]
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    B --&gt; C[Find Problematic Documents]
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>    C --&gt; D[Apply Assignment Rules]
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    D --&gt; E[Generate Assignments]
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>    E --&gt; F[Update Documents]
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>    F --&gt; G[Commit Changes]
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>    G --&gt; H[Display Results]
</code></pre></div></td></tr></table></div>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<h3 id="fix_tenant_automation"><code>fix_tenant_automation()</code><a class="headerlink" href="#fix_tenant_automation" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong>: Main function that orchestrates the tenant assignment process.</p>
<p><strong>Parameters</strong>: None</p>
<p><strong>Returns</strong>: None</p>
<p><strong>Process</strong>:
1. Establishes database session
2. Loads all entities into memory
3. Queries for problematic documents
4. Applies assignment rules based on content analysis
5. Updates document records with new tenant assignments
6. Commits changes to database
7. Provides detailed output of operations performed</p>
<h2 id="output-format">Output Format<a class="headerlink" href="#output-format" title="Permanent link">&para;</a></h2>
<p>The script provides comprehensive console output:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>üîß Fixing Tenant Automation
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>========================================
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>üë• Available Entities:
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>  1: Google (Google Services)
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>  2: Personal (Personal Documents)
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>  3: Test Corp (Test Corporation)
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>üìÑ Found 15 documents to fix:
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>  üìÑ Google Drive Notification        ‚Üí Google (Google service detected)
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>  üìÑ Medical Insurance Form           ‚Üí Personal (Personal document detected)
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>  üìÑ Office Rent Agreement           ‚Üí Test Corp (Company document detected)
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>  ‚ùì Unknown Document                 ‚Üí No assignment found
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>üéØ Applying 12 assignments...
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>  ‚úÖ Google Drive Notification ‚Üí Google
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>  ‚úÖ Medical Insurance Form ‚Üí Personal
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>  ‚úÖ Office Rent Agreement ‚Üí Test Corp
<a id="__codelineno-3-18" name="__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>‚úÖ Tenant automation fixed!
<a id="__codelineno-3-20" name="__codelineno-3-20"></a>   üìä 12 documents assigned to tenants
<a id="__codelineno-3-21" name="__codelineno-3-21"></a>   üéØ 3 documents still need manual review
</code></pre></div></td></tr></table></div>
<h2 id="database-schema-requirements">Database Schema Requirements<a class="headerlink" href="#database-schema-requirements" title="Permanent link">&para;</a></h2>
<p>The script expects the following database structure:</p>
<h3 id="document-table">Document Table<a class="headerlink" href="#document-table" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="o">-</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="k">Primary</span><span class="w"> </span><span class="k">key</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="o">-</span><span class="w"> </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">title</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="o">-</span><span class="w"> </span><span class="n">content</span><span class="p">:</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">content</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="o">-</span><span class="w"> </span><span class="n">sender</span><span class="p">:</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">sender</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="o">-</span><span class="w"> </span><span class="n">recipient</span><span class="p">:</span><span class="w"> </span><span class="n">Document</span><span class="w"> </span><span class="n">recipient</span><span class="w"> </span><span class="p">(</span><span class="n">updated</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">script</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="o">-</span><span class="w"> </span><span class="n">entity_id</span><span class="p">:</span><span class="w"> </span><span class="k">Foreign</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Entity</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="p">(</span><span class="n">updated</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">script</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="entity-table">Entity Table<a class="headerlink" href="#entity-table" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="o">-</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="k">Primary</span><span class="w"> </span><span class="k">key</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Entity</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="n">name</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="o">-</span><span class="w"> </span><span class="k">alias</span><span class="p">:</span><span class="w"> </span><span class="n">Entity</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">name</span><span class="o">/</span><span class="k">alias</span>
</code></pre></div></td></tr></table></div>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<ul>
<li>Uses SQLAlchemy's transaction management with automatic rollback on errors</li>
<li>Async context managers ensure proper resource cleanup</li>
<li>Path configuration handles module imports from different locations</li>
</ul>
<h2 id="customization">Customization<a class="headerlink" href="#customization" title="Permanent link">&para;</a></h2>
<p>To modify assignment rules, update the logic in the <code>fix_tenant_automation()</code> function:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># Add new rule</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">elif</span> <span class="s2">&quot;new_keyword&quot;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span class="n">assigned_entity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">alias</span> <span class="o">==</span> <span class="s2">&quot;New Entity&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="n">reason</span> <span class="o">=</span> <span class="s2">&quot;New rule applied&quot;</span>
</code></pre></div></td></tr></table></div>
<h2 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">&para;</a></h2>
<ul>
<li>Loads all entities into memory for efficient lookup</li>
<li>Uses async operations for database queries</li>
<li>Batch commits changes after processing all assignments</li>
<li>Content analysis performed in-memory to minimize database calls</li>
</ul>
<h2 id="security-notes">Security Notes<a class="headerlink" href="#security-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>Database connection uses local SQLite file</li>
<li>No external network connections required</li>
<li>Operates on existing data without exposing sensitive information</li>
<li>Uses parameterized queries through SQLAlchemy ORM</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.top", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>